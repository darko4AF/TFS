<!DOCTYPE html>
<html>
<!--
Copyright 2010 by Dan Fabulich.

Dan Fabulich licenses this file to you under the
ChoiceScript License, Version 1.0 (the "License"); you may
not use this file except in compliance with the License. 
You may obtain a copy of the License at

 http://www.choiceofgames.com/LICENSE-1.0.txt

See the License for the specific language governing
permissions and limitations under the License.

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied.
-->
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0">
<!-- INSERT correct meta values -->
<!-- <title>TFS Book Two Alpha</title> -->

<script>window.version="UNKNOWN"</script>





<style id="dynamic"></style>






<!--[if IE 6]><style>.alertify-logs { position: absolute; }</style><![endif]-->
<meta name="apple-mobile-web-app-capable" content="yes" />
<script>
// INSERT store name; disabled by default because it's confusing for newbie authors
window.storeName = "TFSBookTwoAlpha"
//Scene.generatedFast = true;
var rootDir = "../";
</script><script>allScenes = {"startup": {"crc":-1405399616, "lines":["*title TFS Book Two Alpha","*author Aelsa Trevelyan","*scene_list","    preintro","    intro","    chap01","    chap02","    ","*comment Fernweh Saga: Book One Variables/Stats","","*comment MC Variables","*create name \" \"","*create surname \" \"","*create gender \"Unknown\" ","*create pc_he \"he\"","*create pc_him \"him\"","*create pc_his \"his\"","*create pc_hiss \"his\" ","*create pc_man \"man\"","*create pc_boy \"boy\"","*create pc_sir \"mister\"","*create is \"is\" ","*create was \"was\"","*create pc_son \"son\"","*create pc_nickname false","*create nickname \" \"","*create mc_plural false","","*create pc_hair_style \" \"","*create pc_hair_color \" \" ","*create pc_hair_dyed \" \"","*create pc_natural_hair_color \" \"","*create pc_dyed_hair_color \" \"","*create pc_eye_color \" \"","*create pc_height \" \"","*create pc_injuries \"None\" ","*create room_theme \" \"","*create pc_role \" \" "," ","*create attraction \"Unknown\""," ","*create attire \" \" ","*create top \" \" ","*create bottom \" \"","","*comment Grandfather Variables","*create grandfather_name \" \"","*create grandfather_nickname \" \"","*create grandfather_relationship 50","*create grandfather_eyes \" \"","*create grandfather_eyes_feel \" \"","","*comment Personality Variables","*create sincerity 50","*create optimistic 50","*create merciful 50","*create reckless 50","*create friendly 50","*create cooperative 50","*create flirtatious 50 ","*create heart 50","*create resistance 50","*create believer 50","","*comment Character Pronouns","*create reese \" \"","*create r_him \" \"","*create r_his \" \"","*create r_man \" \"","*create r_she \" \"","*create r_mister \" \"","*create r_son \" \"","*create r_hiss \" \"","*create r_blond \" \"","","*create beckett \" \"","*create b_him \" \"","*create b_his \" \"","*create b_man \" \"","*create b_she \" \"","*create b_hiss \" \"","","*create james \" \"","*create j_him \" \"","*create j_his \" \"","*create j_man \" \"","*create j_she \" \"","*create j_sir \" \"","*create j_hiss \" \"","*create j_mister \" \"","*create j_brother \" \"","","*create silas \" \"","*create s_him \" \"","*create s_his \" \"","*create s_man \" \"","*create s_she \" \"","*create s_hiss \" \"","","*create malachi \" \"","*create waiter \" \"","*create w_him \" \"","*create w_his \" \"","*create w_man \" \"","*create w_she \" \"","*create w_hiss \" \"","*create w_brunet \" \"","","*create alex \" \"","*create a_gender \" \"","*create a_their \" \"","*create a_them \" \"","*create a_they \" \"","*create a_theirs \" \"","*create a_person \" \"","*create a_sibling \" \"","*create a_are \" \"","*create a_have \" \"","*create a_were \" \"","*create a_plural false","","*create charles \" \"","*create c_him \" \"","*create c_his \" \"","*create c_man \" \"","*create c_she \" \"","*create c_mister \" \"","*create c_son \" \"","*create c_hiss \" \"","","*comment Character Dynamics Variables ","*create reese_friendship 50","*create beckett_friendship 50","*create james_friendship 50","*create silas_friendship 50","*create reese_romance \" \"","*create beckett_romance \" \"","*create james_romance \" \"","*create silas_romance \" \"","","*create alex_past \" \"","*create alex_friendship 50","*create alex_strained \" \"","*create alex_crush \"false\"","*create alex_crush_b \"false\"","*create flirt_alex_mc 0","*create flirt_alex_b 0","*create ba_crush_reaction \" \"","*create reject_alex_mc 0","*create alex_crush_b_i \"false\"","*create flirt_alex_b_i 0","*create bai_crush_reaction \" \"","","*create waiter_friendship 50","*create waiter_flirt 0","*create mal_romance \" \"","*create w_hint \" \"","*create w_number_name \" \"","*create w_letter_known \"false\"","*create w_number_hand \" \"","*create w_mal_nn false","*create w_2nd_letter \" \" ","*create m_name_known \" \" ","*create w_meet_official \" \"","*create w_perception \" \"","","*create msv_relationship 50","","*create charles_friendship 50","","*create canine_trust 50","","*create reese_romance_number 0","*create beckett_romance_number 0","*create james_romance_number 0","*create silas_romance_number 0","*create  jr_romance_number 0","","*create beckett_romanceable \" \"","*create silas_romanceable \" \"","*create reese_romanceable \" \"","*create james_romanceable \" \"","","*create s_nickname false","*create snickname_check \" \" ","","*create denial_r_ro 0","","*comment Character Stat Screen Info","*create physical_attribute \"false\"","","*create status_r \"alive\"","*create status_b \"alive\"","*create status_j \"alive\"","*create status_s \"alive\" ","*create status_m \"alive\"","","*create beckett_desc_1 \" \"","*create beckett_desc_2 \" \"","*create beckett_desc_3 \" \"","*create beckett_romance_desc \"false\"","","*create silas_desc_1 \" \"","*create silas_desc_2 \" \"","*create silas_desc_3 \" \"","*create silas_romance_desc \"false\"","","*create reese_desc_1 \" \"","*create reese_desc_2 \" \"","*create reese_desc_3 \" \"","*create reese_romance_desc \"false\"","","*create james_desc_1 \" \"","*create james_desc_2 \" \"","*create james_desc_3 \" \"","*create james_romance_desc \"false\"","","*create jr_romance_desc \"false\" ","","*create alex_desc_1 \" \"","*create alex_desc_2 \" \"","*create alex_desc_3 \" \"","","*create waiter_desc_1 \" \"","*create waiter_desc_2 \" \"","*create waiter_desc_3 \" \"","*create waiter_romance_desc \"false\"","","*create msv_desc_1 \" \"","*create msv_desc_2 \" \"","*create msv_desc_3 \" \"","","*create dog_desc_1 \" \"","*create dog_desc_2 \" \"","*create dog_desc_3 \" \"","","*create b_meet \"false\"","*create s_meet \"false\"","*create r_meet \"false\"","*create j_meet \"false\"","*create w_meet \"false\"","*create a_meet \"false\" ","*create dog_meet \"false\" ","*create msv_meet \"false\" ","","*create role_b \"visitor\"","*create role_r \"socialite\"","*create role_j \"detective\"","*create role_s \"scholar\"","*create role_m \"server\"","","*create reese_friendship_text \" \"","*create beckett_friendship_text \" \"","*create james_friendship_text \" \"","*create silas_friendship_text \" \"","*create waiter_friendship_text \" \"","*create alex_friendship_text \" \"","*create dog_friendship_text \" \"","*create msv_friendship_text \" \"","","*create reese_romance_text \"\u2026\"","*create beckett_romance_text \"\u2026\"","*create james_romance_text \"\u2026\"","*create silas_romance_text \"\u2026\"","*create waiter_romance_text \"\u2026\" ","*create jr_romance_text \"\u2026\"","","*comment Skills Variables ","*create retrocognition 10 ","*create empathetic_impressions 10","*create extrasensory_awareness 10","*create primary_skill \" \"","*create primary_ei \" \"","*create primary_rc \" \"","*create primary_ea \" \"","*create primary_skill_text \" \"","*create dagger_reaction_text \" \"","*create receptive 50","*create past_affinity_specific \" \"","*create past_affinity_text \" \" ","*create past_susceptibility_text \" \" ","","*create combat 50","","*comment Introduction Variables","*create baby_deer_road \" \"","","*comment Chapter 1 Variables","*create rt1 \" \"","*create rt2 \" \"","*create potential_abandoniss 0","*create why_sent_away \" \"","*create i_see_you \" \"","","*comment Chapter 2 Variables ","*create diner_meal \" \"","*create rsvp_memo \" \"","*create marj_meet_1 \" \"","","*comment Chapter 3 Variables ","*create meet_n_greet \" \"","*create monument_pic \" \"","*create monument_pic_emo \"none\"","*create candle_memo \" \"","*create lantern_fire \" \"","*create light_receiver \" \"","*create plate_preview \" \"","*create emotion_mare_1 \" \"","*create strikes_mare_1 0","*create mrs_dorran_s_pic \"none\"","","*comment Chapter 4 Variables","*create j_dishonest \" \"","*create not_garfield \" \"","*create bathroom_check \" \"","*create feed_puppy \" \"","*create past_affinity \" \" ","*create search_walk  \" \"","*create grandfather_gift \" \"","*create cake_flavor \" \"","*create past_comp \" \"","","*comment Chapter 6 Variables","*create cookie_preference \" \"","*create drink_choice \" \"","*create drink_choice_known \"false\" ","*create flower_choice \" \"","*create b_check_in_1 \" \"","*create jour_feel_1 \" \"","*create past_crush \" \"","*create first_kiss \" \"","*create w_continuity_stats \" \"","*create get_waiter_number \" \"","*create playdate_pick \" \"","*create letter_guess \" \"","*create guess_attempt \"none\"","","*comment Chapter 7 Variables","*create diner_seat \" \"","*create coroner_pick \" \"","*create coroner_death_rxn \" \"","*create stay_promise_b \"false\"","*create destination_info1 \" \"","*create w_name_progression \" \"","*create r_memory_lib \" \"","*create judith_interaction \" \"","","*comment Chapter 8 Variables ","*create see_home_opinion \" \"","*create mare3_guest \" \"","*create mare3_touch \" \"","*create mare3_specific_act \" \"","*create questionable_interest 0","*create mare3_extra_guest \"none\"","*create strikes_mare3_lid 0","*create childhood_home \" \"","","*comment Chapter 9 Variables ","*create pun_opinion \" \"","*create feelings_s_reveal \" \"","*create jealous_ask_rcat \"false\"","*create reese_tp_departure \" \"","*create w_sidewalk_interest  \"false\"","*create r_proposition \"none\"","","*comment Chapter 10 Variables","*create mechanic_decor \" \"","*create named_dog \"false\"","*create box_delivery \" \"","*create found_dagger \"false\"","*create bn_driver \" \"","*create dog_name \" \"","*create name_help \"unknown\"","*create r_prank_1 \"none\"","*create woods_watch_share \" \"","*create s_nickname_ask_again \" \" ","","","*comment Chapter 11 Variables ","*create call_for_backup  \" \"","*create b_handhold_fore \"nope\"","*create s_handhold_fore \"nope\"","*create forest_pick \" \"","","*create deer_reaction \" \"","*create deer_guilt \" \"","*create baby_bambi \" \"","*create investigate_pod \" \"","*create sprig_convo_1 \"none\"","","*create when_did_flee \"none\"","*create solo_vine \" \"","*create vines_multi \" \"","","*create alcohol_pref \" \"","","*create tree_trunk_buddy \" \"","","*create sprig_pick \" \"","*create b_ily_clearing \" \"","*create sprig_moment \" \"","*create milton_status \" \"","*create r_arm_injury \" \"","*create sprig_death \" \"","*create sprig_kill_method \" \"","*create mc_kill_sprig \" \"","*create past_susceptibility \"Hazy\"","*create milton_knowledge \" \"","*create ms_v_hardened 50","*create ms_v_ring \" \"","*create msv_loyalty_1 \" \"","","*create combative_stat \"false\"","","*comment Chapter 12 Variables","*create dog_ownership \" \"","*create dagger_kept \" \"","*create candle_status \" \"","*create friendship_necklace_style \" \"","*create friendship_necklace_j \" \"","*create friendship_bracelet_b \" \"","*create letters_exchange \" \"","*create r_cat_interest \" \"","*create mal_kissed \"not kissed\"","*create mention_a \"false\"","*create book_willingness \" \"","*create milton_injury \" \"","","*create mc_scar_1 \"none\"","*create mc_scar_2 \"none\"","","*comment Chapter 13 Variables ","*create r_handshake \" \"","*create deer_visitor \" \"","*create b_kiss \" \"","*create j_guilt \" \"","*create jr_hug \" \"","*create j_hug \" \"","*create s_return_visit \" \"","*create dog_toy \"none\"","*create b_playlist_mention \"none\"","","*create bonus_verse \"false\"","","*create townline_pick \" \"","*create leave_opinion \" \"","*create venture_line \" \"","*create steps_townline \" \"","*create stuck_pick \" \"","*create mc_stuck \" \"","","*comment Inventory Slots ","*create inventory_slot_1_text \" \"","*create Inventory_slot_2_text \" \"","*create inventory_slot_3_text\" \"","*create Inventory_slot_4_text \" \"","*create inventory_slot_5_text \" \"","*create Inventory_slot_6_text \" \"","*create inventory_slot_65_text \" \"","*create inventory_slot_7_text \" \"","*create Inventory_slot_8_text \" \"","","*create inventory_slot_1 \"nothing\"","*create Inventory_slot_2 \"nothing\"","*create inventory_slot_3 \" \"","*create Inventory_slot_4 \" \"","*create inventory_slot_5 \" \"","*create Inventory_slot_6 \" \"","*create inventory_slot_65 \" \"","*create inventory_slot_7 \" \"","*create Inventory_slot_8 \" \"","","*comment Injury Slots","*create injury_slot_1_text \" \"","*create injury_slot_2_text \" \"","*create injury_slot_3_text \" \"","*create injury_slot_4_text \" \"","*create injury_slot_5_text \" \"","*create injury_slot_6_text \" \"","","*create injury_slot_1 \"nothing\"","*create injury_slot_2 \"nothing\"","*create injury_slot_3 \" \"","*create injury_slot_4 \" \"","*create injury_slot_5 \" \"","*create injury_slot_6 \" \"","","*comment Fernweh Saga: Book Two Variables/Stats","","*create alpha_password \" \"","*create alpha_password_1 \" \"","*create alpha_password_2 \" \"","*create alpha_password_3 \" \"","*create alpha_password_4 \" \"","*create alpha_password_5 \" \"","","*create selected_best_friend \"none\"","*create tentative_ro_pick \"none\"","*create first_echo_experience \"false\"","","*comment Introduction Variables","*create polaroid_memory \"false\"","","*comment Chapter 1 Variables","*create j_jam_gift \"false\"","*create ttp_duties \" \"","*create ttp_feelings \" \" ","*create ro_excursion \" \"","*create marj_encounter_1 \" \"","*create w_tailored_nn \" \"","*create ttp_decor \" \"","*create ttp_a_event_1 \"false\"","*create alex_cookies_action \" \"","*create r_nickname \" \"","*create a_walkie_reveal \" \"","*create stronger_batteries \" \"","","*comment Chapter 2 Variables","*create r_kissed \" \"","*create r_kiss_1 \" \"","*create dominant 0","*create b_confidant \" \"","","*comment Doppel Variables ","*create doppel_friendship 50","*create doppel \" \"","*create doppel_grudge 0","*create doppel_crush \" \"","*create doppel_heartbreak 50","","*comment Achievement Variable ","*create achievement_preference \"enabled\"","","*comment Achievements Listing (Yes, I will add these later.) ","","","*finish"], "labels":{}},
"choicescript_stats": {"crc":-285568308, "lines":["*label personality_stats","[b] [i]Personal Information[/i] [/b] ","*line_break","*if (pc_nickname = true)","    Name: $!{name} \"$!{nickname}\" $!{surname}","    *goto nickname_stat_if_com","*elseif (pc_nickname = false)","    Name: $!{name} $!{surname}","    *goto nickname_stat_if_com","*label nickname_stat_if_com ","*line_break","Role: $!{pc_role} ","","","","[b]Personality: [/b]","*stat_chart","        opposed_pair sincerity","            Sincerity","            Snark ","        opposed_pair reckless","            Reckless ","            Cautious","        opposed_pair friendly","            Friendly","            Aloof","        opposed_pair optimistic","            Optimistic","            Pessimistic","        opposed_pair merciful","            Merciful ","            Cruel        ","        opposed_pair flirtatious","            Flirtatious","            Shy","        ","            ","[b]Traits:[/b]","*stat_chart","        opposed_pair heart","            Heart","            Head","        opposed_pair cooperative","            Cooperative","            Independent","        opposed_pair resistance","            Resistance","            Compliance","        opposed_pair believer","            Believer","            Skeptic    ","*label screen","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","","","*label physical_attributes ","[b][i]Physical Attributes[/i][/b]","*line_break","*if (pc_hair_dyed = \"false\")","    [b]Hair Color:[/b] $!{pc_hair_color}","    *goto hairstyle_information","*elseif (pc_hair_dyed = \"true\") ","    [b]Hair Color:[/b] Naturally ${pc_natural_hair_color} that has been dyed ${pc_dyed_hair_color}","    *goto hairstyle_information","*label hairstyle_information","*line_break","[b]Hair Style:[/b] $!{pc_hair_style} ","*line_break","[b]Eye Color:[/b] $!{pc_eye_color}","*line_break","[b]Height:[/b] $!{pc_height}","*line_break","[b]Clothing Style:[/b] $!{attire}. ${top} ${bottom}.","*line_break","[b]Injuries Sustained:[/b] $!{injury_slot_1_text} $!{injury_slot_2_text} $!{injury_slot_3_text}","","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","    ","*label connections_dynamics_choice","","Would you like to view the connections you have met or view your social dynamics?","","*choice ","    #Connections","        *goto acquaintances_stats","    #Primary Social Dynamics","        *goto acquaintance_dynm","    *selectable_if (msv_meet = \"true\") #Secondary Social Dynamics","        *goto acquaintance_dynm_2         ","","    ","*label acquaintances_stats  ","[b][i] Connections[/i][/b]","*line_break","*if (b_meet = \"true\")","    *goto actual_b_stats","*else","    *goto stats_choice_opti","*label actual_b_stats","[b] $!{beckett} Warrick [/b]","*line_break","[b]Status:[/b] $!{status_b}","*line_break ","[b]Role:[/b] $!{role_b} ","*if (b_man = \"man\")","    *line_break","    [b]Height:[/b] 5'9\"","    *line_break","    [b]Description:[/b] Expressive, hazel eyes. Light brown hair cut short with natural waves. Olive skin with a golden undertone. Somewhat athletic build.","    *goto stats_s_start","*else","    *line_break","    [b]Height:[/b] 5'6\"","    *line_break","    [b]Description:[/b] Expressive, hazel eyes. Slightly wavy, medium length, light brown hair. Olive skin with a golden undertone. Somewhat athletic build, curvaceous. ","    *goto stats_s_start","","*label stats_s_start","","","*if (s_meet = \"true\")","    *goto actual_s_stats","*else","    *goto stats_choice_opti","*label  actual_s_stats","[b] $!{silas} Dorran [/b]","*line_break","[b]Status:[/b] $!{status_s}","*line_break ","[b]Role:[/b] $!{role_s} ","*if ((s_man = \"man\") and (judith_interaction = \"s_dye\"))","    *line_break","    [b]Height:[/b] 6'4\"","    *line_break","    [b]Description:[/b] Dark brown eyes. Long, ebony hair that has been braided with care; a few lengths have been dyed a deep violet. Dark brown skin. Lanky, willowy build. ","    *goto stats_start_r","*elseif ((s_man = \"woman\") and (judith_interaction = \"s_dye\"))","    *line_break","    [b]Height:[/b] 6'1\"","    *line_break","    [b]Description:[/b] Dark brown eyes. Long ebony hair that has been braided with care; a few lengths have been dyed a deep violet. Dark brown skin. Lanky, willowy build.","    *goto stats_start_r","*elseif (s_man = \"man\")","    *line_break","    [b]Height:[/b] 6'4\"","    *line_break","    [b]Description:[/b] Dark brown eyes. Long, ebony hair that has been braided with care; a few lengths have been dyed a royal blue. Dark brown skin. Lanky, willowy build. ","    *goto stats_start_r","*elseif (s_man = \"woman\")","    *line_break","    [b]Height:[/b] 6'1\"","    *line_break","    [b]Description:[/b] Dark brown eyes. Long ebony hair that has been braided with care; a few lengths have been dyed a royal blue. Dark brown skin. Lanky, willowy build.","    *goto stats_start_r","","*label stats_start_r","","","*if (r_meet = \"true\")","    *goto actual_r_stats","*else","    *goto stats_choice_opti","*label  actual_r_stats","[b] $!{reese} Verner [/b]","*line_break","[b]Status:[/b] $!{status_r}","*line_break ","[b]Role:[/b] $!{role_r} ","*if (r_man = \"man\")","    *line_break","    [b]Height:[/b] 6'0\"","    *line_break","    [b]Description:[/b] Pale blue eyes. Ivy League style crew cut platinum blond hair that is styled back with product. Fair, borderline pale skin. A toned build with lean, defined muscle. ","    *goto stats_start_j","*else","    *line_break","    [b]Height:[/b] 5'4\"","    *line_break","    [b]Description:[/b] Pale blue eyes. Long, sleek platinum blond hair. Fair, borderline pale skin. A toned build with lean, defined muscle.","    *goto stats_start_j","","*label stats_start_j","","","*if (j_meet = \"true\")","    *goto actual_j_stats","*else","    *goto stats_choice_opti","*label  actual_j_stats","[b] $!{james} Corvin [/b]","*line_break","[b]Status:[/b] $!{status_j}","*line_break ","[b]Role:[/b] $!{role_j} ","*if (j_man = \"man\")","    *line_break","    [b]Height:[/b] 6'2\"","    *line_break","    [b]Description:[/b] Intense green eyes. Almost shoulder length, raven hair often restrained by a hair tie. Naturally tan skin. Well-built and muscular, broad shoulders.","    *goto stats_start_m","*else","    *line_break","    [b]Height:[/b] 5'9\"","    *line_break","    [b]Description:[/b] Intense green eyes. Shoulder length, raven hair often restrained by a hair tie. Naturally tan skin. Lean and solid build, broad shoulders. ","    *goto stats_start_m","","*label stats_start_m","","","*if (w_meet = \"true\")","    *goto actual_w_stats","*else","    *goto stats_choice_opti","*label  actual_w_stats","*if (m_name_known = \"true\") ","    [b]$!{malachi}[/b]","    *goto stats_m_con","*elseif (w_mal_nn = true) ","    [b]Mal[/b]","    *goto stats_m_con","*elseif (w_2nd_letter = \"true\") ","    [b]Ma-Something\u2026?[/b]","    *goto stats_m_con","*elseif (w_letter_known = \"true\") ","    [b]M-Something\u2026?[/b]","    *goto stats_m_con","*elseif (w_meet_official = \"true\") ","    [b]The $!{waiter}[/b]","    *goto stats_m_con ","*label stats_m_con","*line_break","[b]Status:[/b] $!{status_m}","*line_break ","[b]Role:[/b] $!{role_m} ","*if (w_man = \"man\")","    *line_break","    [b]Height:[/b] 5'11\"","    *line_break","    [b]Description:[/b] Burnt umber eyes. Short, dark brown hair in a quiff style. Smooth, tawny brown skin. Designer stubble that frames his jaw. Toned build and a poised posture.","    *goto stats_choice_opti","*else","    *line_break","    [b]Height:[/b] 5'11\" ","    *line_break","    [b]Description:[/b] Burnt umber eyes. Dark brown hair cut in a blunt, bob style. Smooth, tawny brown skin. Lips often shaded by dark lipstick. Toned build and a poised posture.","    *goto stats_choice_opti","","*line_break","*label stats_choice_opti","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","","    ","*label acquaintance_dynm","[i][b]Primary Social Dynamics[/b][/i]","*line_break","*if (b_meet = \"true\")","    *goto actual_b_dyn","*else","    *goto stats_choice_opti1","*label actual_b_dyn","[b] $!{beckett} Warrick [/b]","*line_break ","*if (beckett_friendship <= 44)","    *set beckett_desc_1 \"It's like you're trying to make a bad situation worse. $!{b_she}'s stressed from being stuck in Fernweh. Your continued lack of support is eroding this 'friendship'\u2026 Regret is creeping in.\"","    *goto b_short_friend_desc_set","*elseif (beckett_friendship <= 57)","    *set beckett_desc_1 \"You and $!{beckett} are still friends. While ${b_she} knows your likes, dislikes, favorite meal, and an embarrassing story or two, it feels like you're starting to drift apart.\"","    *goto b_short_friend_desc_set","*elseif (beckett_friendship <= 63)","    *set beckett_desc_1 \"$!{b_she} was there for you during the return visit, just like how you're offering support during the forced stay. $!{b_she} sees that. Your friendship is enduring.\"","    *goto b_short_friend_desc_set","*elseif (beckett_friendship <= 68)","     *set beckett_desc_1 \"$!{b_she} views your friendship as one of the things that's keeping ${b_him} going. The syrup-drenched Belgian waffles lost some of their appeal as did snapping pictures of Fernweh, but there's something reassuring about your presence.\"","     *goto b_short_friend_desc_set","*elseif (beckett_friendship <= 71)","     *set beckett_desc_1 \"$!{b_she} sometimes listens to a playlist that has a mix of your and ${b_his} favorite songs while out walking, so ${b_she} doesn't feel as alone. You and $!{beckett} remain strong friends.\"","     *goto b_short_friend_desc_set","*elseif (beckett_friendship <= 90)","    *set beckett_desc_1 \"Your kind persistence hasn't escaped ${b_his} notice; ${b_she} is lucky to have a bestie like you who stands by ${b_him} through it all.\"","    *goto b_short_friend_desc_set","","*label b_short_friend_desc_set","${beckett_desc_1} ${beckett_desc_2} ${beckett_desc_3}","*if (beckett_friendship <= 44)","    *set beckett_friendship_text \"\u2026Friends? It's Getting Harder to Tell\"","    *goto b_short_friend_chart","*elseif (beckett_friendship <= 57)","    *set beckett_friendship_text \"Friends (But Things are a Little Tense)\"","    *goto b_short_friend_chart","*elseif (beckett_friendship <= 63)","    *set beckett_friendship_text \"Mutually Supportive Friends\"","    *goto b_short_friend_chart","*elseif (beckett_friendship <= 68)","    *set beckett_friendship_text \"Great Friends ($!{b_she} Needs You)\"","    *goto b_short_friend_chart","*elseif (beckett_friendship <= 71)","    *set beckett_friendship_text \"Strong Friends\"","    *goto b_short_friend_chart   ","*elseif (beckett_friendship <= 90)","    *set beckett_friendship_text \"Besties!\"","    *goto b_short_friend_chart","","*label b_short_friend_chart","*stat_chart","    text beckett_friendship_text [b]Friendship[/b]","*if ((tentative_ro_pick = \"beckett\") and (polaroid_memory = \"true\"))","     *set beckett_romance_desc \"true\"","     *set beckett_romance_text \"You sometimes find it hard to look at the polaroid of you and $!{beckett} together, but at least that's a way for you to see ${b_his} true smile again.\"","     *goto b_short_romance_desc_set","*elseif (townline_pick = \"beckett\") ","    *set beckett_romance_desc \"true\"","    *set beckett_romance_text \"The imposed stay in Fernweh hasn't helped whatever was starting to develop between you and your beloved friend.\"","    *goto b_short_romance_desc_set ","*else","    *goto b_short_romance_desc_set"," ","*label b_short_romance_desc_set   ","*if (beckett_romance_desc = \"true\")","    *goto b_potential_romance_chart","*elseif (beckett_romance_desc = \"false\")","    *goto s_check_meet","","*label b_potential_romance_chart    ","*stat_chart","    text beckett_romance_text [b]Romance[/b]","*label s_check_meet","*if (s_meet = \"true\")","    *goto actual_s_dyn","*else","    *goto stats_choice_opti1","*label actual_s_dyn","[b] $!{silas} Dorran [/b]","*line_break","*if (silas_friendship <= 44) ","    *set silas_desc_1 \"$!{s_she} views your attitude as a sign to give you space and keep to ${s_him}self. You and $!{silas} aren't engaging much\u2026\"","    *goto s_short_friend_desc_set","*elseif (silas_friendship <= 56)","    *set silas_desc_1 \"$!{s_his} honest curiosity about you remains, although your well-being weighs on ${s_his} mind now that you're staying in town. Your friendship is developing. \"","    *goto s_short_friend_desc_set","*elseif (silas_friendship <= 61)","    *set silas_desc_1 \"$!{s_his} care for you is evident in how ${s_she} seeks out your opinions and takes the time to actively listen even while crafting a poem or reading.\"","    *goto s_short_friend_desc_set","*elseif (silas_friendship <= 66)","     *set silas_desc_1 \"$!{s_she} relishes your company despite being used to ${s_his} own. Being self-contained means ${s_she} has to make an effort to connect; you're worth that, a solid friend.\"","     *goto s_short_friend_desc_set","*elseif (silas_friendship <= 69)","     *set silas_desc_1 \"$!{s_she} uses the late hours of the night shift to try any music, movies, or books you've mentioned to ${s_him} so the two of you can talk about them. $!{s_she} wants to help you cope with what you're going through. \"","     *goto s_short_friend_desc_set","*elseif (silas_friendship <= 90)","    *set silas_desc_1 \"$!{s_his} mother raised ${s_him} to be considerate of others, but it's much more than that with you. Manners, hospitality, or a kind disposition have nothing to do with how $!{silas} wants to look out for you.\"","    *goto s_short_friend_desc_set","","*label s_short_friend_desc_set","${silas_desc_1} ${silas_desc_2} ${silas_desc_3} ","*if (silas_friendship <= 44)","    *set silas_friendship_text \"\u2026Just Acquaintances with a Shared History\"  ","    *goto s_short_friend_chart","*elseif (silas_friendship <= 56)","    *set silas_friendship_text \"The Prospect of Friendship ($!{s_she} Sees That with You)\"","    *goto s_short_friend_chart","*elseif (silas_friendship <= 61)","    *set silas_friendship_text \"Budding Friends\"","    *goto s_short_friend_chart","*elseif (silas_friendship <= 66)","    *set silas_friendship_text \"Friends ($!{s_she}'s Here for You)\"","    *goto s_short_friend_chart","*elseif (silas_friendship <= 69)","    *set silas_friendship_text \"Better Friends\"","    *goto s_short_friend_chart","*elseif (silas_friendship <= 90)","    *set silas_friendship_text \"Part of $!{s_his} Found Family\"","    *goto s_short_friend_chart","","*label s_short_friend_chart","*stat_chart","    text silas_friendship_text [b]Friendship[/b]","*if ((tentative_ro_pick = \"silas\") and (polaroid_memory = \"true\"))","    *set silas_romance_desc \"true\"","    *set silas_romance_text \"A copy of your and $!{silas}'s polaroid picture can be found on the B&B's fridge, except you sometimes prefer to look at the original when alone\u2026 It's special.\"","    *goto s_short_romance_desc_set","*elseif (townline_pick = \"silas\")","     *set silas_romance_desc \"true\"","     *set silas_romance_text \"The imposed stay in Fernweh gives you a chance to spend time with $!{silas}. Is there something more to the compassion ${s_she} shows you?\" ","     *goto s_short_romance_desc_set","*else","    *goto s_short_romance_desc_set"," ","*label s_short_romance_desc_set   ","*if (silas_romance_desc = \"true\")","    *goto s_potential_romance_chart","*elseif (silas_romance_desc = \"false\")","    *goto r_check_meet","","*label s_potential_romance_chart    ","*stat_chart","    text silas_romance_text [b]Romance[/b]","*label r_check_meet","*if (r_meet = \"true\")","    *goto actual_r_dyn","*else","    *goto stats_choice_opti1","*label actual_r_dyn","[b] $!{reese} Verner [/b]","*line_break","*if (reese_friendship <= 44)","    *set reese_desc_1 \"Your disposition towards ${r_him} creates distance; why should ${r_she} bother engaging with you? Your dynamic with $!{reese} is lacking.\"","    *goto r_short_friend_desc_set","*elseif (reese_friendship <= 58)","    *set reese_desc_1 \"$!{r_his} interest hasn't faded but tempered with more care after spending time with you. $!{reese} often asks how you are even from people other than you.\"","    *goto r_short_friend_desc_set","*elseif (reese_friendship <= 64)","    *set reese_desc_1 \"How you're feeling occupies ${r_his} thoughts due to your forced stay in Fernweh. $!{reese} Verner taking an avid interest in your well-being means something.\"","    *goto r_short_friend_desc_set","*elseif (reese_friendship <= 69)","    *set reese_desc_1 \"$!{r_she} allots time in ${r_his} schedule specifically to catch up with you, preferring it to any of the social events or business meetings. Spending moments with you is a privilege; $!{reese} not only values it, but treasures it.\"   ","    *goto r_short_friend_desc_set","*elseif (reese_friendship <= 71)","    *set reese_desc_1 \"$!{r_she} would allow you the 'esteemed privilege' of driving Angelique. The implicit trust is only outweighed by how $!{reese} would likely plan an entire adventure for the two of you.\"   ","    *goto r_short_friend_desc_set","*elseif (reese_friendship <= 90)","    *set reese_desc_1 \"$!{r_she} sometimes wishes you had more of a choice in things. Would you still spend time with ${r_him} if you could go elsewhere? $!{reese} secretly hopes so. $!{r_she} has grown to seek out your presence, which is rare for ${r_him}.\"","    *goto r_short_friend_desc_set","","*label r_short_friend_desc_set","${reese_desc_1} ${reese_desc_2} ${reese_desc_3} ","*if (reese_friendship <= 44)","    *set reese_friendship_text \"Distant Acquaintances\"","    *goto r_short_friend_chart","*elseif (reese_friendship <= 58)","    *set reese_friendship_text \"Toasty Acquaintances ($!{r_she} Doesn't Use 'Friend' Lightly)\"","    *goto r_short_friend_chart","*elseif (reese_friendship <= 64)","    *set reese_friendship_text \"You're Both Friend\u2026ly ($!{r_she} Enjoys Your Company)\"","    *goto r_short_friend_chart","*elseif (reese_friendship <= 69)","    *set reese_friendship_text \"The Golden Opportunity of [i]Friendship[/i] (That's You!)\"","    *goto r_short_friend_chart","*elseif (reese_friendship <= 72)","    *set reese_friendship_text \"We Make Our Own Opportunities, Just Like How $!{reese} Has Made a [i]Friend[/i] in You\"","    *goto r_short_friend_chart","*elseif (reese_friendship <= 90)","    *set reese_friendship_text \"A [i]Genuine[/i], Limited Edition Friend ($!{r_she} Doesn't Have Many\u2026)\"","    *goto r_short_friend_chart","","*label r_short_friend_chart","*stat_chart","    text reese_friendship_text [b]Friendship[/b]","*if (townline_pick = \"jr\")","    *goto j_check_meet","*elseif (reese_romance_number >= 5)","    *goto r_romance_layers_desc","","*label r_romance_layers_desc   ","*if (((tentative_ro_pick = \"reese\") and (polaroid_memory = \"true\")) and (denial_r_ro >= 4))","    *set reese_romance_desc \"true\"","    *set reese_romance_text \"Studying $!{reese}'s expression in the polaroid has occupied some of your nights. Why was ${r_she} watching you with that lonely smile? You shouldn't care\u2014you don't.\"","    *goto r_short_romance_desc_set","*elseif ((tentative_ro_pick = \"reese\") and (polaroid_memory = \"true\"))","    *set reese_romance_desc \"true\"","    *set reese_romance_text \"Your nights are sometimes occupied by studying $!{reese}'s expression in the polaroid. While ${r_his} eyes are exclusively on you in the picture, yours are always drawn to that lonely smile on ${r_his} face.\"","    *goto r_short_romance_desc_set","*elseif ((townline_pick = \"reese\") and (denial_r_ro >= 4))","     *set reese_romance_desc \"true\"","     *set reese_romance_text \"Staying in Fernweh will only make the conflicting emotions you feel around the Verner heir persist. This imposed stay is worse than you thought.\" ","     *goto r_short_romance_desc_set","*elseif (townline_pick = \"reese\")","     *set reese_romance_desc \"true\"","     *set reese_romance_text \"The imposed stay in Fernweh didn't only catch you off guard. $!{reese} seemed ready to let you go, if that's what you needed, but what about now\u2026?\" ","     *goto r_short_romance_desc_set","*else","    *goto r_short_romance_desc_set"," ","*label r_short_romance_desc_set   ","*if (reese_romance_desc = \"true\")","    *goto r_potential_romance_chart","*elseif (reese_romance_desc = \"false\")","    *goto j_check_meet","","*label r_potential_romance_chart    ","*stat_chart","    text reese_romance_text [b]Romance[/b]","*label j_check_meet","*if (j_meet = \"true\")","    *goto actual_j_dyn","*else","    *goto stats_choice_opti1","*label actual_j_dyn","[b] $!{james} Corvin [/b]","*line_break ","*if (james_friendship <= 44)","    *set james_desc_1 \"$!{j_she} is unsure what exactly is motivating your attitude towards him; could it be stress or just plain dislike? $!{j_she} remains guarded. $!{james} and you haven't reconnected.\"","    *goto j_short_friend_desc_set       ","*elseif (james_friendship <= 58)","    *set james_desc_1 \"$!{j_she} sometimes checks-in with you on the walkie talkie to see how you're holding up in addition to asking $!{silas}'s and $!{reese}'s opinion. Your friendship is developing.\"","    *goto j_short_friend_desc_set","*elseif (james_friendship <= 63)","    *set james_desc_1 \"$!{j_she} had estimated when you'd be leaving Fernweh, but didn't dare mark that date on ${j_his} calendar. Now, that you're staying, ${j_his} concern for you is tinged with guilt about wanting to spend more time together.\"","    *goto j_short_friend_desc_set","*elseif (james_friendship <= 68)","    *set james_desc_1 \"$!{j_his} late night patrols have a tendency to end up near the B&B so ${j_she} can spend some time with you. $!{james}'s guilt about your forced stay becomes more muted when ${j_she} spends time with you, reminiscing and reconnecting.\"","    *goto j_short_friend_desc_set","*elseif (james_friendship <= 71)","    *set james_desc_1 \"$!{j_his} cluttered desk now has a pad of sticky notes that remind ${j_him} when ${j_she}'s supposed to meet up with you and take a break. $!{j_she} wants to be there for you like you once were there for ${j_him}.\"","    *goto j_short_friend_desc_set","*elseif (james_friendship <= 90)","    *set james_desc_1 \"$!{j_she} missed you, but you're here now and sometimes it takes $!{james} a moment to let that sink in. $!{j_she} wishes ${j_she} could make up for lost time.\"","    *goto j_short_friend_desc_set","","*label j_short_friend_desc_set","${james_desc_1} ${james_desc_2} ${james_desc_3}","*if (james_friendship <= 44) ","    *set james_friendship_text \"\u2026Still Acquaintances\"","    *goto j_short_friend_chart","*elseif (james_friendship <= 58)","    *set james_friendship_text \"Tentative Friends\"","    *goto j_short_friend_chart","*elseif (james_friendship <= 63)","    *set james_friendship_text \"Burgeoning Friends\"","    *goto j_short_friend_chart","*elseif (james_friendship <= 68)","    *set james_friendship_text \"Friends ($!{j_she} Hopes That Doesn't Change)\"","    *goto j_short_friend_chart","*elseif (james_friendship <= 71)","    *set james_friendship_text \"[i]Lifelong[/i] Friends Won't Apply to the Two of You ($!{j_she} Resents That, but Cherishes Your Friendship)\"","    *goto j_short_friend_chart","*elseif (james_friendship <= 90)","    *set james_friendship_text \"$!{j_his} Dear Friend (Losing You Once Was Enough)\"","    *goto j_short_friend_chart","","*label j_short_friend_chart","*stat_chart","    text james_friendship_text [b]Friendship[/b]","*if (townline_pick = \"jr\")","    *goto jr_romance_layers_desc","*elseif (townline_pick = \"james\")","    *goto j_romance_layers_desc","","*label jr_romance_layers_desc","*if ((tentative_ro_pick = \"jr\") and (polaroid_memory = \"true\"))","    *set jr_romance_desc \"true\"","    *set jr_romance_text \"On bad nights, you sometimes take out the polaroid of you, $!{james}, and $!{reese}, fondly recalling the antics and compromise of the moment.\"","    *goto j_jr_short_romance_desc_set   ","*elseif (townline_pick = \"jr\")","     *set jr_romance_desc \"true\"","     *set jr_romance_text \"The imposed stay in Fernweh gives you time to explore this unexpected dynamic with $!{reese} and $!{james}. Is there something more to it?\" ","     *goto j_jr_short_romance_desc_set","*else","    *goto j_jr_short_romance_desc_set","","*label j_romance_layers_desc","*if ((tentative_ro_pick = \"james\") and (polaroid_memory = \"true\"))","    *set james_romance_desc \"true\"","    *set james_romance_text \"You sometimes observe the polaroid of you and $!{james}, often wondering what was going through ${j_his} head while ${j_she} looked off into the distance and anywhere but at you.\"","    *goto j_jr_short_romance_desc_set   ","*elseif (townline_pick = \"james\")","     *set james_romance_desc \"true\"","     *set james_romance_text \"The imposed stay in Fernweh changes everything. The absence $!{james} was ready to endure yet again is gone, but what does that mean for the two of you?\" ","     *goto j_jr_short_romance_desc_set","*else","    *goto j_jr_short_romance_desc_set","","*label j_jr_short_romance_desc_set   ","*if (james_romance_desc = \"true\")","    *goto j_potential_romance_chart","*elseif (jr_romance_desc = \"true\")","    *goto jr_potential_romance_chart","*else","    *goto w_check_meet","","*label j_potential_romance_chart    ","*stat_chart","    text james_romance_text [b]Romance[/b]","*label outsmart_the_goto","*if (james_romance_desc = \"true\")","    *goto w_check_meet","*else","    *goto w_check_meet","","*label jr_potential_romance_chart","[b]$!{name}, $!{james}, & $!{reese} Romance:[/b] ${jr_romance_text} ","*label w_check_meet","*if (w_meet = \"true\")","    *goto actual_w_dyn","*else","    *goto stats_choice_opti1","*label actual_w_dyn","","","*if (m_name_known = \"true\") ","    [b] $!{malachi} [/b]","    *goto m_friendship_range","*elseif (w_mal_nn = true) ","    [b]Mal[/b]","    *goto m_friendship_range","*elseif (w_2nd_letter = \"true\") ","    [b]Ma-Something\u2026?[/b]","    *goto m_friendship_range","*elseif (w_letter_known = \"true\") ","    [b]M-Something\u2026?[/b]","    *goto m_friendship_range","*elseif (w_meet_official = \"true\") ","    [b]The $!{waiter}[/b]","    *goto m_friendship_range","","*label m_friendship_range","*line_break ","*if (waiter_friendship <= 50) ","    *set waiter_desc_1 \"$!{w_she} seems to be acutely aware of your wariness, which only heightens your unease around ${w_him}. Your dynamic remains somewhat contentious.\"","    *goto w_short_friend_desc_set","*elseif (waiter_friendship <= 52)","    *set waiter_desc_1 \"$!{w_his} unshakably pleasant smile gives nothing away even when it's directed at you. It's hard to know where you stand with ${w_him}, but your dynamic is cordial.\" ","    *goto w_short_friend_desc_set    ","*elseif (waiter_friendship <= 55) ","    *set waiter_desc_1 \"$!{w_she} remains amicable with you, taking a deeper interest beyond your favored hot drink and Fernweh Diner meal. You think ${w_his} smiles are a touch warmer; they can be difficult to read.\" ","    *goto w_short_friend_desc_set","*elseif (waiter_friendship <= 90) ","    *set waiter_desc_1 \"@{w_mal_nn Mal|The ${waiter}} seeking you out outside of an official Fernweh Diner capacity could suggest something more. Does ${w_she} want to be around you, or is it just circumstance?\" ","    *goto w_short_friend_desc_set","","*label w_short_friend_desc_set","${waiter_desc_1} ${waiter_desc_2} ${waiter_desc_3}","*if (waiter_friendship <= 50)","    *set waiter_friendship_text \"One of $!{w_his} Least Favorite Customers\u2026\" ","    *goto w_short_friend_chart","*elseif (waiter_friendship <= 52) ","    *set waiter_friendship_text \"One of $!{w_his} Customers\" ","    *goto w_short_friend_chart","*elseif (waiter_friendship <= 55) ","    *set waiter_friendship_text \"A Familiar Face (Especially Considering Your Stay)\" ","    *goto w_short_friend_chart","*elseif (waiter_friendship <= 90) ","    *set waiter_friendship_text \"Someone Bearable to Be Around (Don't Take This Lightly)\" ","    *goto w_short_friend_chart","","*label w_short_friend_chart","*stat_chart","    text waiter_friendship_text [b]Friendship[/b]","*if (waiter_flirt >= 4)","    *set waiter_romance_desc \"true\"","    *set waiter_romance_text \"Seeing more of Mal wasn't exactly your plan, but the stay in Fernweh has changed everything. Does that fill you with regret, dread, hope, or something else entirely?\"","    *goto w_short_romance_desc_set    ","*else","    *goto w_short_romance_desc_set"," ","*label w_short_romance_desc_set   ","*if (waiter_romance_desc = \"true\")","    *goto w_potential_romance_chart","*elseif (waiter_romance_desc = \"false\")","    *goto stats_choice_opti1","","*label w_potential_romance_chart    ","*stat_chart","    text waiter_romance_text [b]Romance[/b]","*label stats_choice_opti1","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","   ","   ","*label acquaintance_dynm_2","[i][b]Secondary Social Dynamics[/b][/i]","*line_break","*if (msv_meet = \"true\")","    *goto actual_msv_dyn","*else","    *goto stats_choice_opti2","*label actual_msv_dyn","[b] Ms. Verner [/b]","*line_break ","*if (msv_relationship <= 47)","    *set msv_desc_1 \"You and Ms. Verner tend to clash when around each other since your dynamic is vaguely contentious\u2026 It doesn't help that you're stuck in Fernweh; is the town big enough for the both of you?\"","    *goto msv_short_friend_desc_set","*elseif (msv_relationship <= 54)","    *set msv_desc_1 \"Past encounters suggest that she dislikes you. It shouldn't be an active dislike, but now that you're stuck in Fernweh, you might naturally draw more of her focus. Your dynamic with Ms. Verner is coolly neutral at best.\"","    *goto msv_short_friend_desc_set","*elseif (msv_relationship <= 57)","     *set msv_desc_1 \"You believed your dynamic was improving since she seemed a little less frigid, but it's hard to say how your stay in town will go. Can you continue to thaw some of Ms. Verner's disposition?\"","     *goto msv_short_friend_desc_set","*elseif (msv_relationship <= 90)","     *set msv_desc_1 \"Much like digging your bare hands into snow, you might find interacting with Ms. Verner to be smarting due to her cutting words and judgmental looks, but there could be something beneath her cold demeanor. Do you want to know more?\"","     *goto msv_short_friend_desc_set","","*label msv_short_friend_desc_set","${msv_desc_1} ${msv_desc_2} ${msv_desc_3}","*if (msv_relationship <= 47)","    *set msv_friendship_text \"Distant Adversaries\"","    *goto msv_short_friend_chart","*elseif (msv_relationship <= 54)","    *set msv_friendship_text \"\u2026Barely Acquaintances\"","    *goto msv_short_friend_chart","*elseif (msv_relationship <= 57)","    *set msv_friendship_text \"A Possible Future Contact\"","    *goto msv_short_friend_chart    ","*elseif (msv_relationship <= 90)","    *set msv_friendship_text \"You Have Surprised Each Other\"","    *goto msv_short_friend_chart    ","","*label msv_short_friend_chart","*stat_chart","    text msv_friendship_text [b]Friendship[/b]","*label a_check_meet","*if (a_meet = \"true\")","    *goto actual_a_dyn","*else","    *goto stats_choice_opti2","*label actual_a_dyn","[b] $!{alex} Corvin [/b]","*line_break","*if ((alex_past = \"idolized\") and (alex_strained = \"true\"))","    *goto a_strained_statuses","*elseif ((alex_past = \"idolized\") and (alex_crush = \"true\"))","    *goto a_crush_statuses","*elseif (alex_past = \"idolized\") ","    *goto a_idolized_statuses","*elseif (alex_past = \"neutral\")","    *goto a_neutral_statuses","*elseif (alex_past = \"frenemies\")","    *goto a_frenemies_statuses","","*label a_strained_statuses","*if (alex_past = \"strained\")","    *set alex_desc_1 \"$!{a_they} once looked up to you, but that adoration has faded away into something bitter. Spending more time in Fernweh might let you discover more.\"","    *set alex_friendship_text \"Your Dynamic is Strained\" ","    *goto a_short_friend_chart","*else","    *goto a_short_friend_chart","","*label a_crush_statuses","*if ((alex_past = \"idolized\") and (alex_crush = \"true\"))","    *set alex_desc_1 \"$!{a_they} once looked up to you, possibly idolizing you, though that past adoration might have turned into something more\u2026 $!{alex} has been rather attentive during your newfound stay in town.\" ","    *set alex_friendship_text \"Fast Friends\" ","    *goto a_short_friend_chart","*else","    *goto a_short_friend_chart","","*label a_idolized_statuses","*if (((alex_past = \"idolized\") and (ttp_duties = \"positive\")) and (ttp_a_event_1 = \"true\"))","    *set alex_desc_1 \"$!{a_they} wouldn't want anyone else in Turn the Page with ${a_them}. $!{alex} looks forward to showing you some barista tricks and hearing about your day.\" ","    *set alex_friendship_text \"Barista Buddies\" ","    *goto a_short_friend_chart","*elseif (alex_past = \"idolized\")","    *set alex_desc_1 \"$!{a_they} once looked up to you, which is why @{a_plural {a_they}'re|${a_they}'s} eager to befriend you, especially now that you can spend more time together. $!{alex} has some ideas for fun adventures!\" ","    *set alex_friendship_text \"Fast Friends\" ","    *goto a_short_friend_chart","*else","    *goto a_short_friend_chart","","*label a_neutral_statuses","*if (alex_past = \"neutral\")","    *set alex_desc_1 \"$!{a_they} @{a_plural were|was} neutral with you growing up and that hasn't changed. @{a_plural $!{a_they}'re|$!{a_they}'s} concerned about how your stay will impact $!{james}.\" ","    *set alex_friendship_text \"Acquaintances\" ","    *goto a_short_friend_chart","*else","    *goto a_short_friend_chart ","","*label a_frenemies_statuses","*if (((alex_past = \"frenemies\") and (ttp_duties = \"positive\")) and (ttp_a_event_1 = \"true\"))","    *set alex_desc_1 \"$!{a_they} @{a_plural don't|doesn't} understand why you would ever want to be in Turn the Page with ${a_them}. It's annoying at times, but also distracting.\" ","    *set alex_friendship_text \"Barista Brawlers\" ","    *goto a_short_friend_chart","*elseif (alex_past = \"frenemies\")","    *set alex_desc_1 \"You and $!{alex} tend to clash or create tension due to your negative past history. Who knows how things will go as your stay in Fernweh progresses.\"","    *set alex_friendship_text \"Former Frenemies\" ","    *goto a_short_friend_chart","*else","    *goto a_short_friend_chart ","","*label a_short_friend_chart","${alex_desc_1} ${alex_desc_2} ${alex_desc_3}","*stat_chart","    text alex_friendship_text [b]Friendship[/b]    ","*label d_check_meet","*if (dog_meet = \"true\")","    *goto actual_d_dyn","*else","    *goto stats_choice_opti2","","*label actual_d_dyn","[b]$!{dog_name}[/b]","*line_break","*if (dog_ownership = \"none\")","    *goto d_none_statuses","*elseif (dog_ownership = \"b pet\")","    *goto d_bpet_statuses","*elseif (dog_ownership = \"mc duty\")","    *goto d_mcduty_statuses","*elseif (dog_ownership = \"mc pet\")","    *goto d_mcpet_statuses","","*label d_none_statuses","*if (canine_trust <= 48)","    *set dog_desc_1 \"Your past negative attitude towards her hasn't been forgotten. The dog is skittish around you, which is fine because she's the Dorrans' problem now.\"","    *set dog_friendship_text \"She Knows to Stay Away\u2026\" ","    *goto d_short_friend_chart","*elseif (canine_trust <= 51)","    *set dog_desc_1 \"She hasn't received much attention or support from you; this hasn't helped with her anxiety. Luckily, the Dorrans volunteered to take her on as their pet.\"","    *set dog_friendship_text \"Just Strangers Living Under the Same Roof\"  ","    *goto d_short_friend_chart","","*label d_bpet_statuses","*if (canine_trust <= 48)","    *set dog_desc_1 \"Your past attitude towards her hasn't been forgotten. The dog is unsettled around you, which is fine because she prefers $!{beckett}'s company anyway.\"","    *set dog_friendship_text \"She Knows to Stay Away\u2026\" ","    *goto d_short_friend_chart","*elseif (canine_trust <= 51)","    *set dog_desc_1 \"She hasn't received much attention or support from you; this hasn't helped with her anxiety. Luckily, $!{beckett}s is willing to take time with her to let her heal.\"","    *set dog_friendship_text \"Just Strangers Living Under the Same Roof\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 53)","    *set dog_desc_1 \"She appreciates the kindness you've shown her, although it will take time for her to warm up. It's fortunate that $!{beckett} will be patient with her.\"","    *set dog_friendship_text \"A Nice Human\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 57)","    *set dog_desc_1 \"She tends to seek out either you or $!{beckett} for comfort. Her anxious habits are something that you're both trying to soothe. You agreed to let $!{beckett} take her, but you are still invested in $!{dog_name}'s well-being.\"","    *set dog_friendship_text \"A Safe and Good Human\"  ","    *goto d_short_friend_chart","*elseif ((canine_trust <= 57) and (tentative_ro_pick = \"beckett\"))","    *set dog_desc_1 \"Jokingly talking about co-parenting $!{dog_name} has now become a reality. She tends to seek out you and $!{beckett} for comfort, but at least it gives you a chance to spend time together.\"","    *set dog_friendship_text \"One of the Two Good Humans\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 90)","    *set dog_desc_1 \"She is still technically $!{beckett}'s dog, but she trusts you as well, possibly even willing to be protective over you in addition to seeking out gentle pets.\"","    *set dog_friendship_text \"A Trusted Friend\"  ","    *goto d_short_friend_chart","","*label d_mcduty_statuses","*if (canine_trust <= 53)","    *set dog_desc_1 \"She appreciates the kindness you've shown her, although it will take time for her to warm up. You will need to exercise patience with her and her anxiety.\"","    *set dog_friendship_text \"A Nice Human\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 57)","    *set dog_desc_1 \"She tends to seek you out for comfort. Her anxious habits are something that you've noticed. You are firm in your commitment to look after her, so you're trying to get this under control.\"","    *set dog_friendship_text \"A Safe Human\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 61)","    *set dog_desc_1 \"Her need to keep you within sight isn't easing up anytime soon, but she has learned that you do always come back for her.\"","    *set dog_friendship_text \"A Dependable Human\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 90)","    *set dog_desc_1 \"She's slowly letting herself trust you. The comfort you give her must be repaid; she has become more protective over you in a way that you've noticed too.\"","    *set dog_friendship_text \"Her Potential Friend\"  ","    *goto d_short_friend_chart","","*label d_mcpet_statuses","*if (canine_trust <= 53)","    *set dog_desc_1 \"She appreciates the kindness you've shown her, although it will take time for her to warm up. It's fortunate that you are being patient with her and her anxiety.\"","    *set dog_friendship_text \"A Nice Human\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 57)","    *set dog_desc_1 \"She tends to seek you out for comfort, but also to feel safe again. Her anxious habits are something that you've noticed and are actively trying to soothe.\"","    *set dog_friendship_text \"A Safe and Good Human\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 61)","    *set dog_desc_1 \"Her need to keep you within sight isn't easing up anytime soon, but she has learned that you do always come back for her. She's learning to trust more.\"","    *set dog_friendship_text \"A Human Who Won't Leave Her (Again)\"  ","    *goto d_short_friend_chart","*elseif (canine_trust <= 90)","    *set dog_desc_1 \"She's letting herself trust you. The honest comfort you give her must be repaid; she would protect you with her teeth and claws. No one will take you away too.\"","    *set dog_friendship_text \"Her Friend (Could You Become Her New Best One?)\"  ","    *goto d_short_friend_chart","","*label d_short_friend_chart","${dog_desc_1} ${dog_desc_2} ${dog_desc_3}","*stat_chart","    text dog_friendship_text [b]Friendship[/b]","*label stats_choice_opti2 ","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","    ","    ","*label inventory_skills_choice","","Would you like to view your skills or your inventory? ","","*choice","    #Skills","        *goto skills_stats","    #Explanation of Skills","        *goto explain_skills_stats","    #Inventory","        *goto inventory_stats","","*label explain_skills_stats","","[b][i]The Fernweh Saga[/i][/b] builds atmosphere in the writing and interweaves hints throughout the narrative about the secrets and mysteries you will uncover. Skills were touched on in certain scenes within Book One, but they are introduced as a mechanic in Book Two as your character develops them. This awareness will begin to heighten, though there are other 'things' that will influence your story as well that can only be discovered by continuing it.","","I would recommend naturally coming across the effects of your primary skill along with what else your character is capable of by advancing the plot. It will allow for a more organic read. ","","The skills page will update as your character learns new things. ","","Do you still wish to view an explanation of the skills?","","*choice","    #Yes, I would like to view them despite spoilers. ","        *goto explain_skills_stats_yes","    #No, I will learn more alongside my character.","        *goto choice_options_menu","","*label explain_skills_stats_yes","[b][i]Explanation of Skills for Book Two[/i][/b]","","[b]Past Affinity:[/b] A childhood hobby or activity that you continue to enjoy as an adult. ","","[b]Primary Ability:[/b] One of the three skills your character expresses attunement to. Returning to Fernweh helps to awaken or manifest these abilities due to the town's unique situation.","*line_break","[b]-Retrocognition:[/b] The ability to see or look into the past. It is usually illustrated by seeing glimpses of scenes or snatches of images that can then be used to inform actions/feelings. ","*line_break","[b]-Empathetic Impressions:[/b] Rooted in empathy, this skill relates to certain events leaving a 'signature' or an 'impression' of feeling that can be interpreted to yield new insight.","*line_break","[b]-Extrasensory Awareness:[/b] Also known as 'ESP' or a 'sixth sense'. An instinctual awareness or instinct about a place, object, or person that goes beyond the five senses. Having an inkling. ","","[b]Past Susceptibility:[/b] How easy it is for your character to get caught up in past memories or moments. Their willingness to take a moment and reflect on memories, both good and bad. ","","[b]Dagger:[/b] There will be scenes linked to this dagger as the series progresses.","","[b]Combat/Diplomacy:[/b] How willing you are to use a combative approach versus a more diplomatic one.","","*if (first_echo_experience = \"true\")","    [b]Echoes:[/b] Remnants of the past clinging to the present, although some are more stubborn than others and require a particular kind of person to reveal themselves. Your character's sensitivity and the town of Fernweh's [i]special[/i] situation allows them to peer into these echoes. They will usually read as scenes, moments, or glimpses from a time in the past, allowing you learn about the character(s) involved or inform your choices. Abilities can influence them.","","    This means a character with Retrocognition might experience an echo differently than one who has Empathetic Impressions as their main ability. Relationships can also have an impact.","","    You will gain a deeper, first-hand understanding of all of these by continuing the series, so I appreciate your patience and curiosity. ","    *goto choice_options_menu","*else","    You will gain a deeper, first-hand understanding of all of these by continuing the series, so I appreciate your patience and curiosity.  ","    *goto choice_options_menu  ","    ","","*label skills_stats","[i][b]Skills[/b][/i]","","*if (past_affinity = \" \")","    [b]Past Affinity:[/b] ${past_affinity_text}","    *goto skills_continued","*else","    [b]Past Affinity:[/b] $!{past_affinity}. ${past_affinity_text} ","    *goto skills_continued","","*label skills_continued","","*if (primary_skill = \" \")","    [b]Primary Ability:[/b] To be discovered\u2026","    *goto skills_stat_chart","*elseif (primary_skill = \"retrocognition\")","    [b]Primary Ability:[/b] You sometimes zone out to reflect on things more deeply, catching glimpses of what may be half-formed thoughts or ideas until you snap out of it.","    *goto skills_stat_chart","*elseif (primary_skill = \"empathetic impressions\")","    [b]Primary Ability:[/b] You were often said to be a 'sensitive' child, although it wasn't always your own emotions that got you worked up. Even now, you're almost too aware of others. ","    *goto skills_stat_chart","*elseif (primary_skill = \"extrasensory awareness\")","    [b]Primary Ability:[/b] Your gut instinct has rarely lead you astray in the past. Sometimes things can feel intuitively 'off' to you enough to influence your choices and opinions. ","    *goto skills_stat_chart","","*label skills_stat_chart","*stat_chart ","    percent retrocognition Retrocognition","    percent empathetic_impressions Empathetic Impressions ","    percent extrasensory_awareness Extrasensory Awareness","","[b]Past Susceptibility:[/b] [i]${past_susceptibility}[/i]. ${past_susceptibility_text} ","","*stat_chart","    opposed_pair receptive","        Receptive ","        Dismissive","        ","*if (dagger_kept = \"kept\")","    [b]Dagger:[/b] You decided to keep the dagger; it could come in handy.","    *goto check_combat_stat_1","*elseif (dagger_kept = \"left\")","    [b]Dagger:[/b] You decided to refuse the dagger; it won't serve any purpose. ","    *goto check_combat_stat_1","","*label check_combat_stat_1","*stat_chart","    opposed_pair combat","        Combat ","        Diplomacy","","*label choice_options_menu","","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent    ","","    ","*label inventory_stats","[i][b]Inventory:[/b][/i]","*line_break","$!{inventory_slot_1_text}","*line_break","$!{inventory_slot_2_text}","*line_break","$!{inventory_slot_3_text}","*line_break","$!{inventory_slot_4_text}","*line_break","$!{inventory_slot_5_text}","*line_break","$!{inventory_slot_6_text}","*line_break","$!{inventory_slot_65_text} ","*line_break","$!{inventory_slot_7_text}","*line_break","$!{inventory_slot_8_text}","","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","    ","*label disable_achievements_consent","","Would you like to disable achievements from popping up during the course of your game and from being awarded to you?","","It's likely best to make this decision and stick with it, so there can be an accurate count of your achievements. ","","*choice","    #Yes, disable achievements.","        *set achievement_preference \"disabled\"","        *goto stats_choice_opti3","    #No, keep achievements enabled.","        *goto stats_choice_opti3 ","    ","*label stats_choice_opti3","","Your preference for achievements has been accounted for. ","","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent","    ","*label enable_achievements_consent","","Would you like to re-enable achievements? ","","They will pop up during the course of your game and be awarded to you. It's likely best to make this decision and stick with it, so there can be an accurate count of your achievements. ","","*choice","    #Yes, enable achievements.","        *set achievement_preference \"enabled\"","        *goto stats_choice_opti4","    #No, keep achievements disabled.","        *goto stats_choice_opti4","    ","*label stats_choice_opti4","","Your preference for achievements has been accounted for.","","*choice","    #Personal Information","        *goto personality_stats","    *selectable_if (physical_attribute = \"true\") #Physical Attributes ","        *goto physical_attributes","    *selectable_if (b_meet = \"true\") #Connections & Social Dynamics","        *goto connections_dynamics_choice","    #Skills & Inventory","        *goto inventory_skills_choice","    *if (achievement_preference = \"enabled\") #Disable Achievements","        *goto disable_achievements_consent","    *if (achievement_preference = \"disabled\") #Enable Achievements","        *goto enable_achievements_consent"], "labels":{"personality_stats":0,"nickname_stat_if_com":9,"screen":51,"physical_attributes":67,"hairstyle_information":76,"connections_dynamics_choice":102,"acquaintances_stats":115,"actual_b_stats":122,"stats_s_start":141,"actual_s_stats":148,"stats_start_r":179,"actual_r_stats":186,"stats_start_j":205,"actual_j_stats":212,"stats_start_m":231,"actual_w_stats":238,"stats_m_con":254,"stats_choice_opti":273,"acquaintance_dynm":289,"actual_b_dyn":296,"b_short_friend_desc_set":318,"b_short_friend_chart":339,"b_short_romance_desc_set":353,"b_potential_romance_chart":359,"s_check_meet":362,"actual_s_dyn":367,"s_short_friend_desc_set":389,"s_short_friend_chart":410,"s_short_romance_desc_set":424,"s_potential_romance_chart":430,"r_check_meet":433,"actual_r_dyn":438,"r_short_friend_desc_set":460,"r_short_friend_chart":481,"r_romance_layers_desc":489,"r_short_romance_desc_set":509,"r_potential_romance_chart":515,"j_check_meet":518,"actual_j_dyn":523,"j_short_friend_desc_set":545,"j_short_friend_chart":566,"jr_romance_layers_desc":574,"j_romance_layers_desc":586,"j_jr_short_romance_desc_set":598,"j_potential_romance_chart":606,"outsmart_the_goto":609,"jr_potential_romance_chart":615,"w_check_meet":617,"actual_w_dyn":622,"m_friendship_range":641,"w_short_friend_desc_set":656,"w_short_friend_chart":671,"w_short_romance_desc_set":681,"w_potential_romance_chart":687,"stats_choice_opti1":690,"acquaintance_dynm_2":706,"actual_msv_dyn":713,"msv_short_friend_desc_set":729,"msv_short_friend_chart":744,"a_check_meet":747,"actual_a_dyn":752,"a_strained_statuses":766,"a_crush_statuses":774,"a_idolized_statuses":782,"a_neutral_statuses":794,"a_frenemies_statuses":802,"a_short_friend_chart":814,"d_check_meet":818,"actual_d_dyn":824,"d_none_statuses":836,"d_bpet_statuses":846,"d_mcduty_statuses":872,"d_mcpet_statuses":890,"d_short_friend_chart":908,"stats_choice_opti2":912,"inventory_skills_choice":928,"explain_skills_stats":940,"explain_skills_stats_yes":956,"skills_stats":987,"skills_continued":997,"skills_stat_chart":1012,"check_combat_stat_1":1032,"choice_options_menu":1038,"inventory_stats":1055,"disable_achievements_consent":1090,"stats_choice_opti3":1103,"enable_achievements_consent":1121,"stats_choice_opti4":1134}},
"choicescript_upgrade": {"crc":0, "lines":[""], "labels":{}},
"preintro": {"crc":101461004, "lines":["*temp w_gender","*temp gatekeep_sincerity \"false\"","*temp gatekeep_snarky \"false\"","*temp gatekeep_friendly \"false\"","*temp gatekeep_aloof \"false\"","*temp gatekeep_merciful \"false\"","*temp gatekeep_cruel \"false\"","*comment preintro","*label tfs2_alpha_welcome","[b][i]The Fernweh Saga: Book Two Alpha Content: Welcome![/i][/b]","*line_break","","Hello [i][b]TFS[/b][/i] Patrons! ","","I hope you're doing well.","","Welcome to the Book Two alpha content. I'm supremely excited for you all to explore it, but first I wanted to offer a heartfelt 'thank you' for your support and provide some information.","","You'll find a character creation setup on the next few pages where you can craft your MC(s) or use a premade character. Right now, I'm keeping it slim so that you can get right into the shiny, new content, but the creation will become longer as the drops/variables stack up. I wanted to avoid breaking your saves; it should be future-proofed for drops at least for a while.","","There is also a short and sweet recap; however, I feel most of you are familiar with Book One.","",">Reminders< ","*line_break","-[i][b]TFS [/b][/i]Discord might be a good place to swap uncovered scenes/comments/tips with readers.","*line_break","-[i][b]TFS[/b][/i] Alpha Content Guidelines: this is a post on Patreon with more details about the alpha.","*line_break","-If you've not had a chance to rate/review [b][i]TFS: Book One[/i][/b], please consider doing so. It helps me and the series!","*line_break","-My email is: [i]lacunafiction@gmail.com[/i], if you have any concerns/questions. ","*line_break","","You can enter the password for this drop on the next page. While I did make it fun, secrecy will always be the most serious aspect to me, so thank you for your consideration!","*page_break ","*label tfs2_alpha_password_prompt","","The hilt of a familiar dagger feels unusually cold within your grasp, stinging your palm and forcing your fingers to spread apart before tensing up. You know better than to drop it again. ","","The fog at your knees is almost impossible to see through as it coalesces within the copse of trees to shroud all but one: a towering beech. Its expanse of silvery bark has a dark sheen to it as if there's a faint shadow overlaying the bark. The tips of your fingers lack any splinters; you've kept a hand on it. It's the only thing that seems tangible in this eerie, in-between place\u2026","","What word do you [i]carve[/i] into its wood?","","It is waiting along with you. ","","*choice","    #Raise the dagger to begin carving a specific word.","        Please enter the password for this round of alpha content, no caps. Thank you!","        *input_text alpha_password","        *goto tfs2_alpha_password_start","    #Hesitate with the dagger held aloft. It feels like you're trespassing.","        *goto tfs2_alpha_welcome","*page_break ","","*comment Yes, I'm fully aware there are ways to get around this little ethics check, lol. But if someone is that dedicated, then we will see how that benefits them in the long run. :-) ","","*label tfs2_alpha_password_check","","*if (alpha_password = \"fealty\") ","    You have just finished notching the diagonal line of the 'y' when the bark starts to crack open, widening along the seams of your carving. Beeches don't produce much sap, and they definitely shouldn't be oozing out a burbling black substance. It's like you just smashed a well of ink against the bark rather than making targeted cuts with your blade into a creepy tree.","    ","    All you see is ebony as the word\u2014the vow\u2014splits along each letter, flowing and then gushing until you have to stumble backwards in shock, foot catching on a root. Your nails scrabble across the too smooth bark; there's no grip to be had. You fall into the thick fog, but even it retreats from the torrent coming from the tree, fearfully receding within seconds.","    ","    It's staining you\u2014no, it's going to [i]drown[/i] you.","    ","    There's only a chilling black on all sides that clings and latches on; it welcomes you home.   ","    *page_break [b][i]One of Us. One of Us. One of Us.[/i][/b]","    *goto tfs2_alpha_password_start","*else","    You have just finished notching the last line of your word when the bark starts to crack open, widening along the seams of your carving. Beeches don't produce much sap, and they definitely shouldn't be oozing out a burbling crimson substance. It's like you just grievously wounded something of flesh and blood rather than making a choice to carve into a random tree.","    ","    All you see is red as the word\u2014the mistake\u2014splits along each letter, flowing and then gushing until you have to stumble backwards in shock, foot catching on a root. Your nails scrabble across the too smooth bark; there's no grip to be had. You fall into the thick fog.","    ","    There's only a chilling white on all sides that rushes in to fill any gap; it eagerly consumes you. ","    *page_break [b][i]Commit to Being One with Us or Leave This Place[/i][/b]","    *goto tfs2_alpha_password_prompt","","*label tfs2_alpha_password_start","","(Maybe 'fun' wasn't the right word for the password section. Oh well, let's get into Book Two.)","","[b][i]The Fernweh Saga: Book Two Alpha Content[/i][/b]","*line_break","","It has been a few weeks since your return visit to your hometown ended in a permanent stay.","","Bittersweet memories, harrowing nightmares, and a rising sense of unease plague you, while the townsfolk have quickly readopted their ordinary routines, unaware of what lurks in the woods. It would be easy to feel alone, if not for the people who stood by your side through it all. Together you might be able to continue to uncover what's going on within Fernweh's borders.","","Your unexpected residency comes with more than just unanswered questions about the town\u2026","","Explore the continuation of the romance you were starting to develop.","","Though much like your tentative feelings and bouts of eddying dread, something else waits beneath the surface, roiling and rippling as it gains more substance to pull you back under.","*line_break","_ _ _ _","","[i][b]The Fernweh Saga[/b][/i] is an immersive, romantic thriller interactive fiction series with slow-build horror and suspense elements that unravel as you move deeper into the plot. ","","I hope you enjoy your time in Fernweh! ","*page_break Get Started","*rand w_gender 1 2","","*label tfs2_alpha_character_menu","","Let's decide how the continuation of your visit should play out.","","[b]Short Recap:[/b] The events of Book One will be briefly recapped in four pages; then you can select which method of character creation is best for you.","","[b]Alpha Content Character Creation:[/b] You select what choices your character made that are relevant to the currently available alpha content. Eventually, more choices will be added to reflect your Book One playthrough. (Recommended)","","[b]Pre-made Character for the Alpha Content:[/b] You select a pre-made character. This lets you get right into the story. ","","*choice ","    #Read the short recap of Book One","        *goto tfs2_alpha_recap","    #Alpha Content Character Creation","        *goto tfs2_alpha_cc","    #Pre-made Character for the Alpha Content","        *goto tfs2_alpha_pre","    ","*label tfs2_alpha_recap","","You returned to your hometown of Fernweh in Book One.","","It had been years since you were last in town. You were sent away following the tragic house fire that claimed your parents' lives, but the death of your grandfather brought you back.","","While grim circumstances overshadowed the visit you never planned on making, there were also opportunities to reminisce, reconnect, and reunite with old childhood friends, rivals, and neighbors. You even brought along a friend to make the trip more bearable. Signing legal documents and tying up the loose ends were only the start of what you had to deal with\u2026","","Vivid nightmares, hazy memories, and bittersweet nostalgia resurfaced during your homecoming.","*page_break ","","You learned that your grandfather didn't die from natural causes.","","A freak animal attack was said to be the cause, but something wasn't adding up. ","","Joining an off-the-books, side investigation into his death wasn't exactly the closure you were looking for\u2026 ","","As more questions piled up about how and why your grandfather died in Fernweh's woods, a local kid went missing, which led to you discovering a mutilated, dead boar in the woods. If there could be a link between the two resulted in you visiting the coroner's office for additional autopsy details. More questions required you to search elsewhere in town, though the chance of an animal randomly attacking your grandfather seemed to become slimmer and slimmer. ","","Your sleepless nights were also piling up, allowing your mind to conjure up night terrors that seemed to twist your feelings for those around you until cruel caricatures invaded your dreams.","*page_break ","","Another visit out to your grandfather's cabin only added to the odd finds you had discovered.","","An encyclopedia of the occult, a meticulously hand-drawn picture of you, and markings along a door frame were now joined by a mini-arsenal of weapons in the root cellar. It seemed like another question without a clear answer, until you finally got a solid, if a little wet, lead. A stray dog your grandfather used to take care of left the bloody hat of the missing kid on the porch. ","","She was able to track the scent, guiding you and the others to a sunken, lush clearing\u2026","","Sadly, there were more than just blackberry bushes in the copse of trees. Bloated, deep green plant pods were affixed to trunks, acting as storage containers for prey. You came face to face with a wicked tree creature. It waited and watched before engaging you in a fight for survival.","","Everyone made it through the night, but you would never be able to look at the forest again in the same way.","*page_break ","","You signed all the paperwork. The missing kid was found. Your grandfather's murderer was ash. ","","And yet, the inklings of dread you felt during the visit would sometimes creep back in. Luckily, you were finally leaving town, and even had a special someone, or someones, to send you off.","","Getting the chance to actually say goodbye this time isn't something you passed up, but you soon realized it wasn't necessary. Your newly repaired car started acting up the closer you got to the town line. That infernal ticking noise started again, the lights dimmed, and a particular song oozed out of the radio before it died, and with it, your hope of leaving started to decay.  ","","The friend you brought for the visit attempted to leave by walking along the main road, but somehow came back from the opposite direction, seemingly looping back around. ","","A disorienting feeling of vertigo threatened to overwhelm you as the chilling realization set in.","","You would not be leaving Fernweh. ","","You could not\u2026","*page_break ","*goto tfs2_alpha_character_menu","","*label tfs2_alpha_cc","","[b]Alpha Content Character Creation\u2026[/b]","*line_break","- - -","","This should be a relatively streamlined MC creation process; it loosely follows Book One's story, but the questions are more to the point than couched in narrative. You'll be in Book Two soon.","","(Soon-ish? Please rest assured every choice links to a used variable. Thanks for understanding.) ","","Please select a gender identity and orientation. ","","*fake_choice ","    #Gay Woman: Uses she/her pronouns, attracted to women. ","        *set gender \"female\"","        *set pc_he \"she\"","        *set pc_him \"her\"","        *set pc_his \"her\"","        *set pc_hiss \"hers\" ","        *set is \"is\"","        *set was \"was\"","        *set pc_man \"woman\"","        *set pc_boy \"girl\"","        *set pc_sir \"miss\"","        *set pc_son \"daughter\"","        *set mc_plural false","        *set attraction \"women\"","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","    #Bisexual Woman: Uses she/her pronouns, attracted to both men and women.","        *set gender \"female\"","        *set pc_he \"she\"","        *set pc_him \"her\"","        *set pc_his \"her\"","        *set pc_hiss \"hers\" ","        *set is \"is\"","        *set was \"was\"","        *set pc_man \"woman\"","        *set pc_boy \"girl\"","        *set pc_sir \"miss\"","        *set pc_son \"daughter\"","        *set mc_plural false","        *set attraction \"both\"","   #Straight Woman: Uses she/her pronouns, attracted to men.","        *set gender \"female\"","        *set pc_he \"she\"","        *set pc_him \"her\"","        *set pc_his \"her\"","        *set pc_hiss \"hers\" ","        *set is \"is\"","        *set was \"was\"","        *set pc_man \"woman\"","        *set pc_boy \"girl\"","        *set pc_sir \"miss\"","        *set pc_son \"daughter\"","        *set mc_plural false","        *set attraction \"men\"","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","   #Gay Man: Uses he/him pronouns, attracted to men. ","        *set gender \"male\"","        *set mc_plural false","        *set attraction \"men\"","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","   #Bisexual Man: Uses he/him pronouns, attracted to both men and women.","        *set gender \"male\"","        *set mc_plural false","        *set attraction \"both\"  ","   #Straight Man: Uses he/him pronouns, attracted to women.","        *set gender \"male\"","        *set mc_plural false","        *set attraction \"women\"","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","   #Non-binary person attracted to women. Uses they/them pronouns. ","        *set gender \"non-binary\" ","        *set pc_he \"they\"","        *set pc_him \"them\"","        *set pc_his \"their\"","        *set pc_hiss \"theirs\" ","        *set is \"are\"","        *set was \"were\"","        *set pc_man \"person\"","        *set pc_sir \"ser\"","        *set pc_son \"child\"","        *set pc_boy \"child\"","        *set mc_plural true","        *set attraction \"women\"","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","   #Non-binary person attracted to both men and women. Uses they/them pronouns. ","        *set gender \"non-binary\" ","        *set pc_he \"they\"","        *set pc_him \"them\"","        *set pc_his \"their\"","        *set pc_hiss \"theirs\"","        *set is \"are\"","        *set was \"were\"","        *set pc_man \"person\"","        *set pc_sir \"ser\"","        *set pc_son \"child\"","        *set pc_boy \"child\"","        *set mc_plural true","        *set attraction \"both\"","   #Non-binary person attracted to men. Uses they/them pronouns.","        *set gender \"non-binary\" ","        *set pc_he \"they\"","        *set pc_him \"them\"","        *set pc_his \"their\"","        *set pc_hiss \"theirs\"","        *set is \"are\"","        *set was \"were\"","        *set pc_man \"person\"","        *set pc_sir \"ser\"","        *set pc_son \"child\"","        *set pc_boy \"child\"","        *set mc_plural true","        *set attraction \"men\"","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","*page_break","","*if (attraction = \"both\") ","    *goto quick_cc_set_mal ","*else","    *goto quick_character_choices_2","","*label quick_cc_set_mal ","*if (w_gender = 1)","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","        *goto quick_character_choices_2","*elseif (w_gender = 2)","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","        *goto quick_character_choices_2","        ","*label quick_character_choices_2","","Please select or enter in a first name. ","","*label quick_character_firstname","","*choice ","    *if (gender = \"female\") #Malia ","        *set name \"malia\" ","        *goto name_check_thing","    *if (gender = \"female\") #Diana  ","        *set name \"diana\" ","        *goto name_check_thing","    *if (gender = \"female\") #Kim","        *set name \"kim\" ","        *goto name_check_thing","    *if (gender = \"female\") #Evie","        *set name \"evie\" ","        *goto name_check_thing","    *if (gender = \"female\") #Kamala ","        *set name \"kamala\" ","        *goto name_check_thing","    *if (gender = \"female\") #Lena ","        *set name \"lena\" ","        *goto name_check_thing","    *if (gender = \"female\") #Valerie ","        *set name \"valerie\" ","        *goto name_check_thing","    *if (gender = \"male\") #Derek ","        *set name \"derek\" ","        *goto name_check_thing","    *if (gender = \"male\") #Steve ","        *set name \"steve\" ","        *goto name_check_thing","    *if (gender = \"male\") #Jerome ","        *set name \"jerome\" ","        *goto name_check_thing","    *if (gender = \"male\") #Jay ","        *set name \"jay\" ","        *goto name_check_thing","    *if (gender = \"male\") #Michael  ","        *set name \"michael\" ","        *goto name_check_thing","    *if (gender = \"male\") #Andre ","        *set name \"andre\" ","        *goto name_check_thing","    *if (gender = \"non-binary\") #Jesse ","        *set name \"jesse\" ","        *goto name_check_thing","    *if (gender = \"non-binary\") #Taylor ","        *set name \"taylor\" ","        *goto name_check_thing","    *if (gender = \"non-binary\") #Kennedy ","        *set name \"kennedy\" ","        *goto name_check_thing","    *if (gender = \"non-binary\") #Razi  ","        *set name \"razi\" ","        *goto name_check_thing","    *if (gender = \"non-binary\") #Clark ","        *set name \"clark\" ","        *goto name_check_thing","    *if (gender = \"non-binary\") #Erin ","        *set name \"erin\" ","        *goto name_check_thing","    #None of these","        Please type your first name below. ","        *input_text name   ","*page_break","","*label name_check_thing","*if ((name = \"reese\") or (name = \"Reese\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"ruby\") or (name = \"Ruby\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"beckett\") or (name = \"Beckett\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"becca\") or (name = \"Becca\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"silas\")  or (name = \"Silas\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"sofia\") or (name = \"Sofia\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"james\") or (name = \"James\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"jane\") or (name = \"Jane\"))","    This name will be in use by a main character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"milton\") or (name = \"Milton\"))","    This name will be in use by a character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"alex\") or (name = \"Alex\"))","    This name will be in use by a character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"alek\") or (name = \"Alek\"))","    This name will be in use by a character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"alina\") or (name = \"Alina\"))","    This name will be in use by a character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"mallory\") or (name = \"Mallory\"))","    This name will be in use by a character in the game. Would you like to change it? ","    *goto name_change_pos","*elseif ((name = \"malachi\") or (name = \"Malachi\"))","    This name will be in use by a character in the game. Would you like to change it? ","    *goto name_change_pos","*else ","    *goto quick_character_choices_3","","*label name_change_pos ","*choice","    #Yes, change your name to something else.","        *page_break","        *goto quick_character_firstname","    #No, continue with the story. ","        *page_break ","        *goto quick_character_choices_3","    ","*label quick_character_choices_3","","$!{name} has a nice ring to it, but do you have a nickname too? ","","*fake_choice","    #Yes, you have a nickname that your friends use.","        Please type your nickname below. ","        *input_text nickname ","        *set pc_nickname true ","    #No, you don't have a nickname that you prefer your friends to use. ","        *set pc_nickname false","*page_break ","","Please select or enter in a surname below.","","*label quick_character_surname","","*fake_choice","    #Beckham","        *set surname \"beckham\" ","    #Wallis","        *set surname \"wallis\"","    #Zane","        *set surname \"zane\"","    #Nottingham","        *set surname \"nottingham\" ","    #Clanton","        *set surname \"clanton\"","    #Amell ","        *set surname \"amell\" ","    #Rivera","        *set surname \"rivera\"","    #Rogel","        *set surname \"rogel\"","    #Gnam","        *set surname \"gnam\"","    #Clifton","        *set surname \"clifton\" ","    #None of these","        Please enter your last name below. ","        *input_text surname","*page_break","","*if ((surname = \"verner\") or (surname = \"Verner\")) ","    Sorry, this last name is already in use by a main character in the game. Please select another one.","    *goto quick_character_surname","*elseif ((surname = \"corvin\") or (surname = \"Corvin\"))","    Sorry, this last name is already in use by a main character in the game. Please select another one.","    *goto quick_character_surname","*elseif ((surname = \"dorran\") or (surname = \"Dorran\"))","    Sorry, this last name is already in use by a main character in the game. Please select another one.","    *goto quick_character_surname","*elseif ((surname = \"warrick\") or (surname = \"Warrick\"))","    Sorry, this last name is already in use by a main character in the game. Please select another one.","    *goto quick_character_surname","*elseif ((surname = \"callaway\") or (surname = \"Callaway\"))","    Sorry, this last name is already in use by a character in the game. Please select another one.","    *goto quick_character_surname","*elseif ((surname = \"bowers\") or (surname = \"Bowers\"))","    Sorry, this last name is already in use by a character in the game. Please select another one.","    *goto quick_character_surname","*else ","    *goto quick_character_choices_4","","*label quick_character_choices_4","","It's hard to forget the $!{surname} name. ","","It was granted to you from your mother's side of the family. Her father\u2014your grandfather\u2014was known as\u2026","","*fake_choice","    #\u2026Kenneth","        *set grandfather_name \"kenneth\" ","    #\u2026Dan","        *set grandfather_name \"dan\"","    #\u2026Ben","        *set grandfather_name \"ben\"","    #\u2026Jose","        *set grandfather_name \"jose\"","    #\u2026Clint","        *set grandfather_name \"clint\"","    #\u2026Martin ","        *set grandfather_name \"martin\" ","    #\u2026Luca","        *set grandfather_name \"luca\"","    #Something else","        Please type the name of your grandfather below.","        *input_text grandfather_name    ","*page_break","","It had been years since you last saw your grandfather, but you still recall his features. ","","What color are your own eyes?","","*fake_choice","    #Light Blue","        *set pc_eye_color \"light blue\" ","    #Dark Blue","        *set pc_eye_color \"dark blue\"","    #Gray","        *set pc_eye_color \"gray\" ","    #Light Green ","        *set pc_eye_color \"light green\" ","    #Dark Green ","        *set pc_eye_color \"dark green\" ","    #Hazel","        *set pc_eye_color \"hazel\" ","    #Light Brown ","        *set pc_eye_color \"light brown\" ","    #Dark Brown ","        *set pc_eye_color \"dark brown\" ","    #They are a more specific color. ","        Please type a color for your eyes below.  ","        *input_text pc_eye_color","*page_break","*set physical_attribute \"true\"","What color is your hair?","","*choice ","    #It is my natural hair color.","        *set pc_hair_dyed \"false\"","        *goto quick_natural_color_1","    #It is dyed a specific color.","        *set pc_hair_dyed \"true\"","        *goto quick_dyed_color","*page_break","","*label quick_natural_color_1","","Please select a hair color. ","","*if ((gender = \"male\") or (gender = \"non-binary\")) ","    *goto quick_natural_color_1_mnb","*elseif (gender = \"female\") ","    *goto quick_natural_color_1_fem","","*label quick_natural_color_1_mnb","   ","*choice","    #Platinum Blond","        *set pc_natural_hair_color \"platinum blond\"","        *set pc_hair_color \"platinum blond\"","        *goto quick_hair_style","    #Ash Blond","        *set pc_natural_hair_color \"ash blond\"","        *set pc_hair_color \"ash blond\"","        *goto quick_hair_style","    #Warm Blond","        *set pc_natural_hair_color \"warm blond\"","        *set pc_hair_color \"warm blond\"","        *goto quick_hair_style","    #Strawberry Blond","        *set pc_natural_hair_color \"strawberry blond\"","        *set pc_hair_color \"strawberry blond\"","        *goto quick_hair_style","    #Light Red","        *set pc_natural_hair_color \"light red\"","        *set pc_hair_color \"light red\"","        *goto quick_hair_style","    #Deep Red","        *set pc_natural_hair_color \"deep red\"","        *set pc_hair_color \"deep red\"","        *goto quick_hair_style","    #Russet Red","        *set pc_natural_hair_color \"russet red\"","        *set pc_hair_color \"russet red\" ","        *goto quick_hair_style","    #Auburn Red","        *set pc_natural_hair_color \"auburn red\"","        *set pc_hair_color \"auburn red\" ","        *goto quick_hair_style","    #Light Brown","        *set pc_natural_hair_color \"light brown\"","        *set pc_hair_color \"light brown\" ","        *goto quick_hair_style","    #Golden Brown","        *set pc_natural_hair_color \"golden brown\"","        *set pc_hair_color \"golden brown\"","        *goto quick_hair_style","    #Medium Brown","        *set pc_natural_hair_color \"medium brown\"","        *set pc_hair_color \"medium brown\" ","        *goto quick_hair_style","    #Dark Brown","        *set pc_natural_hair_color \"dark brown\"","        *set pc_hair_color \"dark brown\" ","        *goto quick_hair_style","    #Brown Black ","        *set pc_natural_hair_color \"brown black\"","        *set pc_hair_color \"brown black\"","        *goto quick_hair_style","    #Blue Black","        *set pc_natural_hair_color \"blue black\"","        *set pc_hair_color \"blue black\" ","        *goto quick_hair_style","    #Raven","        *set pc_natural_hair_color \"raven\"","        *set pc_hair_color \"raven\" ","        *goto quick_hair_style","    #It is a different color.","        Please type a color for your hair below. ","        *input_text pc_hair_color","        *goto q_nat_col_conf1_mnb","*page_break","","*label quick_natural_color_1_fem","","*choice","    #Platinum Blonde","        *set pc_natural_hair_color \"platinum blonde\"","        *set pc_hair_color \"platinum blonde\"","        *goto quick_hair_style","    #Ash Blonde","        *set pc_natural_hair_color \"ash blonde\"","        *set pc_hair_color \"ash blonde\"","        *goto quick_hair_style","    #Warm Blonde","        *set pc_natural_hair_color \"warm blonde\"","        *set pc_hair_color \"warm blonde\"","        *goto quick_hair_style","    #Strawberry Blonde","        *set pc_natural_hair_color \"strawberry blonde\"","        *set pc_hair_color \"strawberry blonde\"","        *goto quick_hair_style","    #Light Red","        *set pc_natural_hair_color \"light red\"","        *set pc_hair_color \"light red\"","        *goto quick_hair_style","    #Deep Red","        *set pc_natural_hair_color \"deep red\"","        *set pc_hair_color \"deep red\"","        *goto quick_hair_style","    #Russet Red","        *set pc_natural_hair_color \"russet red\"","        *set pc_hair_color \"russet red\" ","        *goto quick_hair_style","    #Auburn Red","        *set pc_natural_hair_color \"auburn red\"","        *set pc_hair_color \"auburn red\" ","        *goto quick_hair_style","    #Light Brown","        *set pc_natural_hair_color \"light brown\"","        *set pc_hair_color \"light brown\" ","        *goto quick_hair_style","    #Golden Brown","        *set pc_natural_hair_color \"golden brown\"","        *set pc_hair_color \"golden brown\"","        *goto quick_hair_style","    #Medium Brown","        *set pc_natural_hair_color \"medium brown\"","        *set pc_hair_color \"medium brown\" ","        *goto quick_hair_style","    #Dark Brown","        *set pc_natural_hair_color \"dark brown\"","        *set pc_hair_color \"dark brown\" ","        *goto quick_hair_style","    #Brown Black ","        *set pc_natural_hair_color \"brown black\"","        *set pc_hair_color \"brown black\"","        *goto quick_hair_style","    #Blue Black","        *set pc_natural_hair_color \"blue black\"","        *set pc_hair_color \"blue black\" ","        *goto quick_hair_style","    #Raven","        *set pc_natural_hair_color \"raven\"","        *set pc_hair_color \"raven\" ","        *goto quick_hair_style","    #It is a different color.","        Please type a color for your hair below. ","        *input_text pc_hair_color","        *goto q_nat_col_conf1_fem","*page_break","","*label q_nat_col_conf1_mnb","","Your hair color is ${pc_hair_color}?","","*choice","    #Yes.","        *goto quick_nat_col_reent","    #No.","        *goto quick_natural_color_1_mnb","*page_break","","*label q_nat_col_conf1_fem","","Your hair color is ${pc_hair_color}?","","*choice","    #Yes.","        *goto quick_nat_col_reent","    #No.","        *goto quick_natural_color_1_fem","*page_break","","*label quick_nat_col_reent","","Your hair color is ${pc_hair_color}.","","Please reenter your hair color as written above.","*input_text pc_natural_hair_color","*page_break","*goto quick_hair_style","","*label quick_dyed_color","","Please select a color for your dyed hair. ","","*choice","    #Rose Gold","        *set pc_dyed_hair_color \"rose gold\"","        *set pc_hair_color \"rose gold\"","        *goto quick_natural_color_2","    #Light Pink","        *set pc_dyed_hair_color \"light pink\"","        *set pc_hair_color \"light pink\"","        *goto quick_natural_color_2","    #Coral Pink","        *set pc_dyed_hair_color \"coral pink\"","        *set pc_hair_color \"coral pink\"","        *goto quick_natural_color_2","    #Magenta","        *set pc_dyed_hair_color \"magenta\"","        *set pc_hair_color \"magenta\" ","        *goto quick_natural_color_2","    #Lavender","        *set pc_dyed_hair_color \"lavender\"","        *set pc_hair_color \"lavender\"","        *goto quick_natural_color_2","    #Blue Violet","        *set pc_dyed_hair_color \"blue violet\"","        *set pc_hair_color \"blue violet\"","        *goto quick_natural_color_2","    #Deep Purple","        *set pc_dyed_hair_color \"deep purple\"","        *set pc_hair_color \"deep purple\"","        *goto quick_natural_color_2","    #Indigo","        *set pc_dyed_hair_color \"indigo\"","        *set pc_hair_color \"indigo\" ","        *goto quick_natural_color_2","    #Royal Blue","        *set pc_dyed_hair_color \"royal blue\"","        *set pc_hair_color \"royal blue\" ","        *goto quick_natural_color_2","    #Electric Blue","        *set pc_dyed_hair_color \"electric blue\"","        *set pc_hair_color \"electric blue\" ","        *goto quick_natural_color_2","    #Sky Blue","        *set pc_dyed_hair_color \"sky blue\"","        *set pc_hair_color \"sky blue\" ","        *goto quick_natural_color_2","    #Aqua","        *set pc_dyed_hair_color \"aqua\"","        *set pc_hair_color \"aqua\"","        *goto quick_natural_color_2","    #Tea Green","        *set pc_dyed_hair_color \"tea green\"","        *set pc_hair_color \"tea green\" ","        *goto quick_natural_color_2","    #Neon Green","        *set pc_dyed_hair_color \"neon green\"","        *set pc_hair_color \"neon green\" ","        *goto quick_natural_color_2","    #Dark Green","        *set pc_dyed_hair_color \"dark green\"","        *set pc_hair_color \"dark green\" ","        *goto quick_natural_color_2","    #It is dyed a different color.","        Please type a color for your hair below. ","        *input_text pc_hair_color","        *goto quick_dye_col_conf","*page_break","","*label quick_dye_col_conf","","Your hair color is ${pc_hair_color}?","","*choice","    #Yes.","        *goto quick_dye_col_reent","    #No.","        *goto quick_dyed_color","*page_break","","*label quick_dye_col_reent","","Your hair color is ${pc_hair_color}.","","Please reenter your hair color as written above.","*input_text pc_dyed_hair_color","*page_break","*goto quick_natural_color_2","","*label quick_natural_color_2","","And what is your natural hair color?","","*if ((gender = \"male\") or (gender = \"non-binary\")) ","    *goto quick_natural_color_2_mnb","*elseif (gender = \"female\") ","    *goto quick_natural_color_2_fem","","*label quick_natural_color_2_mnb","","*choice","    #Platinum Blond","        *set pc_natural_hair_color \"platinum blond\"","        *goto quick_hair_style","    #Ash Blond","        *set pc_natural_hair_color \"ash blond\"","        *goto quick_hair_style","    #Warm Blond","        *set pc_natural_hair_color \"warm blond\"","        *goto quick_hair_style","    #Strawberry Blond","        *set pc_natural_hair_color \"strawberry blond\"","        *goto quick_hair_style","    #Light Red","        *set pc_natural_hair_color \"light red\"","        *goto quick_hair_style","    #Deep Red","        *set pc_natural_hair_color \"deep red\"","        *goto quick_hair_style","    #Russet Red","        *set pc_natural_hair_color \"russet red\"","        *goto quick_hair_style","    #Auburn Red","        *set pc_natural_hair_color \"auburn red\"","        *goto quick_hair_style","    #Light Brown","        *set pc_natural_hair_color \"light brown\"","        *goto quick_hair_style","    #Golden Brown","        *set pc_natural_hair_color \"golden brown\"","        *goto quick_hair_style","    #Medium Brown","        *set pc_natural_hair_color \"medium brown\"","        *goto quick_hair_style","    #Dark Brown","        *set pc_natural_hair_color \"dark brown\"","        *goto quick_hair_style","    #Brown Black ","        *set pc_natural_hair_color \"brown black\"","        *goto quick_hair_style","    #Blue Black","        *set pc_natural_hair_color \"blue black\"","        *goto quick_hair_style","    #Raven","        *set pc_natural_hair_color \"raven\"","        *goto quick_hair_style","    #It is a different color.","        Please type a color for your hair below. ","        *input_text pc_natural_hair_color","        *goto q_nat_col_conf2_mnb","*page_break","","*label quick_natural_color_2_fem","","*choice","    #Platinum Blonde","        *set pc_natural_hair_color \"platinum blonde\"","        *goto quick_hair_style","    #Ash Blonde","        *set pc_natural_hair_color \"ash blonde\"","        *goto quick_hair_style","    #Warm Blonde","        *set pc_natural_hair_color \"warm blonde\"","        *goto quick_hair_style","    #Strawberry Blonde","        *set pc_natural_hair_color \"strawberry blonde\"","        *goto quick_hair_style","    #Light Red","        *set pc_natural_hair_color \"light red\"","        *goto quick_hair_style","    #Deep Red","        *set pc_natural_hair_color \"deep red\"","        *goto quick_hair_style","    #Russet Red","        *set pc_natural_hair_color \"russet red\"","        *goto quick_hair_style","    #Auburn Red","        *set pc_natural_hair_color \"auburn red\"","        *goto quick_hair_style","    #Light Brown","        *set pc_natural_hair_color \"light brown\"","        *goto quick_hair_style","    #Golden Brown","        *set pc_natural_hair_color \"golden brown\"","        *goto quick_hair_style","    #Medium Brown","        *set pc_natural_hair_color \"medium brown\"","        *goto quick_hair_style","    #Dark Brown","        *set pc_natural_hair_color \"dark brown\"","        *goto quick_hair_style","    #Brown Black ","        *set pc_natural_hair_color \"brown black\"","        *goto quick_hair_style","    #Blue Black","        *set pc_natural_hair_color \"blue black\"","        *goto quick_hair_style","    #Raven","        *set pc_natural_hair_color \"raven\"","        *goto quick_hair_style","    #It is a different color.","        Please type a color for your hair below. ","        *input_text pc_natural_hair_color","        *goto q_nat_col_conf2_fem","*page_break","","*label q_nat_col_conf2_mnb","","Your natural hair color is ${pc_natural_hair_color}?","","*choice","    #Yes.","        *goto quick_hair_style","    #No.","        *goto quick_natural_color_2_mnb","*page_break","","*label q_nat_col_conf2_fem","","Your natural hair color is ${pc_natural_hair_color}?","","*choice","    #Yes.","        *goto quick_hair_style","    #No.","        *goto quick_natural_color_2_fem","*page_break","","*label quick_hair_style","","What is the style of your ${pc_hair_color} hair?","","*fake_choice","    #Long length that goes below your shoulder blades.","        *set pc_hair_style \"long length\" ","    #Medium length that touches your shoulders.","        *set pc_hair_style \"medium length\" ","    #Short length that is cut to be alongside your jaw.","        *set pc_hair_style \"short length\" ","    #Very short length that is cut cropped and closer to your scalp. ","        *set pc_hair_style \"very short length\" ","    #Shaved to create a bare scalp.","        *set pc_hair_style \"shaved\" ","*page_break","","How tall are you? ","","*fake_choice","    #You are very tall. (Height 6'2\" and greater.)","        *set pc_height \"very tall\"","    #You are tall. (Height 5'8\" to  6'1\".)","        *set pc_height \"tall\"","    #You are an average height. (Height 5'5\" to 5'7\".)","        *set pc_height \"average\" ","    #You are short. (Height 5'4\" and under.)","        *set pc_height \"short\"","*page_break","","([b]Note[/b]: There will be choices later on in the creation process to set friendship levels, including selecting your character's best friend. The displayed text will update [i]after[/i] you make those decisions. You should expect lukewarm statuses until you award those affinity points, if you check the relationship/friendship dynamics while moving through this section.)","","Returning to town was due to your grandfather's death, but bringing along your friend made the visit more bearable.","","You were lucky to have\u2026","","*fake_choice","    #\u2026Beckett with you. He loyally stayed by your side, offering support when possible.","        *set beckett \"Beckett\"","        *set b_him \"him\"","        *set b_his \"his\"","        *set b_man \"man\" ","        *set b_she \"he\"","        *set b_hiss \"his\"","        *set b_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set beckett_romanceable \"true\"","            *goto quick_character_choices_5","        *elseif (attraction = \"women\") ","            *set beckett_romanceable \"false\"","            *goto quick_character_choices_5","    #\u2026Becca with you. She loyally stayed by your side, offering support when possible.","        *set beckett \"Becca\"","        *set b_him \"her\"","        *set b_his \"her\"","        *set b_man \"woman\" ","        *set b_she \"she\"","        *set b_hiss \"hers\"","        *set b_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set beckett_romanceable \"true\"","            *goto quick_character_choices_5","        *elseif (attraction = \"men\") ","            *set beckett_romanceable \"false\"","            *goto quick_character_choices_5","*page_break ","","*label quick_character_choices_5","","You and $!{beckett} stayed at a bed and breakfast owned by the Dorrans.","","Mrs. Dorran's appreciation for art was reflected in her interior design choices. Please select a room theme.","","*fake_choice","    #\u2026Safari Slumber.","        *set room_theme \"safari slumber\"","        *set rt1 \"safari\"","        *set rt2 \"slumber\"","    #\u2026Cat's Cradle.","        *set room_theme \"cat's cradle\"","        *set rt1 \"cat's\"","        *set rt2 \"cradle\"","    #\u2026Nautical Nap.","        *set room_theme \"nautical nap\"","        *set rt1 \"nautical\"","        *set rt2 \"nap\"","    #\u2026Rockin' Rest.","        *set room_theme \"rockin' rest\"","        *set rt1 \"rockin'\"","        *set rt2 \"rest\"","    #\u2026Futuristic Futon.","        *set room_theme \"futuristic futon\"","        *set rt1 \"futuristic\"","        *set rt2 \"futon\"","    #\u2026Zombie Zen.","        *set room_theme \"zombie zen\" ","        *set rt1 \"zombie\"","        *set rt2 \"zen\"","    #\u2026Royal Retreat.","        *set room_theme \"royal retreat\" ","        *set rt1 \"royal\"","        *set rt2 \"retreat\"","*page_break","","Mrs. Dorran asked her reserved, but undoubtedly considerate, child to help you get settled in. ","","*fake_choice","    #Silas assisted without complaint. His quiet, grounding presence helped during the visit.","        *set silas \"Silas\" ","        *set s_him \"him\"","        *set s_his \"his\"","        *set s_man \"man\"","        *set s_she \"he\"","        *set s_hiss \"his\"","        *set s_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set silas_romanceable \"true\"","            *goto quick_character_choices_6","        *elseif (attraction = \"women\") ","            *set silas_romanceable \"false\"","            *goto quick_character_choices_6","    #Sofia assisted without complaint. Her quiet, grounding presence helped during the visit.","        *set silas \"Sofia\" ","        *set s_him \"her\"","        *set s_his \"her\"","        *set s_man \"woman\"","        *set s_she \"she\"","        *set s_hiss \"hers\"","        *set s_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set silas_romanceable \"true\"","            *goto quick_character_choices_6","        *elseif (attraction = \"men\") ","            *set silas_romanceable \"false\"","            *goto quick_character_choices_6","*page_break","","*label quick_character_choices_6","","'Well-rested' or 'rejuvenated' didn't characterize your first night's sleep in Fernweh.","","You had places to go and paperwork to sign while settling your grandfather's estate and affairs.","","Please select your preferred attire.","","*fake_choice","    #Sporty: joggers, a light jacket, and a sleeveless top.","        *set attire \"sporty\"","        *set top \"A sleeveless top with a light jacket and\" ","        *set bottom \"joggers\" ","    #Casual: jeans and a favorite T-shirt.","        *set attire \"casual\"","        *set top \"A favorite T-shirt and\" ","        *set bottom \"jeans\" ","    #Comfortable: a hoodie, undershirt, and jeans.","        *set attire \"comfortable\"","        *set top \"An undershirt with a hoodie and\" ","        *set bottom \"jeans\" ","    #Colorful: a brightly colored or patterned dress with a light sweater.","        *set attire \"colorful\"","        *set top \"A brightly colored or patterned dress and a\" ","        *set bottom \"light sweater\" ","    #Colorful: a brightly colored or patterned shirt with cargo pants.","        *set attire \"colorful\"","        *set top \"A brightly colored or patterned shirt and\"","        *set bottom \"cargo pants\" ","    #Business Casual: a sweater, collared shirt, and formal pants.","        *set attire \"business casual\"","        *set top \"A collared shirt with a sweater and\" ","        *set bottom \"formal pants\" ","    #Business Formal: a collared shirt, blazer, and formal pants.","        *set attire \"business formal\"","        *set top \"A collared shirt with a blazer and\" ","        *set bottom \"formal pants\" ","    #Leather: a leather jacket, a white undershirt, and dark pants.","        *set attire \"leather\"","        *set top \"A leather jacket with an undershirt and\" ","        *set bottom \"dark pants\" ","    #Lace: a lacey blouse accented with accessories and paired with a simple skirt.","        *set attire \"lace\"","        *set top \"A lacey blouse accented with accessories and a\" ","        *set bottom \"skirt\"","    #Denim: a denim jacket, colorful T-shirt, and jeans.","        *set attire \"denim\"","        *set top \"A denim jacket with a colorful T-shirt and\" ","        *set bottom \"jeans\"","*page_break ","","Returning to your hometown meant meeting both new and old faces. ","","What is your first instinct or inclination when reacting to things?","","*choice","    #Sincerity","        *set sincerity +17","        *set gatekeep_sincerity \"true\"","        Sometimes you also react in a way that is\u2026","        *choice","            #Snarky","                *set sincerity -12","                *set gatekeep_snarky \"true\"","                *goto quick_personality_choices_1","            #Friendly","                *set friendly +12","                *set gatekeep_friendly \"true\"","                *goto quick_personality_choices_1","            #Aloof","                *set friendly -12","                *set gatekeep_aloof \"true\"","                *goto quick_personality_choices_1","            #Merciful ","                *set merciful +12","                *set gatekeep_merciful \"true\"","                *goto quick_personality_choices_1","            #Cruel","                *set merciful -12","                *set gatekeep_cruel \"true\"","                *goto quick_personality_choices_1","    #Snarky","        *set sincerity -17","        *set gatekeep_snarky \"true\"","        Sometimes you also react in a way that is\u2026","        *choice","            #Sincere","                *set sincerity +12","                *set gatekeep_sincerity \"true\"","                *goto quick_personality_choices_1","            #Friendly","                *set friendly +12","                *set gatekeep_friendly \"true\"","                *goto quick_personality_choices_1","            #Aloof","                *set friendly -12","                *set gatekeep_aloof \"true\"","                *goto quick_personality_choices_1","            #Merciful ","                *set merciful +12","                *set gatekeep_merciful \"true\"","                *goto quick_personality_choices_1","            #Cruel","                *set merciful -12","                *set gatekeep_cruel \"true\"","                *goto quick_personality_choices_1","    #Friendly","        *set friendly +17","        *set gatekeep_friendly \"true\"","        Sometimes you also react in a way that is\u2026","        *choice","            #Snarky","                *set sincerity -12","                *set gatekeep_snarky \"true\"","                *goto quick_personality_choices_1","            #Sincere","                *set sincerity +12","                *set gatekeep_sincerity \"true\"","                *goto quick_personality_choices_1","            #Aloof","                *set friendly -12","                *set gatekeep_aloof \"true\"","                *goto quick_personality_choices_1","            #Merciful ","                *set merciful +12","                *set gatekeep_merciful \"true\"","                *goto quick_personality_choices_1","            #Cruel","                *set merciful -12","                *set gatekeep_cruel \"true\"","                *goto quick_personality_choices_1","    #Aloof","        *set friendly -17","        *set gatekeep_aloof \"true\"","        Sometimes you also react in a way that is\u2026","        *choice","            #Snarky","                *set sincerity -12","                *set gatekeep_snarky \"true\"","                *goto quick_personality_choices_1","            #Sincere","                *set sincerity +12","                *set gatekeep_sincerity \"true\"","                *goto quick_personality_choices_1","            #Friendly","                *set friendly +12","                *set gatekeep_friendly \"true\"","                *goto quick_personality_choices_1","            #Merciful ","                *set merciful +12","                *set gatekeep_merciful \"true\"","                *goto quick_personality_choices_1","            #Cruel","                *set merciful -12","                *set gatekeep_cruel \"true\"","                *goto quick_personality_choices_1","    #Merciful","        *set merciful +17","        *set gatekeep_merciful \"true\"","        Sometimes you also react in a way that is\u2026","        *choice","            #Snarky","                *set sincerity -12","                *set gatekeep_snarky \"true\"","                *goto quick_personality_choices_1","            #Sincere","                *set sincerity +12","                *set gatekeep_sincerity \"true\"","                *goto quick_personality_choices_1","            #Friendly","                *set friendly +12","                *set gatekeep_friendly \"true\"","                *goto quick_personality_choices_1","            #Aloof ","                *set friendly -12","                *set gatekeep_aloof \"true\"","                *goto quick_personality_choices_1","            #Cruel","                *set merciful -12","                *set gatekeep_cruel \"true\"","                *goto quick_personality_choices_1","    #Cruel","        *set merciful -17","        *set gatekeep_cruel \"true\"","        *set baby_deer_road \"cruel\" ","        Sometimes you also react in a way that is\u2026","        *choice","            #Snarky","                *set sincerity -12","                *set gatekeep_snarky \"true\"","                *goto quick_personality_choices_1","            #Sincere","                *set sincerity +12","                *set gatekeep_sincerity \"true\"","                *goto quick_personality_choices_1","            #Friendly","                *set friendly +12","                *set gatekeep_friendly \"true\"","                *goto quick_personality_choices_1","            #Aloof ","                *set friendly -12","                *set gatekeep_aloof \"true\"","                *goto quick_personality_choices_1","            #Merciful","                *set merciful -12","                *set gatekeep_merciful \"true\"","                *goto quick_personality_choices_1","*page_break","","*label quick_personality_choices_1","","On occasion, you were also somewhat\u2026","","*fake_choice","    *if (gatekeep_sincerity = \"false\") #Sincere","        *set sincerity +7","    *if (gatekeep_snarky = \"false\") #Snarky","        *set sincerity -7","    *if (gatekeep_friendly = \"false\") #Friendly","        *set friendly +7","    *if (gatekeep_aloof = \"false\") #Aloof","        *set friendly -7","    *if (gatekeep_merciful = \"false\") #Merciful ","        *set merciful +7","    *if (gatekeep_cruel = \"false\") #Cruel","        *set merciful -7","*page_break","","Your disposition can also be impacted by how you usually process things. ","","There were many revelations to contend with during your visit. Did your heart or head rule you?","","*fake_choice","    #You feel deeply and can be ruled by your emotions. Extremely heart-oriented.","        *set heart +17","    #You tend to trust your instincts and feelings. Very heart-oriented.","        *set heart +12","    #You like to feel out a situation, trusting your intuition. Moderately heart-oriented.","        *set heart +7","    #Your heart or your mind could be useful depending on the situation. You're neutral. ","    #You prefer to connect the dots and use logic. Moderately head-oriented.","        *set heart -7","    #You rely on hard facts and your ability to make sense of things. Very head-oriented.","        *set heart -12","    #You think deeply, needing credible connections and insight. Extremely head-oriented. ","        *set heart -17","*page_break","","Everyone deserves a break, especially when enduring dry legal proceedings and past trauma\u2026","","You took yours at the Fernweh Diner and ordered your preferred drink. ","","*fake_choice","    #Tea.","        *set drink_choice \"tea\"","    #Coffee.","        *set drink_choice \"coffee\"","    #Hot Chocolate.","        *set drink_choice \"hot chocolate\"","*page_break","","The Fernweh Diner has a variety of drinks to meet the needs of its customers. ","","The ${waiter} likely serves many cups of ${drink_choice} in a given day. $!{w_she} served your and $!{beckett}'s meals, remaining attentive and receptive throughout the lunch.","","Did you learn more about the ${waiter} during your visit?","","*choice","    #$!{w_she} is just a ${waiter}\u2026 A kind of peculiar one. You didn't really get along.","        *set w_meet_official \"true\"","        *set w_mal_nn false","        *set waiter_friendship -2","        *set w_meet \"true\"","        *goto mal_not_interested_con","    #$!{w_she} is just the ${waiter} and nothing more.","        *set w_meet_official \"true\"","        *set w_mal_nn false","        *set w_meet \"true\"","        *goto mal_not_interested_con","    #You tried to guess the first letter of ${w_his} name but failed.","        *set w_meet_official \"true\"","        *set w_mal_nn false","        *set waiter_friendship +1","        *set guess_attempt \"fail\"","        *set w_meet \"true\"","        *goto mal_not_interested_con","    #You correctly guessed the first letter of ${w_his} name, but didn't learn ${w_his} nickname.","        *set w_2nd_letter \"true\"","        *set w_mal_nn false","        *set waiter_friendship +2","        *set guess_attempt \"success\"","        *set w_meet \"true\"","        *goto mal_not_interested_con","    #You correctly guessed the first letter of ${w_his} name and learned ${w_his} nickname.","        *set w_mal_nn true","        *set waiter_friendship +3","        *set guess_attempt \"success\"","        *set w_meet \"true\"","        *goto mal_not_interested_con","    #There was no guessing. The ${waiter} coyly offered to give you ${w_his} name and number. [Mal Romance] ","        *set waiter_flirt +1 ","        *set guess_attempt \"unnecessary\"","        *set waiter_friendship +2","        *goto mal_interest_name_choices      ","*page_break","","*label mal_interest_name_choices","","Did you accept the ${waiter}'s offer to get ${w_his} name and number?","","*choice","    #Yes, you accepted ${w_his} offer. [Mal Romance]","        *set waiter_flirt +1 ","        *goto mal_interest_name_choices1","    #No, you denied ${w_his} offer.","        *set w_meet_official \"true\"","        *set w_mal_nn false","        *set w_meet \"true\"","        *goto mal_not_interested_con","*page_break","","*label mal_interest_name_choices1","","Did you give the ${waiter} your hand so ${w_she} could write on your palm? Also, did you eventually learn ${w_his} nickname, or did you stop collecting letters as the visit progressed?","","*fake_choice","    #You gave the ${waiter} your hand and learned ${w_his} nickname.","        *set waiter_flirt +1 ","        *set w_number_hand \"true\"","        *set w_mal_nn true","        *set w_meet \"true\"","    #You gave the ${waiter} your hand, but didn't learn ${w_his} nickname\u2026","        *set waiter_flirt +1 ","        *set w_2nd_letter \"true\"","        *set w_number_hand \"true\"","        *set w_mal_nn false","        *set w_meet \"true\"","    #You didn't give the ${waiter} your hand, but you did learn ${w_his} nickname.","        *set w_number_hand \"false\"","        *set w_mal_nn true","        *set w_meet \"true\"","    #You didn't give the ${waiter} your hand, and you didn't learn ${w_his} nickname.","        *set w_number_hand \"false\"","        *set w_mal_nn false","        *set w_meet \"true\"","*page_break        ","        ","*label  mal_not_interested_con","","After the diner meal, you encountered your former childhood rival, who seemed to have been waiting for your return to town.  ","","*fake_choice","    #Reese Verner. His quippy humor failed to mask how he was curious about you.","        *set reese \"Reese\"","        *set r_him \"him\"","        *set r_his \"his\"","        *set r_man \"man\"","        *set r_she \"he\"","        *set r_mister \"mister\"","        *set r_son \"son\"","        *set r_hiss \"his\"","        *set r_blond \"blond\"","        *set r_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set reese_romanceable \"true\"","            *goto quick_character_choices_j","        *elseif (attraction = \"women\") ","            *set reese_romanceable \"false\"","            *goto quick_character_choices_j","    #Ruby Verner. Her quippy humor failed to mask how she was curious about you.","        *set reese \"Ruby\"","        *set r_him \"her\"","        *set r_his \"her\"","        *set r_man \"woman\"","        *set r_she \"she\"","        *set r_mister \"miss\"","        *set r_son \"daughter\"","        *set r_hiss \"hers\"","        *set r_blond \"blonde\"","        *set r_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set reese_romanceable \"true\"","            *goto quick_character_choices_j","        *elseif (attraction = \"men\") ","            *set reese_romanceable \"false\"","            *goto quick_character_choices_j","*page_break","","*label quick_character_choices_j","","*if ((((attraction = \"women\") and (b_man = \"man\")) and (s_man = \"man\")) and (r_man = \"man\"))","    *set james \"Jane\"","    *set j_him \"her\"","    *set j_his \"her\"","    *set j_man \"woman\"","    *set j_she \"she\"","    *set j_sir \"ma'am\"","    *set j_mister \"miss\"","    *set j_hiss \"hers\"","    *set j_brother \"sister\"","    *set j_meet \"true\"","    *set james_romanceable \"true\"","    *goto quick_character_choices_jset","*elseif ((((attraction = \"men\") and (b_man = \"woman\")) and (s_man = \"woman\")) and (r_man = \"woman\"))","    *set james \"James\"","    *set j_him \"him\"","    *set j_his \"his\"","    *set j_man \"man\"","    *set j_she \"he\"","    *set j_sir \"sir\"","    *set j_mister \"mister\"","    *set j_hiss \"his\"","    *set j_brother \"brother\"","    *set j_meet \"true\"","    *set james_romanceable \"true\"","    *goto quick_character_choices_jset","*else","    *goto quick_character_choices_jpick","","*label quick_character_choices_jset","","$!{reese} offered to give you a ride to the Fernweh Police Station, which decreased the commute and brought you that much closer to learning more about your grandfather's death.","","While there you witnessed an exchange between a chatty officer and his superior; it made you think about your opinions on teamwork versus handling things independently. ","","*fake_choice","    #You preferred to be responsible for your own success and mistakes. Working alone is best.","        *set cooperative -15","    #You tended to work alone, but the right team may make a difference.","        *set cooperative -10","    #You tended to work in teams but could work alone, if needed.","        *set cooperative +10","    #You preferred cooperation for a better exchange of ideas. Working with a team is best.","        *set cooperative +15","*page_break    ","","You also spoke with Fernweh's Detective, $!{james} Corvin, though the conversation eventually shifted to\u2026","","*choice ","    #\u2026$!{james}'s sister.","        *set alex \"Alina\"","        *set a_gender \"female\"","        *set a_their \"her\"","        *set a_them \"her\"","        *set a_they \"she\"","        *set a_theirs \"hers\"","        *set a_person \"woman\"","        *set a_sibling \"sister\"","        *set a_are \"is\"","        *set a_have \"has\"","        *set a_were \"was\"","        *set a_plural false","        *goto quick_character_choices_8","    #\u2026$!{james}'s brother.","        *set alex \"Alek\"","        *set a_gender \"male\"","        *set a_their \"his\"","        *set a_them \"him\"","        *set a_they \"he\"","        *set a_theirs \"his\"","        *set a_person \"man\"","        *set a_sibling \"brother\"","        *set a_are \"is\"","        *set a_have \"has\"","        *set a_were \"was\"","        *set a_plural false","        *goto quick_character_choices_8","    #\u2026$!{james}'s sibling.","        *set alex \"Alex\"","        *set a_gender \"non-binary\"","        *set a_their \"their\"","        *set a_them \"them\"","        *set a_they \"they\"","        *set a_theirs \"theirs\"","        *set a_person \"person\"","        *set a_sibling \"sibling\"","        *set a_are \"are\"","        *set a_have \"have\"","        *set a_were \"were\"","        *set a_plural true","        *goto quick_character_choices_8","*page_break ","","*label quick_character_choices_jpick","","$!{reese} offered to give you a ride to the Fernweh Police Station, which decreased the commute and brought you that much closer to learning more about your grandfather's death. ","","While there you witnessed an exchange between a chatty officer and his superior; it made you think about your opinions on teamwork versus handling things independently. ","","*fake_choice","    #You preferred to be responsible for your own success and mistakes. Working alone is best.","        *set cooperative -15","    #You tended to work alone, but the right team may make a difference.","        *set cooperative -10","    #You tended to work in teams but could work alone, if needed.","        *set cooperative +10","    #You preferred cooperation for a better exchange of ideas. Working with a team is best.","        *set cooperative +15","*page_break    ","","You also saw your childhood friend who happened to be Fernweh's Detective.","","*fake_choice ","    #James Corvin. His care for you carried over into adulthood, though he seemed guarded. ","        *set james \"James\"","        *set j_him \"him\"","        *set j_his \"his\"","        *set j_man \"man\"","        *set j_she \"he\"","        *set j_sir \"sir\"","        *set j_mister \"mister\"","        *set j_hiss \"his\"","        *set j_brother \"brother\"","        *set j_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set james_romanceable \"true\"","            *goto quick_character_choices_7","        *elseif (attraction = \"women\") ","            *set james_romanceable \"false\"","            *goto quick_character_choices_7","    #Jane Corvin. Her care for you carried over into adulthood, though she seemed guarded. ","        *set james \"Jane\"","        *set j_him \"her\"","        *set j_his \"her\"","        *set j_man \"woman\"","        *set j_she \"she\"","        *set j_sir \"ma'am\"","        *set j_mister \"miss\"","        *set j_hiss \"hers\"","        *set j_brother \"sister\"","        *set j_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set james_romanceable \"true\"","            *goto quick_character_choices_7","        *elseif (attraction = \"men\") ","            *set james_romanceable \"false\"","            *goto quick_character_choices_7","*page_break ","","*label quick_character_choices_7","","You and $!{james} spoke about your grandfather's passing, but the conversation eventually shifted to\u2026","","*choice ","    #\u2026$!{james}'s sister.","        *set alex \"Alina\"","        *set a_gender \"female\"","        *set a_their \"her\"","        *set a_them \"her\"","        *set a_they \"she\"","        *set a_theirs \"hers\"","        *set a_person \"woman\"","        *set a_sibling \"sister\"","        *set a_are \"is\"","        *set a_have \"has\"","        *set a_were \"was\"","        *set a_plural false","        *goto quick_character_choices_8","    #\u2026$!{james}'s brother.","        *set alex \"Alek\"","        *set a_gender \"male\"","        *set a_their \"his\"","        *set a_them \"him\"","        *set a_they \"he\"","        *set a_theirs \"his\"","        *set a_person \"man\"","        *set a_sibling \"brother\"","        *set a_are \"is\"","        *set a_have \"has\"","        *set a_were \"was\"","        *set a_plural false","        *goto quick_character_choices_8","    #\u2026$!{james}'s sibling.","        *set alex \"Alex\"","        *set a_gender \"non-binary\"","        *set a_their \"their\"","        *set a_them \"them\"","        *set a_they \"they\"","        *set a_theirs \"theirs\"","        *set a_person \"person\"","        *set a_sibling \"sibling\"","        *set a_are \"are\"","        *set a_have \"have\"","        *set a_were \"were\"","        *set a_plural true","        *goto quick_character_choices_8","*page_break ","","*label quick_character_choices_8","","You remembered $!{alex} from your childhood. The two of you were\u2026","","*fake_choice","    #\u2026like oil and water or cats and dogs. You didn't get along, but dealt with each other for $!{james}'s benefit.  ","        *set alex_past \"frenemies\" ","    #\u2026relatively close with $!{alex} looking up to you and always wanting to play with you and $!{james}.","        *set alex_past \"idolized\"","    #\u2026neutral with each other. You saw ${a_them} in passing when meeting up with $!{james}.","        *set alex_past \"neutral\" ","*page_break","","Your past history with $!{alex} influenced your reintroduction to ${a_them}.","","*choice","    *if (alex_past = \"idolized\") #$!{alex} seemed to take an interest in you, but you either kept things friendly or focused on a special someone, if not someones, instead.","        *set alex_crush \"true\"","        *set reject_alex_mc +1","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"idolized\") #$!{alex} seemed to take an interest in you, and you didn't exactly discourage ${a_them}.","        *set alex_crush \"true\"","        *set flirt_alex_mc +1","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"idolized\") #$!{alex} was eager to rekindle your past friendship. The conversation stayed focused on your well-being and your grandfather's passing.","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"idolized\") #$!{alex}'s didn't give you the warm reception you expected; the interaction was strained\u2026","        *set a_meet \"true\"","        *set alex_strained \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"idolized\") #$!{alex} seemed to take an interest in $!{beckett}.","        *set flirt_alex_b_i +1","        *set alex_crush_b_i \"true\"","        *set a_meet \"true\"","        *goto set_acrushb_i_reactions","    *if (alex_past = \"frenemies\") #$!{alex} seemed to take an interest in $!{beckett}, overlooking you to admire your friend.","        *set flirt_alex_b +1","        *set alex_crush_b \"true\"","        *set a_meet \"true\"","        *goto set_acrushb_reactions","    *if (alex_past = \"frenemies\") #$!{alex} ignored you entirely to focus on $!{james}.","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"frenemies\") #You made an effort to reluctantly say 'hi' to $!{alex}.","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"neutral\") #You kept quiet and allowed the two Corvins to speak.","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"neutral\") #You introduced $!{beckett} to $!{alex}, not wanting your friend to feel left out.","        *set a_meet \"true\"","        *goto quick_character_choices_9","    *if (alex_past = \"neutral\") #You made an effort to politely greet $!{alex}. ","        *set a_meet \"true\"","        *goto quick_character_choices_9","*page_break","","*label set_acrushb_i_reactions","","How did you feel about $!{alex} potentially having a crush on $!{beckett}?","","*choice","    *selectable_if (beckett_romanceable = \"true\") #You tried to carefully discourage it, unsure of your own feelings for $!{beckett}.","        *set bai_crush_reaction \"discourage_ro\" ","    #You gently discouraged it, knowing nothing would come of the fleeting crush.","        *set bai_crush_reaction \"discourage\"","    #You remained neutral. Who cares what or who $!{beckett} does in ${b_his} free time?","        *set bai_crush_reaction \"neutral\"","    #You encouraged it, trying to play matchmaker by joining the conversation.","        *set bai_crush_reaction \"encourage\" ","*page_break","*goto quick_character_choices_9","","*label set_acrushb_reactions","","How did you feel about $!{alex} potentially having a crush on $!{beckett}?","","*choice","    *selectable_if (beckett_romanceable = \"true\") #You firmly discouraged it, unsure of your own feelings for $!{beckett}.","        *set ba_crush_reaction \"discourage_ro\" ","    #You discouraged it, unwilling to entertain the idea of $!{alex} getting close to your friend.","        *set ba_crush_reaction \"discourage\"","    #You remained neutral. Who cares what or who $!{beckett} does in ${b_his} free time?","        *set ba_crush_reaction \"neutral\"","*page_break","*goto quick_character_choices_9","","*label quick_character_choices_9","","Seeing $!{alex} again was different than re-meeting your other past connections. $!{a_they} ${a_were} grown when compared to what you remembered of ${a_them}, no longer a rambunctious kid. It was suddenly easier for you to realize the difference years can make\u2026 ","","You didn't leave town until you were almost 15, but teen years are supposedly formative. ","","Did you have a teenage crush? ","","*fake_choice","    *selectable_if (silas_romanceable = \"true\") #You had a crush on $!{silas}, but never acted on it\u2026","        *set past_crush \"silas\" ","    *selectable_if (reese_romanceable = \"true\") #You had a crush on $!{reese}. Not that you would ever admit that to anyone.","         *set past_crush \"reese\"","    *selectable_if (james_romanceable = \"true\") #You had a crush on $!{james}, but never acted on it\u2026","         *set past_crush \"james\"","    *selectable_if (james_romanceable = \"true\") #You had a crush on $!{james}. $!{j_she} was your first kiss, but you never took it further.","         *set past_crush \"james\"","         *set first_kiss \"james\" ","    *selectable_if ((james_romanceable = \"true\") and (reese_romanceable = \"true\")) #You had crushes on $!{reese} and $!{james}, but never acted on them\u2026","        *set past_crush \"jr\"","    #You never had a past crush on anyone in Fernweh.","        *set past_crush \"none\"","*page_break","","Crushes aside, you had a passion, talent, or skill as a child that possibly even carried over into adulthood.","","Please select your past affinity.","","*choice","    #Writing","        *set past_affinity \"writing\"","        *set past_comp \"writing contest\"","        You tended to favor\u2026","        *goto q_tailored_affinity_writing","    #Science","        *set past_affinity \"science\"","        *set past_comp \"science fair\"","        You tended to favor\u2026","        *goto q_tailored_affinity_science","    #Math","        *set past_affinity \"math\"","        *set past_comp \"math competition\"","        *set past_affinity_text \"Problem solving with numbers fascinates you; sudoku isn't a chore, but fun\u2026\" ","        *goto q_past_affinity_common ","    #Baking","        *set past_affinity \"baking\"","        *set past_comp \"bake off\"","        You tended to favor\u2026","        *goto q_tailored_affinity_bake","    #Art","        *set past_affinity \"art\"","        *set past_comp \"art show\"","        You tended to favor\u2026","        *goto q_tailored_affinity_art","    #Music ","        *set past_affinity \"music\"","        *set past_comp \"music recital\"","        You preferred to play\u2026","        *goto q_tailored_affinity_music","    #Poetry","        *set past_affinity \"poetry\"","        *set past_comp \"poetry jam\"","        *set past_affinity_text \"Expressing your thoughts and feelings in a poetic form is something you still engage in when wanting to unwind or be creative.\" ","        *goto q_past_affinity_common ","    #Running","        *set past_affinity \"running\"","        *set past_comp \"track meet\"","        *set past_affinity_text \"Going for a run can be a great way to clear your head and get some fresh air.\" ","        *goto q_past_affinity_common ","*page_break","","*label q_tailored_affinity_writing","","*choice","    #\u2026short stories that focus on fantastical worlds, magical items, and epic quests. ","        *set past_affinity_specific \"short stories\"","        *set past_affinity_text \"Fantastical worlds and societies of magic feature in your short stories.\"","        *goto q_past_affinity_common","    #\u2026anthologies of horror where the same characters endure frightening trials.","        *set past_affinity_specific \"anthologies\"","        *set past_affinity_text \"Horror, grim ends, and ill-fated romances work their way into your anthologies.\" ","        *goto q_past_affinity_common","    #\u2026brief excerpts that focus on science fiction themes to offer a glimpse of the future. ","        *set past_affinity_specific \"excerpts\"","        *set past_affinity_text \"Futuristic advancements and elements of sci-fi keep your excerpts fresh and your imagination primed to think up new things.\" ","        *goto q_past_affinity_common","    #\u2026long works that feature exploration and adventure such as discovering lost tombs.","        *set past_affinity_specific \"long works\"","        *set past_affinity_text \"Treasure maps, forbidden artifacts, and a sense of discovery weave their way into your long works to create an ongoing adventure.\" ","        *goto q_past_affinity_common","*page_break ","","*label q_tailored_affinity_science","","*choice","    #\u2026botany. Plants can either flourish or decay all according to how they are handled. ","        *set past_affinity_specific \"botany\"","        *set past_affinity_text \"Tending to plants can give you a sense of calm as they bloom thanks to your dedicated care.\"","        *goto q_past_affinity_common","    #\u2026astronomy. Space is so vast that it makes sense to be curious about what's above.","        *set past_affinity_specific \"astronomy\"","        *set past_affinity_text \"You still have an interest in admiring the stars, moons, and planets when you have time to spare.\" ","        *goto q_past_affinity_common","    #\u2026geology. Perhaps, the mines helped fuel this interest? Rocks can be fascinating.  ","        *set past_affinity_specific \"geology\"","        *set past_affinity_text \"Collecting rocks and crystals is still fun for you; their different formations shape how they look and feel.\" ","        *goto q_past_affinity_common","    #\u2026archeology. Studying past civilizations is always an admirable use of time. ","        *set past_affinity_specific \"archeology\"","        *set past_affinity_text \"Reading about those who came before you is intriguing; you still seek out archaeological digests in your free time.\" ","        *goto q_past_affinity_common","*page_break ","","*label q_tailored_affinity_bake","","*choice","    #\u2026classy confections with refined flavor combinations that would be found in elegant restaurants.","        *set past_affinity_specific \"classy\"","        *set past_affinity_text \"Creating elegant confections in your free time is a delectable way to express your creativity.\"","        *goto q_past_affinity_common","    #\u2026experimental sweets with unique methods of preparation. Yes, you know how to use a mini blowtorch to add some excitement to dishes.","        *set past_affinity_specific \"experimental\"","        *set past_affinity_text \"Using cutting edge techniques in your desserts make them not only interesting, but delicious.\" ","        *goto q_past_affinity_common","    #\u2026rustic desserts. You treat recipes that have passed down over the years with care because love is the most important ingredient.","        *set past_affinity_specific \"rustic\"","        *set past_affinity_text \"Respecting tradition is why you enjoy using old recipes you have unearthed. The flavors tend to be simple, homey, and classic.\"   ","        *goto q_past_affinity_common","    #\u2026cutesy creations. Your desserts are eye-catching, colorful, and inviting.","        *set past_affinity_specific \"cutesy\"","        *set past_affinity_text \"We eat with our eyes first. You enjoy making desserts with visual appeal that live up to their flavor; it helps you unwind too.\" ","        *goto q_past_affinity_common","*page_break ","","*label q_tailored_affinity_art","","*choice","    #\u2026drawing a variety of things from characters to places only found in  your imagination.","        *set past_affinity_specific \"drawing\"","        *set past_affinity_text \"Drawing is a creative outlet that you still enjoy; it helps you bring your ideas to life.\"","        *goto q_past_affinity_common","    #\u2026painting. You have used both watercolors and acrylic paint when constructing your vision.","        *set past_affinity_specific \"painting\"","        *set past_affinity_text \"Is painting a metaphor for control? Who knows. Picking up a brush and altering a canvas brings you some calm.\" ","        *goto q_past_affinity_common","    #\u2026sculpting. Taking raw materials and transforming them into something new is exciting. ","        *set past_affinity_specific \"sculpting\"","        *set past_affinity_text \"Transforming a medium into something else makes you happy; there is freedom in sculpting that helps you unwind.\"   ","        *goto q_past_affinity_common","*page_break ","","*label q_tailored_affinity_music","","*choice","    #\u2026the piano. There is an inherent elegance associated with this instrument, though you were also at peace when tickling the ivory keys.","        *set past_affinity_specific \"piano\"","        *set past_affinity_text \"Playing the piano offers you an escape; it's easy to get swept up in the music you're creating.\"","        *goto q_past_affinity_common","    #\u2026the guitar. You enjoyed producing interesting melodies.","        *set past_affinity_specific \"guitar\"","        *set past_affinity_text \"Strumming your guitar or sitting down and playing a song are both ways to let your mind wander or relax while you play.\" ","        *goto q_past_affinity_common","    #\u2026the drums. Finding the beat has never been a problem for you, so your natural rhythm pairs well with this instrument.","        *set past_affinity_specific \"drums\"","        *set past_affinity_text \"Drums can be misunderstood as too loud, but you have always enjoyed tempering their sounds to create your own beats or melodies.\"   ","        *goto q_past_affinity_common","    #\u2026the violin. It is one of the most difficult instruments to master, but you keep at it.","        *set past_affinity_specific \"violin\"","        *set past_affinity_text \"You still remember aspects of your violin lessons; there is something soothing about playing it that can help you relax after a long day.\"   ","        *goto q_past_affinity_common","    #\u2026an instrument. What was it again?","        Please type in your preferred instrument below.","        *input_text past_affinity_specific","        *set past_affinity_text \"Playing the ${past_affinity_specific} offers you an escape; it's easy to get swept up in the music.\"","        *goto q_past_affinity_common","*page_break","","*label q_past_affinity_common","","While we're on the subject of the past, a particular memory comes to mind that's faintly dim.  ","","A friendship necklace; two perfectly divided halves that came together to make a whole.","","You had one from $!{james}, didn't you? ","","*choice","    #You lost your half in the house fire; it was gone.","        *set friendship_necklace_j \"burned\"","        *goto fr_bend_jneck_burn","    #You threw it away to help forget about $!{james} and Fernweh.","        *set friendship_necklace_j \"trashed\"","        *goto fr_bend_jneck_trash","    #You still have it, but the memories make it hard to wear.","        *set friendship_necklace_j \"traumatic\"","        *goto fr_bend_jneck_mem","    #You still have it, but don't care to wear it anymore.","        *set friendship_necklace_j \"disinterested\"","        *goto fr_bend_jneck_dis","    #You still have it and sometimes will wear it.","        *set friendship_necklace_j \"worn\"","        *goto fr_bend_jneck_wear","    #No, you are remembering wrong. There was never a two-part friendship necklace.","        *set friendship_necklace_j \"nope\"","        *goto fr_bend_jneck_nop","*page_break","","*label fr_bend_jneck_burn","","The house fire took many things from you, including most of your personal belongings.","","There was nothing left of your half of the necklace since it was likely reduced to molten metal or warped into something else.","","It was gone.","","You remember the design of it.","*goto fr_bend_jneck_cho","","*label fr_bend_jneck_trash","","The house fire took many things from you, but not your life or that necklace, since you had it while away from home on that fateful night.","","It served as a tangible reminder of Fernweh and of $!{james} when all the rest had been burned away, so you eventually threw it out.","","You remember the design of it.","*goto fr_bend_jneck_cho","","*label fr_bend_jneck_mem","","The house fire took many things from you, but not your life or that necklace, since you had it while away from home on that fateful night.","","It served as a tangible reminder of Fernweh and of $!{james} when all the rest burned away.","","You did not discard it, but could not bring yourself to wear it because of the memories, so it was kept safely hidden in a box.","","You remember the design of it.","*goto fr_bend_jneck_cho","","*label fr_bend_jneck_dis","","The house fire took many things from you, but not your life or that necklace, since you had it while away from home on that fateful night.","","It served as a tangible reminder of Fernweh and of $!{james} when all the rest burned away.","","You still had it, but don't care to wear it anymore, viewing it as a piece of old jewelry.","","You remember the design of it.","*goto fr_bend_jneck_cho","","*label fr_bend_jneck_wear","","The house fire took many things from you, but not your life or that necklace, since you had it while away from home on that fateful night.","","It served as a tangible reminder of Fernweh and of $!{james} when all the rest burned away.","","You still had your half of the necklace and would occasionally wear it, keeping it tarnish free and safe as time progresses.","","It has an interesting design.","*goto fr_bend_jneck_cho","","*label fr_bend_jneck_nop","","\u2026What necklace?","","You never had a two-part, friendship necklace that $!{james} gave you during your childhood.","","Maybe you were remembering something from a movie where the bond between two childhood friends is symbolized by chains and charms. One was a mousy blonde and the other was a vivacious brunette; you think it was a horror film with an unhappy ending. Who knows\u2026?","","Thinking more on it only made the memory go hazy.","*page_break","*goto fr_bend_jneck_done","","*label fr_bend_jneck_cho","","*fake_choice","    #A silver, fractured heart with 'Partners in Crime' etched in it.","        *set friendship_necklace_style \"partners in crime\"","    #A gilded sword and shield that interlocks.","        *set friendship_necklace_style \"sword and shield\"","    #Intricate, antique-looking lock and key pendants that fit together. ","        *set friendship_necklace_style \"lock and key\"","    #A moon and star charm that complement each other.","        *set friendship_necklace_style \"moon and stars\"","    #Two chrome puzzle pieces that align with each other.","        *set friendship_necklace_style \"puzzle pieces\"","*page_break","*goto fr_bend_jneck_done","","*label fr_bend_jneck_done","","You know what would go great with a necklace? Some flowers. Except the type your grandfather used to give you can foster mixed feelings. ","","What were they again? ","","Typically, you received\u2026","","*fake_choice","    #\u2026a daisy, which symbolizes loyalty and purity.","        *set flower_choice \"daisy\" ","    #\u2026an aster, which symbolizes patience and wisdom.","        *set flower_choice \"aster\" ","    #\u2026a striped carnation, which symbolizes pride and beauty.","        *set flower_choice \"carnation\"","    #\u2026a bouquet of forget-me-nots, which symbolizes perseverance and consideration.","        *set flower_choice \"forget-me-nots\" ","    #\u2026a striped carnation wreathed with forget-me-nots because the colors are as complementary as the meanings; beauty and perseverance.","        *set flower_choice \"both\"","    #\u2026a snapdragon, which symbolizes graciousness and strength.","        *set flower_choice \"snapdragon\" ","*page_break","","Your mind eventually had to drift away from the fonder past memories as you read.","","Reading one of your grandfather's journal entries about how you won a ${past_comp} was a nice change of pace until his chronicling started to become odd, if not mind-boggling.","","He recounted a past winter solstice that you hazily remembered since it was one of the rare times he made an effort to show up at a family event. It was around the time his isolationist behavior was setting in. Back then, it was hard to know how to act around him; he had become more of a stranger to you. Your grandfather wrote about you acting a little strangely.","","There seemed to be more to the entry, but it was hard to parse out why. ","","*fake_choice","    #You had lingered by your grandmother's rocking chair, smiling wistfully. (Empathetic Impressions)","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","    #You had managed to anticipate a glass's fall, catching it. (Retrocognition) ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","    #You chose to close the curtains as if sensing something was amiss. (Extrasensory Awareness)","        *set extrasensory_awareness +15","        *set primary_skill \"extrasensory awareness\"","        *set primary_ea \"true\"","        *set primary_ei \"false\"","        *set primary_rc \"false\"","*page_break ","","Your grandfather's writings only went downhill\u2026","","He wrote about re-remembering things. He claimed the house fire was his fault. He admitted that he felt like he was being watched at times even when all alone or with others around him. ","","The entries shifted from childhood nostalgia to more grim subject matters.","","The journal was a first-hand, primary source from your grandfather; you needed other sources.","","A visit to the coroner's office left you wanting answers, so you went to the\u2026","","*choice ","    #\u2026Fernweh Historical Library to research.","        *set destination_info1 \"library\"","        *goto continue_with_alpha_cc","    #\u2026Old Hunting Lodge to speak to an outdoorsman.","        *set destination_info1 \"lodge\"","        *goto ask_about_judith","*page_break","","*label ask_about_judith","","While at the lodge you encountered a little girl with a staggering personality, Judith.","","How did the interaction go? ","","*fake_choice ","    #Judith complimented $!{silas}'s hair. She shared how she wanted to dye hers purple. ","        *set judith_interaction \"s_dye\"","    #Judith played a game with $!{james}, which managed to earn a smile from ${j_him}.","        *set judith_interaction \"j_smile\"","    #Judith questioned $!{james}'s credentials by inspecting ${j_his} badge. ","        *set judith_interaction \"j_detective\"","*page_break","*goto continue_with_alpha_cc","","*label  continue_with_alpha_cc","The information you learned only seemed to cast your grandfather's death in a more grisly light.","","Did your optimism or pessimism prevail? ","","*fake_choice","    #You chose to be extremely optimistic, searching for the positives of any situation.","        *set optimistic +17","    #You resolved to be very optimistic, always looking on the bright side.","        *set optimistic +12","    #You tended to be moderately optimistic. There can be good within the bad.","        *set optimistic +7","    #You preferred to take things as they come, not too positive or too negative. ","    #You were inclined to be moderately pessimistic. It's a more realistic perspective\u2026","        *set optimistic -7","    #You were determined to be very pessimistic, always preparing for the worst. It's safer.","        *set optimistic -12 ","    #You chose to be extremely pessimistic to help insulate yourself. It's best to seek out the negatives than to be caught off guard by them.","        *set optimistic -17","*page_break","","Eventually, you wound back up at the cabin to look for clues, though this time there was an unexpected guest. ","","What did you name the skittish, stray dog? ","","*fake_choice","    #Taffy","        *set dog_name \"taffy\"","        *set dog_meet \"true\"","    #Honeybun","        *set dog_name \"honeybun\"","        *set dog_meet \"true\"","    #Blue","        *set dog_name \"blue\"","        *set dog_meet \"true\"","    #Mini","        *set dog_name \"mini\"","        *set dog_meet \"true\"","    #You were inhospitable towards the dog, so $!{beckett} named her Waffles without you.","        *set dog_name \"waffles\"","        *set name_help \"overruled\"","        *set dog_meet \"true\"","    #You were close enough to $!{beckett} to use ${b_his} suggestion: Waffles.","        *set dog_name \"waffles\"","        *set name_help \"beckett\"","        *set dog_meet \"true\"","    #You were close enough to $!{silas} to use ${s_his} suggestion: Marigold.","        *set dog_name \"marigold\"","        *set name_help \"silas\"","        *set dog_meet \"true\"","    #You were close enough to $!{reese} to use ${r_his} suggestion: Aurora.","        *set dog_name \"aurora\"","        *set name_help \"reese\"","        *set dog_meet \"true\"","    #You were close enough to $!{james} to use ${j_his} suggestion: Goldie.","        *set dog_name \"goldie\"","        *set name_help \"james\"","        *set dog_meet \"true\"","    #You were close enough to $!{james} and $!{reese} to use their suggestion: Aurum. ","        *set dog_name \"aurum\"","        *set name_help \"jr\"","        *set dog_meet \"true\"","    #Something else ","        *set dog_meet \"true\"","        *input_text dog_name","        Please input the name of the dog.","*page_break ","","The dog in question didn't seem to understand that the name referred to her just yet. ","","$!{dog_name} used to be looked after by your grandfather; he might have trained her too.","","She retrieved a bloodied cap that belonged to Milton Callaway, setting it on the front porch. ","","You and the others resolved to go into the woods to look for him. ","","Were you reluctant about leaving and demanded $!{james} call for backup? ","","*fake_choice","    #Yes, you urged $!{james} to call the station for backup.","        *set call_for_backup \"true\"","        *set r_arm_injury \"three\"","        *set milton_injury \"severe\"","    #No, you decided to search the forest for Milton without backup.","*page_break","","Entering Fernweh's woods at night to follow the trail of a missing kid was a daunting task\u2026","","How reckless or cautious were you while navigating the forest?","","*fake_choice","    #You held your breath at times, taking apprehensive steps and staying mindful. Extremely Cautious.","        *set reckless -17","    #Twigs didn't have a chance to snap with how careful you were. Very cautious. ","        *set reckless -12","    #You watched your step and sometimes the surroundings. Moderately cautious. ","        *set reckless -7","    #You weren't exactly reckless or cautious, but your guard was raised. ","    #You were ready to react and pushed ahead during the search. Moderately reckless.","        *set reckless +7 ","    #You were daring, reorganizing the forest with each of your bold steps. Very reckless. ","        *set reckless +12","    #A forest wasn't going to daunt you. Sticks, pine cones, and twigs were kicked aside as you forged a path. Extremely reckless. ","        *set reckless +17","*page_break ","","Searching for Milton eventually led you to a clearing with bulbous, unnatural plant pods. ","","One way or another, you discovered that a baby deer was trapped inside of one of them.","","*choice","    #The baby deer survived the night.","        *set baby_bambi \"alive\"","        *goto alive_bambi_feels","    #The baby deer didn't survive the night. You killed it.","        *set baby_bambi \"dead\"","        *goto dead_bambi_feels","*page_break","","*label alive_bambi_feels","","How did you feel about the baby deer surviving? ","","*choice","    #You cared about it and its well-being.","        *set deer_reaction \"cared\"","        *set deer_visitor \"fawn and doe\"","        *goto quick_character_choices_10","    #You were more focused on its fur coat; the matted blood was disgusting\u2026","        *set deer_reaction \"disgust\"","        *set deer_visitor \"fawn\"","        *goto quick_character_choices_10","    #You were neutral about its survival; there were other things to worry about.","        *set deer_reaction \"neutral\"","        *set deer_visitor \"fawn\"","        *goto quick_character_choices_10","    #You really didn't care if it lived or died; it was weak to get captured. ","        *set deer_reaction \"uncaring\"","        *set deer_visitor \"fawn\"","        *goto quick_character_choices_10","*page_break","","*label dead_bambi_feels","","How did you feel about killing the baby deer? ","","*choice","    #You felt extremely guilty about it; sadness, shame, and horror overwhelmed you.","         *set deer_guilt \"very guilty\"","         *set deer_visitor \"doe\"","         *goto quick_character_choices_10","     #You felt guilt about it. Lashing out or looking away didn't help you feel better\u2026","         *set deer_guilt \"guilty\"","         *set deer_visitor \"doe\"","         *goto quick_character_choices_10","     #You were neutral about it, turning away to focus on something else.","         *set deer_guilt \"neutral\"","         *set deer_visitor \"doe\"","         *goto quick_character_choices_10","     #You didn't feel guilty, unwilling to take any blame. It wasn't your fault it was there.","         *set deer_guilt \"none\"","         *set deer_visitor \"doe and buck\"","         *goto quick_character_choices_10","     ","*label quick_character_choices_10","","Seeing the baby deer like [i]this[/i] made you remember your very first encounter with it on the road when first arriving in Fernweh. ","","How did you react back then?","","*fake_choice","    #You were determined to spare Bambi, instantly stopping the car.","        *set baby_deer_road \"stop\" ","    #You pumped the brakes to carefully manage the situation by stopping the car.","        *set baby_deer_road \"stop\" ","    #You swerved into the other lane to avoid it. ","        *set baby_deer_road \"go\" ","    #You accelerated in the hope that it would run off.","        *set baby_deer_road \"go\" ","    #You kept going, it should have moved out of the way. The road isn't for animals.","        *set baby_deer_road \"cruel\" ","*page_break  ","*goto quick_character_choices_10ish","","*label quick_character_choices_10ish","","You were soon confronted by what trapped the baby deer in the pod to harvest its blood. ","","Predatory lengths of vine that were skilled at ensnaring prey before latching on to suckle.","","*if (call_for_backup = \"true\")","    Did you receive a puncture wound from a vine drilling into your left leg? ","    *goto backup_puncture_choice","*else","    *goto quick_vine_trials_choice","","*label backup_puncture_choice","","*choice","    #Yes, you received a puncture wound from a vine.","        *set mc_scar_2 \"puncture wound\"","        *goto quick_character_choices_11","    #No, you didn't receive a puncture wound from a vine.","        *goto quick_character_choices_11","*page_break ","","*label quick_vine_trials_choice       ","    ","How did you fare in the battles against them?","","*fake_choice ","    #Successfully passed both the solo and teamwork trials.","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","    #You received a puncture wound. Failed the solo trial, passed the teamwork one.","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_2 \"puncture wound\"","    #The vines weren't weakened. Passed the solo trial, failed the teamwork one.","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","    #You failed both of the trials, received a puncture wound, and the vines were active.","        *set milton_injury \"severe\"","        *set r_arm_injury \"three\"","        *set mc_scar_2 \"puncture wound\"","*page_break","","*label quick_character_choices_11","","The sentient plant life had a taste for blood.","","Did the vines reopen any of your prior wounds? You might have gotten some when leaving the forest the first time to look for Milton; a wild thorn bush could have grazed or scratched you.  ","","*fake_choice","    #Yes, they tore into three gouges on your left ankle.","        *set mc_scar_1 \"ankle gouges\"","    #Yes, they widened two thin cuts on your left ankle.","        *set mc_scar_1 \"ankle cuts\"","    #No, they just ensnared your ankle and threatened to bruise it.","    #No, they kind of just poked your ankle. They probably weren't used to bone.","*page_break        ","","The predatory vines answered to a menacing tree creature, though the two seemed to have a symbiotic, friendly relationship. One harvested, while the other protected. Both were deadly.","","When confronted with the creature, how did you react? Was there any communication?","","*fake_choice","    #You tried to talk to it by saying you didn't mean to trespass on its land.","        *set combat -5","    #You assured it that there didn't have to be any violence. You wanted peace. ","        *set combat -7 ","    #You glowered at the thing that murdered your grandfather; it was a seething look.","        *set combat +5 ","    #You threatened it, saying you would give it a fight, if that's what it wanted.","        *set combat +7 ","    #You reacted in a different manner. No words or looks were wasted on the creature. ","*page_break  ","","The monster eventually died.","","Fire ate away the layers of wood while you all stood there watching the creature's body become harder to discern. You were transfixed by the way the erratic flames jumped and danced, using any available surface as a chance to spread without any care or restraint.   ","","Did this seem familiar?","","You weren't there the night of the house fire, but naturally, you have imagined what it was like.","","How did you tend to view the past? ","","*fake_choice","    #It's easy to think of the past, sometimes too easy\u2026","        *set past_susceptibility \"Easy\"","        *set receptive +10","        *set past_susceptibility_text \"It's easy for you to think of the past, sometimes too easy when a particular memory threatens to engulf you.\"","    #It's best to keep all of that locked away and buried down deep.","        *set past_susceptibility \"Buried\"","        *set receptive -10","        *set past_susceptibility_text \"It's best to keep the past locked away and buried down deep. You won't let it drag you down again.\"","    #It is important to work through the past to try and heal.","        *set past_susceptibility \"Healthy\"","        *set receptive +4","        *set past_susceptibility_text \"It's important to work through the past to try and heal. You aren't going to fully embrace or erase it; there needs to be balance.\"","    #It's better to push forward. Don't look back.","        *set past_susceptibility \"Forward\"","        *set receptive -8","        *set past_susceptibility_text \"It's better to push forward. Don't look back on the past when you have new places to be and things to achieve.\" ","    #It is important to not forget the good parts because of all the bad\u2026","        *set past_susceptibility \"Rose-Tinted\"","        *set past_susceptibility_text \"It's important to not forget the good parts of the past because of all the bad\u2026 Your memories are a part of you.\"","        *set receptive +8","*page_break","","Confronting something that should not exist was eye-opening, but you experienced many things that didn't quite add up or seemed bizarre before setting foot in than sunken clearing.","","How skeptical or open to believing were you? ","","*fake_choice","    #Nothing is truly unexplained; your skeptical nature influenced how you viewed what you found in Fernweh. Extreme skeptic. ","        *set believer -17","    #There are kernels of fact in fiction; you were apprehensive about putting much stock in the odd happenings around town. Moderate skeptic. ","        *set believer -12","    #There should be rules about what is possible. You were reluctant to abandon them. Somewhat a skeptic.","        *set believer -7","    #You weren't really a skeptic or a believer, but a survivor trying to get through the visit. ","    #Facts have limitations; you are slightly open-minded to the unexplainable. Somewhat a believer. ","        *set believer +7","    #There has to be more to the world. You were willing to believe and trust that some things are simply not as they seem. Moderate believer. ","        *set believer +12","    #Not everything can be neatly answered. There could be truth to folk tales, myths, and hauntings. Truths that seem unusual, but are real. Extreme believer. ","        *set believer +17","*page_break","","Your own belief or skepticism aside, you do know of one person who felt that there was a wrongness in Fernweh: Marjorie. You had seen her a few times during your visit, but how did that very first encounter go? It's safe to say that you had discovered more since that time.","","*fake_choice","    #You were kind to her, willing to listen to her rambling fears and odd warnings. ","        *set marj_meet_1 \"kind\"","    #You made a joke about her ramblings, trying to lighten things up. ","        *set marj_meet_1 \"joke\"","    #You remained silent, if not neutral, not very keen to engage with her.","        *set marj_meet_1 \"neutral\"","    #You viewed her as crazy, suggesting she needed to be kept away from normal people.","         *set marj_meet_1 \"mean\"     ","*page_break","","The events of that night tested more than just you\u2026 ","","[i]Ms. Verner.[/i]","","Speaking of Ms. Verner, how well did you and she get along\u2026? ","","You had encounters with her during your visit. Could there be more to her cold demeanor?","","*fake_choice","    #Her disinterested dislike strengthened into subtle disdain since you two tended to clash.","        *set msv_relationship -3","        *set msv_meet \"true\"","    #It was at best a coolly neutral dynamic. You two didn't really connect or clash\u2026","        *set msv_relationship +1","        *set msv_meet \"true\"","    #She minimally warmed up to you. Your dynamic might continue to improve with time.","        *set msv_relationship +5","        *set msv_meet \"true\"","*page_break","    ","Whether that night was a nightmare for Ms. Verner or not is yet to be seen, but it was for you. ","","Dwelling on your Fernweh-induced nightmares was something you tried to avoid when possible. ","","A certain four-legged, canine companion could help with that. Did you keep $!{dog_name}?","","*fake_choice ","    #You intended to take $!{dog_name}, viewing her as a new friend and pet.","        *set dog_ownership \"mc pet\"","        *set canine_trust +5 ","    #$!{dog_name} was your grandfather's. You had an obligation to look after her.","        *set dog_ownership \"mc duty\"","        *set canine_trust +3","    #$!{beckett} was willing to take care of $!{dog_name}, so you let ${b_him}.","        *set dog_ownership \"b pet\"","        *set canine_trust +3","    #You didn't want to deal with $!{dog_name}. Someone else could find her a new home.","        *set dog_ownership \"none\"","    #You had no interest in keeping a mutt with codependency issues near you\u2026","        *set dog_ownership \"none\" ","        *set canine_trust -2         ","*page_break","","You checked-in with your connections before a farewell brunch was served at the B&B. ","","At one point, Mrs. Dorran politely asked you to get the front door. ","","You realized that her surprise for the brunch was actually a delivery from the Fernweh Diner. ","","@{w_mal_nn Mal|The ${waiter}} was waiting outside for you to take the Belgian waffles.","","*choice","    #It was a quick encounter. You took the food, spoke briefly, and then went back inside.","        *goto character_choices_13","    #The two of you shared a moment on the porch. $!{w_she} was willing to talk with you. [Mal Romance]","        *set waiter_flirt +2","        *set waiter_friendship +1","        *set mare3_extra_guest \"true\"","        *goto quick_mal_porch_choice","*page_break ","","*label quick_mal_porch_choice","","@{w_mal_nn Mal|The ${waiter}} seemed to be willing to let you steer the conversation, lingering by the threshold of the door as you decided how to say goodbye to ${w_him}.","","*fake_choice","    #You decided to quickly kiss ${w_him} after making a teasing remark.","        *set waiter_flirt +1","        *set mal_kissed \"kissed\"","    #You only teased ${w_him}, but your personal spaces definitely overlapped.","        *set mal_kissed \"teased\"","    #You flustered and commented on the weather. $!{w_she} was surprisingly sweet in return.","        *set mal_kissed \"weather\"","    #You and @{w_mal_nn Mal|the ${waiter}} shared a brief moment; it felt charged though\u2026","*page_break","*goto character_choices_13","","*label character_choices_13","","The end of brunch meant that your time to leave Fernweh was drawing closer.","","This time you left Fernweh on your own terms after checking-in with everyone and enjoying a nice meal\u2026 It was very different from the rushed, intense departure following the house fire.","","Your grandfather had sent you away without really saying goodbye. ","","Did you feel abandoned by him? ","","*fake_choice ","    #Yes, how he sent you away left a lasting impression. Abandonment leaves a mark. ","        *set potential_abandoniss +3","    #No, you didn't internalize the abandonment quite that strongly. It still hurt though.","*page_break ","","How did you feel about leaving your hometown again?","","*fake_choice ","    #You weren't relieved, but ecstatic about leaving this messed up town.","        *set leave_opinion \"favorable\"","    #You felt relieved to be leaving Fernweh.","        *set leave_opinion \"favorable\"","    #You have good and bad memories of the town. It was likely best to leave for now.","        *set leave_opinion \"uncertain\"","    #Leaving was more bittersweet than you expected\u2026","        *set leave_opinion \"uncertain\"","    #Staying was something you considered a few times. You didn't feel relieved to leave.","        *set leave_opinion \"disfavorable\"","    #You could see yourself living in Fernweh. ","        *set leave_opinion \"disfavorable\"","*page_break","","You would not be making the departure alone. ","","A special someone, or someones, volunteered to drive out with you to send you off. ","","(Please note that this choice doesn't lock-in your romance option(s); it just gives me an idea as to which route you followed in Book One. There will be a warning when it's time to lock-in a path.)","","(I would suggest making a save now, if you would like to switch up romance options/best friends while using the same MC. Some content will be choice-dependent, which is why talking on Discord/Patreon might help you all uncover more. I'll provide some hints as well.) ","","*choice ","    *selectable_if (beckett_romanceable = \"true\") #No volunteer was needed since you had $!{beckett} by your side.","        *set townline_pick \"beckett\"","        *set tentative_ro_pick \"beckett\"","        *set beckett_friendship +14","        *goto quick_bff_choice_list","    *selectable_if (silas_romanceable = \"true\") #$!{silas}","        *set townline_pick \"silas\"","        *set tentative_ro_pick \"silas\"","        *set silas_friendship +12","        *set mrs_dorran_s_pic \"unaware\"","        *goto quick_bff_choice_list","    *selectable_if (reese_romanceable = \"true\") #$!{reese}","        *set townline_pick \"reese\"","        *set reese_friendship +15","        *set tentative_ro_pick \"reese\"","        *set r_prank_1 \"none\"","        *goto r_denial_overlay_setting","    *selectable_if (james_romanceable = \"true\") #$!{james}","        *set townline_pick \"james\"","        *set james_friendship +14","        *set tentative_ro_pick \"james\"","        *goto quick_bff_choice_list","    *selectable_if ((james_romanceable = \"true\") and (reese_romanceable = \"true\")) #$!{james} and $!{reese}","        *set townline_pick \"jr\"","        *set reese_friendship +15","        *set james_friendship +14","        *set tentative_ro_pick \"jr\"","        *goto quick_bff_choice_list","*page_break","","*label r_denial_overlay_setting","","Did you try to deny the tentative feelings you were developing for $!{reese}? ","","*fake_choice ","    #Yes, your actions were influenced by denial. You and ${r_she} shouldn't work, and yet\u2026 It was hard not to think of ${r_him} at times. ","        *set denial_r_ro +5","    #No, you didn't feel any denial towards $!{reese}, but possibly some other emotions. ","*page_break        ","","*label quick_bff_choice_list","","You experienced a lot during your visit to Fernweh. ","","Did your friendship strengthen with someone in particular? Who was your closest friend?","","*if (tentative_ro_pick = \"beckett\")","    *goto quick_set_r_b_ro_rxn","*elseif (tentative_ro_pick = \"silas\")","    *goto quick_set_r_s_ro_rxn","*elseif (tentative_ro_pick = \"reese\")","    *goto quick_bff_choice_r","*elseif (tentative_ro_pick = \"james\")","    *goto quick_bff_choice_j","*elseif (tentative_ro_pick = \"jr\")","    *goto quick_bff_choice_jr","","*label quick_set_r_b_ro_rxn","","*choice ","    #$!{silas}","        *set silas_friendship +12","        *set selected_best_friend \"silas\" ","        Did you have a second closest friend\u2026?","        *choice","            #$!{reese}","                *set reese_friendship +9","                *set james_friendship +5","                *goto quick_character_choices_15","            #$!{james}","                *set reese_friendship +5","                *set james_friendship +9","                *goto quick_character_choices_15","    #$!{reese}","        *set reese_friendship +15","        *set selected_best_friend \"reese\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set james_friendship +5","                *goto quick_character_choices_15","            #$!{james}","                *set silas_friendship +4","                *set james_friendship +9","                *goto quick_character_choices_15","    #$!{james}","        *set james_friendship +14","        *set selected_best_friend \"james\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set reese_friendship +5","                *goto quick_character_choices_15","            #$!{reese}","                *set reese_friendship +9","                *set silas_friendship +4","                *goto quick_character_choices_15","*page_break","","*label quick_set_r_s_ro_rxn","","*choice ","    #$!{beckett}","        *set beckett_friendship +14","        *set selected_best_friend \"beckett\" ","        Did you have a second closest friend\u2026?","        *choice","            #$!{reese}","                *set reese_friendship +9","                *set james_friendship +5","                *goto quick_character_choices_15","            #$!{james}","                *set reese_friendship +5","                *set james_friendship +9","                *goto quick_character_choices_15","    #$!{reese}","        *set reese_friendship +15","        *set selected_best_friend \"reese\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set james_friendship +5","                *goto quick_character_choices_15","            #$!{james}","                *set beckett_friendship +5","                *set james_friendship +9","                *goto quick_character_choices_15","    #$!{james}","        *set james_friendship +14","        *set selected_best_friend \"james\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set reese_friendship +5","                *goto quick_character_choices_15","            #$!{reese}","                *set reese_friendship +9","                *set beckett_friendship +5","                *goto quick_character_choices_15","*page_break","","*label quick_bff_choice_r","","*choice ","    #$!{beckett}","        *set beckett_friendship +14","        *set selected_best_friend \"beckett\" ","        Did you have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set james_friendship +5","                *goto quick_character_choices_15","            #$!{james}","                *set silas_friendship +4","                *set james_friendship +9","                *goto quick_character_choices_15","    #$!{silas}","        *set silas_friendship +12","        *set selected_best_friend \"silas\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set james_friendship +5","                *goto quick_character_choices_15","            #$!{james}","                *set beckett_friendship +5","                *set james_friendship +9","                *goto quick_character_choices_15","    #$!{james}","        *set james_friendship +14","        *set selected_best_friend \"james\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set silas_friendship +4","                *goto quick_character_choices_15","            #$!{silas}","                *set silas_friendship +7","                *set beckett_friendship +5","                *goto quick_character_choices_15","*page_break","","*label quick_bff_choice_j","","*choice ","    #$!{beckett}","        *set beckett_friendship +14","        *set selected_best_friend \"beckett\" ","        Did you have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set reese_friendship +5","                *goto quick_character_choices_15","            #$!{reese}","                *set reese_friendship +9","                *set silas_friendship +4","                *goto quick_character_choices_15","    #$!{silas}","        *set silas_friendship +12","        *set selected_best_friend \"silas\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set reese_friendship +5","                *goto quick_character_choices_15","            #$!{reese}","                *set beckett_friendship +5","                *set reese_friendship +9","                *goto quick_character_choices_15","    #$!{reese}","        *set reese_friendship +15","        *set selected_best_friend \"reese\"","        Did you have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set silas_friendship +4","                *goto quick_character_choices_15","            #$!{silas}","                *set silas_friendship +7","                *set beckett_friendship +5","                *goto quick_character_choices_15","*page_break","","*label quick_bff_choice_jr","","*choice ","    #${beckett}","        *set beckett_friendship +14","        *set silas_friendship +7","        *set selected_best_friend \"beckett\" ","        *goto quick_character_choices_15","    #$!{silas}","        *set silas_friendship +12","        *set beckett_friendship +8","        *set selected_best_friend \"silas\"","        *goto quick_character_choices_15","*page_break","","*label quick_character_choices_15","","*if (pc_nickname = true)","    *goto set_s_nickname_usage","*else","    *goto quick_character_choices_15ish","","*label set_s_nickname_usage","","At some point in your trip, did $!{silas} feel close enough to you to ask about your nickname? ","","*fake_choice","    #No, ${s_she} did not. The two of you weren't friendly enough yet.","        *set snickname_check \"no\"","        *set s_nickname false","    #Yes, ${s_she} did. You agreed to letting ${s_him} use your nickname.","        *set snickname_check \"yes\"","        *set s_nickname true","        *set s_nickname_ask_again \"never\" ","    #Yes, ${s_she} did, but you didn't want ${s_him} calling you by your nickname.","        *set snickname_check \"yes\"","        *set s_nickname false","        *set s_nickname_ask_again \"never\" ","    #Yes, ${s_she} did, but you still felt some distrust towards ${s_him}. You weren't ready for ${s_him} to use it yet\u2026","        *set snickname_check \"yes\"","        *set s_nickname false","*page_break ","","*label quick_character_choices_15ish","        ","*if (tentative_ro_pick = \"beckett\")","    You shared a moment with $!{beckett} near the town line before trying to leave. ","    ","    $!{b_she} wanted to do anything ${b_she} possibly could that might make the hellish visit a little better for you. It was an offer rooted in kindness.","    *goto quick_RO_define_moment","*elseif (tentative_ro_pick = \"silas\")","    You shared a moment with $!{silas} near the town line before trying to leave.","    ","    $!{s_she} didn't rush you, possibly savoring your company one last time, though ${s_she} did work up the courage to ask if you might ever return to Fernweh again\u2026","    *goto quick_RO_define_moment","*elseif (tentative_ro_pick = \"reese\")","    You shared a moment with $!{reese} near the town line before trying to leave. ","    ","    $!{r_she} wouldn't look at you at first, but eventually confessed to not wanting to say goodbye to you. It was the second most intense farewell you had ever experienced. ","    *goto quick_RO_define_moment","*elseif (tentative_ro_pick = \"james\")","    You shared a moment with $!{james} near the town line before trying to leave.","    ","    $!{j_she} was quiet, if not muted, about you leaving again, but ${j_she} respected it and said that your happiness should always come first. The two of you shared a wistful farewell.","    *goto quick_RO_define_moment","*elseif (tentative_ro_pick = \"jr\")","    You shared a moment with $!{james} and $!{reese} near the town line before trying to leave.","    ","    $!{reese}'s sense of humor faltered when ${j_she} confessed to not wanting to say goodbye to you, something that $!{james} agreed with ${r_him} on. It was good to see them bond. ","    *goto quick_RO_define_moment","","*label quick_RO_define_moment","","What else happened?","","*fake_choice ","    *if (tentative_ro_pick = \"beckett\") #You tried to kiss $!{beckett}, but were interrupted\u2026 It was an almost-kiss.","        *set b_kiss \"kiss\"","    *if (tentative_ro_pick = \"beckett\") #You thought about kissing $!{beckett}, but nothing happened.","        *set b_kiss \"thought\"","    *if (tentative_ro_pick = \"beckett\") #You leaned in to kiss $!{beckett}, but worried about ruining your friendship. $!{b_she} kissed your cheek.","        *set b_kiss \"cheek\"","    *if (tentative_ro_pick = \"beckett\") #You spoke with ${b_him}, smiling fondly or teasing ${b_him}.","    *if (tentative_ro_pick = \"reese\") #You shook $!{reese}'s hand, though it was closer to a handhold.","        *set r_handshake \"shaked\"","    *if (tentative_ro_pick = \"reese\") #You refused $!{reese}'s hand; it was only an attempt at distance. ","        *set r_handshake \"refused\"","    *if (tentative_ro_pick = \"jr\") #You hugged $!{james} and reached back to hold $!{reese}'s hand.","        *set jr_hug \"hug hand\"","    *if (tentative_ro_pick = \"jr\") #You worried about leaving things tense with $!{james} and $!{reese}, mentioning that they should hug things out.","        *set jr_hug \"jr hug mention\"","    *if (tentative_ro_pick = \"jr\") #You held $!{james}'s and $!{reese}'s hands before bidding them farewell. ","        *set jr_hug \"hand hand\"","    *if (tentative_ro_pick = \"jr\") #You jokingly mentioned a group hug before saying goodbye.","        *set jr_hug \"group hug mention\"","    *if (tentative_ro_pick = \"james\") #You soothed $!{james}'s guilt about the investigation before hugging ${j_him}.","        *set j_guilt \"soothed\"","        *set j_hug \"hugged\"","    *if (tentative_ro_pick = \"james\") #You didn't soothe $!{james}'s guilt about the investigation before hugging ${j_him}.","        *set j_guilt \"not soothed\"","        *set j_hug \"hugged\"","    *if (tentative_ro_pick = \"james\") #You didn't soothe $!{james}'s guilt about the investigation and did not hug ${j_him}.","        *set j_guilt \"not soothed\"","        *set j_hug \"nope\"","    *if (tentative_ro_pick = \"james\") #You soothed $!{james}'s guilt about the investigation, but didn't hug ${j_him}.","        *set j_guilt \"soothed\"","        *set j_hug \"nope\"","    *if (tentative_ro_pick =\"silas\") #You firmly said it was unlikely you would ever want to return.","        *set s_return_visit \"hard pass\"","    *if (tentative_ro_pick =\"silas\") #You were unsure about how you felt about coming back.","        *set s_return_visit \"uncertain\"","    *if (tentative_ro_pick =\"silas\") #You were open to the possibility of coming back. It would be for the people and not the town.","        *set s_return_visit \"possibly\"","*page_break","","You experienced quite a few romantic moments during your trip\u2026","","Did you tend to be shy or flirtatious when giving or receiving attention?","","*fake_choice","    #Very flirtatious. You masterfully wielded insinuation and leading words to draw focus.","        *set flirtatious +12","    #Somewhat flirtatious. You flirted when the mood strikes you, keeping things playful. ","        *set flirtatious +7","    #You weren't exactly shy or flirtatious. It depends on the situation and how you felt.","    #Somewhat shy. You can grow slightly self-conscious, stumbling over your words.","        *set flirtatious -7 ","    #Very shy. It's\u2014Well, it's not your strong suit. You usually flustered under the attention.","        *set flirtatious -12","*page_break ","","Once the farewells were over with, it was time for you to drive off into the afternoon sun rays\u2026","","\u2026Except your car broke down yet again, creating a rhythmic ticking noise before dying. It seemed like an uncanny coincidence, but $!{beckett} unsuccessfully trying to walk out of town made you aware that something was very wrong. $!{b_she} somehow looped back around.","","Trying or not trying to leave was a measure of your resistance against whatever lurks in town.","","How resistant were you, if at all? Was it better to comply or to dig your heels in and retaliate? ","","[i][b]How difficult were you?[/b][/i]","","*fake_choice ","    #You were very resistant, defying the rules in the nightmares and staying resolute. ","        *set resistance +15","    #You were moderately resistant, ignoring the warnings worsened things, but you tried to. ","        *set resistance +10","    #You barely resisted. It was hard for you to even take a single step towards the town line.","        *set resistance +5","    #You half-heartedly complied to avoid your night terrors intensifying. ","        *set resistance -5 ","    #You were moderately compliant. It was better, if not easier, to give in at times.","        *set resistance -10","    #You were very compliant. Why fight the inevitable when you could be rewarded? ","        *set resistance -15","*page_break","","In the end, well, you should know how this ended\u2026","","You were stuck in Fernweh.","","It's\u2026 [i][b]exactly where you belong, $!{name}. It always has been.[/b][/i]","*page_break [i][b]Another round awaits us\u2026[/b][/i] Begin Book Two Alpha Content!","*goto tfs2_alpha_finish","","*label tfs2_alpha_pre","","Please select a gender identity and orientation for your pre-made character. ","","*fake_choice ","    #Gay Woman: Uses she/her pronouns, attracted to women. ","        *set gender \"female\"","        *set pc_he \"she\"","        *set pc_him \"her\"","        *set pc_his \"her\"","        *set pc_hiss \"hers\"","        *set is \"is\"","        *set was \"was\"","        *set pc_man \"woman\"","        *set pc_boy \"girl\"","        *set pc_sir \"miss\"","        *set pc_son \"daughter\"","        *set mc_plural false","        *set attraction \"women\"","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","    #Bisexual Woman: Uses she/her pronouns, attracted to both men and women.","        *set gender \"female\"","        *set pc_he \"she\"","        *set pc_him \"her\"","        *set pc_his \"her\"","        *set pc_hiss \"hers\"","        *set is \"is\"","        *set was \"was\"","        *set pc_man \"woman\"","        *set pc_boy \"girl\"","        *set pc_sir \"miss\"","        *set pc_son \"daughter\"","        *set mc_plural false","        *set attraction \"both\"","   #Straight Woman: Uses she/her pronouns, attracted to men.","        *set gender \"female\"","        *set pc_he \"she\"","        *set pc_him \"her\"","        *set pc_his \"her\"","        *set pc_hiss \"hers\"","        *set is \"is\"","        *set was \"was\"","        *set pc_man \"woman\"","        *set pc_boy \"girl\"","        *set pc_sir \"miss\"","        *set pc_son \"daughter\"","        *set mc_plural false","        *set attraction \"men\"","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","   #Gay Man: Uses he/him pronouns, attracted to men. ","        *set gender \"male\"","        *set mc_plural false","        *set attraction \"men\"","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","   #Bisexual Man: Uses he/him pronouns, attracted to both men and women.","        *set gender \"male\"","        *set mc_plural false","        *set attraction \"both\"  ","   #Straight Man: Uses he/him pronouns, attracted to women.","        *set gender \"male\"","        *set mc_plural false","        *set attraction \"women\"","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","   #Non-binary person attracted to women. Uses they/them pronouns. ","        *set gender \"non-binary\" ","        *set pc_he \"they\"","        *set pc_him \"them\"","        *set pc_his \"their\"","        *set pc_hiss \"theirs\"","        *set is \"are\"","        *set was \"were\"","        *set pc_man \"person\"","        *set pc_sir \"ser\"","        *set pc_son \"child\"","        *set pc_boy \"child\"","        *set mc_plural true","        *set attraction \"women\"","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","   #Non-binary person attracted to both men and women. Uses they/them pronouns. ","        *set gender \"non-binary\" ","        *set pc_he \"they\"","        *set pc_him \"them\"","        *set pc_his \"their\"","        *set pc_hiss \"theirs\"","        *set is \"are\"","        *set was \"were\"","        *set pc_man \"person\"","        *set pc_sir \"ser\"","        *set pc_son \"child\"","        *set pc_boy \"child\"","        *set mc_plural true","        *set attraction \"both\"","   #Non-binary person attracted to men. Uses they/them pronouns.","        *set gender \"non-binary\" ","        *set pc_he \"they\"","        *set pc_him \"them\"","        *set pc_his \"their\"","        *set pc_hiss \"theirs\"","        *set is \"are\"","        *set was \"were\"","        *set pc_man \"person\"","        *set pc_sir \"ser\"","        *set pc_son \"child\"","        *set pc_boy \"child\"","        *set mc_plural true","        *set attraction \"men\"","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","*page_break","","*if (attraction = \"both\") ","    *goto premade_cc_set_mal ","*else","    *goto premade_character_choices_2","","*label premade_cc_set_mal ","*if (w_gender = 1)","        *set malachi \"Malachi\"","        *set waiter \"waiter\"","        *set w_him \"him\"","        *set w_his \"his\"","        *set w_man \"man\"","        *set w_she \"he\"","        *set w_hiss \"his\"","        *set w_brunet \"brunet\"","        *goto premade_character_choices_2","*elseif (w_gender = 2)","        *set malachi \"Mallory\"","        *set waiter \"waitress\"","        *set w_him \"her\"","        *set w_his \"her\"","        *set w_man \"woman\"","        *set w_she \"she\"","        *set w_hiss \"hers\"","        *set w_brunet \"brunette\"","        *goto premade_character_choices_2","        ","*label premade_character_choices_2","","Before you select which pre-made character you are interested in, you will need to select the genders of some of the characters you encounter in Fernweh.","","([b]Note[/b]: There will be choices later on in the creation process to set friendship levels, including selecting your character's best friend. The displayed text will update [i]after[/i] you make those decisions. You should expect lukewarm statuses until you award those affinity points, if you check the relationship/friendship dynamics while moving through this section.)","","Let's start with\u2026","","*fake_choice","    #\u2026Beckett Warrick. He was a loyal, supportive friend throughout the trip.","        *set beckett \"Beckett\"","        *set b_him \"him\"","        *set b_his \"his\"","        *set b_man \"man\" ","        *set b_she \"he\"","        *set b_hiss \"his\"","        *set b_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set beckett_romanceable \"true\"","            *goto premade_gender_setting_s","        *elseif (attraction = \"women\") ","            *set beckett_romanceable \"false\"","            *goto premade_gender_setting_s","    #\u2026Becca Warrick. She was a loyal, supportive friend throughout the trip.","        *set beckett \"Becca\"","        *set b_him \"her\"","        *set b_his \"her\"","        *set b_man \"woman\" ","        *set b_she \"she\"","        *set b_hiss \"hers\"","        *set b_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set beckett_romanceable \"true\"","            *goto premade_gender_setting_s","        *elseif (attraction = \"men\") ","            *set beckett_romanceable \"false\"","            *goto premade_gender_setting_s","*page_break","","*label premade_gender_setting_s","","Then\u2026","","*fake_choice","    #Silas Dorran. His quiet, grounding presence helped during the visit.","        *set silas \"Silas\" ","        *set s_him \"him\"","        *set s_his \"his\"","        *set s_man \"man\"","        *set s_she \"he\"","        *set s_hiss \"his\"","        *set s_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set silas_romanceable \"true\"","            *goto premade_gender_setting_r","        *elseif (attraction = \"women\") ","            *set silas_romanceable \"false\"","            *goto premade_gender_setting_r","    #Sofia Dorran. Her quiet, grounding presence helped during the visit.","        *set silas \"Sofia\" ","        *set s_him \"her\"","        *set s_his \"her\"","        *set s_man \"woman\"","        *set s_she \"she\"","        *set s_hiss \"hers\"","        *set s_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set silas_romanceable \"true\"","            *goto premade_gender_setting_r","        *elseif (attraction = \"men\") ","            *set silas_romanceable \"false\"","            *goto premade_gender_setting_r","*page_break","","*label premade_gender_setting_r","","Up next is\u2026","","*fake_choice","    #Reese Verner. His quippy humor offered some levity during the homecoming. ","        *set reese \"Reese\"","        *set r_him \"him\"","        *set r_his \"his\"","        *set r_man \"man\"","        *set r_she \"he\"","        *set r_mister \"mister\"","        *set r_son \"son\"","        *set r_hiss \"his\"","        *set r_blond \"blond\"","        *set r_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set reese_romanceable \"true\"","            *goto premade_gender_setting_j","        *elseif (attraction = \"women\") ","            *set reese_romanceable \"false\"","            *goto premade_gender_setting_j","    #Ruby Verner. Her quippy humor offered some levity during the homecoming. ","        *set reese \"Ruby\"","        *set r_him \"her\"","        *set r_his \"her\"","        *set r_man \"woman\"","        *set r_she \"she\"","        *set r_mister \"miss\"","        *set r_son \"daughter\"","        *set r_hiss \"hers\"","        *set r_blond \"blonde\"","        *set r_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set reese_romanceable \"true\"","            *goto premade_gender_setting_j","        *elseif (attraction = \"men\") ","            *set reese_romanceable \"false\"","            *goto premade_gender_setting_j","*page_break","","*label premade_gender_setting_j","","*if ((((attraction = \"women\") and (b_man = \"man\")) and (s_man = \"man\")) and (r_man = \"man\"))","    *set james \"Jane\"","    *set j_him \"her\"","    *set j_his \"her\"","    *set j_man \"woman\"","    *set j_she \"she\"","    *set j_sir \"ma'am\"","    *set j_mister \"miss\"","    *set j_hiss \"hers\"","    *set j_brother \"sister\"","    *set j_meet \"true\"","    *set james_romanceable \"true\"","    *goto premade_gender_setting_a","*elseif ((((attraction = \"men\") and (b_man = \"woman\")) and (s_man = \"woman\")) and (r_man = \"woman\"))","    *set james \"James\"","    *set j_him \"him\"","    *set j_his \"his\"","    *set j_man \"man\"","    *set j_she \"he\"","    *set j_sir \"sir\"","    *set j_mister \"mister\"","    *set j_hiss \"his\"","    *set j_brother \"brother\"","    *set j_meet \"true\"","    *set james_romanceable \"true\"","    *goto premade_gender_setting_a","*else","    *goto premade_gender_setting_jpick","","*label premade_gender_setting_jpick","","Moving on to\u2026","","*fake_choice ","    #James Corvin. His care for others is closely guarded, but he has a remarkably soft heart. ","        *set james \"James\"","        *set j_him \"him\"","        *set j_his \"his\"","        *set j_man \"man\"","        *set j_she \"he\"","        *set j_sir \"sir\"","        *set j_mister \"mister\"","        *set j_hiss \"his\"","        *set j_brother \"brother\"","        *set j_meet \"true\"","        *if ((attraction = \"men\") or (attraction = \"both\")) ","            *set james_romanceable \"true\"","            *goto premade_gender_setting_a","        *elseif (attraction = \"women\") ","            *set james_romanceable \"false\"","            *goto premade_gender_setting_a","    #Jane Corvin. Her care for others is closely guarded, but she has a remarkably soft heart. ","        *set james \"Jane\"","        *set j_him \"her\"","        *set j_his \"her\"","        *set j_man \"woman\"","        *set j_she \"she\"","        *set j_sir \"ma'am\"","        *set j_mister \"miss\"","        *set j_hiss \"hers\"","        *set j_brother \"sister\"","        *set j_meet \"true\"","        *if ((attraction = \"women\") or (attraction = \"both\")) ","            *set james_romanceable \"true\"","            *goto premade_gender_setting_a","        *elseif (attraction = \"men\") ","            *set james_romanceable \"false\"","            *goto premade_gender_setting_a","*page_break","","*label  premade_gender_setting_a","","Last, but not least, is\u2026","","*fake_choice ","    #\u2026$!{james}'s sister. Alina Corvin. Her sunny smile is only outshone by the warmth she shows to those she cares for.  ","        *set alex \"Alina\"","        *set a_gender \"female\"","        *set a_their \"her\"","        *set a_them \"her\"","        *set a_they \"she\"","        *set a_theirs \"hers\"","        *set a_person \"woman\"","        *set a_sibling \"sister\"","        *set a_are \"is\"","        *set a_have \"has\"","        *set a_were \"was\"","        *set a_plural false","    #\u2026$!{james}'s brother. Alek Corvin. His sunny smile is only outshone by the warmth he shows to those he cares for.  ","        *set alex \"Alek\"","        *set a_gender \"male\"","        *set a_their \"his\"","        *set a_them \"him\"","        *set a_they \"he\"","        *set a_theirs \"his\"","        *set a_person \"man\"","        *set a_sibling \"brother\"","        *set a_are \"is\"","        *set a_have \"has\"","        *set a_were \"was\"","        *set a_plural false","    #\u2026$!{james}'s sibling. Alex Corvin. Their sunny smile is only outshone by the warmth they show to those they care for.","        *set alex \"Alex\"","        *set a_gender \"non-binary\"","        *set a_their \"their\"","        *set a_them \"them\"","        *set a_they \"they\"","        *set a_theirs \"theirs\"","        *set a_person \"person\"","        *set a_sibling \"sibling\"","        *set a_are \"are\"","        *set a_have \"have\"","        *set a_were \"were\"","        *set a_plural true","*page_break","","*label premade_character_options","","*if (gender = \"female\")","    *goto premade_female_options","*elseif (gender = \"male\")","    *goto premade_male_options","*elseif (gender = \"non-binary\")","    *goto premade_nonbinary_options","","*label premade_female_options","","Please select one of the characters below.","","*choice","    #Malia Beckham: Snarky and very reckless, moderately resistant. $!{alex} used to idolize her. Neutral opinion of her grandfather. Struggled some when fighting the tree creature. Empathetic impressions.","        *set name \"malia\"","        *set surname \"beckham\"","        *set pc_nickname false","        *set grandfather_name \"kenneth\"","        *set grandfather_nickname \"papa\"","        *set pc_eye_color \"light blue\"","        *set pc_hair_color \"warm blonde\"","        *set pc_natural_hair_color \"warm blonde\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"long length\"","        *set pc_height \"average\"","        *set baby_deer_road \"go\" ","        *set room_theme \"nautical nap\"","        *set rt1 \"nautical\"","        *set rt2 \"nap\"","        *set attire \"sporty\"","        *set top \"A sleeveless top with a light jacket and\" ","        *set bottom \"joggers\" ","        *set marj_meet_1 \"joke\"","        *set past_affinity \"writing\"","        *set past_affinity_specific \"short stories\"","        *set past_comp \"writing contest\"","        *set past_affinity_text \"Fantastical worlds and societies of magic feature in your short stories.\"","        *set jour_feel_1 \"skeptical\"","        *set diner_meal \"sandwich\"","        *set drink_choice \"coffee\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"angry\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"lost\"","        *set mechanic_decor \"mirror\"","        *set past_susceptibility \"Easy\"","        *set past_susceptibility_text \"It's easy for you to think of the past, sometimes too easy when a particular memory threatens to engulf you.\"","        *set candle_status \"left\"","        *set leave_opinion \"uncertain\"","        *set book_willingness \"apprehensive\"","        *set flower_choice \"daisy\" ","        *set friendship_necklace_j \"traumatic\"","        *set friendship_necklace_style \"partners in crime\"","        ","        *set sincerity -17","        *set friendly +12","        *set merciful +5","        *set heart +7","        *set cooperative -15","        *set believer -7","        *set optimistic +7","        *set reckless +17","        *set flirtatious +7","        *set resistance +10","        *set receptive +7","        *set combat +5","        ","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"dead\"","        *set deer_guilt \"very guilty\"","        *set deer_visitor \"doe\"","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_1 \"ankle cuts\"","        *set sprig_death \"quick alcohol\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set milton_knowledge \"conceal\"","        *set msv_loyalty_1 \"neutral\"","        *set ms_v_hardened -1","        ","        *set alex_past \"idolized\"","        *set msv_relationship -3","    ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"taffy\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro","    #Diana Rivera: Friendly and big-hearted, very compliant. She and $!{alex} didn't get along as kids. Positive opinion of her grandfather. Passed the tree creature fight, both trials. Retrocognition.","        *set name \"diana\"","        *set surname \"rivera\"","        *set pc_nickname false","        *set grandfather_name \"ben\"","        *set grandfather_nickname \"gramps\"","        *set pc_eye_color \"light brown\"","        *set pc_hair_color \"golden brown\"","        *set pc_natural_hair_color \"golden brown\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"medium length\"","        *set pc_height \"tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"safari slumber\"","        *set rt1 \"safari\"","        *set rt2 \"slumber\"","        *set attire \"denim\"","        *set top \"A denim jacket with a colorful T-shirt and\" ","        *set bottom \"jeans\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"poetry\"","        *set past_comp \"poetry jam\"","        *set past_affinity_text \"Expressing your thoughts and feelings in a poetic form is something you still engage in when wanting to unwind or be creative.\" ","        *set jour_feel_1 \"possibly\"","        *set diner_meal \"waffles\"","        *set drink_choice \"hot chocolate\"","        *set destination_info1 \"lodge\"","        *set emotion_mare_1 \"afraid\"","        *set mare3_touch \"accept\" ","        *set questionable_interest +2 ","        *set childhood_home \"always\"","        *set mechanic_decor \"cat\"","        *set past_susceptibility \"Rose-Tinted\"","        *set past_susceptibility_text \"It's important to not forget the good parts of the past because of all the bad\u2026 Your memories are a part of you.\"","        *set candle_status \"kept\"","        *set leave_opinion \"disfavorable\"","        *set book_willingness \"curious\"","        *set flower_choice \"aster\" ","        *set friendship_necklace_j \"worn\"","        *set friendship_necklace_style \"moon and stars\"","        ","        *set sincerity +12","        *set friendly +17","        *set merciful +7","        *set heart +17","        *set cooperative +10","        *set believer +7","        *set optimistic +12","        *set reckless -7","        *set flirtatious -12","        *set resistance -15","        *set receptive +16","        *set combat -7","        ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_reaction \"cared\"","        *set deer_visitor \"fawn and doe\"","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","        *set mc_scar_1 \"none\"","        *set mc_kill_sprig \"nope\"","        *set milton_knowledge \"honest\"","        *set msv_loyalty_1 \"questioning\"","        *set ms_v_hardened -3","        ","        *set alex_past \"frenemies\"","        *set msv_relationship +5","        *set grandfather_relationship +12","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"honeybun\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro       ","    #Kim Zane: Sincere and slightly pessimistic, very resistant. She and $!{alex} didn't get along as kids. Abandonment issues linked to grandfather. Struggled some in the creature fight. Retrocognition.","        *set name \"kim\"","        *set surname \"zane\"","        *set pc_nickname false","        *set grandfather_name \"clint\"","        *set grandfather_nickname \"grandpa\"","        *set pc_eye_color \"dark brown\"","        *set pc_natural_hair_color \"blue black\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_color \"blue black\"","        *set pc_hair_style \"short length\"","        *set pc_height \"short\"","        *set baby_deer_road \"go\" ","        *set room_theme \"futuristic futon\"","        *set rt1 \"futuristic\"","        *set rt2 \"futon\"","        *set attire \"colorful\"","        *set top \"A brightly colored or patterned shirt and\" ","        *set bottom \"cargo pants\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"science\"","        *set past_comp \"science fair\"","        *set past_affinity_specific \"geology\"","        *set past_affinity_text \"Collecting rocks and crystals is still fun for you; their different formations shape how they look and feel.\" ","        *set jour_feel_1 \"crazy\"","        *set diner_meal \"burger\"","        *set drink_choice \"coffee\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"angry\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"house\"","        *set mechanic_decor \"bat\"","        *set past_susceptibility \"Healthy\"","        *set past_susceptibility_text \"It's important to work through the past to try and heal. You aren't going to fully embrace or erase it; there needs to be balance.\"","        *set candle_status \"wickless\"","        *set leave_opinion \"favorable\"","        *set book_willingness \"refuse\"","        *set flower_choice \"carnation\" ","        *set friendship_necklace_j \"burned\"","        *set friendship_necklace_style \"sword and shield\"","        ","        *set sincerity +17","        *set friendly -12","        *set merciful -5","        *set heart -7","        *set cooperative -10","        *set believer -12","        *set optimistic -12","        *set reckless +7","        *set flirtatious +12","        *set resistance +15","        *set receptive +7","        ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_reaction \"neutral\"","        *set deer_visitor \"fawn\"","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_1 \"ankle gouges\"","        *set sprig_death \"slow lighter\"","        *set sprig_kill_method \"slow\"","        *set mc_kill_sprig \"killed\"","        *set milton_knowledge \"conceal\"","        *set msv_loyalty_1 \"neutral\"","        *set ms_v_hardened -1","        ","        *set alex_past \"neutral\"","        *set msv_relationship +1","        *set grandfather_relationship -12","        *set potential_abandoniss +3","        ","        *set dog_ownership \"mc duty\"","        *set canine_trust +3","        *set dog_name \"sunny\" ","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro  ","    #Evie Amell: Aloof and cautious. Moderately compliant. Neutral past history with $!{alex}. Her opinion of her grandfather is improving. Failed both trials when fighting the creature. Extrasensory awareness ","        *set name \"evie\"","        *set surname \"amell\"","        *set pc_nickname false","        *set grandfather_name \"luca\"","        *set grandfather_nickname \"poppa\"","        *set pc_eye_color \"gray\"","        *set pc_hair_color \"auburn red\"","        *set pc_natural_hair_color \"auburn red\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"long length\"","        *set pc_height \"very tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"zombie zen\"","        *set rt1 \"zombie\"","        *set rt2 \"zen\"","        *set attire \"leather\"","        *set top \"A leather jacket with an undershirt and\" ","        *set bottom \"dark pants\" ","        *set marj_meet_1 \"neutral\"","        *set past_affinity \"music\"","        *set past_comp \"music recital\"","        *set past_affinity_specific \"piano\"","        *set past_affinity_text \"Playing the piano offers you an escape; it's easy to get swept up in the music you're creating.\"","        *set jour_feel_1 \"neutral\"","        *set diner_meal \"parfait\"","        *set drink_choice \"tea\"","        *set destination_info1 \"lodge\"","        *set emotion_mare_1 \"afraid\"","        *set mare3_touch \"avoid\" ","        *set childhood_home \"projection\"","        *set mechanic_decor \"tool\"","        *set past_susceptibility \"Forward\"","        *set past_susceptibility_text \"It's better to push forward. Don't look back on the past when you have new places to be and things to achieve.\" ","        *set candle_status \"kept\"","        *set leave_opinion \"uncertain\"","        *set book_willingness \"combative\"","        *set flower_choice \"forget-me-nots\" ","        *set friendship_necklace_style \"puzzle pieces\"","        *set friendship_necklace_j \"disinterested\"","        ","        *set sincerity -12","        *set friendly -17","        *set merciful -7","        *set heart +5 ","        *set cooperative +15","        *set believer +3","        *set optimistic -7","        *set reckless -17","        *set flirtatious -5","        *set resistance -10","        *set receptive -16","        ","        *set extrasensory_awareness +15","        *set primary_skill \"extrasensory awareness\"","        *set primary_ea \"true\"","        *set primary_ei \"false\"","        *set primary_rc \"false\"","        ","        *set baby_bambi \"dead\"","        *set deer_guilt \"neutral\"","        *set deer_visitor \"doe\"","        *set milton_injury \"severe\"","        *set r_arm_injury \"three\"","        *set mc_scar_1 \"none\"","        *set mc_scar_2 \"puncture wound\"","        *set sprig_death \"flare\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set milton_knowledge \"wait\"","        *set msv_loyalty_1 \"loyal\"","        *set ms_v_hardened +2","        ","        ","        *set alex_past \"neutral\"","        *set msv_relationship +1","        *set grandfather_relationship +5","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"fluffy\" ","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro  ","    #Valerie Clifton: Sincere and merciful, neutral willpower. $!{alex}'s childhood adoration turned into a crush. Slightly negative opinion of her grandfather. Passed tree creature fight. Empathetic impressions.","        *set name \"valerie\"","        *set surname \"clifton\"","        *set pc_nickname false","        *set grandfather_name \"geralt\"","        *set grandfather_nickname \"grandpa\"","        *set pc_eye_color \"dark green\"","        *set pc_hair_color \"dark brown\"","        *set pc_natural_hair_color \"dark brown\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"medium length\"","        *set pc_height \"tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"cat's cradle\"","        *set rt1 \"cat's\"","        *set rt2 \"cradle\"","        *set attire \"business formal\"","        *set top \"A collared shirt with a blazer and\" ","        *set bottom \"formal pants\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"baking\"","        *set past_comp \"bake off\"","        *set past_affinity_specific \"rustic\"","        *set past_affinity_text \"Respecting tradition is why you enjoy using old recipes you have unearthed. The flavors tend to be simple, homey, and classic.\"   ","        *set jour_feel_1 \"believe\"","        *set diner_meal \"pancakes\"","        *set drink_choice \"tea\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"sad\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"always\"","        *set mechanic_decor \"mirror\"","        *set past_susceptibility \"Buried\"","        *set past_susceptibility_text \"It's best to keep the past locked away and buried down deep. You won't let it drag you down again.\"","        *set candle_status \"kept\"","        *set leave_opinion \"favorable\"","        *set book_willingness \"curious\"","        *set flower_choice \"both\" ","        *set friendship_necklace_j \"worn\"","        *set friendship_necklace_style \"lock and key\"","        ","        *set sincerity +17","        *set friendly -5","        *set merciful +12","        *set heart -17","        *set cooperative -15","        *set believer +12","        *set optimistic -7","        *set reckless -12","        *set flirtatious -7","        *set resistance +5","        *set receptive -12","        *set combat -5","        ","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_guilt \"cared\"","        *set deer_visitor \"fawn and doe\"","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","        *set mc_scar_1 \"ankle cuts\"","        *set mc_scar_2 \"none\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set sprig_death \"mercy kill\"","        *set milton_knowledge \"wait\"","        *set msv_loyalty_1 \"questioning\"","        *set ms_v_hardened -1","        ","        *set alex_past \"idolized\"","        *set alex_crush \"true\"","        *set reject_alex_mc +1","        *set msv_relationship +5","        *set grandfather_relationship -5","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"ciri\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro","*page_break ","","*label premade_male_options","","Please select one of the characters below.","","*choice","    #Derek Beckham: Snarky and very reckless, moderately resistant. $!{alex} used to idolize him. Neutral opinion of his grandfather. Struggled some when fighting the tree creature. Empathetic impressions.","        *set name \"derek\"","        *set surname \"beckham\"","        *set pc_nickname false","        *set grandfather_name \"kenneth\"","        *set grandfather_nickname \"papa\"","        *set pc_eye_color \"light blue\"","        *set pc_hair_color \"warm blond\"","        *set pc_natural_hair_color \"warm blond\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"short length\"","        *set pc_height \"average\"","        *set baby_deer_road \"go\" ","        *set room_theme \"nautical nap\"","        *set rt1 \"nautical\"","        *set rt2 \"nap\"","        *set attire \"sporty\"","        *set top \"A sleeveless top with a light jacket and\" ","        *set bottom \"joggers\" ","        *set marj_meet_1 \"joke\"","        *set past_affinity \"writing\"","        *set past_affinity_specific \"short stories\"","        *set past_comp \"writing contest\"","        *set past_affinity_text \"Fantastical worlds and societies of magic feature in your short stories.\"","        *set jour_feel_1 \"skeptical\"","        *set diner_meal \"sandwich\"","        *set drink_choice \"coffee\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"angry\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"lost\"","        *set mechanic_decor \"mirror\"","        *set past_susceptibility \"Easy\"","        *set past_susceptibility_text \"It's easy for you to think of the past, sometimes too easy when a particular memory threatens to engulf you.\"","        *set candle_status \"left\"","        *set leave_opinion \"uncertain\"","        *set book_willingness \"apprehensive\"","        *set flower_choice \"daisy\" ","        *set friendship_necklace_j \"traumatic\"","        *set friendship_necklace_style \"partners in crime\"","        ","        *set sincerity -17","        *set friendly +12","        *set merciful +5","        *set heart +7","        *set cooperative -15","        *set believer -7","        *set optimistic +7","        *set reckless +17","        *set flirtatious +7","        *set resistance +10","        *set receptive +7","        *set combat +5","        ","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"dead\"","        *set deer_guilt \"very guilty\"","        *set deer_visitor \"doe\"","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_1 \"ankle cuts\"","        *set sprig_death \"quick alcohol\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set milton_knowledge \"conceal\"","        *set msv_loyalty_1 \"neutral\"","        *set ms_v_hardened -1","        ","        *set alex_past \"idolized\"","        *set msv_relationship -3","    ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"taffy\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro","    #Steve Rivera: Friendly and big-hearted, very compliant. He and $!{alex} didn't get along as kids. Positive opinion of his grandfather. Passed the tree creature fight, both trials. Retrocognition.","        *set name \"steve\"","        *set surname \"rivera\"","        *set pc_nickname false","        *set grandfather_name \"ben\"","        *set grandfather_nickname \"gramps\"","        *set pc_eye_color \"light brown\"","        *set pc_hair_color \"golden brown\"","        *set pc_natural_hair_color \"golden brown\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"medium length\"","        *set pc_height \"tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"safari slumber\"","        *set rt1 \"safari\"","        *set rt2 \"slumber\"","        *set attire \"denim\"","        *set top \"A denim jacket with a colorful T-shirt and\" ","        *set bottom \"jeans\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"poetry\"","        *set past_comp \"poetry jam\"","        *set past_affinity_text \"Expressing your thoughts and feelings in a poetic form is something you still engage in when wanting to unwind or be creative.\" ","        *set jour_feel_1 \"possibly\"","        *set diner_meal \"waffles\"","        *set drink_choice \"hot chocolate\"","        *set destination_info1 \"lodge\"","        *set emotion_mare_1 \"afraid\"","        *set mare3_touch \"accept\" ","        *set questionable_interest +2 ","        *set childhood_home \"always\"","        *set mechanic_decor \"cat\"","        *set past_susceptibility \"Rose-Tinted\"","        *set past_susceptibility_text \"It's important to not forget the good parts of the past because of all the bad\u2026 Your memories are a part of you.\"","        *set candle_status \"kept\"","        *set leave_opinion \"disfavorable\"","        *set book_willingness \"curious\"","        *set flower_choice \"aster\" ","        *set friendship_necklace_j \"worn\"","        *set friendship_necklace_style \"moon and stars\"","        ","        *set sincerity +12","        *set friendly +17","        *set merciful +7","        *set heart +17","        *set cooperative +10","        *set believer +7","        *set optimistic +12","        *set reckless -7","        *set flirtatious -12","        *set resistance -15","        *set receptive +16","        *set combat -7","        ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_reaction \"cared\"","        *set deer_visitor \"fawn and doe\"","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","        *set mc_scar_1 \"none\"","        *set mc_kill_sprig \"nope\"","        *set milton_knowledge \"honest\"","        *set msv_loyalty_1 \"questioning\"","        *set ms_v_hardened -3","        ","        *set alex_past \"frenemies\"","        *set msv_relationship +5","        *set grandfather_relationship +12","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"honeybun\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro       ","    #Jay Zane: Sincere and slightly pessimistic, very resistant. He and $!{alex} didn't get along as kids. Abandonment issues linked to grandfather. Struggled some in the creature fight. Retrocognition.","        *set name \"jay\"","        *set surname \"zane\"","        *set pc_nickname false","        *set grandfather_name \"clint\"","        *set grandfather_nickname \"grandpa\"","        *set pc_eye_color \"dark brown\"","        *set pc_natural_hair_color \"blue black\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_color \"blue black\"","        *set pc_hair_style \"long length\"","        *set pc_height \"short\"","        *set baby_deer_road \"go\" ","        *set room_theme \"futuristic futon\"","        *set rt1 \"futuristic\"","        *set rt2 \"futon\"","        *set attire \"colorful\"","        *set top \"A brightly colored or patterned shirt and\" ","        *set bottom \"cargo pants\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"science\"","        *set past_comp \"science fair\"","        *set past_affinity_specific \"geology\"","        *set past_affinity_text \"Collecting rocks and crystals is still fun for you; their different formations shape how they look and feel.\" ","        *set jour_feel_1 \"crazy\"","        *set diner_meal \"burger\"","        *set drink_choice \"coffee\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"angry\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"house\"","        *set mechanic_decor \"bat\"","        *set past_susceptibility \"Healthy\"","        *set past_susceptibility_text \"It's important to work through the past to try and heal. You aren't going to fully embrace or erase it; there needs to be balance.\"","        *set candle_status \"wickless\"","        *set leave_opinion \"favorable\"","        *set book_willingness \"refuse\"","        *set flower_choice \"carnation\" ","        *set friendship_necklace_j \"burned\"","        *set friendship_necklace_style \"sword and shield\"","        ","        *set sincerity +17","        *set friendly -12","        *set merciful -5","        *set heart -7","        *set cooperative -10","        *set believer -12","        *set optimistic -12","        *set reckless +7","        *set flirtatious +12","        *set resistance +15","        *set receptive +7","        ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_reaction \"neutral\"","        *set deer_visitor \"fawn\"","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_1 \"ankle gouges\"","        *set sprig_death \"slow lighter\"","        *set sprig_kill_method \"slow\"","        *set mc_kill_sprig \"killed\"","        *set milton_knowledge \"conceal\"","        *set msv_loyalty_1 \"neutral\"","        *set ms_v_hardened -1","        ","        *set alex_past \"neutral\"","        *set msv_relationship +1","        *set grandfather_relationship -12","        *set potential_abandoniss +3","        ","        *set dog_ownership \"mc duty\"","        *set canine_trust +3","        *set dog_name \"sunny\" ","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro  ","    #Andre Amell: Aloof and cautious. Moderately compliant. Neutral past history with $!{alex}. His opinion of his grandfather is improving. Failed both trials when fighting the creature. Extrasensory awareness ","        *set name \"andre\"","        *set surname \"amell\"","        *set pc_nickname false","        *set grandfather_name \"luca\"","        *set grandfather_nickname \"poppa\"","        *set pc_eye_color \"gray\"","        *set pc_hair_color \"auburn red\"","        *set pc_natural_hair_color \"auburn red\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"short length\"","        *set pc_height \"very tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"zombie zen\"","        *set rt1 \"zombie\"","        *set rt2 \"zen\"","        *set attire \"leather\"","        *set top \"A leather jacket with an undershirt and\" ","        *set bottom \"dark pants\" ","        *set marj_meet_1 \"neutral\"","        *set past_affinity \"music\"","        *set past_comp \"music recital\"","        *set past_affinity_specific \"piano\"","        *set past_affinity_text \"Playing the piano offers you an escape; it's easy to get swept up in the music you're creating.\"","        *set jour_feel_1 \"neutral\"","        *set diner_meal \"parfait\"","        *set drink_choice \"tea\"","        *set destination_info1 \"lodge\"","        *set emotion_mare_1 \"afraid\"","        *set mare3_touch \"avoid\" ","        *set childhood_home \"projection\"","        *set mechanic_decor \"tool\"","        *set past_susceptibility \"Forward\"","        *set past_susceptibility_text \"It's better to push forward. Don't look back on the past when you have new places to be and things to achieve.\" ","        *set candle_status \"kept\"","        *set leave_opinion \"uncertain\"","        *set book_willingness \"combative\"","        *set flower_choice \"forget-me-nots\" ","        *set friendship_necklace_style \"puzzle pieces\"","        *set friendship_necklace_j \"disinterested\"","        ","        *set sincerity -12","        *set friendly -17","        *set merciful -7","        *set heart +5 ","        *set cooperative +15","        *set believer +3","        *set optimistic -7","        *set reckless -17","        *set flirtatious -5","        *set resistance -10","        *set receptive -16","        ","        *set extrasensory_awareness +15","        *set primary_skill \"extrasensory awareness\"","        *set primary_ea \"true\"","        *set primary_ei \"false\"","        *set primary_rc \"false\"","        ","        *set baby_bambi \"dead\"","        *set deer_guilt \"neutral\"","        *set deer_visitor \"doe\"","        *set milton_injury \"severe\"","        *set r_arm_injury \"three\"","        *set mc_scar_1 \"none\"","        *set mc_scar_2 \"puncture wound\"","        *set sprig_death \"flare\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set milton_knowledge \"wait\"","        *set msv_loyalty_1 \"loyal\"","        *set ms_v_hardened +2","        ","        ","        *set alex_past \"neutral\"","        *set msv_relationship +1","        *set grandfather_relationship +5","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"fluffy\" ","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro  ","    #Michael Clifton: Sincere and merciful, neutral willpower. $!{alex}'s childhood adoration turned into a crush. Slightly negative opinion of his grandfather. Passed tree creature fight. Empathetic impressions.","        *set name \"michael\"","        *set surname \"clifton\"","        *set pc_nickname false","        *set grandfather_name \"geralt\"","        *set grandfather_nickname \"grandpa\"","        *set pc_eye_color \"dark green\"","        *set pc_hair_color \"dark brown\"","        *set pc_natural_hair_color \"dark brown\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"medium length\"","        *set pc_height \"tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"cat's cradle\"","        *set rt1 \"cat's\"","        *set rt2 \"cradle\"","        *set attire \"business formal\"","        *set top \"A collared shirt with a blazer and\" ","        *set bottom \"formal pants\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"baking\"","        *set past_comp \"bake off\"","        *set past_affinity_specific \"rustic\"","        *set past_affinity_text \"Respecting tradition is why you enjoy using old recipes you have unearthed. The flavors tend to be simple, homey, and classic.\"   ","        *set jour_feel_1 \"believe\"","        *set diner_meal \"pancakes\"","        *set drink_choice \"tea\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"sad\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"always\"","        *set mechanic_decor \"mirror\"","        *set past_susceptibility \"Buried\"","        *set past_susceptibility_text \"It's best to keep the past locked away and buried down deep. You won't let it drag you down again.\"","        *set candle_status \"kept\"","        *set leave_opinion \"favorable\"","        *set book_willingness \"curious\"","        *set flower_choice \"both\" ","        *set friendship_necklace_j \"worn\"","        *set friendship_necklace_style \"lock and key\"","        ","        *set sincerity +17","        *set friendly -5","        *set merciful +12","        *set heart -17","        *set cooperative -15","        *set believer +12","        *set optimistic -7","        *set reckless -12","        *set flirtatious -7","        *set resistance +5","        *set receptive -12","        *set combat -5","        ","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_guilt \"cared\"","        *set deer_visitor \"fawn and doe\"","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","        *set mc_scar_1 \"ankle cuts\"","        *set mc_scar_2 \"none\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set sprig_death \"mercy kill\"","        *set milton_knowledge \"wait\"","        *set msv_loyalty_1 \"questioning\"","        *set ms_v_hardened -1","        ","        *set alex_past \"idolized\"","        *set alex_crush \"true\"","        *set reject_alex_mc +1","        *set msv_relationship +5","        *set grandfather_relationship -5","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"ciri\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro","*page_break ","","*label premade_nonbinary_options","","Please select one of the characters below.","","*choice","    #Jesse Beckham: Snarky and very reckless, moderately resistant. $!{alex} used to idolize them. Neutral opinion of their grandfather. Struggled some when fighting the tree creature. Empathetic impressions.","        *set name \"jesse\"","        *set surname \"beckham\"","        *set pc_nickname false","        *set grandfather_name \"kenneth\"","        *set grandfather_nickname \"papa\"","        *set pc_eye_color \"light blue\"","        *set pc_hair_color \"warm blond\"","        *set pc_natural_hair_color \"warm blond\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"long length\"","        *set pc_height \"average\"","        *set baby_deer_road \"go\" ","        *set room_theme \"nautical nap\"","        *set rt1 \"nautical\"","        *set rt2 \"nap\"","        *set attire \"sporty\"","        *set top \"A sleeveless top with a light jacket and\" ","        *set bottom \"joggers\" ","        *set marj_meet_1 \"joke\"","        *set past_affinity \"writing\"","        *set past_affinity_specific \"short stories\"","        *set past_comp \"writing contest\"","        *set past_affinity_text \"Fantastical worlds and societies of magic feature in your short stories.\"","        *set jour_feel_1 \"skeptical\"","        *set diner_meal \"sandwich\"","        *set drink_choice \"coffee\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"angry\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"lost\"","        *set mechanic_decor \"mirror\"","        *set past_susceptibility \"Easy\"","        *set past_susceptibility_text \"It's easy for you to think of the past, sometimes too easy when a particular memory threatens to engulf you.\"","        *set candle_status \"left\"","        *set leave_opinion \"uncertain\"","        *set book_willingness \"apprehensive\"","        *set flower_choice \"daisy\" ","        *set friendship_necklace_j \"traumatic\"","        *set friendship_necklace_style \"partners in crime\"","        ","        *set sincerity -17","        *set friendly +12","        *set merciful +5","        *set heart +7","        *set cooperative -15","        *set believer -7","        *set optimistic +7","        *set reckless +17","        *set flirtatious +7","        *set resistance +10","        *set receptive +7","        *set combat +5","        ","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"dead\"","        *set deer_guilt \"very guilty\"","        *set deer_visitor \"doe\"","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_1 \"ankle cuts\"","        *set sprig_death \"quick alcohol\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set milton_knowledge \"conceal\"","        *set msv_loyalty_1 \"neutral\"","        *set ms_v_hardened -1","        ","        *set alex_past \"idolized\"","        *set msv_relationship -3","    ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"taffy\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro","    #Taylor Rivera: Friendly and big-hearted, very compliant. They and $!{alex} didn't get along as kids. Positive opinion of their grandfather. Passed the tree creature fight, both trials. Retrocognition.","        *set name \"taylor\"","        *set surname \"rivera\"","        *set pc_nickname false","        *set grandfather_name \"ben\"","        *set grandfather_nickname \"gramps\"","        *set pc_eye_color \"light brown\"","        *set pc_hair_color \"golden brown\"","        *set pc_natural_hair_color \"golden brown\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"medium length\"","        *set pc_height \"tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"safari slumber\"","        *set rt1 \"safari\"","        *set rt2 \"slumber\"","        *set attire \"denim\"","        *set top \"A denim jacket with a colorful T-shirt and\" ","        *set bottom \"jeans\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"poetry\"","        *set past_comp \"poetry jam\"","        *set past_affinity_text \"Expressing your thoughts and feelings in a poetic form is something you still engage in when wanting to unwind or be creative.\" ","        *set jour_feel_1 \"possibly\"","        *set diner_meal \"waffles\"","        *set drink_choice \"hot chocolate\"","        *set destination_info1 \"lodge\"","        *set emotion_mare_1 \"afraid\"","        *set mare3_touch \"accept\" ","        *set questionable_interest +2 ","        *set childhood_home \"always\"","        *set mechanic_decor \"cat\"","        *set past_susceptibility \"Rose-Tinted\"","        *set past_susceptibility_text \"It's important to not forget the good parts of the past because of all the bad\u2026 Your memories are a part of you.\"","        *set candle_status \"kept\"","        *set leave_opinion \"disfavorable\"","        *set book_willingness \"curious\"","        *set flower_choice \"aster\" ","        *set friendship_necklace_j \"worn\"","        *set friendship_necklace_style \"moon and stars\"","        ","        *set sincerity +12","        *set friendly +17","        *set merciful +7","        *set heart +17","        *set cooperative +10","        *set believer +7","        *set optimistic +12","        *set reckless -7","        *set flirtatious -12","        *set resistance -15","        *set receptive +16","        *set combat -7","        ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_reaction \"cared\"","        *set deer_visitor \"fawn and doe\"","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","        *set mc_scar_1 \"none\"","        *set mc_kill_sprig \"nope\"","        *set milton_knowledge \"honest\"","        *set msv_loyalty_1 \"questioning\"","        *set ms_v_hardened -3","        ","        *set alex_past \"frenemies\"","        *set msv_relationship +5","        *set grandfather_relationship +12","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"honeybun\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro       ","    #Kennedy Zane: Sincere and slightly pessimistic, very resistant. They and $!{alex} didn't get along as kids. Abandonment issues linked to grandfather. Struggled some in the creature fight. Retrocognition.","        *set name \"kennedy\"","        *set surname \"zane\"","        *set pc_nickname false","        *set grandfather_name \"clint\"","        *set grandfather_nickname \"grandpa\"","        *set pc_eye_color \"dark brown\"","        *set pc_natural_hair_color \"blue black\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_color \"blue black\"","        *set pc_hair_style \"short length\"","        *set pc_height \"short\"","        *set baby_deer_road \"go\" ","        *set room_theme \"futuristic futon\"","        *set rt1 \"futuristic\"","        *set rt2 \"futon\"","        *set attire \"colorful\"","        *set top \"A brightly colored or patterned shirt and\" ","        *set bottom \"cargo pants\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"science\"","        *set past_comp \"science fair\"","        *set past_affinity_specific \"geology\"","        *set past_affinity_text \"Collecting rocks and crystals is still fun for you; their different formations shape how they look and feel.\" ","        *set jour_feel_1 \"crazy\"","        *set diner_meal \"burger\"","        *set drink_choice \"coffee\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"angry\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"house\"","        *set mechanic_decor \"bat\"","        *set past_susceptibility \"Healthy\"","        *set past_susceptibility_text \"It's important to work through the past to try and heal. You aren't going to fully embrace or erase it; there needs to be balance.\"","        *set candle_status \"wickless\"","        *set leave_opinion \"favorable\"","        *set book_willingness \"refuse\"","        *set flower_choice \"carnation\" ","        *set friendship_necklace_j \"burned\"","        *set friendship_necklace_style \"sword and shield\"","        ","        *set sincerity +17","        *set friendly -12","        *set merciful -5","        *set heart -7","        *set cooperative -10","        *set believer -12","        *set optimistic -12","        *set reckless +7","        *set flirtatious +12","        *set resistance +15","        *set receptive +7","        ","        *set retrocognition +15","        *set primary_skill \"retrocognition\"","        *set primary_rc \"true\"","        *set primary_ei \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_reaction \"neutral\"","        *set deer_visitor \"fawn\"","        *set milton_injury \"moderate\"","        *set r_arm_injury \"two\"","        *set mc_scar_1 \"ankle gouges\"","        *set sprig_death \"slow lighter\"","        *set sprig_kill_method \"slow\"","        *set mc_kill_sprig \"killed\"","        *set milton_knowledge \"conceal\"","        *set msv_loyalty_1 \"neutral\"","        *set ms_v_hardened -1","        ","        *set alex_past \"neutral\"","        *set msv_relationship +1","        *set grandfather_relationship -12","        *set potential_abandoniss +3","        ","        *set dog_ownership \"mc duty\"","        *set canine_trust +3","        *set dog_name \"sunny\" ","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro  ","    #Clark Amell: Aloof and cautious. Moderately compliant. Neutral past history with $!{alex}. Their opinion of their grandfather is improving. Failed both trials when fighting the creature. Extrasensory awareness ","        *set name \"clark\"","        *set surname \"amell\"","        *set pc_nickname false","        *set grandfather_name \"luca\"","        *set grandfather_nickname \"poppa\"","        *set pc_eye_color \"gray\"","        *set pc_hair_color \"auburn red\"","        *set pc_natural_hair_color \"auburn red\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"short length\"","        *set pc_height \"very tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"zombie zen\"","        *set rt1 \"zombie\"","        *set rt2 \"zen\"","        *set attire \"leather\"","        *set top \"A leather jacket with an undershirt and\" ","        *set bottom \"dark pants\" ","        *set marj_meet_1 \"neutral\"","        *set past_affinity \"music\"","        *set past_comp \"music recital\"","        *set past_affinity_specific \"piano\"","        *set past_affinity_text \"Playing the piano offers you an escape; it's easy to get swept up in the music you're creating.\"","        *set jour_feel_1 \"neutral\"","        *set diner_meal \"parfait\"","        *set drink_choice \"tea\"","        *set destination_info1 \"lodge\"","        *set emotion_mare_1 \"afraid\"","        *set mare3_touch \"avoid\" ","        *set childhood_home \"projection\"","        *set mechanic_decor \"tool\"","        *set past_susceptibility \"Forward\"","        *set past_susceptibility_text \"It's better to push forward. Don't look back on the past when you have new places to be and things to achieve.\" ","        *set candle_status \"kept\"","        *set leave_opinion \"uncertain\"","        *set book_willingness \"combative\"","        *set flower_choice \"forget-me-nots\" ","        *set friendship_necklace_style \"puzzle pieces\"","        *set friendship_necklace_j \"disinterested\"","        ","        *set sincerity -12","        *set friendly -17","        *set merciful -7","        *set heart +5 ","        *set cooperative +15","        *set believer +3","        *set optimistic -7","        *set reckless -17","        *set flirtatious -5","        *set resistance -10","        *set receptive -16","        ","        *set extrasensory_awareness +15","        *set primary_skill \"extrasensory awareness\"","        *set primary_ea \"true\"","        *set primary_ei \"false\"","        *set primary_rc \"false\"","        ","        *set baby_bambi \"dead\"","        *set deer_guilt \"neutral\"","        *set deer_visitor \"doe\"","        *set milton_injury \"severe\"","        *set r_arm_injury \"three\"","        *set mc_scar_1 \"none\"","        *set mc_scar_2 \"puncture wound\"","        *set sprig_death \"flare\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set milton_knowledge \"wait\"","        *set msv_loyalty_1 \"loyal\"","        *set ms_v_hardened +2","        ","        ","        *set alex_past \"neutral\"","        *set msv_relationship +1","        *set grandfather_relationship +5","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"fluffy\" ","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro  ","    #Razi Clifton: Sincere and merciful, neutral willpower. $!{alex}'s childhood adoration turned into a crush. Slightly negative opinion of their grandfather. Passed tree creature fight. Empathetic impressions.","        *set name \"razi\"","        *set surname \"clifton\"","        *set pc_nickname false","        *set grandfather_name \"geralt\"","        *set grandfather_nickname \"grandpa\"","        *set pc_eye_color \"dark green\"","        *set pc_hair_color \"dark brown\"","        *set pc_natural_hair_color \"dark brown\"","        *set pc_hair_dyed \"false\"","        *set pc_hair_style \"medium length\"","        *set pc_height \"tall\"","        *set baby_deer_road \"stop\" ","        *set room_theme \"cat's cradle\"","        *set rt1 \"cat's\"","        *set rt2 \"cradle\"","        *set attire \"business formal\"","        *set top \"A collared shirt with a blazer and\" ","        *set bottom \"formal pants\" ","        *set marj_meet_1 \"kind\"","        *set past_affinity \"baking\"","        *set past_comp \"bake off\"","        *set past_affinity_specific \"rustic\"","        *set past_affinity_text \"Respecting tradition is why you enjoy using old recipes you have unearthed. The flavors tend to be simple, homey, and classic.\"   ","        *set jour_feel_1 \"believe\"","        *set diner_meal \"pancakes\"","        *set drink_choice \"tea\"","        *set destination_info1 \"library\"","        *set emotion_mare_1 \"sad\"","        *set mare3_touch \"resist\" ","        *set childhood_home \"always\"","        *set mechanic_decor \"mirror\"","        *set past_susceptibility \"Buried\"","        *set past_susceptibility_text \"It's best to keep the past locked away and buried down deep. You won't let it drag you down again.\"","        *set candle_status \"kept\"","        *set leave_opinion \"favorable\"","        *set book_willingness \"curious\"","        *set flower_choice \"both\" ","        *set friendship_necklace_j \"worn\"","        *set friendship_necklace_style \"lock and key\"","        ","        *set sincerity +17","        *set friendly -5","        *set merciful +12","        *set heart -17","        *set cooperative -15","        *set believer +12","        *set optimistic -7","        *set reckless -12","        *set flirtatious -7","        *set resistance +5","        *set receptive -12","        *set combat -5","        ","        *set empathetic_impressions +15","        *set primary_skill \"empathetic impressions\"","        *set primary_ei \"true\"","        *set primary_rc \"false\"","        *set primary_ea \"false\"","        ","        *set baby_bambi \"alive\"","        *set deer_guilt \"cared\"","        *set deer_visitor \"fawn and doe\"","        *set milton_injury \"minimal\"","        *set r_arm_injury \"one\"","        *set mc_scar_1 \"ankle cuts\"","        *set mc_scar_2 \"none\"","        *set mc_kill_sprig \"killed\"","        *set sprig_kill_method \"quick\"","        *set sprig_death \"mercy kill\"","        *set milton_knowledge \"wait\"","        *set msv_loyalty_1 \"questioning\"","        *set ms_v_hardened -1","        ","        *set alex_past \"idolized\"","        *set alex_crush \"true\"","        *set reject_alex_mc +1","        *set msv_relationship +5","        *set grandfather_relationship -5","        ","        *set dog_ownership \"mc pet\"","        *set canine_trust +5","        *set dog_name \"ciri\"","        *set a_meet \"true\"","        *set msv_meet \"true\"","        *set dog_meet \"true\"","        *set physical_attribute \"true\"","        *goto premade_tentative_ro","*page_break ","","*label premade_tentative_ro","","Please select the character(s) you would like to pursue a romance with in Book Two.","","This is not a permanent, romance lock-in choice. It simply gives me an idea of who your character likely spent time with in Book One and might be more inclined to eventually romance. ","","There will be a warning when you set your romantic path for the rest of the series.","","*choice","    *selectable_if (beckett_romanceable = \"true\") #$!{beckett}","        *set townline_pick \"beckett\"","        *set tentative_ro_pick \"beckett\"","        *set beckett_friendship +14","    *selectable_if (silas_romanceable = \"true\") #$!{silas}","        *set townline_pick \"silas\"","        *set tentative_ro_pick \"silas\"","        *set silas_friendship +12","        *set mrs_dorran_s_pic \"unaware\"","    *selectable_if (reese_romanceable = \"true\") #$!{reese}","        *set townline_pick \"reese\"","        *set reese_friendship +15","        *set tentative_ro_pick \"reese\"","        *set r_prank_1 \"none\"","    *selectable_if (james_romanceable = \"true\") #$!{james}","        *set townline_pick \"james\"","        *set james_friendship +14","        *set tentative_ro_pick \"james\"","    *selectable_if ((james_romanceable = \"true\") and (reese_romanceable = \"true\")) #$!{james} and $!{reese} (Poly route) ","        *set townline_pick \"jr\"","        *set reese_friendship +15","        *set james_friendship +14","        *set tentative_ro_pick \"jr\"","        *set r_prank_1 \"none\"","*page_break","","Please select if your character displayed any interest in the ${waiter} beyond friendship.","","*fake_choice ","    #Yes, ${pc_he} did and even shared a quick kiss with the ${waiter}.","        *set mare3_extra_guest \"true\"","        *set w_number_hand \"true\"","        *set w_mal_nn true","        *set mal_kissed \"kissed\"","        *set waiter_flirt +5","        *set waiter_friendship +3","        *set w_meet \"true\"","    #Yes, ${pc_he} did and shared a moment with the ${waiter} on the porch.","        *set mare3_extra_guest \"true\"","        *set w_number_hand \"true\"","        *set w_mal_nn true","        *set waiter_flirt +4","        *set waiter_friendship +3","        *set w_meet \"true\"","    #No, ${pc_he} did not, but they were very friendly with each other and spoke some.","        *set w_mal_nn true","        *set waiter_friendship +3","        *set w_meet \"true\"","    #No, ${pc_he} did not. They were relatively friendly with each other.","        *set w_2nd_letter \"true\"","        *set w_mal_nn false","        *set waiter_friendship +2","        *set w_meet \"true\"","    #No, ${pc_he} did not. The ${waiter} was just the ${waiter} and nothing more.","        *set guess_attempt \"fail\"","        *set waiter_friendship +1","        *set w_meet_official \"true\"","        *set w_mal_nn false","        *set w_meet \"true\"","    #No, ${pc_he} would not want to. They didn't really get along with each other.","        *set w_meet_official \"true\"","        *set w_mal_nn false","        *set waiter_friendship -2","        *set w_meet \"true\"","*page_break ","","Please select if your character had a past, teenage crush or not.","","*fake_choice","    *selectable_if (silas_romanceable = \"true\") #$!{pc_he} had a crush on $!{silas}, but never acted on it\u2026","        *set past_crush \"silas\" ","    *selectable_if (reese_romanceable = \"true\") #$!{pc_he} had a crush on $!{reese}. Not that ${pc_he} would ever admit that to anyone.","         *set past_crush \"reese\"","    *selectable_if (james_romanceable = \"true\") #$!{pc_he} had a crush on $!{james}, but never acted on it\u2026","         *set past_crush \"james\"","    *selectable_if (james_romanceable = \"true\") #$!{pc_he} had a crush on $!{james}. $!{j_she} was $!{name}'s first kiss, but the two of them never took it further.","         *set past_crush \"james\"","         *set first_kiss \"james\" ","    *selectable_if ((james_romanceable = \"true\") and (reese_romanceable = \"true\")) #$!{pc_he} had crushes on $!{reese} and $!{james}, but never acted on them\u2026","        *set past_crush \"jr\"","    #$!{pc_he} never had a past crush on anyone in Fernweh.","        *set past_crush \"none\"","*page_break","","Please select your character's best friend. ","","*if (tentative_ro_pick = \"beckett\")","    *goto premade_set_r_b_ro_rxn","*elseif (tentative_ro_pick = \"silas\")","    *goto premade_set_r_s_ro_rxn","*elseif (tentative_ro_pick = \"reese\")","    *goto premade_set_r_r_ro_rxn","*elseif (tentative_ro_pick = \"james\")","    *goto premade_set_r_j_ro_rxn","*elseif (tentative_ro_pick = \"jr\")","    *goto premade_r_jr_ro_rxn","","*label  premade_set_r_b_ro_rxn","    ","*choice ","    #$!{silas}","        *set silas_friendship +12","        *set selected_best_friend \"silas\" ","        Did your character have a second closest friend\u2026?","        *choice","            #$!{reese}","                *set reese_friendship +9","                *set james_friendship +5","                *goto premade_summary_page","            #$!{james}","                *set reese_friendship +5","                *set james_friendship +9","                *goto premade_summary_page","    #$!{reese}","        *set reese_friendship +15","        *set selected_best_friend \"reese\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set james_friendship +5","                *goto premade_summary_page","            #$!{james}","                *set silas_friendship +4","                *set james_friendship +9","                *goto premade_summary_page","    #$!{james}","        *set james_friendship +14","        *set selected_best_friend \"james\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set reese_friendship +5","                *goto premade_summary_page","            #$!{reese}","                *set reese_friendship +9","                *set silas_friendship +4","                *goto premade_summary_page","*page_break","","*label premade_set_r_s_ro_rxn","","*choice ","    #$!{beckett}","        *set beckett_friendship +14","        *set selected_best_friend \"beckett\" ","        Did your character have a second closest friend\u2026?","        *choice","            #$!{reese}","                *set reese_friendship +9","                *set james_friendship +5","                *goto premade_summary_page","            #$!{james}","                *set reese_friendship +5","                *set james_friendship +9","                *goto premade_summary_page","    #$!{reese}","        *set reese_friendship +15","        *set selected_best_friend \"reese\"","        Did your character  have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set james_friendship +5","                *goto premade_summary_page","            #$!{james}","                *set beckett_friendship +5","                *set james_friendship +9","                *goto premade_summary_page","    #$!{james}","        *set james_friendship +14","        *set selected_best_friend \"james\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set reese_friendship +5","                *goto premade_summary_page","            #$!{reese}","                *set reese_friendship +9","                *set beckett_friendship +5","                *goto premade_summary_page","*page_break","","*label premade_set_r_r_ro_rxn","","*choice ","    #$!{beckett}","        *set beckett_friendship +14","        *set selected_best_friend \"beckett\" ","        Did your character have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set james_friendship +5","                *goto premade_summary_page","            #$!{james}","                *set silas_friendship +4","                *set james_friendship +9","                *goto premade_summary_page","    #$!{silas}","        *set silas_friendship +12","        *set selected_best_friend \"silas\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set james_friendship +5","                *goto premade_summary_page","            #$!{james}","                *set beckett_friendship +5","                *set james_friendship +9","                *goto premade_summary_page","    #$!{james}","        *set james_friendship +14","        *set selected_best_friend \"james\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set silas_friendship +4","                *goto premade_summary_page","            #$!{silas}","                *set silas_friendship +7","                *set beckett_friendship +5","                *goto premade_summary_page","*page_break","","*label premade_set_r_j_ro_rxn","","*choice ","    #$!{beckett}","        *set beckett_friendship +14","        *set selected_best_friend \"beckett\" ","        Did your character have a second closest friend\u2026?","        *choice","            #$!{silas}","                *set silas_friendship +7","                *set reese_friendship +5","                *goto premade_summary_page","            #$!{reese}","                *set reese_friendship +9","                *set silas_friendship +4","                *goto premade_summary_page","    #$!{silas}","        *set silas_friendship +12","        *set selected_best_friend \"silas\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set reese_friendship +5","                *goto premade_summary_page","            #$!{reese}","                *set beckett_friendship +5","                *set reese_friendship +9","                *goto premade_summary_page","    #$!{reese}","        *set reese_friendship +15","        *set selected_best_friend \"reese\"","        Did your character have a second closest friend\u2026?","        *choice","            #$!{beckett}","                *set beckett_friendship +8","                *set silas_friendship +4","                *goto premade_summary_page","            #$!{silas}","                *set silas_friendship +7","                *set beckett_friendship +5","                *goto premade_summary_page","*page_break","","*label premade_r_jr_ro_rxn","","*choice ","    #${beckett}","        *set beckett_friendship +14","        *set silas_friendship +7","        *set selected_best_friend \"beckett\" ","        *goto premade_summary_page","    #$!{silas}","        *set silas_friendship +12","        *set beckett_friendship +8","        *set selected_best_friend \"silas\"","        *goto premade_summary_page","*page_break","","*label premade_summary_page","","In the end, well, you should know how this ended\u2026","","You were stuck in Fernweh.","","It's\u2026 [i][b]exactly where you belong, $!{name}. It always has been.[/b][/i]","*page_break [i][b]Another round awaits us\u2026[/b][/i] Begin Book Two Alpha Content!","*goto tfs2_alpha_finish","","*label tfs2_alpha_finish","*finish "], "labels":{"tfs2_alpha_welcome":8,"tfs2_alpha_password_prompt":35,"tfs2_alpha_password_check":56,"tfs2_alpha_password_start":77,"tfs2_alpha_character_menu":102,"tfs2_alpha_recap":120,"tfs2_alpha_cc":169,"quick_cc_set_mal":333,"quick_character_choices_2":355,"quick_character_firstname":359,"name_check_thing":424,"name_change_pos":470,"quick_character_choices_3":479,"quick_character_surname":494,"quick_character_choices_4":543,"quick_natural_color_1":606,"quick_natural_color_1_mnb":615,"quick_natural_color_1_fem":684,"q_nat_col_conf1_mnb":753,"q_nat_col_conf1_fem":764,"quick_nat_col_reent":775,"quick_dyed_color":784,"quick_dye_col_conf":855,"quick_dye_col_reent":866,"quick_natural_color_2":875,"quick_natural_color_2_mnb":884,"quick_natural_color_2_fem":938,"q_nat_col_conf2_mnb":992,"q_nat_col_conf2_fem":1003,"quick_hair_style":1014,"quick_character_choices_5":1081,"quick_character_choices_6":1151,"quick_personality_choices_1":1360,"mal_interest_name_choices":1457,"mal_interest_name_choices1":1472,"mal_not_interested_con":1498,"quick_character_choices_j":1539,"quick_character_choices_jset":1570,"quick_character_choices_jpick":1634,"quick_character_choices_7":1690,"quick_character_choices_8":1739,"set_acrushb_i_reactions":1799,"set_acrushb_reactions":1815,"quick_character_choices_9":1829,"q_tailored_affinity_writing":1900,"q_tailored_affinity_science":1921,"q_tailored_affinity_bake":1942,"q_tailored_affinity_art":1963,"q_tailored_affinity_music":1980,"q_past_affinity_common":2006,"fr_bend_jneck_burn":2035,"fr_bend_jneck_trash":2046,"fr_bend_jneck_mem":2055,"fr_bend_jneck_dis":2066,"fr_bend_jneck_wear":2077,"fr_bend_jneck_nop":2088,"fr_bend_jneck_cho":2100,"fr_bend_jneck_done":2116,"ask_about_judith":2187,"continue_with_alpha_cc":2203,"alive_bambi_feels":2322,"dead_bambi_feels":2345,"quick_character_choices_10":2367,"quick_character_choices_10ish":2387,"backup_puncture_choice":2399,"quick_vine_trials_choice":2409,"quick_character_choices_11":2430,"quick_mal_porch_choice":2588,"character_choices_13":2604,"r_denial_overlay_setting":2676,"quick_bff_choice_list":2686,"quick_set_r_b_ro_rxn":2703,"quick_set_r_s_ro_rxn":2747,"quick_bff_choice_r":2791,"quick_bff_choice_j":2835,"quick_bff_choice_jr":2879,"quick_character_choices_15":2894,"set_s_nickname_usage":2901,"quick_character_choices_15ish":2922,"quick_ro_define_moment":2950,"tfs2_alpha_pre":3043,"premade_cc_set_mal":3199,"premade_character_choices_2":3221,"premade_gender_setting_s":3260,"premade_gender_setting_r":3295,"premade_gender_setting_j":3336,"premade_gender_setting_jpick":3367,"premade_gender_setting_a":3408,"premade_character_options":3454,"premade_female_options":3463,"premade_male_options":3896,"premade_nonbinary_options":4329,"premade_tentative_ro":4762,"premade_set_r_b_ro_rxn":4868,"premade_set_r_s_ro_rxn":4912,"premade_set_r_r_ro_rxn":4956,"premade_set_r_j_ro_rxn":5000,"premade_r_jr_ro_rxn":5044,"premade_summary_page":5059,"tfs2_alpha_finish":5069}},
"intro": {"crc":599341895, "lines":["*temp paper_action \" \"","*temp dagger_seen \"false\"","*comment alphaintro","[b][i]PRELUDE[/i][/b]","*line_break","","[b]???\u2026[/b]","*line_break","- - -","","[b][i]A welcome back is unnecessary when you have gone absolutely nowhere, not a single, contrary step out of line\u2026 Or over the line, for that matter. Trying is a fruitless endeavor as with all of your supposed choices. The ending is set.[/i][/b]","","[b][i]Every game has a final victor; it isn't you, $!{name} $!{surname}.[/i][/b]","","[b][i]That feeling of absence was only an illusion\u2014a delusion\u2014that you tried to comfort yourself with. Waiting isn't something you have truly suffered through, but it matters little now. You will fulfill your role, acting within the familiar bounds and confines that feel like home once again.[/i][/b]","","[b][i]Welcome to another round\u2026[/i][/b]","*page_break [b][i]Let's play.[/i][/b]","*set pc_role \"Returning Visitor\u2026?\" ","*set inventory_slot_1_text \"car keys\"","*set inventory_slot_2_text \"cell phone\"","*set inventory_slot_3_text \"grandfather's keys\"","*set inventory_slot_4_text \"walkie talkie\"","*set inventory_slot_1 \"car keys\"","*set inventory_slot_2 \"cell phone\" ","*set inventory_slot_3 \"grandfather's keys\"","*set inventory_slot_4 \"walkie talkie\"","[b][i]INTRODUCTION[/i][/b]","*line_break","","[b]Outside of the Fernweh Diner\u2026[/b]","*line_break","- - -","","[i]Clack. Clack. Clack.[/i]","","The distinctive sound of metal sharply colliding with glass disrupts your thoughts. Cobbled together antique spoons have found a new use as a noisy windchime that heralds the arrival of customers into the restaurant who will soon be clinking and clanking with their own cutlery. It still reminds you of someone with bony knuckles hungrily beating against the door\u2026","","You don't get the chance to fully unhook your fingers from the door handle as it swings shut.","","The jarring noise is sealed inside, locked away until another citizen has a craving for Belgian waffles, scalding coffee, or specialty fruit syrups. A to-go cup of ${drink_choice} doesn't occupy your hand, so why are you loitering around outside\u2026? ","","As if in answer to your question, a heavy drop of rain lands with a solid [i]plunk[/i] you can feel, like the tiny, individual droplets conspired together to create a splash. It seeps into your scalp, causing your shoulders to rise up reflexively at the ticklish sensation. Residual rainwater has collected on wet cloth awnings and roofs.","","The unseasonable heat ensnaring Fernweh finally met its match.","","The sudden downpour helped cool things off; you taking shelter in the diner during it made sense.","*page_break","","*if (waiter_flirt >= 4)","    The empty street is becoming less desolate as sunrays slice through the leftover cloud cover to create defined regions of shade and light.","","    Only now do you completely lower your hand back to your side, curling up your fingers that were still slightly bent from resting on the door. No farewell or goodbye accompanied the din of the windchime, which could be another reason why you lingered with the door cracked open. $!{w_she} almost always addresses you, purposefully seeking out your table.","","    The steadily brightening sunlight works to your disadvantage. Squinting doesn't help anything because the angle causes the light to glint off of the large, picture windows in a way that obscures the interior of the restaurant. You won't be able to catch a glimpse of a particular server among the red aprons that typically flit about, so there is no point continuing to peer inside.","    *page_break","    *goto scene01_dream1_street","","*else","    The empty street is becoming less desolate as sunrays slice through the leftover cloud cover to create defined regions of shade and light.","    *goto scene01_dream1_street","","*label scene01_dream1_street","","It's odd not to see anyone else milling about, but they could be waiting for it to dry out more.","","You begin the short walk to your parked car.","","An earthy scent seems to rise up from the ground, seeping out of the freshly watered grass and drenched potted plants. There's a sweet tinge to it like decay rather than something obviously floral. Trees and manicured shrubs dot the sidewalks to break up the concrete since the Board values curb appeal. You avoid the slightly muddier puddles created by the rain loosening up packed soil, but soon your deliberate steps come to a stop.","","There is a newspaper on your car's windshield.","","It's the one with the article about your grandfather\u2026","*page_break","","Your eyes leave the specific issue of the Fernweh Gazette to scan the immediate surroundings for the culprit of this sick joke.","","No one steps forward or peeks out from behind a corner to watch you react to something that should be old news. This story full of lies circulated a few weeks ago. You mash the button on your car key fob with more force than needed, ignoring how the answering electronic chirp echoes along the deserted street. The soggy paper mocks you as you yank open the driver's side door; its main headline is slightly blurred.","","The editor felt the need to use a bold, heavy font that now seems to drip black ink similar to blood weeping from a cut. It's begrudgingly eye-catching; everyone in town saw this piece.","","'[b]The Terror that Sank Its Teeth Into Fernweh Declawed![/b]'","","Why would someone do this to you?","","*choice","    #Quell your irritation and remain level-headed.","        *set heart -2","        *goto scene01_dream1_jokehead","    #Issue a challenge. \"Hey, ass-hat, come out!\"","        *set combat +2","        *goto scene01_dream1_jokecomb","    #Mask the upset you feel. They shouldn't get the satisfaction of hurting your feelings.","        *set heart +2","        *goto scene01_dream1_jokeheart","    #Calmly address them. \"This is disrespectful.\"","        *set combat -2","        *goto scene01_dream1_jokedipl","    #Just ignore them and continue leaving.","        *goto scene01_dream1_jokeneu","*page_break","","*label scene01_dream1_jokehead","","You take a slow, centering breath.","","The humidity coalescing in the air following the rain shower makes it linger in your lungs even after you release a measured exhale. The irritation starts to subside, but it doesn't entirely fade away because a reminder about what befell your grandfather isn't needed. You also don't need to re-read the cover story.","","It would be a waste of energy to get worked up over a stupid joke; the prankster isn't worth it.","","Logically, the lack of a reaction should bother them more since they took the time to plant this during a storm to get a rise out of you.","*page_break","*goto scene01_dream1_paper","","*label scene01_dream1_jokecomb","","You don't scan or scrutinize the surroundings, but assess them for potential hiding spots since this prankster is a coward. If they want to mess with you, they should have the courage to do it to your face rather than use a family member's death as ammunition. There isn't any movement in the bushes closest to you, while the corners and tree trunks also remain empty.","","\"Hey, ass-hat, come out!\" Your shout fails to provoke any reaction as it faintly echoes along the shop fronts, losing its combative edge within seconds. You resist the urge to hurl a piece of loose gravel at a cluster of trash cans to try and force the sicko out. Waiting around becomes more annoying as the sticky humidity sets in that is worsened by your flush of anger.","","\"Try this again and see what happens.\"","","With that last warning, you stop holding your ground in a one-sided stand off to finally leave.","*page_break","*goto scene01_dream1_paper","","*label scene01_dream1_jokeheart","","You already have a pristine copy of this paper.","","It's tucked away and usually kept out of sight, but you could not bring yourself to completely forget about how the town views yet another $!{surname} family death. It felt wrong to toss aside the article about your grandfather's death like it was a stale, finished story. The tone of the article is one of triumph and finality.","","It doesn't feel completely resolved\u2026","","Masking your upset isn't easy when this is such a targeted action that required someone to save the article. You take a steadying breath before continuing to leave, trying not to think about how the damp, earthy scent leftover from the rain shower is familiar from when you were searching the deep woods. Your feelings should never be a source of entertainment.","*page_break","*goto scene01_dream1_paper","","*label scene01_dream1_jokedipl","","This is wrong\u2026","","You know that and so would most citizens of Fernweh, so you redirect the bitter annoyance you feel into something constructive. The car door handle releases a dull click when you loosen up your grip on the rain slicked metal, no longer squeezing it tightly. Whoever chose to do this is the one with the problem, not you.","","\"This joke is extremely disrespectful.\"","","No one pops out from behind a cluster of trash cans or rounds the corner of a building to counter your point, but they could be listening. Someone had to make the effort to save the article related to your grandfather and time when you would leave your car; obviously, there was some advanced planning involved\u2026 You withhold a sigh to appear mostly receptive.","","\"If this happens again, I won't be talking to you about it, but to $!{james} or someone else at the station.\"","","All things considered, a calm warning is fair.","","You wait a little longer for them to come out of their hiding spot before deciding to leave.","*page_break","*goto scene01_dream1_paper","","*label scene01_dream1_jokeneu","","It's tempting to assess the surroundings again.","","Ignoring whoever felt the need to devise a plan that involved a weeks old newspaper, your car, and a hiding spot is for the best. They don't deserve any reaction. The sticky humidity forming after the rain is mildly uncomfortable to be out in, so let them squat in it, waiting for you to be upset or angry over a stale story.","","It's actually a little pathetic, but also creepy\u2026","","You don't want to linger out here on the street.","*page_break","*goto scene01_dream1_paper","","*label scene01_dream1_paper","","Thin trails of grayish black liquid trickle from the damp paper, creating streaks along the windshield as drops of rain filter through the printed words and steal away their dark ink. The 'Fernweh Terror' article earned a massive front page spread with a rare, full color photo. It made the town newspaper relevant again\u2026","","You briefly study the image that isn't quite as waterlogged as the rest of the article.","","*if (destination_info1 = \"library\")","    The white stone facade and symmetrical lines of the Fernweh Historical Library photographed nicely, providing a beautiful backdrop to something horrible. Red ink has turned slightly pink from the water, but it's clear that some blood wets the wide, marble steps you remember nimbly hopping up as a child. Drops leak from the slain black bear that fills the arms of a group of hunters. It took four burly men to partially lift up the bear, who didn't lay a single claw or tooth on your grandfather.","","    Chief Bowers stands off to the side, appearing unreadable as she disregards the photo op.","","    Your eyes are drawn to Mrs. Grendal even though she isn't front and center in the picture. She was caught mid-sentence, gesturing a hand at the blood that could be staining the grout of the steps. Her expression is outraged, and you know that a lecture had to follow.","","    The caption reads: '[i]One for the record books! A bearable end to a grisly threat.[/i]'","    *page_break","    *goto scene01_dream1_paperdeet","","*elseif (destination_info1 = \"lodge\")","    The stacked logs of the Old Hunting Lodge help it blend into the surrounding forest, allowing it to act as an understated backdrop to something horrible. Brown and green tones shift into a mass of black that is supported by four burly men. It's hard to see the hunters who are lifting up the slain animal that never touched your grandfather. The bear's fur has a distinctly spiked and clumped look to it from the blood saturating its pelt. It is on display\u2026","","    Chief Bowers stands off to the side, appearing unreadable as she disregards the photo op.","","    Your eyes seek out Jeremiah. He stands on the porch of the lodge, arms crossed with a displeased look on his face at what is happening in front of the building's steps. It's unlikely the hunters were allowed in for drinks or snacks once the photograph was finished.","","    The caption reads: '[i]By tooth and claw, local hunters snapped this bear's maw![/i]'","    *page_break","    *goto scene01_dream1_paperdeet","","*label scene01_dream1_paperdeet","","*if (milton_injury = \"severe\")","    Fernweh's strict hunting seasons and tag system were set aside when the news spread of Milton Callaway's severe injuries. It was hard to contain that information, which must have been why the station issued an advisory about a wild animal threat in the area before enlisting hunters to be on the lookout for it. You knew the real 'terror' had been reduced to ash, but the townsfolk needed an easy culprit.","","    \u2026It was only a convenient lie.","","    You and the others used it too when carrying a steadily bleeding out Milton through the forest.","","    Just like your grandfather, he wasn't the victim of a freak animal attack, but something far more unnatural and sinister. That story would only sell horror novels, not news. The citizens have gone back to the normalcy of their daily routines after the momentary thrill of what happened; it changed everything for you\u2026","    *page_break","    *goto scene01_dream1_paperact","","*else ","    This article only represents a convenient lie.","","    The real 'terror' in the woods was reduced to ash days before the station issued an advisory about a potential wildlife threat. The missing kid, Milton Callaway, returned home alive, but he wasn't entirely unscathed. You and the others carried him out of the woods.","","    It didn't surprise you when the warning was called off when they found a suitable, furry culprit.","","    Just like your grandfather, Milton wasn't the victim of a freak animal attack, but something far more unnatural and sinister. That story would only sell horror novels, not news. The citizens have gone back to the normalcy of their daily routines after the momentary thrill of what happened; it changed everything for you\u2026","    *page_break","    *goto scene01_dream1_paperact","","*label scene01_dream1_paperact","","Driving with a newspaper blocking part of your windshield could earn a ticket, but more importantly, you don't want it stuck on the car.","","*choice","    #Tear the paper in half. It's all lies.","        *set paper_action \"tear\"","        *goto scene01_dream1_paperact1","    #Simply discard the paper by tossing it aside.","        *set paper_action \"discard\"","        *goto scene01_dream1_paperact2","    #Fold the paper to obscure the picture and take it to throw away later.","        *set paper_action \"take\"","        *goto scene01_dream1_paperact3","*page_break","","*label scene01_dream1_paperact1","","You snatch up the damp newspaper with some measure of irritation before tearing it in half.","","It's not very satisfying.","","There is no sharp ripping noise as the fibers of paper break easily beneath your fingers; instead, they seem to retaliate by excreting grayish black liquid. Inky trails are left on your palms. It's as if the printed sentences are shifting from horizontal to vertical in an attempt to stubbornly adhere to your skin. Ink mixed with water should be wet and viscous.","","Why is it sticky\u2026?","","You instantly drop the paper to the sidewalk rather than finish the job of tearing it down the middle. The lines of your palm have new, dark outlines to them that cause you to lock your jaw when it reminds you of black, burbling sap oozing and recoloring a wooden carapace. It's just printer ink and rainwater, but it suddenly feels all wrong when you run a thumb over it to create a sluggish path that reveals your skin.","*page_break","","Maybe the starch from the paper caused the mixture to thicken or the Fernweh Gazette uses cheap ink. It doesn't matter! You settle heavily in your seat, searching for anything in the cup holders or around the dashboard to get clean. Only the tips of your fingers are spared.","","A travel pack of tissues $!{beckett} no doubt packed along with a mini first aid kit and hand sanitizer helps you calm down a little. $!{b_she} really does think of everything. You breathe a little easier after using half the pack of tissues and a quarter of the antibacterial gel. Your palms are back to normal without any traces of ebony stains; they aren't even sticky or tacky when you rub your hands together.","","\"Stupid paper,\" you mutter the complaint. Glancing out the window rewards you with a view of the newspaper gradually recoloring the gray sidewalk. It's tainting everything else. You take stock of what you touched in your search for a wipe, noticing something in particular.","","The Polaroid group photo Mrs. Dorran took.","*page_break","*goto scene01_dream1_polo","","*label scene01_dream1_paperact2","","You reach for the newspaper before it has a chance to excrete another watery, grayish black trail of ink on your windshield. Grabbing the corner of the paper keeps your fingers clean, though the way you eagerly fling it aside forces a few water droplets to wet your arm as it arcs to land in a tent-like heap on the sidewalk.","","\u2026It's technically not littering if it's paper, right?","","Discarding plastic would be way worse, and someone should not have put it on your car in the first place. It's their fault. You settle in your seat, pulling away from the curb after casting one last, searching look around the street.","*page_break","","Your attention is split.","","Fortunately, the townsfolk have yet to take advantage of the break in the rainy weather, so the road that stretches ahead is free of any other cars or roaming pedestrians. Your eyes deviate from the center line when an annoying ticklish sensation skates up your arm again. A few droplets of grayish liquid dot your skin with what appears to be tiny, suspended pigments of ebony ink within each off-colored bead\u2026","","There is something unsettling about this; it reminds you of black, burbling sap leaking out to recolor a wooden carapace. Why is it sticky? Shaking out your hand to air dry them failed.","","The droplets stubbornly cling on, multiplied and broken, but still wet. Maybe it's something to do with the cheap ink the Fernweh gazette uses or because the paper sat out? You check the road again before searching for anything to help; $!{beckett} had to pack something useful.","","A package of tissues and tropical gummy bears come free from the passenger side compartment. At least the tissues will work, so you pull over. Distractedly dabbing away the liquid turns into scrubbing at your arm with a wad of tissue to ensure no inky residue is left behind.","*page_break","","You detect movement from the corner of your eye right before something covers half of the windshield. It dims the weak sunlight pouring into the car. The newspaper latches onto the sheet of glass even as wind continues to ruffle its other pages. You can't hear the sound of it fluttering, but watch the shadows it casts.","","It feels like the black bear is making steady eye contact with you despite its lolling head\u2026","","Your fingers find the button for the windshield wiper blades before your mind fully gives them the instruction to do so. More water saturates the article, warping the memorialized kill into a black blob that is soon scraped away. The wipers keep going back and forth on repeat until a harsh squeaking noise signals that it's time for you to cut them off. Now, the paper is in tatters off to the side, cut apart and damp so it's closer to paper pulp than a processed item.","","Well, that's one way to recycle\u2026","","You take stock of what you found during your search for a wipe or cloth, noticing something in particular.","","The Polaroid group photo Mrs. Dorran took.","*page_break","*goto scene01_dream1_polo","","*label scene01_dream1_paperact3","","You use the tip of your index finger to drag the newspaper closer. It works at first, but the damp paper begins to stick to the windshield, leaving grayish black streaks behind on the glass that will have to be cleaned later. The picture of the memorialized kill now appears warped as if the black bear was beaten to death; it's an elongated mass of weeping black.","","This isn't going anywhere\u2026","","Averting your eyes from the photo makes you feel a little better when you pick up the article and fold it in half. The Fernweh Gazette should be ashamed. Compressing the wet pages causes the rainwater gathered in them to seep out onto your palms; the cool liquid is surprisingly sticky rather than viscous or wet.","","You quickly toss the paper into the floorboard in the back seat so it can be trashed later on before climbing into the driver's seat.","*page_break","","A news outlet that would plaster a dead animal on its front page likely uses cheap or off-brand printing ink. You attempt to keep focused on that as you search for something to get the sticky substance off of your palms. It coats them, darkening the natural lines and fine creases with an unsettling ebony that reminds you of black, burbling sap leaking out of a wooden carapace to recolor it. Its eyes were\u2014","","\"Come on, $!{beckett},\" you mutter the comment to yourself with a hint of exasperation when another compartment comes up empty. How is it you found tropical flavored gummy bears, a spark plug, cartoon themed band-aids, and a yo-yo in your own car, but not a cloth? $!{b_she} had to pack something useful. It's not ${b_his} fault you're feeling uneasy about that night\u2026","","A rustling noise prompts you to glance over your shoulder, until a package of tissues falls from where you flipped down the passenger side visor.","","It must have been the tissues, not the paper.","","You eagerly snatch them up to clean your hands along with any other surface you touched. Now, there is no trace of the substance, though your eyes do settle on something in particular that was misplaced during the frantic search. The Polaroid group photo Mrs. Dorran took.","*page_break","*goto scene01_dream1_polo","","*label scene01_dream1_polo","","Mrs. Dorran had a creative vision for this photograph. She positioned you all according to the image she had conjured up in her mind's eye, politely and patiently offering instructions. The wraparound front porch of the B&B became a stage with its planter boxes full of fresh blooms and sculptures acting as props.","","*if (townline_pick = \"beckett\")","    *set tentative_ro_pick \"beckett\"","    *goto scene01_dream1_roline","*elseif (townline_pick = \"silas\")","    *set tentative_ro_pick \"silas\"","    *goto scene01_dream1_roline","*elseif (townline_pick = \"reese\")","    *set tentative_ro_pick \"reese\"","    *goto scene01_dream1_roline","*elseif (townline_pick = \"james\") ","    *set tentative_ro_pick \"james\"","    *goto scene01_dream1_roline","*elseif (townline_pick = \"jr\") ","    *set tentative_ro_pick \"jr\"","    *goto scene01_dream1_roline","*else","    *goto scene01_dream1_roline","","*label scene01_dream1_roline","","*if (tentative_ro_pick = \"beckett\")","    You had shuffled around a few times, but always found yourself drawn to $!{beckett}.","    *page_break","    *goto scene01_dream1_importb","","*elseif (tentative_ro_pick = \"silas\")","    You had shuffled around a few times, but always found yourself drawn to $!{silas}.","    *page_break","    *goto scene01_dream1_imports","","*elseif (tentative_ro_pick = \"reese\")","    You had shuffled around a few times, but always found yourself drawn to $!{reese}.","    *page_break","    *goto scene01_dream1_importr","","*elseif (tentative_ro_pick = \"james\")","    You had shuffled around a few times, but always found yourself drawn to $!{james}.","    *page_break","    *goto scene01_dream1_importj","","*elseif (tentative_ro_pick = \"jr\")","    You had shuffled around a few times, but always found yourself drawn to $!{james} and $!{reese}.","    *page_break","    *goto scene01_dream1_importjr","","*label scene01_dream1_importb","*set polaroid_memory \"true\"","Staying close to $!{beckett} wasn't difficult. $!{b_she} would reflexively turn ${b_his} head to watch you pose along the railing or stand opposite a free form sculpture. Mrs. Dorran may have noticed that too because she started grouping your directions together by always addressing the two of you, not just you alone.","","In the final photo, $!{beckett} is right by your side, loosely looping an arm around you to lean closer due to Mrs. Dorran's reminder that a Polaroid camera doesn't allow for a wide angle. $!{b_his} faint blush didn't make it into the final image, but you remember it. It's $!{beckett}'s endearing, slightly self-conscious smile that causes your own lips to downturn the longer you admire this frozen moment of happiness.","","Things changed after this was taken.","","You seek out someone else before you start missing ${b_his} smile in earnest\u2026","","*if (selected_best_friend = \"silas\")","    $!{silas} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffs","","*elseif (selected_best_friend = \"reese\")","    $!{reese} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffr","","*elseif (selected_best_friend = \"james\")","    $!{james} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffj","","*elseif (selected_best_friend = \"none\")","    This person made an effort to be nearby you; your friendship strengthened during the visit.","    *goto scene01_dream1_importchob","","*label scene01_dream1_imports","*set polaroid_memory \"true\"","Lingering by $!{silas} didn't require you to do anything at all besides stand in the spot Mrs. Dorran said was yours. She indicated it once before gently urging her child to join the pose that allowed both of you to be framed by sage green shutters with a backdrop of stained glass. The statement piece window glowed in the sunny daylight, gleaming and bright as the light passed through each section of color.","","While the striking hues captured in the photo are gorgeous, you prefer to focus on $!{silas}.","","$!{s_she} stands just behind you, partially reclining on the lip of the window sill, but still appearing statuesque. There is an effortless serenity to ${s_him}, a calm that you feel even when looking at a weeks old photograph. Mrs. Dorran let you two serve as the focal point of the image, but even then she wanted multiple shots and moods. You later learned from $!{silas} that ${s_his} mother was prolonging things because she was going to miss you.","","Being 'missed' requires an absence or a departure\u2026","","You frown a little at that bitter thought before seeking out someone else in the picture.","","*if (selected_best_friend = \"beckett\")","    $!{beckett} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffb","","*elseif (selected_best_friend = \"reese\")","    $!{reese} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffr","","*elseif (selected_best_friend = \"james\")","    $!{james} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffj","","*elseif (selected_best_friend = \"none\")","    This person made an effort to be nearby you; your friendship strengthened during the visit.","    *goto scene01_dream1_importchos","","*label scene01_dream1_importr","*set polaroid_memory \"true\"","Hearing Mrs. Dorran's babysitter tone of voice reawakened old memories of when she would occasionally look after you for your parents. It isn't a harsh tone, but a gently chiding one that urges you to carefully reconsider your actions. She used it on $!{reese} a few times when attempting to capture a spectacular group photo since ${r_she} kept trying to change ${r_his} spot.","","The stairs leading up to the B&B's front porch is where you all were gathered to let the rails frame the shot that had good natural light.","","$!{reese} was determined to be one step above you, if not on equal footing. $!{r_she} would cast a quick look over ${r_his} shoulder at you before beginning to creep up higher while Mrs. Dorran was directing someone else. Mischief isn't what you remember feeling from ${r_his} commitment to move out of line, not when ${r_she} would always look to check that you were still there with an unexpected intensity. Eventually, you joined ${r_his} step to put an end to the stalemate about the best positions.","","In the final photo, $!{reese} isn't looking directly at the camera despite knowing how to take perfect pictures as a Verner. Instead, ${r_she} is frozen, watching you with a weak smile that seems lonely. You have studied ${r_his} expression before; now isn't the time to dwell on it\u2026","","You seek out someone else in the Polaroid.","","*if (selected_best_friend = \"beckett\")","    $!{beckett} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffb","","*elseif (selected_best_friend = \"silas\")","    $!{silas} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffs","","*elseif (selected_best_friend = \"james\")","    $!{james} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffj","","*elseif (selected_best_friend = \"none\")","    This person made an effort to be nearby you; your friendship strengthened during the visit.","    *goto scene01_dream1_importchor","","*label scene01_dream1_importj","*set polaroid_memory \"true\"","Keeping close to $!{james} was made difficult by how ${j_she} would linger off to the side by the railing or wait near the start of the stairs. $!{j_she} seemed uncomfortable, possibly self-conscious, about the group photo. It was hard to curb the need to glance over at ${j_him} when you were supposed to be facing the camera with a photo-ready expression\u2026","","Mrs. Dorran may have noticed your distracted behavior because she changed the entire shot.","","The framing symmetry of the stairs was replaced with everyone leaning on the porch rail, which gave you an opportunity to be near $!{james}. $!{j_she} instantly made space, offering you a tentative smile before just as quickly glancing back at your car. Your departure was stirring up past memories and tugging open old wounds, but you saw the way $!{james} gingerly tucked away ${j_his} copy of the photo, even if ${j_she} avoided looking at it.","","In the final image, $!{james} is frozen, staring into the distance with a quietly somber expression.","","You seek out someone else in the Polaroid.","","*if (selected_best_friend = \"beckett\")","    $!{beckett} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffb","","*elseif (selected_best_friend = \"silas\")","    $!{silas} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffs","","*elseif (selected_best_friend = \"reese\")","    $!{reese} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffr","","*elseif (selected_best_friend = \"none\")","    This person made an effort to be nearby you; your friendship strengthened during the visit.","    *goto scene01_dream1_importchoj","","*label scene01_dream1_importjr","*set polaroid_memory \"true\"","Positioning yourself relative to $!{james} and $!{reese} wasn't easy. One was cemented to the porch railing to look out over the cul-de-sac with a distant expression, while the other one wouldn't stand still or stay put in a single spot. The front door with its hand painted welcome sign was supposed to be the background, not the railing or the steps that they each preferred.","","Mrs. Dorran's directives for capturing the best group shot were only viewed as suggestions by $!{reese}, who inched higher on the steps to be above you or considered posing on the rail to distract $!{james}. It felt like ${r_she} was stalling\u2026 You know the depths of Mrs. Dorran's kind patience from when she used to babysit you years ago, but she did eventually intervene.","","'Time out' may be a touch strong\u2026","","\u2026$!{reese} was given a 'special' spot on the porch swing, while $!{james} volunteered to stand nearby to prevent any swinging or rocking attempts. You recall $!{reese}'s slightly indignant expression about needing supervision fading when you sat next to ${r_him}. The three of you were finally all settled; the somberness of the upcoming departure was briefly alleviated.","","You smile, faintly amused by the story behind the image before seeking out someone else.","","*if (selected_best_friend = \"beckett\")","    $!{beckett} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffb","","*elseif (selected_best_friend = \"silas\")","    $!{silas} made an effort to be nearby you; your friendship strengthened during the visit.","    *page_break","    *goto scene01_dream1_importbffs","","*elseif (selected_best_friend = \"none\")","    This person made an effort to be nearby you; your friendship strengthened during the visit.","    *goto scene01_dream1_importchojr","","*label scene01_dream1_importchob","","(Please note this is a [b]confirmation[/b] of your best friend.)","","*choice","    *if (tree_trunk_buddy = \"silas\") #[b]$!{silas}[/b]","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    *if (tree_trunk_buddy = \"reese\") #[b]$!{reese}[/b]","        *set selected_best_friend \"reese\"","        *goto scene01_dream1_importbffr","    *if (tree_trunk_buddy = \"james\") #[b]$!{james}[/b]","        *set selected_best_friend \"james\"","        *goto scene01_dream1_importbffj","    #\u2026$!{silas}","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    #\u2026$!{reese}","        *set selected_best_friend \"reese\"","        *goto scene01_dream1_importbffr","    #\u2026$!{james}","        *set selected_best_friend \"james\"","        *goto scene01_dream1_importbffj","*page_break","","*label scene01_dream1_importchos","","(Please note this is a [b]confirmation[/b] of your best friend.)","","*choice","    *if (tree_trunk_buddy = \"beckett\") #[b]$!{beckett}[/b]","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    *if (tree_trunk_buddy = \"reese\") #[b]$!{reese}[/b]","        *set selected_best_friend \"reese\"","        *goto scene01_dream1_importbffr","    *if (tree_trunk_buddy = \"james\") #[b]$!{james}[/b]","        *set selected_best_friend \"james\"","        *goto scene01_dream1_importbffj","    #\u2026$!{beckett}","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    #\u2026$!{reese}","        *set selected_best_friend \"reese\"","        *goto scene01_dream1_importbffr","    #\u2026$!{james}","        *set selected_best_friend \"james\"","        *goto scene01_dream1_importbffj","*page_break","","*label scene01_dream1_importchor","","(Please note this is a [b]confirmation[/b] of your best friend.)","","*choice","    *if (tree_trunk_buddy = \"beckett\") #[b]$!{beckett}[/b]","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    *if (tree_trunk_buddy = \"silas\") #[b]$!{silas}[/b]","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    *if (tree_trunk_buddy = \"james\") #[b]$!{james}[/b]","        *set selected_best_friend \"james\"","        *goto scene01_dream1_importbffj","    #\u2026$!{beckett}","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    #\u2026$!{silas}","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    #\u2026$!{james}","        *set selected_best_friend \"james\"","        *goto scene01_dream1_importbffj","*page_break","","*label scene01_dream1_importchoj","","(Please note this is a [b]confirmation[/b] of your best friend.)","","*choice","    *if (tree_trunk_buddy = \"beckett\") #[b]$!{beckett}[/b]","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    *if (tree_trunk_buddy = \"silas\") #[b]$!{silas}[/b]","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    *if (tree_trunk_buddy = \"reese\") #[b]$!{reese}[/b]","        *set selected_best_friend \"reese\"","        *goto scene01_dream1_importbffr","    #\u2026$!{beckett}","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    #\u2026$!{silas}","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    #\u2026$!{reese}","        *set selected_best_friend \"reese\"","        *goto scene01_dream1_importbffr","*page_break","","*label scene01_dream1_importchojr","","(Please note this is a [b]confirmation[/b] of your best friend.)","","*choice","    *if (tree_trunk_buddy = \"beckett\") #[b]$!{beckett}[/b]","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    *if (tree_trunk_buddy = \"silas\") #[b]$!{silas}[/b]","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","    #\u2026$!{beckett}","        *set selected_best_friend \"beckett\"","        *goto scene01_dream1_importbffb","    #\u2026$!{silas}","        *set selected_best_friend \"silas\"","        *goto scene01_dream1_importbffs","*page_break","","*label scene01_dream1_importbffb","","$!{beckett} eagerly assisted Mrs. Dorran in laying out the angles and positioning for a dynamic shot. $!{b_she} politely reminded her about the limited field of view most Polaroid cameras have along with giving her a few tips. It was fun to watch ${b_him} speak with such passion; you couldn't help but smile.","","$!{b_she} claimed a spot close to you in the picture, preferring to be near a familiar friend.","","Your and $!{beckett}'s friendship deepened during the visit, but it's different now\u2026 The soft smile on ${b_his} face that usually brightens when directed your way is rare these days. You use your thumb to mostly cover ${b_him} in the photograph, though the orange of ${b_his} hoodie peeking out pulls a low sigh from you.","*page_break","*goto scene01_dream1_polodone","","*label scene01_dream1_importbffs","","$!{silas} listened attentively to each of Mrs. Dorran's directives, even when they weren't about ${s_his} place in the shot. $!{s_she} was willing to accommodate without complaint. You recall ${s_him} sighing quietly at least a few times before catching your eye to offer a slight smile that implicitly requested some indulgence of ${s_his} mother's creativity.","","$!{s_she} asked you for a picture of the two of you together on the wicker porch swing.","","One good thing about the trip was getting to learn more about $!{silas} and grow closer.","*page_break","*goto scene01_dream1_polodone","","*label scene01_dream1_importbffr","","$!{reese} instantly called dibs on standing next to you as soon as Mrs. Dorran pulled out the camera. Your faint look of surprise only earned a mischievous smile from ${r_him} that was paired with a wink, but ${r_she} didn't try to take back the request or offer any explanation. No one was going to start a debate because you all knew who would have the last word\u2026","","After the group photo, ${r_she} asked your preference on wood stain color for a frame in a casual tone of voice, but it meant something.","","$!{r_she} wanted to treasure the moment.","","One good thing about the trip was developing a friendship with $!{reese}. You got to see another, well-hidden side of ${r_him} at times.","*page_break","*goto scene01_dream1_polodone","","*label scene01_dream1_importbffj","","$!{james} drifted away from the porch railing to have a word with you after the group photo was finished. You could tell something was on ${j_his} mind from how ${j_she} would either watch your car or share fleeting looks with you. This departure was stirring up old memories\u2026","","$!{j_she} politely, if a bit self-consciously, asked you for a picture together by the porch railing. $!{j_his} prepared reasoning about the flower beds adding some color to the shot and how the sunny daylight closer to the edge would brighten it further only caused you to smile. $!{j_she} didn't need reasons to want a photo.","","You noticed how ${j_she} carefully handled your picture, tucking it away like it was something fragile that needed to be treasured.","","One good thing about the trip was rekindling a friendship with $!{james}; the absence hurt\u2026","*page_break","*goto scene01_dream1_polodone","","*label scene01_dream1_polodone","","You put away the group picture, careful not to crimp or scratch the film of the Polaroid when placing it in the glove compartment. Properly framing it, stashing it in a dusty drawer, or viewing it as a beloved memento was meant to come after you left Fernweh. Now, the photograph is in limbo in your car just like you.","","Putting the car in drive is better than nothing, even if you can't technically go anywhere. The illusion of movement sometimes helps to stifle those feelings that can keep you up at night. You start to drive away, speeding up as you exit the populated areas that are still quiet without any foot traffic or townsfolk venturing out.","","It's sometimes better not to see them\u2026","","Their routines, their normalcy, and their lives.","","It can occasionally make you think a little too hard about how you're doing in comparison.","*page_break","","Sparkling drops of rain adorn the dense foliage like crystal ornaments hung along each bow and between the branches that glimmer in the sunlight. The greenery remains verdant with a density that anyone could get lost in, but the recent heat wave has impacted some weaker trees. It's easy to spot them as you pass by.","","Watching the woods has become a habit\u2026","","You begrudgingly glance away from a flagging dogwood tree when a hauntingly melancholic melody oozes from the radio as if on cue. It's only the piano now, but the despondent singer is likely waiting her turn. It had to be [i]this[/i] song.","","*choice","    #Sing along with her out of spite. \"~When my love is dead and gone!~\"","        *goto scene01_dream1_songsp","    #Get frustrated. \"Your love is gone because you kept singing the same damn song.\"","        *goto scene01_dream1_songfrus","    #Ignore the song and focus on the road.","        *goto scene01_dream1_songign","    #Endure it. $!{beckett} once played you a song about frozen yogurt; this isn't that bad.","        *goto scene01_dream1_songfro","    *if (silas_friendship >= 62) #Switch to the CD player. $!{silas} let you borrow some music.","        *goto scene01_dream1_songs","    #Genuinely sing along. The song has grown on you even if it's a little depressing.","        *goto scene01_dream1_songsin","    #Turn the radio off. \"Nope, we're not doing that again.\"","        *goto scene01_dream1_songno","    #Become unnerved and stare at the radio.","        *goto scene01_dream1_songun","*page_break","","*label scene01_dream1_songsp","","No, you're not going to let the piano continue to weave notes until it reaches a crescendo of wistful tones that signal the singer to begin.","","You know this stupid song by now, which is why you take her spotlight out of pure spite.","","*if (tentative_ro_pick = \"beckett\")","    \"~Why does the sun keep on rising!?~\"","","    \"~Why do the birds continue to sing!?~\"","    *goto scene01_dream1_songsp1","","*elseif (tentative_ro_pick = \"silas\")","    \"~Why do the trees keep on swaying!?~\"","","    \"~Why do the waves rush to shore!?~\"","    *goto scene01_dream1_songsp1","","*elseif (tentative_ro_pick = \"reese\")","    \"~Why does the sun keep on setting!?~\"","","    \"~Why does the snow continue to fall!?~\"","    *goto scene01_dream1_songsp1","","*elseif (tentative_ro_pick = \"james\")","    \"~Why does the moon keep on glowing up above!?~\"","","    \"~Why do the mountains still stand tall!?~\"","    *goto scene01_dream1_songsp1","","*elseif (tentative_ro_pick = \"jr\")","    \"~Why does my heart keep on beating!?~\"","","    \"~Why do my tears continue to fall!?~\"","    *goto scene01_dream1_songsp1","","*label scene01_dream1_songsp1","","There is more force behind how you deliver the lyrics in a slightly raised tone of voice, which would be found in rock music rather than in a tragic ballad of love. The singer usually has a few dragging pauses between verses to work up the emotion to push forward singing, but irritation motivates you. It's going to be easy to sing over her when she finally begins to sing.","","*if (waiter_flirt >= 4)","    \"~Why does blood continue to flow through my veins\u2026?~\"","","    A bit of uncertainty laces itself through your voice to weaken it as the wait continues on.","    *page_break","    *goto scene01_dream1_songsp2","","*else","    *page_break","    *goto scene01_dream1_songsp2","","*label scene01_dream1_songsp2","",". . .","","Why isn't the lady singing so you can beat her?","","The piano continues to play, steadily building up emotion for an entrance that doesn't take place. It's like a curtain rising on an empty stage because this is the exact moment for her to begin crooning out those low, smooth tones that are as tempting as they are sad. This track seems to be a purely instrumental version.","","Your irritation morphs into bewilderment and then unease as you sit there comparing what should be with what is. Only one question comes to mind: where is she? You turn off the radio.","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songfrus","","Driving through Fernweh could possibly be a way to clear your head and recenter, but the benefits to this drive just sharply declined.","","The piano continues to play, weaving a stirring melody that is likely meant to be reflective and wistful to accompany the singer's morose lyrics. Each note heightens your frustrations so any sympathy about this tragic ballad of love is whittled away. It's almost time for her to begin.","","\"Your love is gone because you kept singing the same damn song,\" you snap out the remark   during the singer's grand entrance. It is a perfectly timed barb that makes a pleased smile settle on your lips despite the fact you are talking to a radio. It's creepy, so this isn't that weird in comparison. \"He probably went insane having to hear you over and over again.\"","",". . .","","She should be posing a question by now; it's usually about the injustices of the world or nature continuing on despite her broken heart. You clear your throat as the unnerving quiet persists with only the piano softly playing as if it's also waiting for the singer to take center stage. Is this an instrumental version\u2026? Your eyes linger on the speakers of the radio even after you flick the knob of the radio to off.","","A single, bothersome question niggles at the back of your mind: where is she?","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songign","","It's nothing you haven't heard before.","","The piano continues to play, weaving notes into a wistful melody that builds to signal the arrival of the singer. Her smooth, crooning voice is as tempting as it is morose with lyrics that question how the world can keep going when her heart is broken. It's a tragic ballad.","","You only spare one final look at the speakers before focusing back on the road. Clearing your head or getting a slight change of scenery would be better without the depressing soundtrack, but ignoring her somehow feels more pointed than simply switching the radio off. This song isn't going to rule your thoughts.","","Counting trees would be a boring driving game; $!{beckett} could come up with a better one\u2026","","There aren't any other cars out to string together a vehicle rainbow; plus, the license plate game is definitely out for a small town. Is this why Milton Callaway resorted to pranks? Idle hands. You muffle a defeated sigh before glancing back at the radio that continues to produce a piano instrumental rather than the song that should be playing. It's her turn now.","",". . .","","The quiet isn't truly silence, but it feels that way since the singer is missing. Where is she\u2026? You frown at the thought, but turn off the radio to avoid the unnerving feeling creeping in.","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songfro","","You have heard worse, believe it or not\u2026","","$!{beckett} once came across a dementedly catchy song dedicated entirely to frozen yogurt, its sugary toppings, multitude of flavors, and swirl composition. Naturally, ${b_his} next step after complaining about how unbelievably hard it was to get the tune out of ${b_his} head was to share it with you. Friends suffer together, and you did for about a week.","","Listening to a singer romanticize a dessert has prepared you to endure this song about lost love. It's easier to relate to someone with a broken heart wondering how life goes on while she is hurting compared to one organizing the week by flavor. Who enjoys froyo that much?","","No one.","","It's not that great when there is gelato.","","Bracing for the inevitable soon turns into you peering over at the radio in mild confusion. It's time for the lady's grand entrance; she should be posing a question now. The piano continues to softly play as if it's also waiting, which only makes the absence of the lyrics become more unsettling until you decide to turn the radio off.","","It's irrational, but you wonder where she is\u2026","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songs","","You act more quickly than the piano that continues to weave wistful notes into a crescendo that signals the singer to begin. It's like a grand entrance. Switching to the built-in CD player only takes a press of a button, but you mash it eagerly to listen to $!{silas}'s CD.","","Classic rock, punk metal, or soothing acoustic guitar will be so much better than a tragic ballad of lost love. You recall how ${s_she} casually offered to make you a mix of some of ${s_his} favorites after noticing your penchant for going on drives for some freedom. It felt like ${s_she} didn't want you to be too alone with your thoughts without inserting ${s_him}self into your solitude. Of course, you accepted.","","The thoughtfulness outweighed any taste in music; ${s_she} was trying to be considerate.","*page_break","","The first strumming notes of a guitar instantly puts you more at ease as a familiar tune starts to play that isn't haunting. It has a touch of folk to it. You can hear the strings being plucked to create that very faint screech of metal when notes are changed; there's something honest about it and\u2014","","Piano interlaces the guitar's soulful song, even though you know there should still be two more minutes of uninterrupted strumming. It deftly cuts in, accompanying the instrumental, before stealing the spotlight as it grows louder. You flinch when the CD abruptly ejects with a click.","","The radio is now the only source of music within the space, which is already unnerving enough until you realize something is missing. Someone is missing. The singer should be crooning temptingly smooth yet morose lyrics about her love, but she isn't. You slowly raise your hand, mindful of keeping your fingers away from the CD slot that seems to have a mind of its own as you turn off the radio.","","One question nags at your mind: where is she?","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songsin","","The piano masterfully weaves together wistful notes to create a stirring crescendo that acts as a grand entrance for the singer. She'll take the spotlight soon enough, crooning out lyrics that are as tempting to listen to as they are morose. You can appreciate the song, even if it's a little depressing, because it does remind you of your arrival in Fernweh; it's a constant.","","A ballad of lost love deserves this tragic mood.","","*if (tentative_ro_pick = \"beckett\")","    \"~Why does the sun keep on rising\u2026?~\"","","    \"~Why do the birds continue to sing\u2026?~\"","    *goto scene01_dream1_songsin1","","*elseif (tentative_ro_pick = \"silas\")","    \"~Why do the trees keep on swaying\u2026?~\"","","    \"~Why do the waves rush to shore\u2026?~\"","    *goto scene01_dream1_songsin1","","*elseif (tentative_ro_pick = \"reese\")","    \"~Why does the sun keep on setting\u2026?~\"","","    \"~Why does the snow continue to fall\u2026?~\"","    *goto scene01_dream1_songsin1","","*elseif (tentative_ro_pick = \"james\")","    \"~Why does the moon keep on glowing up above\u2026?~\"","","    \"~Why do the mountains still stand tall\u2026?~\"","    *goto scene01_dream1_songsin1","","*elseif (tentative_ro_pick = \"jr\")","    \"~Why does my heart keep on beating\u2026?~\"","","    \"~Why do my tears continue to fall\u2026?~\"","    *goto scene01_dream1_songsin1","","*label scene01_dream1_songsin1","","Your singing voice isn't quite as raw or alluring as hers, but you do make a genuine effort to match the pauses built-in to the verses. It feels like each question is directed at the world that continues to go on while the singer suffers through heartbreak; she can't move forward.","","The other half of your duet is lagging behind.","","*if (waiter_flirt >= 4)","    \"~Why does blood continue to flow through my veins\u2026?~\"","","    A bit of uncertainty laces itself through your voice to weaken it as the wait continues on.","    *goto scene01_dream1_songsin2","","*else","    *goto scene01_dream1_songsin2","","*label scene01_dream1_songsin2","","You nervously swallow, feeling slightly self-conscious about singing alone without having her as a guide. It's not like anyone is around to judge, but something feels wrong as the piano continues to play its instrumental as if it's also waiting. The faintest whisper of a sigh comes from the radio before static starts to distort it.","","You turn it off to lessen your uneasy feelings.","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songno","","No, you're not going to let the piano continue to weave notes until it reaches a crescendo of wistful tones that signal the singer to begin.","","You know this song well enough by now.","","It's meant to be a tragic ballad of lost love, but it also serves as a dual reminder of your arrival in Fernweh and failed attempt at departure\u2026","","\"We're not doing this again,\" you assert with a stern look at the built-in speaker closest to the driver's seat. It only emits the instrumental piece rather than the lamenting lyrics you have partially memorized. Why isn't she singing? Your fingers are poised to turn the music off, but niggling uncertainty makes you hesitate and listen for a moment before doing so.","","The resulting silence doesn't bring much relief.","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_songun","","This isn't just a song to you.","","It's meant to be a tragic ballad of lost love, but it also serves as a dual reminder of your arrival in Fernweh and failed attempt at departure\u2026","","The piano continues to weave wistful notes to herald the arrival of the singer, which in turn signals something to you as you uneasily stare at the radio. This is too familiar. Classical music is supposedly cerebral or calming, and yet your mind is going into overdrive to create an explanation for what's happening\u2026 again.","","Fernweh is a small town, but anyone would complain about a radio station with one song.","","Is your luck that bad to always be in the car driving when it's playing? Is something wrong? Why is it always this same damn song?","","Bracing for the singer's crooning voice to ooze out of the speakers turns into you peering at the radio in confusion. Why isn't she singing? Faint aches in your knuckles alert you to the fact that you're gripping the steering wheel too tightly, even your spine is taut with tension. Most people would conclude this is simply the instrumental version, but only one question comes to your mind: where is the singer?","","You turn off the radio and take a breath.","*page_break","*goto scene01_dream1_bambi","","*label scene01_dream1_bambi","","Quiet descends with a finality that seems to blanket the interior of the car, motivating you to straighten up in your seat beneath its weight.","","This is better than the lyricless song\u2026","","Your eyes deviate back to the thick tree line that flanks most of the roads in town to create dark green borders to the asphalt or dirt paths. Fresh rainfall usually makes birds come out to play in the dewy leaves or scavenge the moist earthworms wriggling around. A weak breeze only faintly stirs through the trees now that you're pointedly looking for its effect. There's still an absence of other vehicles or people.","","It's too quiet\u2014too still\u2014too unerringly stagnant.","","You focus back on your lane to see that you are not alone.","*page_break","","*if (deer_reaction = \"cared\")","    A baby deer is treading along your lane, nimbly walking on the weathered asphalt like it's a forest path. You somehow know it's the one you encountered. Its spots denoting youth have all but faded away, replaced with soft brown fur, though you bet it likely has scars from the vines' punctures. A different kind of spotting, which is likely grayish and rough.","","    What's important is that the fawn survived.","","    You smile faintly at seeing it move about with such certainty that suggests it will be okay despite all it suffered through in the clearing.","","    You're emotionally attached to little Bambi.","    *page_break","    *goto scene01_dream1_bambia","","*elseif ((deer_reaction = \"neutral\") or (deer_reaction = \"disgust\"))","    A baby deer is trotting along your lane like it's a trail in the forest that is open to wildlife. It really shouldn't be doing this, but deer aren't the brightest of animals. As it gets closer, you begin to wonder if this is the same one that survived the horrors of the sunken clearing.","","    The vines. The plant pod. The blood loss.","","    Its white spots denoting youth have all but faded, which means it is around the same age.","","    You mull over that thought for a while.","    *page_break","    *goto scene01_dream1_bambia","","*elseif (deer_reaction = \"uncaring\")","    A baby deer is proudly strutting along your lane like you're the one trespassing on its land. It shouldn't be out on the asphalt, unless it's the same stupid fawn that you saw when first arriving in town. If it can't tell the difference between pavement and the forest floor, then it deserved to suffer in the sunken clearing\u2026","","    Its survival didn't matter to you that night, though it does seem to have grown up, losing some of the white spots denoting youth.","","    You dispassionately stare back at the animal.","    *page_break","    *goto scene01_dream1_bambia","","*elseif ((deer_guilt = \"very guilty\") or (deer_guilt = \"guilty\"))","    It's hurt.","","    You don't immediately realize what type of animal has claimed a spot in the center of the lane as you take in its bloodied appearance. A rich, burgundy liquid adds to the sheen of rainwater left behind on the pavement. Its fur has streaks in it, but the source of the blood is a gouge in its sternum that continually leaks out, adding macabre stripes to its soft pelt.","","    It's a fawn.","","    The baby deer stares directly at you through the windshield, but you can't bring yourself to meet its wide eyes that possess a probing intensity. It could just be your imagination. Why isn't it cowering or fleeing from what did this?","","    You glance over at the woods to avoid looking at the animal. Normally, the nightmares about what you did are set at night in the horrific, sunken clearing. This must be a coincidence.","    *page_break","    *goto scene01_dream1_bambia","","*elseif (deer_guilt = \"neutral\")","    You don't immediately realize what type of animal has claimed a spot in the center of the lane as you take in its bloodied appearance. A rich, burgundy liquid adds to the sheen of rainwater left behind on the pavement. Its fur has streaks in it, but the source of the blood is a gouge in its sternum that continually leaks out, adding macabre stripes to its soft pelt.","","    It's\u2026 it's a baby deer.","","    You narrow your eyes as if that will help this make more sense. It should be cowering or fleeing from whatever predator did that rather than waiting around to become fresh meat. It's going to get itself killed, but that isn't your problem.","    *page_break","    *goto scene01_dream1_bambia","","*elseif (deer_guilt = \"uncaring\")","    You don't immediately realize what type of animal has claimed a spot in the center of the lane as you take in its bloodied appearance. A rich, burgundy liquid adds to the sheen of rainwater left behind on the pavement. Its fur has streaks in it, but the source of the blood is a gouge in its sternum that continually leaks out, adding macabre stripes to its soft pelt.","","    It's a disgusting sight\u2026","","    The circle of life should be kept in Fernweh's forests; while out for a quick drive, you don't need to see a baby deer get eaten by a predator. You withhold a sigh at how the fawn remains in your path rather than cowering or fleeing like a normal animal. It probably deserves this end.","    *page_break","    *goto scene01_dream1_bambia","","*label scene01_dream1_bambia","","*if (baby_deer_road = \"stop\")","    The fawn isn't straying from your lane, which means you'll have to be the one to adjust your actions. Your foot was already hovering over the brake pedal as soon as you caught a glimpse of fur, but now it depresses it. There isn't any resistance, no push back against the sole of your shoe as the brake pads engage.","","    They aren't engaging.","","    Your eyes immediately snap away from the road to uselessly peer at the pedal that's flush against the floorboard of the car. Stomping on it fails to do anything. The distance between you and the deer is rapidly closing as the car coasts from the earlier built-up speed that can't be tempered or slowed down. You can clearly see the baby deer's wide eyes as it stares back.","","    It's all happening too quickly!","","    Swerving isn't your preference, but you twist the wheel to the side to avoid a collision. The steering column resists your command by locking up and producing a sharp grinding noise you can both hear and feel as it quakes up your arms. The wheels are locked in place and the brakes won't work, so that means\u2014","","    You wince when you hear the thumping impact that sounds far too heavy for a baby deer\u2026","    *page_break","    *goto scene01_dream1_bambib","","*elseif (baby_deer_road = \"go\")","    The fawn isn't leaving your lane, which means you'll have to act while it remains unmoving. Your hands already secured a tighter grip on the steering wheel when you saw a glimpse of fur, but now you slacken the hold and loosen your wrists to start the turn. There isn't any flexibility, no swivel or rotation as the steering column interacts with the wheels and chassis.","","    They aren't interacting\u2026","","    Your eyes immediately snap away from the road to uselessly peer at the inflexible wheel. Aggressively jerking it fails to do anything. The mechanism resists your command by locking up and producing a sharp grinding noise you can both hear and feel as it quakes up your arms. The distance between you and the deer is rapidly closing as the car continues heading in a direction you can't control or influence.","","    You can clearly see the baby deer's wide eyes as it stares back. This is happening too quickly! ","","    Braking isn't your preference, but you stomp on the brakes to avoid a messy collision. The pedal flattens out rather than offering any resistance as the brake pads refuse to engage to sap some of the car's built-up momentum. The wheels are locked in place and the brakes won't work, so that means\u2014","","    You jolt when you hear the thumping impact that sounds far too heavy for a baby deer.","    *page_break","    *goto scene01_dream1_bambib","","*elseif (baby_deer_road = \"cruel\")","    The fawn refuses to leave your lane, which means you'll need to give it a reason to go.","","    \"So stupid,\" you mutter the insult, flicking the car's high beam lights on without a second thought. Its wide, sensitive eyes should make the multitude of packed bulbs appear even more blaring compared to the sunlight it's used to. The fawn isn't budging from the onslaught of brightness; instead, it lowers its head down, determined to stand there.","","    One of your hands drifts to the horn, resting on the center of the steering wheel while you debate if the loud noise would work or if you can simply force it to move. The road isn't for animals. This fawn is learning an important life lesson with you as a voluntary teacher; you roll your eyes at the twisted humor, but keep going. The distance continues to close with your foot easing off the gas slightly to let the car coast. ","    ","    Everything should have basic self-preservation.","","    It's an ingrained instinct!","","    Those who don't will\u2014","","    You blink once when a dull, thumping noise registers in your ears. That was the sound of an impact, but it seems too heavy for a fawn\u2026","    *page_break","    *goto scene01_dream1_bambib","","*label scene01_dream1_bambib","","Time slows down following the collision.","","You can hear it ticking by in a lagging, staccato beat as your eyes study the windshield for any trace of what just happened. Did that really just happen? The suddenness of it all leaves you slightly disoriented after trying to decide how best to react, but a blip of light seizes your focus away from detecting any traces of blood.","","The caution symbol glows a brilliant amber.","","Your dashboard is an array of slowly blinking lights, and yet, that one's a shining beacon.","","A caution is less severe than a warning. The rich, yellow hue isn't as arresting as the angry red color that dims and brightens in time with your breathing, but you take its advice. The ticking noise is requalified as an actual sound rather than your mind playing tricks on you. It's either all happening again or you zoned out\u2026","","Something is going on here.","","Your conclusion coincides with the vehicle rolling to a stop, although this time the battery lasts.","*page_break","","*if (heart >= 60)","    Your heart thuds in your chest as the noise of the impact mentally replays despite your attempts to steady yourself. Drumming your fingers on the steering wheel isn't helping. It was a sickening thud that was far too heavy for a baby deer that should've been crushed\u2026","","    Its developing bones would have snapped under the weight of your car driving over it.","","    \"Stop it,\" you mumble the self-directed order, no stranger to talking to yourself as an only child, though that aloneness feels different now. It takes you a moment to work up the nerve to check the mirrors, but it's the right thing to do. What if whatever you hit is laying there in pain; it's your responsibility to contact someone.","","    There's something in the road.","","    When you realize it is too big to be a baby deer, your heart plummets\u2026 It's human-shaped.","    *page_break","    *goto scene01_dream1_dopact","","*elseif (heart <= 40)","    Your thoughts are racing in the wake of all that has happened in such a short amount of time. It's hard for you to sift through it all to find a starting point for a plan, but one thing stands out: the noise. The disturbing, thumping sound of impact was too substantial to come from a tiny fawn impacting the front grill of your car.","","    It's frail bones should've been crushed.","","    \"Okay, okay, so that makes everything worse,\" you mutter the observation, no stranger to talking to yourself as an only child. It helped at times when you were alone. \"Which means\u2014\" you peer up from the insignia on the steering wheel to see what lies in the road by checking the side and rearview mirrors. \"It's not a deer\u2026\"","","    There's something human-shaped in the lane; no amount of orderly logic can prepare you for the jarring sight that puts you as the root cause.","    *page_break","    *goto scene01_dream1_dopact","","*else","    It's hard to know what to think or feel when so much has happened in a brief amount of time.","","    You struggle to concentrate on just one thing as that unsettling impact replays in your head again and again as if syncing with your heart rate. It was too solid of a hit. A fawn would be treated as a passing speed bump by your car, which opens up a new disturbing possibility.","","    What was in the road\u2026?","","    You had been keeping your eyes fixed on the dotted line of the lane divider until now, but they reluctantly drift to check the mirrors. ","","    Something human-shaped lies behind your car.","    *page_break","    *goto scene01_dream1_dopact","","*label scene01_dream1_dopact","","The 'collision' has morphed into an accident.","","How are you going to handle the aftermath?","","*choice","    #Accident? No, this is a crime, and you're leaving the scene. Just walk away from it.","        *set merciful -2","        *goto scene01_dream1_dophitrun","    #Instantly get out of the car to go check on the person. They shouldn't be alone while hurting.","        *set merciful +2","        *goto scene01_dream1_dopgull","    #Stay seated and consider your options; it may be best to walkie talkie $!{james}.","        *set heart -2","        *goto scene01_dream1_dopcall","    #Lock the car doors and stay in. Something isn't right.","        *set believer +2","        *goto scene01_dream1_dopstay","    #Go get help and first aid. You can't handle seeing someone injured like this\u2026","        *set heart +2","        *goto scene01_dream1_dophelp","    #Reluctantly leave the car to see if the person is okay. You're unwilling to get too close.","        *goto scene01_dream1_doprel","*page_break","","*label scene01_dream1_dophitrun","","This isn't an accident; it's the start of a lawsuit at the very least, if not an active crime scene.","","Hit and runs usually involve more driving off than actual running, but you will have to improvise by possibly hiring a seedy individual with a tow truck. You nod absent-mindedly to yourself, snapping your fingers to get rid of any of the shaking in them. It was a true accident, but how will the townsfolk view this incident?","","You aren't willing to risk it.","","Looking at the body once was enough, so you haul yourself out of the driver's seat and start walking without a backwards glance. Could a bobcat, bear, or hell, another tree creature dispose of the body? That could work. The pace of your steps pick up as your mind continues to poke holes in how you can get out of this situation.","","You're jogging now, breathing unevenly as you consider how badly this will impact your future.","","What if you're imprisoned two different ways?","*page_break","","It's only when you pass by your abandoned car again that the frantic edge to your thoughts begins to dissipate. Nearly faceplanting onto the road pulls a garbled curse from you, but you just skid your knees instead. The looping effect only happens when trying to leave, so\u2026","","Why can't you run away into town?","","You quell the need to glance at the prone form laying in the road before deciding to try again.","*page_break 10 Minutes Later\u2026","","A second and third attempt resulted in the exact same thing happening again, except this time you noticed your parked car looming in the distance with each hasty step forward.","","\"Bullshit,\" you curse, punctuating it by slamming the car door shut. It makes sense to at least shelter in here to see what's in store next. You refuse to look at the person you passed on three separate occasions, but chose to speed up rather than slow down. It makes everything feel too real and serious.","","This waiting around might be worse than running in a circle\u2026","","A solid tap on the passenger side window startles you enough that you jump in your seat, scraped knees impacting the steering column. A figure is standing beside the car. They knock another knuckle against the glass in a firm warning to open up, but your eyes dart between them and the empty spot in the road. It's then that you realize the doors are unlocked and mash the lock button to avoid whatever sick karmic retribution is in the making\u2026","","\u2026Except they simply break the glass.","","You must resemble the baby deer as you cast a wide-eyed, stunned look at the person who nimbly climbs inside after plucking the lock mechanism up with their fingers. \"Get out of\u2014\"","","\"Shut up,\" ${pc_he} @{mc_plural snap|snaps} in a brisk tone of voice that sounds vaguely familiar. \"That was cold-blooded even for us.\"","*page_break","*goto scene01_dream1_dopdesc","","*label scene01_dream1_dopgull","","The reality of what you accidentally did is still setting in, but the consequences of it are clear.","","What if the person is injured or dead?","","Your fingers fumble with the door mechanism, snagging slightly on it with how they tremble from a mixture of adrenaline and nerves. It comes open eventually, but the asphalt road suddenly doesn't feel right beneath your feet. Each step paradoxically jolts up your legs while also feeling slightly numb like you aren't feeling the true movement of stiltedly walking ahead.","","How did you make such a horrible mistake?","","More urgency infiltrates your actions as you near the prone figure who must have rolled from the impact with the car, coming to rest on their side. It almost looks like they're resting in the road, except they are eerily still. They could be hurt, so you push your rising fear and concerns away to be compassionate towards them.","*page_break","","\"Hello\u2026?\"","","Your tentative greeting goes entirely unanswered, and the stiff silence is gutting.","","\"I'm so sorry\u2014so, so sorry. I'll get you help, and I won't leave until the paramedics arrive, okay?\" Rambling about how to make this situation right gives you something else to concentrate on besides the blood wetting your shoes. You kneel down next to them, hesitant to move forward with checking for a pulse or to pull back the hood that obscures their face. \"I\u2014\"","","Your next promise dies in your throat when a hand latches onto your trembling wrist right before you can search for their pulse point.","","\"Oh, you're alive,\" you exhale the conclusion with a tremendous amount of relief that's short-lived when the figure starts to twist your wrist. It's too calculated with a precision that alludes to practice. It feels like your bones are attempting to slide over each other to form a pretzel rope, but the pressure only increases. Trying to pull away worsens the pain. \"Stop!\"","","They let go.","","You wobble slightly when rising back up from the kneeled down position with your aching wrist pressed against your middle. Something isn't right. The figure starting to stir is a good thing, but you suddenly want distance between the two of you after their uncalled-for attack.","","You return to your car so it can serve as shelter from whoever this unhinged person may be.","*page_break","","The good news is the person can walk.","","The bad news is they're getting closer to your car with each deliberate step they take.","","You continue to watch their approach by using the side and rearview mirrors, but objects are closer than they appear within the reflective surfaces, which increases your apprehension. It's a tiny warning etched into the glass that's usually meant for cars or sign posts, not for people you accidentally hit. Your eyes dart between all of the mirrors to check each one.","","Concern about the person's well-being still nettles you despite the aggressive encounter.","","They could need help, but you also feel unsafe.","","A hushed gasp falls from your lips when your car doors unlock all by themselves, creating a faint echo as they disengage and leave you exposed. You hit the button again. The locks slide back into place just as the figure comes to a stop by the passenger side door. They don't say anything or tap on the glass; instead, they raise their hand up into your field of view. Sunlight glints off the set of car keys dangling from their fingers; your breath catches slightly.","","The doors unlock with the click of their button, allowing them to nimbly climb inside with you.","","\"You're still softhearted, but that means you're also gullible,\" ${pc_he} @{mc_plural note|notes} in a reflective tone of voice that sounds vaguely familiar. \"We will need to work on that, okay?\"","*page_break","*goto scene01_dream1_dopdesc","","*label scene01_dream1_dopcall","","There's some certainty in staying in your car while considering how best to handle this bad situation. Rendering first aid should be left to the professionals who have years of training and gear to help the person. Your eyes deviate from the time displayed on the digital clock to check on the prone figure laying in the road.","","The impact must have caused them to roll\u2026","","It almost looks like they are using the asphalt as a mattress with how they lie on their side.","","You quietly clear your throat before freeing your walkie talkie from its place in the cup holder. Dialing emergency services on your cell phone is out, but you know someone who can get an ambulance out here within minutes. \"$!{james},\" you address ${j_him} in as calm a tone as you can manage. \"There's been an accident on the road leading out of Fernweh. A person was hit by a car\u2026 Uhm, they need help.\"","","This impersonal tactic helps you better focus on delivering the facts, even if you caused this.","","No response comes.","","\"$!{james}?\" you call to ${j_him}. \"Anyone? I just need an ambulance or someone to\u2014\" You instantly stop asking for help when your inspection of the side and rearview mirrors comes up empty. The figure no longer lies in the middle of the road, but that shouldn't be possible after getting soundly hit by a car. ","","Where did they go\u2026?","*page_break","","You unclick your seatbelt, no longer relying on the mirrors to provide sightlines for what lies behind your car. Twisting in your seat soon transitions into you turning all the way around to try and locate the wounded person. There's something unsettling about their absence paired with the fact that your walkie talkie calls aren't going through to $!{james} or anyone.","","It's just you and them out here.","","Alone.","","Another sweep of the road yields absolutely nothing, but you do startle when something loudly bangs against the hood of the car. Your neck aches from how you whip around to see the figure just as they efficiently move to the passenger side door. Shock hinders your thoughts that are running together without offering a clear directive for you to act on.","","Get out, lock the doors, try the walkie talkie, and other snatches of ideas all fall quiet when the person nimbly climbs inside to join you.","","\"A smart approach doesn't matter if the execution is lacking,\" ${pc_he} @{mc_plural note|notes} in a tone of voice that sounds vaguely familiar. \"Think about that next time.\"","*page_break","*goto scene01_dream1_dopdesc","","*label scene01_dream1_dopstay","","The radio. The deer. The ticking noise.","","You recognize the pattern of events unfolding that all translate to a clear, indisputable warning about something being amiss. It goes beyond strange coincidence or an odd feeling. Locking the car doors doesn't increase your chances of safety or getting through whatever wrongness Fernweh is throwing at you now, but at least it puts a barrier between you and it.","","The 'it' is currently laying in the middle of the road like the pavement is a suitable mattress\u2026","","Hitting the figure that hard must have made it roll with the impact, legs swept out from under it as it went up and over the hood or beneath the chassis. It's easier to think of it in dehumanizing terms because this can't be real, right\u2026? You haven't yet zoned out in a way that could actually cause harm to someone else.","","That unhelpfully worrisome thought prompts you to glare at the supposed 'person' who isn't doing anything unnatural at the moment.","*page_break","","It still isn't moving.","","Your uncertainty about how to handle this is mounting with each passing minute you continue your intent staring contest with a body. The forest has become an afterthought, only the side and rearview mirrors matter now. Your eyes actually burn from how rarely you've allowed yourself to blink, while your neck is developing a slight crick from all the tension.","","Why isn't anything happening?!","","There's no way you hit someone.","","Slowly but surely, your resolve starts to weaken when you remember the walkie talkie in one of the cup holders. Calling this incident into $!{james} may be for the best, or at least telling someone about what's going on. Your eyes only deviate from the mirror for a second to locate the walkie talkie, but that's all it takes.","","There is now an empty spot in the road.","","\"I knew it!\" Your exclamation is contrasted by the sound of something lightly tapping against the passenger's side window. The brief victory sobers near instantly when you see the figure using the tip of a car key to prod the glass once, twice, and then the locks disengage with a finality that makes your breath escape you.","","It\u2014No, they somehow have a copy of your keys, allowing them to easily climb inside the car.","","\"It's fine to believe in something, but make sure it's the right thing,\" ${pc_he} @{mc_plural advise|advises} in a cool tone of voice that sounds vaguely familiar. \"You'll learn.\"","*page_break","*goto scene01_dream1_dopdesc","","*label scene01_dream1_dophelp","","Your eyes dedicatedly trace the fine stitching of the steering wheel as your breathing pattern evens out to become steadier. It wasn't a good idea for you to check the mirrors, not when 'checking' lengthened into prolonged staring at the person you accidentally hit. They must have rolled over from the sudden impact, turning so their back faces you as if asleep.","","No one would use pavement as a mattress\u2026","","You can't bring yourself to go check on them, since the state of their injuries might be too much for you to witness. It could be graphic. Getting help from someone who's trained in first aid is the best solution, which is why you climb out of the car, keeping your gaze on the asphalt rather than giving in to the urge to look.","","Morbid curiosity battles with your emotions.","","You start the walk into town. Each step forward adds certainty and urgency to your movements until you are jogging and then running. Any spilled blood is on your hands.","*page_break 10 Minutes Later\u2026","","\"Wha?\"","","An unfinished, breathless question leaves you when you notice your parked car looming in the distance with each hasty step forward. The looping effect only happens when trying to leave, so why can't you run back into town? Your rapid pace starts to falter when it seems like getting medical assistance won't work.","","How can you help the person now?","","You can't quell the need to glance at the prone figure lying in the road when passing by them. Guilt causes your next steps to become further leaden and lagging, feet shuffling along the pavement as you slow to a stop. A hood obscures their face, not that you could see much because they lie on their side, angled towards the ground. Blood wets your shoes, but you don't see anything visibly gruesome.","","That observation emboldens you to get closer.","*page_break ","","\"Hello\u2026?\" No response comes from them, and the stiff silence starts to fray your nerves. \"I'll get help.\" Contacting $!{james} on the walkie talkie would be another way to get a medic out here, assuming they could reach this part of the road. With that new plan in mind, you begin to leave when a hand latches onto your ankle.","","The figure isn't just holding on.","","Their fingers seek out your Achilles heel with a terrifying precision before they exert force on pressure points that make your calf muscle seize up. It has to be a practiced move. You quickly hobble back in alarm, nearly slipping on a slick patch in the road. Something is wrong. The person starting to stir is a good thing, but you suddenly want distance between the two of you after that uncalled for attack. ","","You retreat to your car so it can serve as shelter from whoever this unhinged person may be.","*page_break","","They're just standing there\u2026","","You peer into your rearview mirror to keep a check on the figure who seems to be engaging you in a staring match. It's hard to see much of their face, but intuitively you feel their focus. It's a positive sign that they're able to stand on their own after the collision; things would be even better if they weren't acting creepy.","","Some of your concern for their well-being and injuries has been replaced with unease.","","\"$!{james}, pick up,\" you issue the request again, only getting silence over the channel. \"I need someone to call an ambulance or medic.\"","",". . .","","A blip of static-y feedback from the walkie talkie draws your attention away from the mirror for only a second, but it's long enough. When you look back up, the figure is gone and the road is empty aside from the steadily drying patch of blood. You don't have time to react to that because someone is knocking on the passenger side door within seconds.","","It almost seems like a gentle warning before they nimbly climb inside and occupy a seat.","","\"If you're going to care, be careful about who it's for,\" ${pc_he} @{mc_plural note|notes} in a reflective tone of voice that sounds vaguely familiar. \"It's a double edged sword, alright?\"","*page_break","*goto scene01_dream1_dopdesc","","*label scene01_dream1_doprel","","You continue counting upwards, though the target number in mind always changes as your concentration slips and forces a restart. It's been at least two minutes since the collision, possibly more or less due to your unreliable count. There's no 'right' way to handle hitting someone by accident, but you wish there was.","","Reluctance turns into stalling as you debate what will do the most good in this situation.","","Go to them? Call someone? Run back to town?","","The person laying unnaturally still in the middle of the road doesn't offer a tie breaker; they almost appear asleep or passed out on the asphalt. The impact must have caused them to roll so they're now on their side. You resolve to check on them from a safe distance away.","*page_break","","Your steps start to lag the closer you get to the prone figure, though noticing the pavement glistening in the sunlight makes you freeze up.","","This is close enough.","","\"Hey\u2026? I'll try to get some help or something.\"","","No response comes from them, which isn't surprising considering everything, but at least you tried. The walk back is far easier than the one you made to get to them. There isn't a victim at the end of the path; instead, your car is waiting for you without any judgment. It might be a good idea to call $!{james} on the walkie talkie or\u2014","","Planning your next move comes to a stop when you hear faint footsteps accompanying your own. You whirl around only to see an empty spot on the pavement that is slightly wetter than the rest. Where did they go\u2026? Your walk becomes a jog back; something isn't right.","*page_break","","The car door slamming shut seems to echo in the quiet space, which you previously viewed as a shelter or refuge compared to the creepy road.","","Now, it is a boxed in area with windows for you to peer out of or for that odd person to look in. Engaging the locks doesn't make you feel any safer, not when the bloodied figure is able to walk off being hit by a car and may be livid or vengeful about it. You continue to scan the mirrors for any sign of movement, tilting your head this way and that to watch everything.","","There will always be a blind spot.","","Something thuds against the roof before you hear it slide off the sheet metal to come to rest near the passenger side door. Did they jump from there? You stare in stunned silence as the figure tries the door handle once before they pull out a key fob and disengage the locks.","","Your own car betrayed you, allowing them to nimbly climb inside and take a seat.","","\"I'm not sure what you were going for with that 'plan',\" ${pc_he} @{mc_plural admit|admits} in a tone of voice that sounds vaguely familiar. \"I don't think you were either.\" ","*page_break","*goto scene01_dream1_dopdesc","","*label scene01_dream1_dopdesc","","The bloody 'figure' is actually a ${pc_man}, not a mysterious, formless hitchhiking ghost who perpetually haunts the road out of Fernweh.","","That should make you feel better about things.","","It doesn't.","","*if (merciful >= 67)","    $!{pc_he} @{mc_plural grip|grips} the edges of ${pc_his} hood, pulling the burgundy fabric taut so it resembles a bonnet with how it conforms to further obscure ${pc_his} head. ","","    Why hide now\u2026?","","    You recognize the motivation behind ${pc_his} self-conscious actions enough to respect them despite everything. Averting your eyes to the windshield is hard to do with a stranger sitting nearby. $!{pc_he} @{mc_plural remain|remains} quiet, but you do hear ${pc_him} shift before feeling the sensation of being observed.","","    \"I'm going to show my face, but try not to freak out, okay?\"","    *page_break","    *goto scene01_dream1_dopdescm1","","*elseif (merciful <= 33)","    \"I'll give you something to really stare at.\"","","    There's something ominous to ${pc_his} biting remark that's scornfully playful rather than joking.","    ","    You don't get a chance to reply when the fabric of ${pc_his} hood is roughly yanked down to reveal a face you see every day in the mirror. $!{pc_he} @{mc_plural roll|rolls} ${pc_his} ${pc_eye_color} eyes at your continued assessment. The blatant mockery would normally earn an insult from you, but it's hard to come up with one as you notice the shared nose shape, jawline, and skin tones.","","    \"~Ta-da~! See\u2026? I was right.\"","","    Your voice shouldn't be coming out of ${pc_his} mouth.   ","    *goto scene01_dream1_doprevealcho","","*elseif (sincerity >= 67)","    \"You wouldn't trust me enough to carry on a conversation with your eyes closed, right?\"","","    Replying to that question isn't needed because ${pc_he} @{mc_plural wave|waves} off your attempt within a few seconds of posing it. You closely watch ${pc_his} hand as it raises to shield ${pc_his} face on the left side, obscuring it further from view while ${pc_his} palm acts as a visor. Why would ${pc_he} try to hide now\u2026? $!{pc_his} free hand fiddles with the folds in the burgundy robe, briefly crimping the velvet fabric into bunches.","","    \"I can't make this any easier,\" ${pc_he} @{mc_plural murmur|murmurs}. \"Sorry.\" ","    *page_break","    *goto scene01_dream1_dopdescs1","","*elseif (sincerity <= 33)","    $!{pc_he} @{mc_plural pinch|pinches} the center of ${pc_his} hood, tugging the burgundy fabric down so it resembles a tapered cowl an assassin might wear to be inconspicuous. It only obscures the top portion of ${pc_his} face; there's a slight grin playing at ${pc_his} lips. Forcefully entering someone's car isn't a laughing matter or joke.","","    \"\u2026$!{name}\u2026\"","","    $!{pc_he} @{mc_plural pitch|pitches} ${pc_his} voice differently, adding a reedy note to it that sounds vaguely spooky. It's the kind of tone ghost stories should be told in while kids are gathered around a campfire. Any quip or retort you could spout off falters when the ${pc_man} pulls back the hood with a flourish, revealing a shocking sight that stuns you.  ","","    \"Boo, it's you!\"","    *page_break","    *goto scene01_dream1_dopdescsn1","","*elseif (friendly >= 67)","    \"\u2026Hi.\"","","    Did the ${pc_man} who just forcefully invited ${pc_him}self into your car say 'hi'? Your reflexive need to return the polite pleasantry doesn't kick-in; instead, you cast a skeptical look in ${pc_his} direction. $!{pc_he} instantly @{mc_plural shift|shifts} in response, straightening up in the seat while ${pc_his} hand adjusts the burgundy fabric of the hood.","","    \"I was trying to build up to this part, but fine.\"","","    There is a tenor of warning to ${pc_his} tone.","    *page_break","    *goto scene01_dream1_dopdescf1","","*elseif (friendly <= 33)","    \"\u2026We need to get this out of the way.\"","","    $!{pc_his} tone of voice isn't ominous or spooky like the reedy pitch some people adopt when telling scary stories around a campfire. It's not exactly inviting either, but efficient and concise. Parting your lips to say more transitions into you snapping them shut when ${pc_he} @{mc_plural lower|lowers} the hood without any preamble or warning. ","    ","    The burgundy fabric falls away to reveal a face you see every day in the mirror.","","    The ${pc_man} silently accepts your staring.","    *goto scene01_dream1_dopdesca1","","*else","    $!{pc_he} @{mc_plural raise|raises} a hand to the edge of ${pc_his} hood, adjusting the velvet fabric to better obscure ${pc_his} face. It's weird to be at a silent impasse with someone who forcibly invited ${pc_him}self into your car. You consider trying to leave while the ${pc_man} is preoccupied staring out the windshield as if pondering something.","","    \"I don't know how to say it, so just look\u2026\"","    ","    The question you were about to pose never gets the chance to form on your tongue because you gawk at ${pc_him}. ","    *page_break","    *goto scene01_dream1_dopdescn1","","*label  scene01_dream1_dopdescm1","","*if (pc_hair_style = \"shaved\")","    The reflexive 'okay' you were about to convey only makes it to the 'oh' part as you gape at the ${pc_man}.","    ","    $!{pc_eye_color} eyes the same exact shade as your own watch you with barely concealed worry about your reaction. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though a troubled frown bows ${pc_his} lips the longer you gawk at the near mirror image of yourself. There is something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress.","","    \"I said don't freak out\u2026\"","","    You barely process the other you's muttered comment, preferring to listen to how your voice comes from the mouth of someone else.","    *goto scene01_dream1_doprevealcho","","*else","    The reflexive 'okay' you were about to convey only makes it to the 'oh' part as you gape at the ${pc_man}. ","    ","    $!{pc_eye_color} eyes the same exact shade as your own watch you with barely concealed worry about your reaction. The faint static cling from the velvety hood didn't disturb ${pc_his} ${pc_hair_color} hair that is styled in a ${pc_hair_style}. $!{pc_he} even @{mc_plural have|has} the same nose shape and jawline, though a troubled frown bows ${pc_his} lips the longer you gawk at the near mirror image of yourself. There is something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress.","","    \"I said don't freak out\u2026\"","","    You barely process the other you's muttered comment, preferring to listen to how your voice comes from the mouth of someone else.","    *goto scene01_dream1_doprevealcho","","*label scene01_dream1_dopdescs1","","*if (pc_hair_style = \"shaved\")","    The ${pc_man} tentatively flips down the hood, keeping ${pc_his} palm flush with ${pc_his} cheek before it also falls away to reveal a face you know too well. ","    ","    $!{pc_his} ${pc_eye_color} eyes flick away to train on the windshield, which only helps you recognize their shade. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though a weak smile curves ${pc_his} lips the longer you stare at the near mirror image of yourself. There's something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress. You can empathize.","","    \"I know it's a lot,\" ${pc_he} quietly @{mc_plural admit|admits}. \"I understand\u2026\"","","    You nod reflexively, too focused on how your voice sounds coming from ${pc_his} mouth.","    *goto scene01_dream1_doprevealcho","","*else","    The ${pc_man} tentatively flips down the hood, keeping ${pc_his} palm flush with ${pc_his} cheek before it also falls away to reveal a face you know too well. ","     ","    $!{pc_his} ${pc_eye_color} eyes flick away to train on the windshield, which only helps you recognize their shade. The faint static cling from the hood didn't disturb ${pc_his} ${pc_hair_color} hair that's styled in a ${pc_hair_style}. $!{pc_he} even @{mc_plural have|has} the same nose shape and jawline, though a weak smile curves ${pc_his} lips the longer you stare at the near mirror image of yourself. There is something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress. You can empathize.","","    \"I know it's a lot,\" ${pc_he} quietly @{mc_plural admit|admits}. \"I understand\u2026\"","","    You nod reflexively, too focused on how your voice sounds coming from ${pc_his} mouth.","    *goto scene01_dream1_doprevealcho","","*label scene01_dream1_dopdescsn1","","*if (pc_hair_style = \"shaved\")","    $!{pc_eye_color} eyes the same exact shade as your own fix on you with faint mirth brimming in them. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though unlike you, ${pc_he} ${is} smiling like there is humor to be found in being confronted with a near mirror image of yourself. There's something very slightly drawn to ${pc_his} features; it's a subtle strain that comes from enduring stress.","","    \"What the\u2014?\"","","    \"I know; that sounded better in my head,\" ${pc_he} @{mc_plural interrupt|interrupts} you with a quick sigh. \"I should have wailed, but I didn't want to hear you screaming at me.\"","    *goto scene01_dream1_doprevealcho","","*else","    $!{pc_eye_color} eyes the same exact shade as your own fix on you with faint mirth brimming in them. ","    ","    The minimal static cling from the hood didn't disturb ${pc_his} ${pc_hair_color} hair that's styled in a ${pc_hair_style}. $!{pc_he} even @{mc_plural have|has} the same nose shape and jawline, though unlike you, ${pc_he} ${is} smiling like there is humor to be found in being confronted with a near mirror image of yourself. There's something very slightly drawn to ${pc_his} features; it's a subtle strain that comes from enduring stress.","","    \"What the\u2014?\"","","    \"I know; that sounded better in my head,\" ${pc_he} @{mc_plural interrupt|interrupts} you with a quick sigh. \"I should have wailed, but I didn't want to hear you screaming at me.\"","    *goto scene01_dream1_doprevealcho","","*label scene01_dream1_dopdescf1","","*if (pc_hair_style = \"shaved\")","    $!{pc_he} carefully @{mc_plural pull|pulls} back the velvety cloth to reveal a face you have seen many times in your daily life; it's yours. ","    ","    $!{pc_eye_color} eyes meet your own in patient assessment similar to how you sometimes size people up before interacting with them. It's subtle, but there. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though ${pc_his} lips thin into an unreadable expression before a soft sigh falls from them at your reaction. There is something very slightly drawn to ${pc_his} features; an unspoken strain that comes from enduring stress.","    *goto scene01_dream1_doprevealcho","","*else","    $!{pc_he} carefully @{mc_plural pull|pulls} back the velvety cloth to reveal a face you have seen many times in your daily life; it's yours. ","    ","    $!{pc_eye_color} eyes meet your own in patient assessment similar to how you sometimes size people up before interacting with them. It's subtle, but there. The faint static cling from the hood didn't disturb ${pc_his} ${pc_hair_color} hair that's styled in a ${pc_hair_style}. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though ${pc_his} lips thin into an unreadable expression before a soft sigh falls from them at your reaction.","","    There's something very slightly drawn to ${pc_his} features; an unspoken strain that comes from enduring stress.","    *goto scene01_dream1_doprevealcho","","*label scene01_dream1_dopdesca1","","*if (pc_hair_style = \"shaved\")","    $!{pc_eye_color} eyes the same exact shade as your own impassively watch you put two and two together. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though ${pc_his} lips remain in an unreadable line that suggest this revelation isn't fazing ${pc_him} at all. There's something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress.","    *goto scene01_dream1_doprevealcho","","*else","    $!{pc_eye_color} eyes the same exact shade as your own impassively watch you put two and two together. The faint static cling from the hood didn't disturb ${pc_his} ${pc_hair_color} hair that's styled in a ${pc_hair_style}. $!{pc_he} even @{mc_plural have|has} the same nose shape and jawline, though ${pc_his} lips remain in an unreadable line that suggest this revelation isn't fazing ${pc_him} at all. There's something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress.","    *goto scene01_dream1_doprevealcho","","*label scene01_dream1_dopdescn1","","*if (pc_hair_style = \"shaved\")    ","    Now, you understand why ${pc_he} @{mc_plural were|was} hesitating with the hood. ","    ","    $!{pc_eye_color} eyes the same exact shade as your own look back at you with faint curiosity. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though a small frown downturns ${pc_his} lips the longer you stare at the near mirror image of yourself. There's something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress.","","    \"Surprise? I guess\u2026\"","","    You barely process the other you's murmured remark, preferring to listen to how your voice comes from the mouth of someone else.","    *goto scene01_dream1_doprevealcho","","*else    ","    Now, you understand why ${pc_he} @{mc_plural were|was} hesitating with the hood. ","    ","    $!{pc_eye_color} eyes the same exact shade as your own look back at you with faint curiosity. The minimal static cling from the hood didn't disturb ${pc_his} ${pc_hair_color} hair that's styled in a ${pc_hair_style}. $!{pc_he} @{mc_plural have|has} the same nose shape and jawline, though a small frown downturns ${pc_his} lips the longer you stare at the near mirror image of yourself. There's something very slightly drawn to ${pc_his} features; a subtle strain that comes from enduring stress.","","    \"Surprise? I guess\u2026\"","","    You barely process the other you's murmured remark, preferring to listen to how your voice comes from the mouth of someone else.","    *goto scene01_dream1_doprevealcho","","*label scene01_dream1_doprevealcho","","*choice","    *if ((((pc_hair_style = \"very short length\") or (pc_hair_style = \"short length\")) or (pc_hair_style = \"medium length\")) or (pc_hair_style = \"long length\")) #Scrutinize ${pc_him} and ${pc_his} style. \"Does my hair really look that way from behind\u2026?\"","        *set doppel_friendship -1","        *goto scene01_dream1_doprevealhair","    #Be irreverent. \"Ha, you ran out of ideas for these nightmares and had to use my own face.\"","        *set doppel_friendship -1","        *goto scene01_dream1_doprevealfuel","    #Remain open-minded. \"Uh, well, this isn't the scariest nightmare I've experienced\u2026\"","        *set doppel_friendship +2","        *goto scene01_dream1_doprevealop","    #Freak out and attempt to leave. \"Stay back!\"","        *goto scene01_dream1_doprevealfre","    #Realize that this can't possibly be real. \"I'm dreaming, aren't I? Another nightmare.\"","        *set doppel_friendship +1","        *goto scene01_dream1_doprevealmare","    #Throw the walkie talkie at ${pc_him}, aiming for ${pc_his} head. \"Imposter!\"","        *set doppel_friendship -2","        *goto scene01_dream1_doprevealwalk","    #Glare at your freaky double. \"I don't trust you. You're nothing but a nightmare.\"","        *set doppel_friendship -2","        *goto scene01_dream1_doprevealmare2","    #Be too shocked to say anything; you simply stare.","        *set doppel_friendship +1","        *goto scene01_dream1_doprevealshock","    #Tip your head back and stare at the ceiling with a weary sigh. \"I'd like to wake up now, please\u2026\" ","        *set doppel_friendship +1","        *goto scene01_dream1_doprevealwake","*page_break ","","*label scene01_dream1_doprevealhair","","Overriding any fear or unease about your copy prompts you to scrutinize ${pc_him} for any flaws or differences that might make this less jarring. $!{pc_he} @{mc_plural have|has} to be a fake or a knock off at best. Your continued staring only earns a puzzled look from your unwanted passenger.","","\"Does my hair really look that way from behind\u2026?\"","","\"What?\" $!{pc_he} @{mc_plural phrase|phrases} the question as a deadpan statement. \"You're focusing on aesthetics?\"","","\"No, I'm focusing on how you're a fraud,\" you reply with a touch of annoyance when ${pc_he} @{mc_plural scoot|scoots} back in the seat so ${pc_his} head is flush against the headrest, which hampers your inspection. A plush velvet robe isn't a part of your wardrobe, and it likely never will be. The cloth appears weighty and soft with a ceremonial reverence to it that's reflected in a few ornamental closures. \"Is that what you wear to sleep\u2026?\"","","\"We don't have time for this\u2014whatever sort of shock you're in to be preoccupied by fashion.\"","","You don't deliver your next critical observation about ${pc_his} shoes when you see the hilt of a familiar dagger peek out from the folds of the robe.","","It may be safer to listen\u2026","*set dagger_seen \"true\"","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_doprevealfuel","","You've experienced far worse.","","Reliving the house fire that stole your parents' lives and being buried under layers of ash in the ruins of your childhood home will outweigh the scare factor of a cheap knock off. It's only a mimicry. Rolling your eyes at ${pc_him} receives a vaguely confused look in return.","","\"Ha, you ran out of ideas for these nightmares and had to use my own face,\" you snipe, adopting an irreverent slant to your words as you lightly tap your cheek. $!{pc_he} closely @{mc_plural follow|follows} the action, which makes you irrationally want to prod at ${pc_him} to see how real ${pc_he} ${is} or if ${pc_he} would dissolve away into fine wisps of smoke. \"That's not very creative.\"","","\"This isn't a nightmare\u2026\" ","","You pointedly indicate ${pc_him} with your index finger, practically jabbing ${pc_his} side of the car. \"Sure it isn't,\" you sarcastically retort, though your wit is sharper than usual from the stress and suspense of the last few minutes. \"I always hope for sweet dreams about being startled by a clone of myself. Thanks so much.\"","","\"We don't have time for snappy jokes,\" ${pc_he} @{mc_plural assert|asserts}. \"Listen or don't.\"","","The only reason you don't immediately quip back to defy this uncanny imposter is because ${pc_his} tone lost its earlier tentative edge. You only notice the change now due to the absence. The way ${pc_he} said 'nightmare' was somber, if not resigned, but why\u2026?","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_doprevealop","","Trying to keep an open mind would be easier if your own face wasn't staring back at you.","","But ${pc_he} @{mc_plural don't|doesn't} seem aggressive now, sitting in the passenger seat with ${pc_his} robe neatly arranged in plush folds that ${pc_he} sometimes @{mc_plural pick|picks} at. $!{pc_his} body language isn't intimidating either. Past nightmares typically start out bad and only end up getting worse.","","\"Uh, well, this isn't the scariest nightmare I've experienced\u2026\"","","You just barely finish your statement when ${pc_his} expression seems to harden. Tension ever so slightly narrows ${pc_his} eyes while ${pc_his} lips become an intractable line. It's the start of an unreadable mask that is still technically polite. Do you sometimes do that too, or is it something ${pc_he} learned?","","\"That's because this isn't a nightmare.\" The ${pc_man} taps against the glass once to indicate the road leading out of Fernweh. \"You aren't as passive in this as you may think.\"","","The way ${pc_he} said 'nightmare' was somber, if not resigned, but why\u2026?","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_doprevealfre","","A haggard mine worker who was overworked to death or the lost soul of a reckless camper would be ten times better than this outcome.","","It's too personal\u2026","","$!{pc_he} ${is} watching you with your own eyes and speaking with a voice that has always been yours. Your initial shock gives way to  alarm the longer you search for any flaws or inconsistencies in the ${pc_man} sitting right next to you and fail to find a single one. It could just as easily be you in that seat, which is a concept your mind instantly and firmly rejects.","","There's only one you.","*page_break","","*if (primary_skill = \"empathetic impressions\")","    \"St\u2014!\"","","    \"You're rightfully scared.\"","","    You don't get the chance to shout a warning at ${pc_him} because ${pc_he} @{mc_plural speak|speaks} over you in a measured tone. It's unwaveringly calm. Your hand had already found the door latch, but you hesitate against your better judgment because ${pc_he} said 'rightfully' scared. Why would someone trying to terrorize or scare you validate your feelings?","","    \"This doesn't have to be scary,\" ${pc_he} @{mc_plural continue|continues} speaking, briefly presenting ${pc_his} empty hands to you to inspire confidence. \"The face thing is just how it is, but we can talk about the rest\u2026\"","","    Your nerves have weakened your voice, so you simply nod, keeping your hand near the door.","    *page_break","    *goto scene01_dream1_dopname","","*else","    \"Stay away!\"","","    \"I\u2014\"","","    The rest of whatever lies or excuses ${pc_he} @{mc_plural have|has} concocted is cut off by the sound of plastic slapping against metal. You roughly pull at the door latch, nearly breaking it in your eagerness to get out of the car. Each time you pull, the ${pc_man} engages the locks with an uncanny precision that adds stabilizing anger to your fear. It's a war of attrition that you're destined to lose with each stupid click of that button. \"Stop doing that!\"","","    \"We don't have time for you to run away.\"","","    $!{pc_he} @{mc_plural sound|sounds} a little bored when making the statement, but it's still a firm statement that you are going to stay put.","    *page_break","    *goto scene01_dream1_dopname","","*label scene01_dream1_doprevealmare","","Your concentration meanders away from the copy of yourself despite the shocking revelation contained beneath ${pc_his} hood.","","This entire sequence of events has been off from the start, which is a sobering feeling when you thought they were real at times. Aimlessly standing outside of the Fernweh Diner with no solid idea about why you were there should have been the first clue. Then there was that black, sap-like ink excreting from the paper to stir up fears from that night in the sunken clearing. It's also been too quiet with no one else present on the roads or around town.","","Well, no one except for who sits beside you\u2026","","$!{pc_he} unflinchingly @{mc_plural return|returns} your look when you angle your head to face ${pc_him} again after the brief quiet. \"I'm dreaming, aren't I? Another nightmare.\" At least this one isn't blatantly playing on past trauma.","","\"No, this isn't a nightmare\u2026 I'm not like that.\" ","","\"I wouldn't call it a dream,\" you reply quickly with a hint of disbelief at the certainty behind ${pc_his} words. \"You weren't startled like me.\"","","The ${pc_man} doesn't respond to your call out, but ${pc_his} expression grows more reserved, curiosity about you tucked away.","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_doprevealwalk","","*if (primary_skill = \"retrocognition\")","    A confrontation with a creepy copy of yourself isn't what you anticipated, but the suspense of the last few minutes has unraveled along with any of your nerves or fears about how to act. Staring at ${pc_him} in shock won't help anything. You need to retake control of your car and force out this unwanted passenger.","","    \"I wouldn't do that\u2026\"","","    $!{pc_he} casually @{mc_plural offer|offers} the warning before your pinkie finger has even had a chance to graze the walkie talkie in the cup holder. That's weird. $!{pc_his} pointed look at your would-be-projectile doesn't sway you from snatching it up and throwing it at ${pc_his} head. There isn't a satisfying smack of plastic against ${pc_his} uncannily similar face; instead, ${pc_he} @{mc_plural catch|catches} it with ease before calmly setting it down.","","    The walkie talkie being placed back within your reach subtly irritates you; it's an insult that this ${pc_man} can be so collected around you.","","    @{mc_plural $!{pc_he}'re|$!{pc_he}'s} an imposter.","","    \"Save that fight for an actual nightmare,\" ${pc_he} @{mc_plural advise|advises}. \"Listen to me or don't, but I wouldn't try that again\u2026\"","    *page_break","    *goto scene01_dream1_dopname","","*else","    A confrontation with a creepy copy of yourself isn't what you anticipated, but the suspense of the last few minutes has unraveled along with any of your nerves or fears about how to act. Staring at ${pc_him} in shock won't help anything. You need to retake control of your car and force out this unwanted passenger.","","    $!{pc_he} @{mc_plural fix|fixes} you with a faintly apprehensive look as if recognizing or sensing that something is about to happen. A knock off clone could have studied your facial expressions to better impersonate and supplant you; it's best not to think about that. Distracting ${pc_him} by blaring the car horn gives you an opening to snatch up the walkie talkie like a baseball, except ${pc_he} @{mc_plural react|reacts} by pulling out a familiar dagger within seconds. \"Impo\u2014Wait, wait stop!\"","","    You have a mostly plastic device raised overhead, while ${pc_he} @{mc_plural have|has} a wicked blade aligned with your chest. ","","    The ${pc_man} puts it away as quickly as ${pc_he} whipped it out, stowing it with an ease that suggests ${pc_his} reaction was reflexive.","","    \"Damn it, don't do that again,\" ${pc_he} @{mc_plural snap|snaps} before exhaling lowly and looking out the window. \"We don't have time to kill each other. It's your choice to listen to what I have to say or not.\"","","    Your earlier bravery starts to fade when faced with potential harm, though the way ${pc_his} tone sounded more alarmed than angry sticks out.","    *set dagger_seen \"true\"","    *page_break","    *goto scene01_dream1_dopname","","*label scene01_dream1_doprevealmare2","","Today's events have only been the twisted conjurings of your subconscious mind with this freaky double meant to be the sick finale.","","There was a reason you couldn't pinpoint exactly why you were outside of the diner, then there was the weeks old newspaper article that secreted a sticky black substance. It's all been building up to this point. You openly glare at the '${pc_man}' who sits in the passenger seat; ${pc_he} ${is} a monster wearing your face. \"I don't trust you. You're nothing but a nightmare.\"","","$!{pc_his} expression grows more reserved after your harsh words, but ${pc_he} @{mc_plural meet|meets} your glare head on.","","\"If the most horrifying part of your 'nightmares' is whether or not you run over little Bambi, then we should trade\u2026 But you and I need to talk.\"","","A refusal is on the tip of your tongue until you see the handle of a familiar dagger peeking out from ${pc_his} robe; it might be best to listen now.","*set dagger_seen \"true\"","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_doprevealshock","","Maybe dealing with a wayward hitchhiking ghost would have been a better alternative\u2026","","It's hard for you to accept what or who is sitting on the other side of the center console, speaking to you in a voice that you would never normally hear\u2026 Or at least it's different when you use your voice versus being spoken to with it. Searching for flaws or inconsistencies injects more shock into your system when not a single, key difference is found between you two.","","No, that's not true.","","The more you stare at ${pc_him}, you do notice tiny things; ${pc_he} @{mc_plural appear|appears} guarded, but it's hard to have a reference point for yourself.","","\"We do need to talk\u2026 eventually.\"","","$!{pc_his} tone is measured in a way that doesn't give too much away, but it's the carefully chosen volume of it that stands out. Your nerves quell ever so slightly because why would someone trying to scare or hurt you choose to soften ${pc_his} delivery? Maybe it's a trap or something else entirely. You stay silent and listen, but always keep ${pc_him} in sight.","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_doprevealwake","","This is too much.","","Fernweh being ominously empty of its citizens, the sap-inspired ink, and the baby deer fiasco were already enough, but now you have a copy. $!{pc_he} ${is} sitting right there, watching you with your eyes and addressing you with your own voice. You tip your head further into the headrest to ignore ${pc_his} attention; it's easier to stare at the drab ceiling of the car.","","\"What are you doing?\"","","Right now, you're counting the barely noticeable screws and fastenings on the roof, though a weary sigh escapes you when the ${pc_man} remains nearby. Why can't ${pc_he} crumble into ash or dissolve into wisps of smoke? \"I'd like to wake up now, please.\" Your intoned request doesn't change anything.","","\"This isn't a nightmare, but that isn't how they work,\" ${pc_he} @{mc_plural remark|remarks} with a hint of sympathy. \"Try to listen to me.\"","","You reluctantly pull your head away from its soft perch, choosing to hold ${pc_his} gaze.","*page_break","*goto scene01_dream1_dopname","","*label scene01_dream1_dopname","","*if (((merciful >= 67) or (sincerity >= 67)) and ((pc_nickname = \"true\") and (dagger_seen = \"true\")))","    \"This might be easier on you once we settle our name,\" the ${pc_man} supposes, fixing you with a thoughtful look. \"I'd be willing to keep $!{name}, if you prefer $!{nickname}?\"","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} the dagger to set it on top of the dashboard. The tip of the blade is purposefully directed away from your side of the car, wickedly sharp metal meets glass as it's tucked closer to the windshield to appear less threatening. It is still within ${pc_his} reach, but @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed. \"Uhm.\"","","    Nothing follows your faint sound of uncertainty since ${pc_his} offer catches you off guard.","","    \"It's too familiar, isn't it?\" $!{pc_he} @{mc_plural deduce|deduces}. \"You're used to hearing both from different people. Pick something or I will, but names are the least of your worries\u2026\"","    *goto scene01_dream1_dopnamecho","","*elseif (((merciful >= 67) or (sincerity >= 67)) and (pc_nickname = \"true\"))","    \"This might be easier on you once we settle our name,\" the ${pc_man} supposes, fixing you with a thoughtful look. \"I'd be willing to keep $!{name}, if you prefer $!{nickname}?\"","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} a familiar dagger to set it on top of the dashboard. The tip of the blade is purposefully directed away from your side of the car, wickedly sharp metal meets glass as it's tucked closer to the windshield to appear less threatening. It is still within ${pc_his} reach, but @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed. \"Uhm.\"","","    Nothing follows your faint sound of uncertainty since ${pc_his} offer catches you off guard.","","    \"It's too familiar, isn't it?\" $!{pc_he} @{mc_plural deduce|deduces}. \"You're used to hearing both from different people. Pick something or I will, but names are the least of your worries\u2026\"","    *goto scene01_dream1_dopnamecho","","*elseif (((merciful >= 67) or (sincerity >= 67)) and (dagger_seen = \"true\"))","    \"This might be easier on you once we settle the issue of our name,\" the ${pc_man} supposes, fixing you with a thoughtful look that turns a touch reluctant. \"I guess you can keep it\u2026\"","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} the dagger to set it on top of the dashboard. The tip of the blade is purposefully directed away from your side of the car, wickedly sharp metal meets glass as it's tucked closer to the windshield to appear less threatening. It is still within ${pc_his} reach, but @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed. \"Uhm.\"","","    Nothing follows your faint sound of uncertainty since ${pc_his} remark catches you off guard.","","    \"Pick something or I will, but names are the least of your worries\u2026\" ","    *goto scene01_dream1_dopnamecho","","*elseif ((merciful >= 67) or (sincerity >= 67))","    \"This might be easier on you once we settle the issue of our name,\" the ${pc_man} supposes, fixing you with a thoughtful look that turns a touch reluctant. \"I guess you can keep it\u2026\"","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} a familiar dagger to set it on top of the dashboard. The tip of the blade is purposefully directed away from your side of the car, wickedly sharp metal meets glass as it's tucked closer to the windshield to appear less threatening. It is still within ${pc_his} reach, but @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed. \"Uhm.\"","","    Nothing follows your faint sound of uncertainty since ${pc_his} remark catches you off guard.","","    \"Pick something or I will, but names are the least of your worries\u2026\" ","    *goto scene01_dream1_dopnamecho","","*elseif ((sincerity <= 33) and (dagger_seen = \"true\"))","    \"This name thing sucks,\" the ${pc_man} notes with a hint of exasperation that isn't entirely directed at you. \"My vote would be for $!{name}-y or Better $!{name}, but those will just add to your confusion or eventually get on my nerves with us sharing it. We need to decide.\" ","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} the dagger before briefly using the crystal inset in its pommel to tap against the window. It's a tune you faintly recognize from one of your favorite television shows; ${is} ${pc_he} thinking or simply being irritating? $!{pc_his} fiddling stops when the tip of the dagger is tucked into the slim space next to the passenger seat like a stowed umbrella instead of a weapon. It is still within ${pc_his} reach, but @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed.","","    \"Any useful thoughts? Or are you rendered speechless in the face of your own beauty?\"","","    \"Smartass,\" you automatically counter ${pc_his} snarkiness despite the bizarre situation. \"Egomaniac, Cloney, Dup\u2014\"","","    \"Okay, okay, pick one, and let's move forward.\"","    *goto scene01_dream1_dopnamecho","","*elseif (sincerity <= 33)","    \"This name thing sucks,\" the ${pc_man} notes with a hint of exasperation that isn't entirely directed at you. \"My vote would be for $!{name}-y or Better $!{name}, but those will just add to your confusion or eventually get on my nerves with us sharing it. We need to decide.\" ","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} a familiar dagger before briefly using the crystal inset in its pommel to tap against the window. It's a tune you faintly recognize from one of your favorite television shows; ${is} ${pc_he} thinking or simply being irritating? $!{pc_his} fiddling stops when the tip of the dagger is tucked into the slim space next to the passenger seat like a stowed umbrella instead of a weapon. It is still within ${pc_his} reach, but @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed.","","    \"Any useful thoughts? Or are you rendered speechless in the face of your own beauty?\"","","    \"Smartass,\" you automatically counter ${pc_his} snarkiness despite the bizarre situation. \"Egomaniac, Cloney, Dup\u2014\"","","    \"Okay, okay, pick one, and let's move forward.\"","    *goto scene01_dream1_dopnamecho","","*elseif ((friendly >= 67) and (dagger_seen = \"true\"))","    \"Proper introductions will make this a little more normal,\" the ${pc_man} decides, fixing you with a schooled expression of attentive politeness that only wavers briefly when ${pc_he} @{mc_plural unholster|unholsters} the dagger. \"I really should've done this first.\"","","    You watch as the wickedly sharp blade is purposefully placed on the floorboard of your car so it is mostly out of reach. It's a gesture of goodwill; @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed now. \"Thanks\u2026\" If your gratitude is entirely reflexive or genuine is debatable, but you still offer it.","","    \"Sure, no problem,\" ${pc_he} @{mc_plural reply|replies} with a fleeting smile that only minimally eases the awkward tension. \"Us sharing the name '$!{name}' will get confusing, and I know you probably think you're more attached to it, so pick one for me or I can\u2026\"","    *goto scene01_dream1_dopnamecho","","*elseif (friendly >= 67)","    \"Proper introductions will make this a little more normal,\" the ${pc_man} decides, fixing you with a schooled expression of attentive politeness that only wavers briefly when ${pc_he} @{mc_plural unholster|unholsters} a familiar dagger. \"I really should've done this first.\"","","    You watch as the wickedly sharp blade is purposefully placed on the floorboard of your car so it is mostly out of reach. It's a gesture of goodwill; @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed now. \"Thanks\u2026\" If your gratitude is entirely reflexive or genuine is debatable, but you still offer it.","","    \"Sure, no problem,\" ${pc_he} @{mc_plural reply|replies} with a fleeting smile that only minimally eases the awkward tension. \"Us sharing the name '$!{name}' will get confusing, and I know you probably think you're more attached to it, so pick one for me or I can\u2026\"","    *goto scene01_dream1_dopnamecho","","*elseif ((friendly <= 33) and (dagger_seen = \"true\"))","    \"Our name,\" the ${pc_man} chooses to bring up the topic directly while unholstering the dagger to set it aside. \"It's going to be a point of confusion, possibly contention, so let's fix it.\"","","    You closely track the movement of the wickedly sharp blade as it's stowed in one of the open compartments of the passenger door. It is still within ${pc_his} reach, but ${pc_he} didn't have to disarm ${pc_him}self, which means this was likely an understated show of goodwill about ${pc_his} threat level. Remaining silent is tempting, but @{mc_plural ${pc_he}'re|${pc_he}'s} waiting for some sort of acknowledgment of the idea. \"What do you mean by 'our' name\u2026?\"","","    \"Sharing the same name isn't something I'm comfortable with given the circumstances,\" ${pc_he} curtly @{mc_plural answer|answers}, though ${pc_his} slight frown isn't directed at you. \"It feels like a charade when there should only be one. Pick something for me or I will.\"","    *goto scene01_dream1_dopnamecho","","*elseif (friendly <= 33)","    \"Our name,\" the ${pc_man} chooses to bring up the topic directly while unholstering a familiar dagger to set it aside. \"It's going to be a point of confusion, possibly contention, so let's fix it.\"","","    You closely track the movement of the wickedly sharp blade as it's stowed in one of the open compartments of the passenger door. It is still within ${pc_his} reach, but ${pc_he} didn't have to disarm ${pc_him}self, which means this was likely an understated show of goodwill about ${pc_his} threat level. Remaining silent is tempting, but @{mc_plural ${pc_he}'re|${pc_he}'s} waiting for some sort of acknowledgment of the idea. \"What do you mean by 'our' name\u2026?\"","","    \"Sharing the same name isn't something I'm comfortable with given the circumstances,\" ${pc_he} curtly @{mc_plural answer|answers}, though ${pc_his} slight frown isn't directed at you. \"It feels like a charade when there should only be one. Pick something for me or I will.\"","    *goto scene01_dream1_dopnamecho","","*elseif (dagger_seen = \"true\")","    \"We need to get names out of the way before this gets anymore confusing for you,\" ${pc_he} @{mc_plural conclude|concludes} after casting an assessing look in your direction that's mostly neutral. \"Introductions may help.\"","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} the dagger, though ${pc_he} @{mc_plural seem|seems} hesitant about what to do with it. The polished, silver blade shines faintly in the sunlight pouring into the car; it appears wickedly sharp. $!{pc_he} must come to a decision because the weapon is tucked into the space between the center console and ${pc_his} seat. Now, @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed, but it's still nearby.","","    Was that a gesture of goodwill or a warning?","","    \"Us sharing '$!{name}' doesn't feel right,\" ${pc_he} @{mc_plural admit|admits} with a subtle frown. \"Pick something else for me or I will\u2026\"","    *goto scene01_dream1_dopnamecho","","*else","    \"We need to get names out of the way before this gets anymore confusing for you,\" ${pc_he} @{mc_plural conclude|concludes} after casting an assessing look in your direction that's mostly neutral. \"Introductions may help.\"","","    You watch as ${pc_he} @{mc_plural unholster|unholsters} a familiar dagger, though ${pc_he} @{mc_plural seem|seems} hesitant about what to do with it. The polished, silver blade shines faintly in the sunlight pouring into the car; it appears wickedly sharp. $!{pc_he} must come to a decision because the weapon is tucked into the space between the center console and ${pc_his} seat. Now, @{mc_plural ${pc_he}'re|${pc_he}'s} technically unarmed, but it's still nearby.","","    Was that a gesture of goodwill or a warning?","","    \"Us sharing '$!{name}' doesn't feel right,\" ${pc_he} @{mc_plural admit|admits} with a subtle frown. \"Pick something else for me or I will\u2026\"","    *goto scene01_dream1_dopnamecho","","*label scene01_dream1_dopnamecho","","You consider what name to give your double\u2026.","","*choice ","    *if (gender = \"male\") #Narcissus","        *set doppel \"narcissus\"","        *goto scene01_dream1_dopnamenar","    *if (gender = \"female\") #Narcissa","        *set doppel \"narcissa\"","        *goto scene01_dream1_dopnamenar","    *if (gender = \"non-binary\") #Narcissium","        *set doppel \"narcissium\"","        *goto scene01_dream1_dopnamenar","    #Bizarro","        *set doppel \"bizarro\"","        *goto scene01_dream1_dopnamebiz","    #Doppel","        *set doppel \"doppel\"","        *goto scene01_dream1_dopnamedop","    *if (gender = \"female\") #Elizabeth","        *set doppel \"elizabeth\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"female\") #Josette","        *set doppel \"josette\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"female\") #Tia","        *set doppel \"tia\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"female\") #Tamara","        *set doppel \"tamara\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"female\") #Mary Kate","        *set doppel \"mary kate\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"female\") #Ashley","        *set doppel \"ashley\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"male\") #Remus","        *set doppel \"remus\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"male\") #Romulus","        *set doppel \"romulus\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"male\") #Zack","        *set doppel \"zack\"","        *goto scene01_dream1_dopnamebor","    *if ((gender = \"male\") or (gender = \"non-binary\")) #Cody","        *set doppel \"cody\"","        *goto scene01_dream1_dopnamebor","    *if ((gender = \"male\") or (gender = \"non-binary\")) #Dylan","        *set doppel \"dylan\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"male\") #Cole","        *set doppel \"cole\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"non-binary\") #Ash","        *set doppel \"ash\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"non-binary\") #Blake","        *set doppel \"blake\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"non-binary\") #Koda","        *set doppel \"koda\"","        *goto scene01_dream1_dopnamebor","    *if (gender = \"non-binary\") #Spencer","        *set doppel \"spencer\"","        *goto scene01_dream1_dopnamebor","    #You have something more specific in mind.","        Please enter a name for your double.","        *input_text doppel","        *goto scene01_dream1_dopnamebor","    #Refuse to name ${pc_him}. \"You don't deserve one.\"","        *set doppel \"doppel\"","        *set doppel_friendship -2","        *set doppel_grudge +1","        *goto scene01_dream1_dopnameref","*page_break","","*label scene01_dream1_dopnamenar","","\"$!{doppel} seems fitting,\" you proudly confer the name, pleased at your own wit before seeking out ${pc_his} reaction to it. \"Right?\"","","\"Insulting me is the same as a self-inflicted burn, but whatever. That suits you,\" $!{doppel} blankly replies with a false smile that dissolves away when you continue to stare at ${pc_him} rather than back down. The stare off lasts for a while until the wind displacing raindrops from the surrounding tree distracts you both; it's a faint pattering of water against sheet metal. $!{pc_he} @{mc_plural look|looks} back at you. \"Maybe we do have narcissistic tendencies\u2026\"","","\"No, I don't,\" you immediately disagree. \"This is about you, not me.\" ","","$!{doppel} shoots you an unconvinced look, but says nothing more about your targeted choice.","*page_break","*goto scene01_dream1_doptemp","","*label scene01_dream1_dopnamebiz","","*if ((past_crush = \"jr\") or (past_crush = \"james\"))","    \"$!{doppel} works,\" you confer the name with a hint of amusement at the comic book reference to Superman's imperfect duplicate. A clone that should never have existed in the first place that went on to wreak havoc. \"It's actually perfect.\"","","    Anticipating ${pc_his} negative reaction turns into you being thrown by the very faint smile on the newly named $!{doppel}'s face. It's almost wistful. Your pointed choice was closer to an insult or an inside joke than a compliment; maybe ${pc_he} failed to understand the meaning. \"He's a character from\u2014\"","","    \"$!{james} would be proud of the usage, just not the application,\" ${pc_he} @{mc_plural interrupt|interrupts} your explanation. \"But you should know that Bizarro wasn't always evil, depending on the age and verse. It's ironic that you think I'm the duplicate here\u2026\"","","    \"What else would you be?\"","","    $!{pc_he} @{mc_plural disregard|disregards} your question, and the brittle smile on ${pc_his} face smooths away within seconds. ","    *page_break","    *goto scene01_dream1_doptemp","","*elseif (tentative_ro_pick = \"beckett\")","    \"$!{doppel} works,\" you confer the name with a hint of amusement at the comic book reference to Superman's imperfect duplicate. A clone that should never have existed in the first place that went on to wreak havoc. \"It's actually perfect.\"","","    \"Did the outsider help inspire your choice? Your little sidekick.\"","","    Anticipating or hoping for a negative reaction to your name pick turns into you growing uncertain about how ${pc_he} ${is} aware of $!{beckett}'s interest in superheroes. You rest your hand on the center console, fingers edging closer to $!{doppel}'s side in an understood warning. Protectiveness over $!{beckett} is clashing with the fact that this version of you has access to a weapon.","","    \"Leave ${b_him} out of this,\" you tersely reply. \"$!{b_she} has been through enough\u2026\"","","    $!{pc_he} @{mc_plural say|says} nothing more on the subject, but $!{pc_he} @{mc_plural do|does} subtly shake ${pc_his} head in what may be disappointment.","    *page_break","    *goto scene01_dream1_doptemp","","*else","    \"$!{doppel} works,\" you confer the name with a hint of amusement at the reference to Superman's imperfect duplicate. A clone that should never have existed in the first place that went on to wreak havoc. \"It's actually perfect.\"","","    \"Calling me 'bizarre' indirectly insults yourself.\"","","    You had anticipated a more satisfying reaction to your pointed name choice, but ${pc_he} may be taking it too literally or playing dumb on purpose. If this really is a version of yourself, then ${pc_he} should know the comic lore. \"No, that's not\u2014He's a character who\u2014\"","","    \"It doesn't matter,\" $!{doppel} curtly cuts off your explanation. \"If thinking you're the original helps you listen better, then that's fine.\"","","    $!{pc_his} comment means ${pc_he} @{mc_plural do|does} understand why you picked that.","    *page_break","    *goto scene01_dream1_doptemp","","*label scene01_dream1_dopnamedop","","*if (believer >= 60)","    \"$!{doppel},\" you confer the name selection after a moment of thought, considering past things you have read or heard in passing. Its meaning seems startlingly perfect for this encounter because this ${pc_man} is your exact double. Noticing the overlapping details isn't hard when you're open-minded enough to believe in the unexplainable. \"It works\u2026\"","","    The way ${pc_he} @{mc_plural sit|sits} in the passenger seat doesn't mimic your own posture, but matches it. Your tones of voice and cadence could be interchangeable. There might be subtle reflections of your personality shining through too, which is why the myth of the 'doppelganger' gives you some certainty.","","    It's still unnatural, but more approachable now.","    *page_break","","    $!{doppel}'s continued silence hasn't gotten past you either, which makes you realize that ${pc_he} might know the same stories as you.","","    Those stories tend to be horror related\u2026","","    \"I'm not your evil twin,\" ${pc_he} @{mc_plural state|states} this flatly in an intentionally controlled tone of voice despite the fact that ${pc_his} hands clench tightly. Any offense is kept from ${pc_his} face. \"The harbinger of bad luck interpretation of the myth is debatable given our track record. Let's get one thing clear: you will never be the original, '$!{name}'.\"","","    There's a steely certainty to ${pc_his} gaze that makes you rethink countering that statement. Among all the similarities are tiny yet stark differences; ${pc_he} @{mc_plural have|has} been tempered, if not hardened, by something. If you meant what you said as an insult or not doesn't matter because $!{doppel} is done with the topic. Only now do you realize your spine is pressed flush against the seat to stay back.","    *page_break","    *goto scene01_dream1_doptemp","","*else","    \"$!{doppel} works,\" you decide on the name after recalling a movie where the main character had a double of herself working for the other faction. It might have been an action series with zombies, but the 'doppelganger' part is most relevant. \"You're like a clone\u2026?\"","","    \"Is that why you picked it? Because there are two of us,\" $!{pc_he} quizzically @{mc_plural verify|verifies} your reasoning behind the selection before subtly shaking ${pc_his} head. \"Usually a 'double walker' would be taken as an insult; it can mean an evil twin or a harbinger of bad luck, which\u2026 I'm not really either of those.\"","","    You decide not to confirm if what you said was meant as an insult when the dagger is close by.","","    \"At least you picked the 'double' part of the term,\" $!{doppel} mutters. \"I guess it's fine.\"","    *page_break","    *goto scene01_dream1_doptemp","","*label scene01_dream1_dopnamebor","","\"$!{doppel}\u2026?\"","","You confer the name after a moment of thought about what to call this ${pc_man} who is your perfect double. There's overlap between how you sit, the cadence to your voice, and other details alongside minor differences like how ${pc_he} occasionally @{mc_plural survey|surveys} the immediate surroundings. $!{pc_he} would probably get annoyed if you used the term 'twinsies' to describe things, but that crossed your mind.","","\"$!{doppel},\" ${pc_he} hesitantly @{mc_plural test|tests} your choice, nodding slightly after hearing it echoed back. \"It'll work just fine.\" ","","$!{pc_his} faint reluctance is something you don't dare bring up due to the lingering tension.","*page_break","*goto scene01_dream1_doptemp","","*label scene01_dream1_dopnameref","","This thing wants a name\u2026? That's ridiculous.","","A tense silence alongside a judgmental stare serves as your supposed 'naming suggestion', but ${pc_he} simply @{mc_plural stare|stares} right back, expression slowly emptying of emotion while yours becomes more harsh. It makes sense that a creep who laid in wait on the road to startle you would be patient. Your aggravation increases at ${pc_his} expectancy.","","\"You don't deserve one,\" you snap out the conclusion that sounds too loud in the quiet car. \"Why would you ever think that you do?\"","","\"Why do you think you deserve mine?\" $!{pc_he} @{mc_plural pose|poses} ${pc_his} own question in a controlled tone of voice despite the fact ${pc_his} hands clenched. Only a glance is spared to the dagger before you receive the full brunt of ${pc_his} exacting focus. \"Borrowing is all you're doing, '$!{name}', and I let you out of misplaced sympathy\u2026\"","","You balk at ${pc_him} attempting to act like the victim or injured party of this conversation.","","\"$!{doppel} will work for my placeholder name,\" ${pc_he} @{mc_plural decide|decides} with a hint of wry humor. \"You seem so determined to view me as evil. Let's see how that works out.\"","","There's both a calm threat and a promise embedded in ${pc_his} words that a part of you would like to challenge, but you spotted how ${pc_his} eyes strayed to the dagger.","","$!{pc_he} might not be as patient as you thought\u2026","*page_break","*goto scene01_dream1_doptemp","","*label scene01_dream1_doptemp","","*if (resistance >= 60)","    \"First, why do you have this on full blast?\"","","    Your eyebrows knit at $!{doppel}'s sudden question until ${pc_he} @{mc_plural gesture|gestures} at the heating and air controls of your car. The dial for the AC is cranked all the way up, little needle point in the iciest blue section of the color band. It doesn't feel unreasonably cool to you, but the whir of air coming out of the vents produces a faint roar as the air passes through the plastic dividers.","","    \"Because it's my car, so\u2026\"","","    You don't finish the rest of your honest reply, unsure why this matters to an uninvited guest.","","    $!{pc_he} @{mc_plural don't|doesn't} pay any mind to your remark, shifting forward to adjust the settings in a way that alludes to familiarity.","","    You'll have to endure the warmth that may pervade the car following ${pc_his} change.","    *page_break","    *goto scene01_dream1_dopcrush","","*elseif (resistance <= 40)","    \"First, why do you have this all the way up?\"","","    Your eyebrows knit at $!{doppel}'s sudden question until ${pc_he} @{mc_plural gesture|gestures} at the heating and air controls of your car. The dial for the heater is turned all the way, little needle point in the toastiest red section of the color band. It doesn't feel unreasonably hot to you, but the whir of air coming out of the vents produces a faint roar as the air passes through the plastic dividers.","","    \"Because it's my car, so\u2026\"","","    You don't finish the rest of your honest reply, unsure why this matters to an uninvited guest.","","    $!{pc_he} @{mc_plural don't|doesn't} pay any mind to your remark, shifting forward to adjust the settings in a way that alludes to familiarity.","","    You brace yourself for the slight chill that may seep into your bones after ${pc_his} change.","    *page_break","    *goto scene01_dream1_dopcrush","","*else","    \"I don't like it like this. It's a bit too warm for me.\"","","    Your eyebrows knit at $!{doppel}'s sudden comment until ${pc_he} @{mc_plural gesture|gestures} at the heating and air controls of your car. The dial for the AC is in the middle of the blue-red color range, practically not in use at all. It doesn't feel unreasonably hot or cold to you, but there's an absence of air whirring out of the vents to regulate the temperature.","","    \"It's my car, so\u2026\"","","    You don't finish the rest of your honest reply, unsure why this matters to an uninvited guest.","","    $!{pc_he} @{mc_plural don't|doesn't} pay any mind to your remark, shifting forward to adjust the settings in a way that alludes to familiarity.","","    You'll likely remain unbothered by ${pc_his} slight change that should awaken the AC.","    *page_break","    *goto scene01_dream1_dopcrush","","*label scene01_dream1_dopcrush","","*if ((past_crush = \"reese\") and (tentative_ro_pick = \"reese\"))","    *set doppel_crush \"match\"","    *goto scene01_dream1_dopcrushr","*elseif ((past_crush = \"reese\") and (tentative_ro_pick = \"jr\"))","    *set doppel_crush \"conflict\"","    *set doppel_heartbreak +1","    *goto scene01_dream1_dopcrushr","*elseif (past_crush = \"reese\")","    *set doppel_crush \"clash\"","    *set doppel_heartbreak +2","    *goto scene01_dream1_dopcrushr","*elseif ((past_crush = \"james\") and (tentative_ro_pick = \"james\"))","    *set doppel_crush \"match\"","    *goto scene01_dream1_dopcrushj","*elseif ((past_crush = \"james\") and (tentative_ro_pick = \"jr\"))","    *set doppel_crush \"conflict\"","    *set doppel_heartbreak +1","    *goto scene01_dream1_dopcrushj","*elseif (past_crush = \"james\")","    *set doppel_crush \"clash\"","    *set doppel_heartbreak +2","    *goto scene01_dream1_dopcrushj","*elseif ((past_crush = \"jr\") and (tentative_ro_pick = \"jr\"))","    *set doppel_crush \"match\"","    *goto scene01_dream1_dopcrushjr","*elseif ((past_crush = \"jr\") and (tentative_ro_pick = \"reese\"))","    *set doppel_crush \"broken\"","    *set doppel_heartbreak +3","    *goto scene01_dream1_dopcrushjr","*elseif ((past_crush = \"jr\") and (tentative_ro_pick = \"james\"))","    *set doppel_crush \"broken\"","    *set doppel_heartbreak +3","    *goto scene01_dream1_dopcrushjr","*elseif (past_crush = \"jr\")","    *set doppel_crush \"clash\"","    *set doppel_heartbreak +2","    *goto scene01_dream1_dopcrushjr","*elseif ((past_crush = \"silas\") and (tentative_ro_pick = \"silas\"))","    *set doppel_crush \"match\"","    *goto scene01_dream1_dopcrushs","*elseif (past_crush = \"silas\")","    *set doppel_crush \"clash\"","    *set doppel_heartbreak +2","    *goto scene01_dream1_dopcrushs","*elseif (past_crush = \"none\")","    *set doppel_crush \"null\"","    *goto scene01_dream1_dopcrushn","","*label scene01_dream1_dopcrushr","","$!{doppel} raising ${pc_his} hand does firmly secure your attention given your past history with tormenting dreams in Fernweh\u2026","","A glimmering of light distracts you from observing ${pc_his} movements with the dial as light refracts through the gemstone of the ring ${pc_he} @{mc_plural wear|wears} on ${pc_his} left ring finger. The sunrays seem to awaken the polished stone, coaxing out a mysterious blue-green shade that resembles the surface of the ocean near sandy shoals with its rich teal hue. The square cut guides the light along its faceted sides like bulbs along a stage that brighten the center plateau of the gem that is set in a heavy platinum band.","","It's vintage with an enduring elegance to it.","*page_break","","*if (doppel_crush = \"match\")","    \"Only a promise.\"","","    $!{doppel} quietly responds to a question that you didn't ask, catching your eye when you stop inspecting the jewelry. The urgency to this exchange ebbs away for a fleeting instant when ${pc_he} @{mc_plural study|studies} you as if searching for something in particular that was once lost. $!{pc_his} attention lingers in a different way than how you initially noticed the physical similarities, not roving or comparing, but truly taking a moment to look at you. $!{pc_he} would be great at stare offs.","","    There is something deeper to this moment\u2026","","    \"Promises can mean everything to certain people despite whether they're broken or kept,\" $!{doppel} notes. \"Try to remember that.\"","","    You aren't sure how to reply to ${pc_his} cryptic advice that could also be a caution, so you stay silent, ignoring any feelings of uncertainty.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (doppel_crush = \"conflict\")","    Idly wondering what type of precious rock was used in the jewelry would be easier if $!{doppel}'s thumb wasn't suddenly in the way. A sliver of the gem still peeks out due to its size. $!{pc_he} just intentionally obscured the ring from your view, which prompts you to glance back at ${pc_him} in silent question. \"What?\"","","    \"I thought you would prefer something more homey or approachable\u2026?\"","","    It doesn't seem like ${pc_he} ${is} judging your aesthetic, not when confusion seeps into ${pc_his} statement towards the end. You nearly bite your tongue when you realize frowning slightly will perfectly match the expression on ${pc_his} face; that's annoying. $!{doppel} is still watching you with cautious apprehension. ","","    The ring may be a touchy subject.","","    \"It's not important,\" you decide to move past this impasse. \"I noticed the color; that's all.\"","","    \"We'll have to disagree, but that will likely be a recurring theme\u2026\"","","    $!{pc_his} reply is closer to a cryptic warning; you remain silent, unsure what to say about it.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (doppel_crush = \"clash\")","    Admiring the blueish green hues of the precious rock any further becomes difficult when $!{doppel} twists the band around. $!{pc_he} @{mc_plural do|does} it intentionally. Now, you only see the underside of the ring of platinum that still glints in the sunlight before that's tucked out of view as well when ${pc_his} other hand settles atop it to obscure. There is a visible tension to the hold, fingers compressing the balled up fist beneath it.","","    $!{pc_his} eyes are already trained on you when you glance up with a questioning look.","","    \"Why bother staring at what you can't have?\"","","    $!{doppel} poses the question harshly, but something about ${pc_his} expression strikes you as upset rather than haughty about having access to fine jewelry. There's an unsaid accusation to how ${pc_he} ${is} watching you as if you will do something wrong again; maybe the ring is a touchy subject? \"I wasn't doing\u2014\"","","    \"You've done enough. We don't have time.\"","","    $!{doppel} cuts through your denial, treating it as an ill-formed excuse a child might rattle off after having been caught. When ${pc_he} @{mc_plural speak|speaks} like this, it's easier to detect the differences between the two of you. A hardness sometimes shadows ${pc_him}.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushj","","$!{doppel} scooting closer to the edge of ${pc_his} seat firmly secures your attention given your past history with tormenting dreams in Fernweh\u2026","","A glimmering of light distracts you from observing ${pc_his} movements with the dial as a silver chain slips free from the neckline of ${pc_his} robe. Sunlight makes the dutifully polished links of metal stand out, but your eyes are drawn to the two-part charm. It's just as pristine as the chain, alluding to years of care.","","*if ((friendship_necklace_j = \"nope\") or (friendship_necklace_style = \"partners in crime\"))","    One half of a silver, fractured heart dangles from the chain with a message etched into it you instantly understand despite the division. When completed, it would spell out: 'partners in crime', which is an implicit message of devotion against all odds. It takes you a second to identify the second charm that is a twist of metal with burnished silver accents to create areas of faint contrast among the shine.","","    It's an infinity symbol.","    *page_break","    *goto scene01_dream1_dopcrushj1","","*elseif (friendship_necklace_style = \"sword and shield\")","    A tiny, gilded sword dangles from the chain by its pommel, allowing the mirror finish blade to gently swing back and forth. It can slot within the accompanying shield charm to create a set ready for miniature battles. It takes you a second to identify the other medallion that is a twist of metal with burnished silver accents to create areas of faint contrast among the shine.","","    It's an infinity symbol.","    *page_break","    *goto scene01_dream1_dopcrushj1","","*elseif (friendship_necklace_style = \"lock and key\")","    An antique-looking key dangles from the chain by one of the holes in its curved top, allowing the intricate teeth along its length to swing. This key will only ever fit one lock; there is something special about that. It takes you a second to identify the second charm that is a twist of metal with burnished silver accents to create areas of faint contrast among the shine.","","    It's an infinity symbol.","    *page_break","    *goto scene01_dream1_dopcrushj1","","*elseif (friendship_necklace_style = \"moon and stars\")","    A brilliant star hangs from a clasp affixed to one of its pointed tips. Light briefly makes it resemble the real thing with how it gleams, though the matching moon in the set could also glow in a more understated way. They only complement, never compete. It takes you a second to identify the second charm that is a twist of metal with burnished silver accents to create areas of faint contrast among the shine.","","    It's an infinity symbol.","    *page_break","    *goto scene01_dream1_dopcrushj1","","*elseif (friendship_necklace_style = \"puzzle pieces\")","    A chrome puzzle piece hangs from a clasp affixed to one of its rounded corners. Light glints off of the mirror finish of the metal that must have been carefully laser cut to get such a unique shape. It will only ever align with one other piece in the set; there is something special about that. It takes you a second to identify the second charm that is a twist of metal with burnished silver accents to create areas of faint contrast among the shine.","","    It's an infinity symbol.","    *page_break","    *goto scene01_dream1_dopcrushj1","","*label scene01_dream1_dopcrushj1","","*if (doppel_crush = \"match\")","    $!{doppel}'s hand comes up to steady the charms, gingerly encasing them before the metal even has a chance of knocking into the dashboard or temperature controls. $!{pc_he} might have detected your subtle interest in the jewelry. You blink once when ${pc_he} @{mc_plural present|presents} the charms to you with some measure of hesitation, still keeping them cupped in ${pc_his} palm.","","    \"Where is yours?\"","    *goto scene01_dream1_dopcrushjwhere","","*elseif (doppel_crush = \"conflict\")","    One of $!{doppel}'s fingers hooks into the chain to gently pull it taut so the charms go still after a few seconds of wobbling. $!{pc_he} must have detected your subtle interest since ${pc_his} eyes flick between you and the metal pieces in what may be uncertainty before ${pc_he} @{mc_plural tuck|tucks} it away. It's not like you were going to try and steal the accessory.","","    \"I thought you'd want something flashier or more of a statement piece\u2026?\"","","    It doesn't seem like ${pc_he} ${is} judging your aesthetic, not when confusion seeps into ${pc_his} statement towards the end. You nearly bite your tongue when you realize frowning slightly will perfectly match the expression on ${pc_his} face; that's annoying. $!{doppel} is still watching you with cautious apprehension. ","","    The necklace must be a touchy subject.","","    \"It's not important,\" you decide to move past this impasse. \"I noticed the shine; that's all.\"","","    \"We'll have to disagree, but that will likely be a recurring theme\u2026\"","","    $!{pc_his} reply is closer to a cryptic warning; you remain silent, unsure what to say about it.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (doppel_crush = \"clash\")","    $!{doppel}'s hand engulfs the charms right after you identify the second one, completely encasing them before the metal even has a chance of knocking into the dashboard. It's a protective action. $!{pc_he} may have detected your subtle interest in the jewelry based on the hard stare ${pc_he} ${is} directing your way.","","    \"I don't see why you bother giving it more than a second look?\"","","    $!{doppel} poses the question harshly, but something about ${pc_his} expression strikes you as upset rather than irrationally defensive over a memento. There is an unsaid accusation to how @{mc_plural ${pc_he}'re|${pc_he}'s} watching you as if you'll do something wrong again; maybe the necklace is a touchy subject? \"I wasn't\u2014\"","","    \"You've done enough. We don't have time.\"","","    $!{doppel} cuts through your denial, treating it as an ill-formed excuse a child might rattle off after having been caught. When ${pc_he} @{mc_plural speak|speaks} like this, it's easier to detect the differences between you two. A hardness sometimes shadows ${pc_him}.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushjwhere","","*if (friendship_necklace_j = \"nope\")","    You furrow your brow at the certainty to ${pc_his} question that almost motivates you to study the fractured charm again. \"I never had a two-part necklace,\" you reply with a quick shrug, unsure why ${pc_he} would fixate on an accessory. \"I just noticed it catching the light.\"","","    \"Right\u2026\"","","    $!{doppel} sounds completely unconvinced by what you just said, though ${pc_his} hold on the charms slackens as they are tucked away.","","    \"Traumatic experiences can rewire the brain or maybe you were dropped on your head as a child,\" ${pc_he} @{mc_plural suppose|supposes}, casting a skeptical glance in your direction. \"Lost memories aren't why I'm here.\"","","    \"But critiquing my taste in jewelry is?\" you mutter to yourself, somewhat glad that the focus is off of the weird necklace.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"burned\")","    \"\u2026I lost it in the house fire.\"","","    Your half of the charm was either reduced to molten metal or warped into something else.","","    \"Oh,\" $!{doppel} murmurs, marginally softening at the realization that the necklace was taken from you by flames. \"I've been told that it's the thought that counts, so\u2026\" $!{pc_he} awkwardly @{mc_plural trail|trails} off with a faintly apologetic look before tucking the necklace away again.","","    $!{is} ${pc_he} really trying to console you\u2026?","","    Confusion about the how and why of ${pc_his} actions is short-lived as $!{doppel} drops the topic, possibly due to the mention of the fire. Or could it be because of $!{james}'s necklace?","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"trashed\")","    \"\u2026I threw it away to help me forget.\"","","    You lost most of your personal belongings in the house fire that claimed your parents' lives; it seemed cruel to have a reminder of this town.","","    \"Forget a what or a who?\" $!{doppel} asks in an insistent tone of voice, clearly disapproving of your past actions. \"This\"\u2014${pc_he} delicately @{mc_plural pinch|pinches} ${pc_his} half of the charm between ${pc_his} index finger and thumb, pointedly bringing it up into your view\u2014\"doesn't represent Fernweh. You know that.\"","","    \"But ${j_she} was in here, while I was out there,\" you counter, nearly smacking your hand against the steering wheel when gesturing at the road leading out of town. \"It's\u2014I don't have it anymore. I trashed it years ago, so leave it at that and be happy you have yours.\"","","    $!{doppel} softens marginally following your slight outburst, tucking away the necklace to keep it from view again. \"Old things can take on new meanings with time,\" ${pc_he} cryptically @{mc_plural note|notes}. \"It's unfortunate that you didn't get the time part\u2026\"","","    $!{is} ${pc_he} really trying to console you?","","    Confusion about the why of ${pc_his} actions is short-lived as $!{doppel} drops the topic, possibly due to the mention of the absence. Or could it be because of $!{james}'s necklace?","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"traumatic\")","    \"It's\u2026 hard\u2026 to wear it, but I keep it in a box.\"","","    The necklace is one of the few tangible reminders of Fernweh and of $!{james} that was spared from the flames of the house fire. While you do treasure it, the associated memories make it more than an accessory looped around your neck. It sometimes felt like a burden, a gift, a cruel joke, or a keepsake.","","    \"I understand,\" $!{doppel} replies with a trace of empathy that's reflected in how ${pc_he} diligently @{mc_plural tuck|tucks} the necklace out of your view, ensuring it is hidden by  the draping of the robe. \"Old things can take on new meanings with time, if you let them\u2026\"","","    $!{is} ${pc_he} really trying to console you?","","    Confusion about the how and why of ${pc_his} actions is short-lived as $!{doppel} drops the topic, possibly due to your somber mood. Or could it be because of $!{james}'s necklace?","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"disinterested\")","    \"Yeah, I still have it, but it's not worth wearing.\"","","    Most of your personal belongings were lost in the house fire that took your parents' lives. The necklace survived through that night only to be stashed in a drawer or box somewhere; you don't remember exactly where. It's old jewelry.","","    \"I see\u2026\"","","    $!{doppel} carefully encloses the charms within ${pc_his} palm before tucking them away. The critical look @{mc_plural ${pc_he}'re|${pc_he}'s} directing your way makes it seem like ${pc_he} ${is} sparing the pieces of metal from you. It feels like you just lost the right to see the childish accessory. \"I\u2014\"","","    \"I don't think it's worth continuing this conversation,\" ${pc_he} firmly @{mc_plural cut|cuts} off your attempt at any more elaboration. \"Value is relative, but most people would view a gift like this as priceless; you're different.\"","","    $!{pc_his} use of 'different' comes off as distantly insulting rather than a descriptor; you remain quiet, preferring to drop the topic.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"worn\")","    Your fingers reflexively seek out the chain that doesn't currently occupy your neck, searching for an absentee half of a charm that you sometimes idly trace when lost in thought.","","    It's not present in this dream\u2026","","    $!{doppel} tracks the motion of your hand with a keen interest before ${pc_his} expression marginally softens when you come up empty.","","    \"I don't\u2014\"","","    \"A dreamscape isn't one-to-one with the real world; it's not a true reflection,\" ${pc_he} calmly @{mc_plural offer|offers} the implicit reassurance without any prompting. \"I'm sure it's safe wherever you left it while awake.\"","","    $!{is} ${pc_he} trying to be considerate\u2026?","","    Confusion about the how and why of ${pc_his} actions is short-lived as $!{doppel} drops the topic by carefully tucking the necklace away.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushjr","","$!{doppel} scooting closer to the edge of ${pc_his} seat firmly secures your attention given your past history with tormenting dreams in Fernweh\u2026","","A glimmering of light distracts you from observing ${pc_his} movements with the dial as a silver chain slips free from the neckline of ${pc_his} robe. Sunlight makes the dutifully polished links of metal stand out, but your eyes are drawn to the two-part charm. It's just as pristine as the chain, alluding to years of care.","","*if ((friendship_necklace_j = \"nope\") or (friendship_necklace_style = \"partners in crime\"))","    One half of a silver, fractured heart dangles from the chain with a message etched into it you instantly understand despite the division. When completed, it would spell out: 'partners in crime', which is an implicit message of devotion against all odds. It's understated compared to the elegant ring that has been strung on the chain as well. ","    ","    The sunrays seem to awaken the polished stone, coaxing out a mysterious blue-green shade that resembles the surface of the ocean near sandy shoals with its rich teal hue. The square cut guides the light along its faceted sides like bulbs along a stage, which brighten the center plateau of the gem that's set in a heavy platinum band.","","    The contrasting styles somehow work.","    *page_break","    *goto scene01_dream1_dopcrushjr1","","*elseif (friendship_necklace_style = \"sword and shield\")","    A tiny, gilded sword dangles from the chain by its pommel, allowing the mirror finish blade to gently swing back and forth. It can slot within the accompanying shield charm to create a set ready for miniature battles. It's understated compared to the elegant ring that has been strung on the chain as well. ","    ","    The sunrays seem to awaken the polished stone, coaxing out a mysterious blue-green shade that resembles the surface of the ocean near sandy shoals with its rich teal hue. The square cut guides the light along its faceted sides like bulbs along a stage, which brighten the center plateau of the gem that's set in a heavy platinum band.","","    The contrasting styles somehow work.","    *page_break","    *goto scene01_dream1_dopcrushjr1","","*elseif (friendship_necklace_style = \"lock and key\")","    An antique-looking key dangles from the chain by one of the holes in its curved top, allowing the intricate teeth along its length to swing. This key will only ever fit one lock; there is something special about that. It's understated compared to the elegant ring that has been strung on the chain as well. ","    ","    The sunrays seem to awaken the polished stone, coaxing out a mysterious blue-green shade that resembles the surface of the ocean near sandy shoals with its rich teal hue. The square cut guides the light along its faceted sides like bulbs along a stage, which brighten the center plateau of the gem that's set in a heavy platinum band.","","    The contrasting styles somehow work.","    *page_break","    *goto scene01_dream1_dopcrushjr1","","*elseif (friendship_necklace_style = \"moon and stars\")","    A brilliant star hangs from a clasp affixed to one of its pointed tips. Light briefly makes it resemble the real thing with how it gleams, though the matching moon in the set could also glow in a more understated way. They only complement, never compete. It's understated compared to the elegant ring that has been strung on the chain as well. ","    ","    The sunrays seem to awaken the polished stone, coaxing out a mysterious blue-green shade that resembles the surface of the ocean near sandy shoals with its rich teal hue. The square cut guides the light along its faceted sides like bulbs along a stage, which brighten the center plateau of the gem that's set in a heavy platinum band.","","    The contrasting styles somehow work.","    *page_break","    *goto scene01_dream1_dopcrushjr1","","*elseif (friendship_necklace_style = \"puzzle pieces\")","    A chrome puzzle piece hangs from a clasp affixed to one of its rounded corners. Light glints off of the mirror finish of the metal that must have been carefully laser cut to get such a unique shape. It will only ever align with one other piece in the set, a perfect match. It's understated compared to the elegant ring that has been strung on the chain as well. ","    ","    The sunrays seem to awaken the polished stone, coaxing out a mysterious blue-green shade that resembles the surface of the ocean near sandy shoals with its rich teal hue. The square cut guides the light along its faceted sides like bulbs along a stage, which brighten the center plateau of the gem that's set in a heavy platinum band.","","    The contrasting styles somehow work.","    *page_break","    *goto scene01_dream1_dopcrushjr1","","*label scene01_dream1_dopcrushjr1","","*if (doppel_crush = \"match\")","    $!{doppel}'s hand comes up to steady the charm and ring, gingerly encasing them before the metal even has a chance of knocking into the dashboard. $!{pc_he} might have detected your subtle interest in the jewelry. You blink once when ${pc_he} @{mc_plural present|presents} both of the medallions to you with some measure of hesitation, still keeping them cupped in ${pc_his} palm.","","    \"Where is yours?\"","","    \"I don't have a ring like that,\" you quickly reply with a hint of disbelief. \"It looks like an heirlo\u2014\"","","    \"I know that promise hasn't been made yet,\" $!{doppel} interjects. \"I'm only asking about the charm since we received it as a kid, so\u2026?\"","    *page_break ","    *goto scene01_dream1_dopcrushjrwhere","","*elseif (doppel_crush = \"broken\")","    $!{doppel}'s fingers roughly hook into the chain to pull it taut; they invade your personal space when ${pc_he} @{mc_plural extend|extends} ${pc_his} hand. You rear back to avoid getting a baguette cut gemstone imprint in your cheek or smacked with a metal charm. The links of the necklace have a newfound rigidity to them, strained and stretched to be a line of silver with the ring and charm weakly wobbling at the end between ${pc_his} two raised fingers.","","    It's ironic ${pc_he} ${is} making a tense peace sign gesture by contorting the accessory when there is nothing peaceful about this\u2026.","","    $!{doppel} must have detected your subtle interest since ${pc_his} eyes are locked with yours as soon as you glance away from the necklace. There's a quiet anger infiltrating the calm that you were slowly starting to get used to; it locks ${pc_his} jaw and makes ${pc_his} gaze flinty. Could you ever look like that? ","","    \"Pick your favorite.\"","","    $!{pc_his} ground out demand only increases your confusion about how noticing jewelry could set someone off to this extent. It's not like you were doing anything wrong. \"What?\"","","    \"It should be easy for you,\" $!{doppel} coldly asserts before tucking away the necklace after snapping ${pc_his} fingers. \"Picking one and only one, but it's a trick question that will only lead to a bad result\u2026 It's better to stay quiet.\"","","    $!{pc_his} reply is closer to a cryptic warning; you remain silent, unsure what to say about it.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (doppel_crush = \"clash\")","    $!{doppel}'s hand engulfs the medallions right after you admire the ring, completely encasing them before the metal even has a chance of knocking into the dashboard. It's a protective action. $!{pc_he} may have detected your subtle interest in the jewelry based on the hard stare ${pc_he} ${is} directing your way.","","    \"Why bother looking at them now?\" ","","    $!{doppel} poses the question harshly, but something about ${pc_his} expression strikes you as upset rather than irrationally defensive over an accessory. There is an unsaid accusation to how @{mc_plural ${pc_he}'re|${pc_he}'s} watching you as if you will do something wrong again; maybe the necklace and ring are touchy subjects? \"I wasn't\u2014\"","","    \"You've done enough. We don't have time.\"","","    $!{doppel} cuts through your denial, treating it as an ill-formed excuse a child might rattle off after having been caught. When ${pc_he} @{mc_plural speak|speaks} like this, it's easier to detect the differences between you two. A hardness sometimes shadows ${pc_him}.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushjrwhere","","*if (friendship_necklace_j = \"nope\")","    You furrow your brow at the certainty to ${pc_his} question that almost motivates you to study the fractured charm again. \"I never had a two-part necklace,\" you respond with a quick shrug, unsure why ${pc_he} would fixate on an accessory. \"I just noticed it catching the light.\"","","    \"Right\u2026\"","","    $!{doppel} sounds completely unconvinced by what you just said, though ${pc_his} hold on the medallions slackens as they're tucked away.","","    \"Traumatic experiences can rewire the brain or maybe you were dropped on your head as a child,\" ${pc_he} @{mc_plural suppose|supposes}, casting a skeptical glance in your direction. \"Lost memories aren't why I'm here.\"","","    \"But critiquing my taste in jewelry is?\" you mutter to yourself, somewhat glad that the focus is off of the weird necklace.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"burned\")","    \"\u2026I lost it in the house fire.\"","","    Your half of the charm was either reduced to molten metal or warped into something else.","","    \"Oh,\" $!{doppel} murmurs, marginally softening at the realization that the necklace was taken from you by flames. \"I've been told it's the thought that counts\u2026\" $!{pc_he} awkwardly @{mc_plural trail|trails} off with a faintly apologetic look before indicating the charm to draw your attention away from the window. \"You still remember it though, right?\"","","    \"Of course, I picked my half of the design.\" ","","    \"Then maybe there's a chance of it being recreated with new thought behind it that respects the original gift from $!{james}.\"","","    $!{is} ${pc_he} really trying to console you\u2026?","","    Confusion about the how and why of ${pc_his} actions is short-lived as $!{doppel} drops the topic, possibly due to the mention of the fire.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"trashed\")","    \"\u2026I threw it away to help me forget.\"","","    You lost most of your personal belongings in the house fire that claimed your parents' lives; it seemed cruel to have a reminder of this town.","","    \"Forget a what or a who?\" $!{doppel} asks in an insistent tone of voice, clearly disapproving of your past actions. \"This\"\u2014${pc_he} delicately @{mc_plural pinch|pinches} ${pc_his} half of the charm between ${pc_his} index finger and thumb, pointedly bringing it up into your view\u2014\"doesn't represent Fernweh. You know that.\"","","    \"But ${j_she} was in here, while I was out there,\" you counter, nearly smacking your hand against the steering wheel when gesturing at the road leading out of town. \"It's\u2014I don't have it anymore. I trashed it years ago, so leave it at that and be happy you have yours.\"","","    $!{doppel} softens marginally following your mild outburst, tucking away the necklace to keep it from view again. \"Old things can take on new meanings with time,\" ${pc_he} cryptically @{mc_plural note|notes}. \"It's unfortunate that you didn't get the time part, but people with access to the most luxurious things will still sometimes crave a meaningful gift over something glitzy. It's hard for me to imagine either of these being thrown away.\"","","    $!{is} ${pc_he} really trying to console you\u2026?","","    Confusion about the why of ${pc_his} actions is short-lived as $!{doppel} drops the topic, possibly due to the mention of the absence.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"traumatic\")","    \"It's\u2026 hard\u2026 to wear it, but I keep it in a box.\"","","    The necklace is one of the few tangible reminders of Fernweh and of $!{james} that was spared from the flames of the house fire. While you do treasure it, the associated memories make it more than an accessory looped around your neck. It sometimes felt like a burden, a gift, a cruel joke, or a keepsake.","","    \"I understand,\" $!{doppel} replies with a trace of empathy that is reflected in how ${pc_he} diligently @{mc_plural tuck|tucks} the necklace out of your view, ensuring it's hidden by the draping of the robe. The ring leaves ${pc_his} fingers last after ${pc_he} @{mc_plural trace|traces} something etched into the band. \"Old things can take on new meanings with time, if you let them\u2026 Someone once taught me that not everything needs to be on display or seen to be dearly treasured.\"","","    $!{is} ${pc_he} really trying to console you?","","    Confusion about the how and why of ${pc_his} actions is short-lived as $!{doppel} drops the topic, possibly due to your somber mood.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"disinterested\")","    \"Yeah, I still have it, but it's not worth wearing.\"","","    Most of your personal belongings were lost in the house fire that took your parents' lives. The necklace survived through that night only to be stashed in a drawer or box somewhere; you don't remember exactly where. It's old jewelry.","","    \"I see\u2026\"","","    $!{doppel} carefully encloses the medallions within ${pc_his} palm before tucking them away. The critical look @{mc_plural ${pc_he}'re|${pc_he}'s} directing your way makes it seem like ${pc_he} ${is} sparing the jewelry from you. It feels like you just lost the right to see both the childish accessory and the luxurious ring. \"I\u2014\"","","    \"I don't think it's worth continuing this conversation,\" ${pc_he} firmly @{mc_plural cut|cuts} off your attempt at any more elaboration. \"Value is relative, but most people would view a gift like that as priceless, even in comparison to a glitzy gemstone. You're different.\"","","    $!{pc_his} use of 'different' comes off as distantly insulting rather than a descriptor; you remain quiet, preferring to drop the topic.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (friendship_necklace_j = \"worn\")","    Your fingers reflexively seek out the chain that doesn't currently occupy your neck, searching for an absentee half of a charm that you sometimes idly trace when lost in thought.","","    It's not present in this dream\u2026","","    $!{doppel} tracks the motion of your hand with a keen interest before ${pc_his} expression marginally softens when you come up empty.","","    \"I don't\u2014\"","","    \"A dreamscape isn't one-to-one with the real world; it's not a true reflection,\" ${pc_he} calmly @{mc_plural offer|offers} the implicit reassurance without any prompting. \"I'm sure it's safe wherever you left it while awake.\"","","    $!{is} ${pc_he} trying to be considerate\u2026?","","    Confusion about the how and why of ${pc_his} actions is short-lived as $!{doppel} drops the topic by carefully tucking the necklace away.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushs","","$!{doppel} raising ${pc_his} hand does firmly secure your attention given your past history with tormenting dreams in Fernweh\u2026","","A faint glint of metal distracts you from observing ${pc_his} movements with the dial as light dapples across the bracelet ${pc_he} @{mc_plural wear|wears} on ${pc_his} right wrist. The sunrays seem absorbed to create a controlled glow rather than reflected in a flashy shine. It has to be handcrafted; there's a level of intricacy to it that you can't imagine being mass produced. Lengths of metal were pulled and patiently woven to create an interlocking, organic pattern that is similar to Celtic knots.","","The focal point of the accessory is a larger knot with two pointed tips that create a diamond shape inset in interlocked knots so two halves form an unbreakable whole. It's flanked by multiple circular ones that remind you of decorative shields. Is there any end to them\u2026?","","Burnished silver is accentuated by small, turquoise stones that were carefully melded into some knot centerpoints or intersections. The rocks seem to bottle the essence of the serene yet powerful ocean. Swirls of black and swoops of faint copper add movement to the rich blue-green color that has multiple shades.","","It's like nothing you have ever seen before.","*page_break","","While it's tempting to follow the design of the knotted bracelet, a flash of light draws your attention back to the indicators on the dashboard. They flare up briefly to appear neon before dimming down just as $!{doppel}'s hand pulls back from the temperature dials. You have to blink away the afterimage of the foggy conditions symbol, still seeing the waves of the electric blue indicator behind your eyelids.","","\"What was that?\"","","*if (doppel_crush = \"match\")","    $!{doppel}'s lack of an immediate response only makes you clear your vision more quickly before fixing ${pc_him} with a questioning look. $!{pc_he} wordlessly @{mc_plural return|returns} it before adjusting the sleeve of ${pc_his} robe to conceal the bracelet. \"How\u2014?\"","","    \"It's special,\" $!{doppel} interrupts by offering a brief explanation. \"My bracelet is crafted with a care that can sometimes shine through. It won't hurt you; that was a warning\u2026\"","","    You decide it's best not to ask what the warning was about because ${pc_he} did kind of answer your question rather than ignore it.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*elseif (doppel_crush = \"clash\")","    \"It was nothing.\"","","    $!{doppel}'s blatant lie only makes you clear your vision more quickly before fixing ${pc_him} with an incredulous look. $!{pc_he} @{mc_plural disregard|disregards} it while continuing to roughly tug at the sleeve of ${pc_his} robe to conceal the bracelet. It's like you lost the privilege to see it. \"No, it wasn't.\"","","    \"Why are you entitled to answers that don't concern you?\"","","    $!{doppel} poses the question harshly, but something about ${pc_his} expression strikes you as upset rather than irrationally defensive over an accessory. There's an unsaid accusation to how ${pc_he} ${is} watching you as if you will do something wrong again; maybe the bracelet is a touchy subject? \"I didn't\u2014\"","","    \"You have done enough. We don't have time.\" ","","    $!{doppel} cuts through your denial, treating it as an ill-formed excuse a child might rattle off after having been caught. When ${pc_he} @{mc_plural speak|speaks} like this, it's easier to detect the differences between you two. A hardness sometimes shadows ${pc_him}.","    *page_break","    *goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushn","","$!{doppel} raising ${pc_his} hand does firmly secure your attention given your past history with tormenting dreams in Fernweh\u2026","","Nothing bad happens. $!{pc_he} @{mc_plural twist|twists} the dial without setting anything on fire or producing a bloodied note from ${pc_his} robe. You only minimally relax after ${pc_he} ${is} done and resettled in the seat.","*goto scene01_dream1_dopcrushfin","","*label scene01_dream1_dopcrushfin","","\"Fernweh's roots run deep, and they are more gnarled and twisted than you can imagine\u2026\"","","$!{doppel} purposefully averts ${pc_his} eyes to the farewell sign in the distance that's by the exit road out of town. Its bright white paint glistens from a combination of glossy sealer and the rainwater catching the sunlight. All of the sheen and shine is overshadowed by the emblem of the ouroboros cast from ebony metal; it silently demands all of the attention.","","The words are slightly curved around it, the dark, beveled trim complements it, and it takes center stage in both sizing and positioning.","","You look between $!{doppel} and what @{mc_plural ${pc_he}'re|${pc_he}'s} intently staring down once, twice, and then finally decide to address ${pc_him}.","","*choice","    #Joke and don't take ${pc_him} seriously. \"Is this the horror of the nightmare? Bad tree metaphors?\"","        *set doppel_friendship -1","        *goto scene01_dream1_dopnewsjoke","    #Remain unfazed by the grim news. \"Yeah, and\u2026?\" ","        *goto scene01_dream1_dopnewsunf","    #Grow impatient at these vague riddles. \"Be more specific, less ominous and annoying.\"","        *set doppel_friendship -1","        *goto scene01_dream1_dopnewsimp","    #Keep quiet, still stunned but focused.","        *goto scene01_dream1_dopnewsstun","    #Show some trust to $!{doppel}. \"I'm listening.\"","        *set doppel_friendship +1","        *goto scene01_dream1_dopnewstru","    #Ignore ${pc_him} and change topics. \"Okay, but why did you pretend to be a baby deer\u2026?\"","        *set doppel_friendship -1","        *goto scene01_dream1_dopnewsign","    #Roll your eyes and tune ${pc_him} out. \"You're evil; this is a nightmare; and I'm over it.\"","        *set doppel_friendship -2","        *set doppel_grudge +1","        *goto scene01_dream1_dopnewsnigh","    #Be nervous and ramble with puns. \"Uh, yeah, it's in need of some pruning? No, wait, shearing or, uhm, culling\u2026?\"","        *set doppel_friendship +1","        *goto scene01_dream1_dopnewsaww","    #Try to be receptive despite the bizarre circumstances. \"I need to know more, please.\"","        *set doppel_friendship +1","        *goto scene01_dream1_dopnewsplz","*page_break","","*label scene01_dream1_dopnewsjoke","","You just barely muffle a scoff of laughter as this inanimate object showdown persists because what ${pc_he} said was entertaining.","","\"Is this the 'horror' \"\u2014you layer sarcasm over the word, distorting it slightly as you say it with a mocking twist of your lips\u2014\"of the nightmare? Bad tree metaphors?\" Your question doesn't faze $!{doppel}, who's thoroughly invested in ${pc_his} grudge match with a masochistic snake symbol; it's hard to take this seriously.","","\"We all know Fernweh is heavily forested, but it must have other qualities too,\" you continue speaking with a joking slant to your words that are faintly dismissive. You faced a monster and survived, while ${pc_he} ${is} being ominously brooding about stupid roots. \"Like, you could say the mysteries are as deep as the mine shafts, or as bottomless as the waterfall, or\u2014\"","","*if (sincerity <= 48)","    \"As depthless as the eyes of the creature that nearly killed your snarky ass in the woods.\" ","","    Okay, ouch\u2026","","    \"I\u2014That isn't\u2026\" You uncertainly trail off because ${pc_his} metaphor did reference depth while also being a well-played insult. Calling this a bad dream may have aggravated ${pc_him}. \"It doesn't matter what this is if you're only going to be all dramatically doom and gloom about the town's secrets. How is that useful to me?\"","","    $!{doppel} finally holds your gaze once again.","    *page_break","    *goto scene01_dream1_dopnewstell","","*else","    \"As empty as your skull because this isn't a nightmare.\"","","    \"\u2026That wasn't a depth metaphor,\" you retort, quickly rolling your eyes at ${pc_his} poor attempt at an insult. Calling this a bad dream may have aggravated ${pc_him}. \"It sure feels like one if you're going to be all dramatically doom and gloom about the town's secrets.\"","","    $!{doppel} finally holds your gaze once again.","    *page_break","    *goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsunf","","You stop peering between $!{doppel} and the farewell sign, withholding a sigh because they don't really seem that different at this moment. Both of them are just sitting there taking up space, while you're trapped in whatever this stupid dream is meant to be. The doom and gloom theatrics hardly faze you; only concrete details about these 'roots' possibly could.","","\"Yeah, and\u2026?\"","","$!{pc_he} subtly @{mc_plural angle|angles} ${pc_his} head in your direction following your bored question. Maybe your flat tone isn't what $!{doppel} anticipated hearing, but you refuse to say anything more; it's ${pc_his} turn to talk.","","$!{pc_he} finally @{mc_plural hold|holds} your gaze once again, nodding once in agreement.","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsimp","","The petulant urge to run over that farewell sign intensifies with each passing second $!{doppel} engages in this showdown. Your car doesn't even work safely enough to do that, but there would be something so satisfying about the wood splintering and the metal bending out of shape. Maybe the Verner's name would fall off of it or just a single one of its letters, which would probably be far more irritating.","","You exhale, focusing back on ${pc_him} as your impatience eats away the visualization.","","There will be no wrecked signs, but verbally tearing into ${pc_him} may be a consolation prize\u2026","","\"Be more specific, less ominous and annoying.\" Your request is closer to a sharp demand that only earns a brief, unimpressed glance from $!{doppel}, which increases your aggravation. There can't be anything that important about a stupid sign's design. \"Is everything in this town vague? Vague and pointless like you?\"","","\"Some things can only be uncovered by yourself to truly understand them,\" ${pc_he} @{mc_plural answer|answers}, finally choosing to hold your gaze again. \"Other things require [i]voluntary[/i] help.\"","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsstun","","$!{pc_his} concentration is securely locked on the sign despite the inanimate object not putting up much of a fight in the showdown. It just remains stationary by the side of the road, though the plated scales of the snake glinting and glimmering seem to suggest a subtle undulation of coiled movement. You strain your vision, preferring to concentrate on the symbol than on who\u2026 or what\u2026 sits nearby.","","$!{doppel}'s appearance still hasn't completely clicked in your brain. Shock could be to blame, but really, you're stunned and just trying to get through this interaction with ${pc_him}. $!{pc_he} @{mc_plural don't|doesn't} make any immediate effort to disrupt the loaded silence. It's tempting to study the trees during the wait or even peer into the rearview mirror to see if the bloody patch in the road is still there. ","","Your focus doesn't fully waver from ${pc_him}.","","You can't let it\u2026","","$!{doppel} finally meets your gaze once again, nodding in agreement to possibly indicate ${pc_he} will speak.","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewstru","","$!{pc_his} commitment to this showdown with an inanimate object is slightly worrying\u2026","","It's not because $!{doppel} will obviously lose against the self-cannibalizing snake cast out of metal, but because ${pc_he} ${is} so intent on keeping it in sight. How can there be such a negative association? You hesitantly rest your hand on the center console before thinking better of trying to gently draw ${pc_his} focus.","","@{mc_plural $!{pc_he}'re|$!{pc_he}'s} too on edge\u2026","","Despite everything, you are willing to show ${pc_him} some trust, which is why you wait instead of demanding answers or assuming ${pc_he} ${is} a figment of your imagination.","","$!{doppel} finally meets your gaze once again with a hint of surprise as if ${pc_he} forgot you were there. \"I'm listening,\" you politely assure ${pc_him}, receiving a grateful nod in return.","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsign","","While $!{doppel} is fixated on the inanimate object in front of the car, you peer into the rearview mirror with a less consuming focus.","","It's still there!","","The glistening patch on the road hasn't magically dried or been completely absorbed by the worn asphalt. It's impossible to make out the reddish hue to the blood from this distance, especially with the damp weather, but that section still stands out. You look back at ${pc_him}, narrowing your eyes slightly as ${pc_he} @{mc_plural persist|persists} with this stupid showdown. $!{pc_his} ominous words about the town's secrets are nothing compared to the earlier theatrics on the road.","","\"Okay, but why did you pretend to be a baby deer\u2026?\"","","$!{doppel} barely turns ${pc_his} head in your direction following the abrupt change in topic that disregards ${pc_his} warning. Your needling curiosity is replaced with indignation at being completely ignored. $!{pc_he} could at least look at the person ${pc_he} tried to scare.","","\"\u2026Was it because you wanted to freak me out? Or is it, like, some sort of stupid, nightmare metaphor? Do you just enjoy pretending to be a cute, woodland creature, prancing around the\u2014\"","","\"Don't strain yourself,\" ${pc_he} @{mc_plural interrupt|interrupts} your next suggestion since they are becoming increasingly critical. \"It's always easier to blame someone else than consider how your own mind works, but I'm not here to unpack all of that convolution\u2026\"","","Only now does $!{doppel} hold your gaze.","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsnigh","","$!{pc_his} fixation on the sign is starting to wear down your patience, bludgeoning it until it is thinner and thinner so your frustrations rip through. This showdown with an inanimate object is the least offensive thing $!{doppel} has done since forcing ${pc_his} way into your car. The baby deer act, the roadkill charade, and ${pc_his} overall attitude are all negatives. ","","Now, ${pc_he} @{mc_plural want|wants} to be all ominously dramatic about the town's secrets? Who would ever trust ${pc_him}?","","You pointedly scoffing doesn't receive any reaction; instead, you roll your eyes before briefly pressing the horn of the car. It's only a tap, similar to a beep, but $!{doppel} does flinch and finally looks at you like you deserve, though it's surprising the wooden sign didn't sag or buckle under ${pc_his} harsh stare\u2026","*page_break","","\"You're evil; this is a nightmare; and I'm over it.\"","","$!{pc_he} should be rebutting or countering what you said; however, there's only silence.","","\"I said I'm done,\" you repeat yourself, waving a hand at the passenger side door. \"Bye.\"","","\"If it was that easy to end a dream, wouldn't you have already done it?\" $!{doppel} mocks your farewell with a knowing smile, tapping ${pc_his} knuckles against the glass in three distinct knocks. \"I see why there are strikes now\u2026 You'll only leave when ready, so deal with it.\" ","","Calling ${pc_him} evil and this a nightmare may have irritated ${pc_him}, but that isn't registering as a problem compared to staying here. You bite back the retort on the tip of your tongue, wondering if ${pc_he} can somehow add to your jail time in this bad dream prison. It may be better to endure ${pc_his} company.","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsaww","","It almost feels like you are interrupting something between ${pc_him} and the sign\u2026","","The masochistic snake symbol continues its self-devouring ritual with $!{doppel} as an avid watcher, who must have some negative link to it. $!{pc_his} hard stare should be capable of warping the planks of wood with its ferocity. You nearly startle yourself when bringing a hand to your chin, absentmindedly resting it against the tips of your fingers before settling further in your seat to watch the showdown. ","","Obviously, nerves are to blame, nothing more.","","What ${pc_he} said about twisted roots and Fernweh's potentially dark past didn't help either.","*page_break","","\"Uh, yeah, gnarled roots are never a good thing, right?\" Your attempt to bridge the silence soon escalates into a railway for your train of thought to freely, if inelegantly, trundle down. It's all been too overwhelming: the article, radio song, baby deer, perfect double, and now ominous tree metaphors. \"This town is in need of some serious pruning. No, wait\u2014shearing, or, uhm, culling\u2026? Whatever gets rid of the creepy woods and what's in them that's scary.\"","","Only now does $!{doppel} glance away from the sign to fix you with a quizzical look that eases up slightly when your lips part to say more.","","No one wants that\u2026","","\"Excise,\" ${pc_he} @{mc_plural volunteer|volunteers} another term with a weak shrug that barely raises ${pc_his} shoulders. \"A controlled burn would keep with the theme too, but\u2026\" $!{doppel} grimaces, quickly moving the conversation forward with a strained smile. \"Er, any of what you said fits, I think, so\u2026 Good.\"","","You didn't expect your rambling to be met with lukewarm encouragement. Getting out some of your nervous energy should make listening to ${pc_his} warnings easier, even if you may not like what ${pc_he} @{mc_plural have|has} to say. Maybe you can learn from this dream.","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewsplz","","$!{pc_his} unwavering concentration on the sign motivates you to also observe the roadside decoration for a few moments to try and see what ${pc_he} @{mc_plural do|does}.","","The self-cannibalizing snake remains locked in its painful meal, though its metal scales seem to subtly undulate due to the glistening, leftover raindrops. If $!{doppel} is anything like you, then ${pc_he} should be familiar with this symbol, which may mean that this reaction is because ${pc_he} @{mc_plural have|has} a negative association with it. It's hard to tell\u2026","","You don't find the sign as compelling to look at, which is why you hesitantly glance over to the right. As confusing and suspenseful as this dream has been, there is only one ${pc_man} who can potentially provide some insight into what is happening. $!{pc_he} @{mc_plural aren't|isn't} responding, but maybe you need to show ${pc_him} your willingness to listen. \"Hey\u2026?\" $!{doppel} blinks before angling ${pc_his} head in your direction as if recalling you're still there. \"I need to know more, please.\"","","\"Some things can only be uncovered through firsthand discovery,\" ${pc_he} @{mc_plural admit|admits} with a hint of disapproval at the waiting that implies. \"I'll say what I can now\u2026\"","*page_break","*goto scene01_dream1_dopnewstell","","*label scene01_dream1_dopnewstell","","It feels like something is about to happen.","","You hush your breathing ever so slightly, taking slower, more even breaths without any clear direction or signal as to why it's a good idea to. There isn't any slowly mounting dread setting in, but an anticipation that sends an implicit directive to both body and mind. Be aware, be on guard, and be vigilant; it is hazily familiar\u2026","","Why? ","","$!{doppel} maintains eye contact with you while indicating a random section of the forest, though you quell the need to search between the trunks for something eerily staring back.","","\"This town\u2014this land\u2014has been a consistent witness to countless things that have left echoes and stains on it,\" ${pc_he} @{mc_plural reveal|reveals} in a stiff tone of voice, selecting each and every word with a calculating sort of care. \"There is a distilled form of suffering within these borders along with happier moments I'd give anything to experience again\u2026 But it's different now.\"","","You aren't exactly following ${pc_him}, choosing to listen and draw conclusions later.","","\"Those echoes are no longer [i]perfectly[/i]\"\u2014${pc_his} voice loses its practiced calm edge for a split second, briefly quaking\u2014\"aligned. I know they will bleed through further in new ways.\" $!{doppel} taps ${pc_his} left temple, offering a closed-lip smile that would signal quiet understanding if not for the way it fails to reach ${pc_his} eyes. \"It can be taxing.\" ","","*if (primary_skill = \"empathetic impressions\")","    Your headaches, your nightmares, your bouts of emotional perceptiveness, or is it something else?","","    There's a lot going on in your head.","    *page_break","    *goto scene01_dream1_dopnewstell1","","*elseif (primary_skill = \"retrocognition\")","    Your headaches, your nightmares, your moments of uncanny perception, or is it something else?","","    There's a lot going on in your head.","    *page_break","    *goto scene01_dream1_dopnewstell1","","*elseif (primary_skill = \"extrasensory awareness\")","    Your headaches, your nightmares, your glimpses of intuition, or is it something else?","","    There's a lot going on in your head.","    *page_break","    *goto scene01_dream1_dopnewstell1","","*label scene01_dream1_dopnewstell1","","\"Your role isn't as set as it may seem, although I would suggest avoiding the growing pains\u2026\"","","A faint bitterness laces through $!{doppel}'s statement that comes off as a secret being shared under duress as if you're prying out this information rather than sitting there quietly. $!{is} ${pc_he} jaded about something? It's hard to interpret ${pc_his} fluctuating mood thanks to ${pc_his} guarded demeanor and how ${pc_he} clearly @{mc_plural know|knows} more than you. \"What is my 'role'?\"","","\"It's no longer my place to say, '$!{name}'.\" $!{doppel} applies the exact same dubious slant to your name as you did when saying the word 'role'. \"This should be my sto\u2014\"","","A low crackle of static emits from the radio, overtaking ${pc_his} next piece of confusingly","foreboding advice as it pours out in waves.","","*fake_choice","    #Smack your hand against the radio.","    #Flick the knob of it again to force it off.","    #Turn it up. You would prefer static to ${pc_him} talking.","    #Angrily mash a few random buttons on it.","    #Calmly turn it on and off to quiet it down.","*page_break","","*if ((w_number_hand = \"true\") and (waiter_flirt >= 4))","    Reaching out your left hand to deal with the infernal radio comes to an abrupt stop when $!{doppel} intercepts it. $!{pc_his} fingers fasten around your wrist in a secure yet undeniably targeted hold that compels your palm to flatten out and open up as ${pc_he} @{mc_plural raise|raises} it above the dashboard. The shafts of sunlight coming in through the window gently warm your fingertips, while the back of your hand hovers over the heated plastic that has been exposed to the sun during the drive.","","    \"What are\u2014?\"","","    \"A trick of the light.\"","","    $!{doppel} murmurs something else that you can't parse out before ${pc_he} just as quickly @{mc_plural release|releases} your wrist.","","    You wonder just how tight ${pc_his} grip was when you feel a faint tingling. It follows your palm lines in lazy, lapping swirls, spiraling out to possibly suggest past restricted blood flow, except there is a faint heat as blood returns. It doesn't hurt at all, but it does feel a little weird.","","    \"I'm going to guess you touched something you weren't supposed to?\"","","    \"There was a sticky newspaper article\u2026\" ","","    \"So, that's a yes,\" $!{doppel} confirms with a low sigh. \"It's probably nothing, just a residual bad memory or something similar. My mistake.\" ","    *page_break","    *goto scene01_dream1_dopnewstell2","","*else","    Reaching out your hand to deal with the infernal radio comes to an abrupt stop when $!{doppel} intercepts it. $!{pc_his} fingers fasten around your wrist in a secure yet undeniably targeted hold that compels you to freeze up. The shafts of sunlight coming in through the window gently warm the back of your hand, while ${pc_his} grip signals a cool warning.","","    It doesn't hurt at all, but the potential is there.","","    \"What are\u2014?\"","","    \"Try to listen.\"","","    $!{doppel} murmurs something else that you can't parse out before ${pc_he} just as quickly @{mc_plural release|releases} your wrist.","    *page_break","    *goto scene01_dream1_dopnewstell2","","*label scene01_dream1_dopnewstell2","","The static slowly ebbs and flows through the speakers, filling the interior of the car with its sharp crackles and lingering hisses of mangled sound. It's building up to something. A song should never be composed of the antithesis of music; a grating noise that is harsh on the ears.","","Your shoulders bunch up slightly, but you don't cover your ears because $!{doppel} is listening.","","If ${pc_he} can do it, so can you\u2026","","\"\u2026~$!{name}?~\u2026\"","","The static-laced call of your name seems to faze both of you, but $!{doppel} is quicker at adjusting the radio tuner to clarify the noise. It slowly becomes a voice that has a soft edge to it like the absent singer. You strain your hearing as more garbled static falls away so only a wisp of an echoing hiss overlays the address.","","\"\u2026~$!{name}, please~\u2026?\"","","*if (((past_crush = \"james\") or (past_crush = \"jr\")) and (doppel_crush = \"match\"))","    \"$!{j_she} sounds worried,\" $!{doppel} whispers the observation to not compete with the radio. $!{pc_he} @{mc_plural turn|turns} the volume up more before scooting to the very edge of ${pc_his} seat to take in the sound, almost allowing ${pc_his} eyes to slip closed before they flick to you. \"About you.\"","    *page_break","    *goto scene01_dream1_dopnewstell3","","*elseif ((past_crush = \"james\") or (past_crush = \"jr\"))","    \"$!{j_she} sounds worried,\" $!{doppel} whispers the observation to not compete with the radio. $!{pc_he} @{mc_plural turn|turns} the volume up more before scooting to the very edge of ${pc_his} seat to take in the sound, almost allowing ${pc_his} eyes to slip closed before they settle on you with an unspoken criticism. \"I don't understand why\u2026\"","    *page_break","    *goto scene01_dream1_dopnewstell3","","*else","    *page_break","    *goto scene01_dream1_dopnewstell3","","*label scene01_dream1_dopnewstell3","","The call of your name is becoming more frequent and incessant, taking on an echoing quality as it repeats again and again in all the glory of immersive surround sound. The car windows faintly rattle from the noise, while your walkie talkie vibrates in the cup holder. You can feel it, seeping into your bones and faintly shaking your teeth until you set them.","","\"I will be seeing you as more resurfaces.\" ","","Somehow $!{doppel}'s farewell manages to cut through the redundant soundtrack of your name. $!{pc_he} @{mc_plural turn|turns} to exit the car as easily as how ${pc_he} first climbed into it. \"Wait, that's\u2014what's wrong with Fernweh!?\" You half-shout the question out of a sense of exasperation alongside the natural need to raise your voice because of the radio.","","\"What's right with it?\"","","That isn't helpful.","","$!{doppel} slams the door shut before you can protest or insist on more answers, which only adds to the cacophony of noises threatening to override your brain. It's too much. You screw your eyes shut, wincing as the metal bang also repeats in time with the radio again and again.","","Everything is shaking, including your hands as you hold your head to weakly shield your ears.","*page_break \"\u2026~$!{name}~\u2026?\"","*finish "], "labels":{"scene01_dream1_street":62,"scene01_dream1_jokehead":102,"scene01_dream1_jokecomb":114,"scene01_dream1_jokeheart":126,"scene01_dream1_jokedipl":138,"scene01_dream1_jokeneu":156,"scene01_dream1_paper":168,"scene01_dream1_paperdeet":196,"scene01_dream1_paperact":220,"scene01_dream1_paperact1":236,"scene01_dream1_paperact2":259,"scene01_dream1_paperact3":293,"scene01_dream1_polo":316,"scene01_dream1_roline":338,"scene01_dream1_importb":365,"scene01_dream1_imports":394,"scene01_dream1_importr":425,"scene01_dream1_importj":456,"scene01_dream1_importjr":487,"scene01_dream1_importchob":513,"scene01_dream1_importchos":538,"scene01_dream1_importchor":563,"scene01_dream1_importchoj":588,"scene01_dream1_importchojr":613,"scene01_dream1_importbffb":632,"scene01_dream1_importbffs":642,"scene01_dream1_importbffr":652,"scene01_dream1_importbffj":664,"scene01_dream1_polodone":676,"scene01_dream1_songsp":714,"scene01_dream1_songsp1":750,"scene01_dream1_songsp2":765,"scene01_dream1_songfrus":777,"scene01_dream1_songign":793,"scene01_dream1_songfro":811,"scene01_dream1_songs":829,"scene01_dream1_songsin":848,"scene01_dream1_songsin1":884,"scene01_dream1_songsin2":899,"scene01_dream1_songno":907,"scene01_dream1_songun":921,"scene01_dream1_bambi":939,"scene01_dream1_bambia":1014,"scene01_dream1_bambib":1063,"scene01_dream1_dopact":1117,"scene01_dream1_dophitrun":1143,"scene01_dream1_dopgull":1181,"scene01_dream1_dopcall":1229,"scene01_dream1_dopstay":1262,"scene01_dream1_dophelp":1295,"scene01_dream1_doprel":1346,"scene01_dream1_dopdesc":1382,"scene01_dream1_dopdescm1":1463,"scene01_dream1_dopdescs1":1485,"scene01_dream1_dopdescsn1":1507,"scene01_dream1_dopdescf1":1527,"scene01_dream1_dopdesca1":1543,"scene01_dream1_dopdescn1":1553,"scene01_dream1_doprevealcho":1575,"scene01_dream1_doprevealhair":1606,"scene01_dream1_doprevealfuel":1625,"scene01_dream1_doprevealop":1643,"scene01_dream1_doprevealfre":1659,"scene01_dream1_doprevealmare":1696,"scene01_dream1_doprevealwalk":1714,"scene01_dream1_doprevealmare2":1747,"scene01_dream1_doprevealshock":1762,"scene01_dream1_doprevealwake":1778,"scene01_dream1_dopname":1794,"scene01_dream1_dopnamecho":1912,"scene01_dream1_dopnamenar":1991,"scene01_dream1_dopnamebiz":2003,"scene01_dream1_dopnamedop":2044,"scene01_dream1_dopnamebor":2075,"scene01_dream1_dopnameref":2087,"scene01_dream1_doptemp":2107,"scene01_dream1_dopcrush":2154,"scene01_dream1_dopcrushr":2204,"scene01_dream1_dopcrushj":2258,"scene01_dream1_dopcrushj1":2299,"scene01_dream1_dopcrushjwhere":2337,"scene01_dream1_dopcrushjr":2427,"scene01_dream1_dopcrushjr1":2478,"scene01_dream1_dopcrushjrwhere":2521,"scene01_dream1_dopcrushs":2615,"scene01_dream1_dopcrushn":2656,"scene01_dream1_dopcrushfin":2663,"scene01_dream1_dopnewsjoke":2702,"scene01_dream1_dopnewsunf":2730,"scene01_dream1_dopnewsimp":2742,"scene01_dream1_dopnewsstun":2756,"scene01_dream1_dopnewstru":2770,"scene01_dream1_dopnewsign":2784,"scene01_dream1_dopnewsnigh":2804,"scene01_dream1_dopnewsaww":2825,"scene01_dream1_dopnewsplz":2848,"scene01_dream1_dopnewstell":2860,"scene01_dream1_dopnewstell1":2897,"scene01_dream1_dopnewstell2":2948,"scene01_dream1_dopnewstell3":2976}},
"chap01": {"crc":1328240525, "lines":["*comment alphachapter 1","[b][i]CHAPTER 1[/i][/b]","*line_break","","[b]The Next Location Goes Here\u2026[/b]","*line_break","- - -","","Thank you for reading the first alpha drop of [i][b]TFS: Book Two[/b][/i]! I'm sure there's more for you to explore within it, but I did want to provide hints about what's to come, if you're curious. :D.","","This first drop was technically 60k words, but that's including the MC creation, stats, etc. in addition to the Introduction. The Introduction alone is 30k words.","","The next drop should be around 43k words and is the first part of [b]Chapter 1[/b]. ","","I hope to have the next alpha content drop ready for [i][b]TFS[/b][/i] patrons to explore in the second half of June.","","Would you like to have a sneak peek of the next drop?","","*choice","    #Yes, I would like to read [i]hints[/i] about what's in store.","        *goto alphadrop_teaser_chap1pt1","    #No, I would prefer to experience it firsthand without any teasers.","        *goto  alphadrop_temp_finish","*page_break ","","*label alphadrop_teaser_chap1pt1","","[b]Hints for Chapter 1 Part 1\u2026[/b]","","Please keep in mind this is just a taste of what you could encounter during the next alpha content drop. ","","-Share a walkie talkie conversation with someone. Can you guess who? ","*line_break","-Yes, there can be scenes with $!{dog_name} or at least mentions of her. ","*line_break","-Decide your feelings and level of involvement with Turn the Page. Is it a beloved childhood hangout, a coping mechanism, a relic of the past, or something that should be bulldozed? ","*line_break","-Get some insight on how $!{beckett} is managing the newfound stay. Where is ${b_she}? $!{silas} might be able to shed some light on things, possibly confide in the MC about other topics too.","*line_break","-Witness an unusual exchange, though you may be able to learn something. How will you treat Marjorie?","*line_break","-Mal! Yes, that's the extent of this bullet point, but trust me on ${w_him} featuring in [b]Chapter 1[/b].","*line_break","-Witness how the MC's primary ability is starting to influence how they engage with Fernweh, including the introduction of a new mechanic that will be echoed throughout the series. ","*line_break","-\u2026And more once you consider choices, relationship dynamics, and other variables! ","*line_break","*label alphadrop_temp_finish","*finish"], "labels":{"alphadrop_teaser_chap1pt1":25,"alphadrop_temp_finish":47}},
"chap02": {"crc":-1537866504, "lines":["*comment alphachapter 2","*comment Yes, I have these extra 'chapters' to try and avoid breaking saves for those of you curious about the directory organization. I will then replace them with the new content, etc. ","[b]Thank you![/b]","*line_break","- - -","","Currently, Chapter 1 is divided into two parts given its size and the frequency of these drops while I'm still writing Book Two. I appreciate your excitement, support, and patience. It's surreal to think that Book One released in January of this year, and we're able to see Book Two taking shape!","","Again, please remember that [b]TFS Discord[/b] might be a good place to chat with other Returning Visitors about the patron-exclusive content you read. Also, you can offer feedback to me via email or in the comments of the alpha drop post. I hope you enjoy your time in Fernweh.","","Best wishes, Aesla <3","*page_break","*ending"], "labels":{}}}</script><script>
;

;
//
// Copyright (c) 2008, 2009 Paul Duncan (paul@pablotron.org)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//


/* 
 * The contents of gears_init.js; we need this because Chrome supports
 * Gears out of the box, but still requires this constructor.  Note that
 * if you include gears_init.js then this function does nothing.
 */
(function() {
  // We are already defined. Hooray!
  if (window.google && google.gears)
    return;

  // factory 
  var F = null;

  // Firefox
  if (typeof GearsFactory != 'undefined') {
    F = new GearsFactory();
  } else {
    // IE
    try {
      F = new ActiveXObject('Gears.Factory');
      // privateSetGlobalObject is only required and supported on WinCE.
      if (F.getBuildInfo().indexOf('ie_mobile') != -1)
        F.privateSetGlobalObject(this);
    } catch (e) {
      // Safari
      if ((typeof navigator.mimeTypes != 'undefined')
           && navigator.mimeTypes["application/x-googlegears"]) {
        F = document.createElement("object");
        F.style.display = "none";
        F.width = 0;
        F.height = 0;
        F.type = "application/x-googlegears";
        document.documentElement.appendChild(F);
      }
    }
  }

  // *Do not* define any objects if Gears is not installed. This mimics the
  // behavior of Gears defining the objects in the future.
  if (!F)
    return;

  // Now set up the objects, being careful not to overwrite anything.
  //
  // Note: In Internet Explorer for Windows Mobile, you can't add properties to
  // the window object. However, global objects are automatically added as
  // properties of the window object in all browsers.
  if (!window.google)
    google = {};

  if (!google.gears)
    google.gears = {factory: F};
})();

/**
 * Persist - top-level namespace for Persist library.
 * @namespace
 */
Persist = (function() {
  var VERSION = '0.2.0', P, B, esc, init, empty, ec;

  // easycookie 0.2.1 (pre-minified)
  // (see http://pablotron.org/software/easy_cookie/)
  ec = (function(){var EPOCH='Thu, 01-Jan-1970 00:00:01 GMT',RATIO=1000*60*60*24,KEYS=['expires','path','domain'],esc=escape,un=unescape,doc=document,me;var get_now=function(){var r=new Date();r.setTime(r.getTime());return r;}
var cookify=function(c_key,c_val){var i,key,val,r=[],opt=(arguments.length>2)?arguments[2]:{};r.push(esc(c_key)+'='+esc(c_val));for(i=0;i<KEYS.length;i++){key=KEYS[i];if(val=opt[key])
r.push(key+'='+val);}
if(opt.secure)
r.push('secure');return r.join('; ');}
var alive=function(){var k='__EC_TEST__',v=new Date();v=v.toGMTString();this.set(k,v);this.enabled=(this.remove(k)==v);return this.enabled;}
me={set:function(key,val){var opt=(arguments.length>2)?arguments[2]:{},now=get_now(),expire_at,cfg={};if(opt.expires){cfg.expires=new Date(now.getTime()+opt.expires*RATIO);cfg.expires=cfg.expires.toGMTString();}
var keys=['path','domain','secure'];for(i=0;i<keys.length;i++)
if(opt[keys[i]])
cfg[keys[i]]=opt[keys[i]];var r=cookify(key,val,cfg);doc.cookie=r;return val;},has:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length);return((!ofs&&key!=sub)||ofs<0)?false:true;},get:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length),end;if((!ofs&&key!=sub)||ofs<0)
return null;end=c.indexOf(';',len);if(end<0)
end=c.length;return un(c.substring(len,end));},remove:function(k){var r=me.get(k),opt={expires:EPOCH};doc.cookie=cookify(k,'',opt);return r;},keys:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push(un(p[0]));}
return r;},all:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push([un(p[0]),un(p[1])]);}
return r;},version:'0.2.1',enabled:false};me.enabled=alive.call(me);return me;}());

  // wrapper for Array.prototype.indexOf, since IE doesn't have it
  var index_of = (function() {
    if (Array.prototype.indexOf)
      return function(ary, val) { 
        return Array.prototype.indexOf.call(ary, val);
      };
    else
      return function(ary, val) {
        var i, l;

        for (i = 0, l = ary.length; i < l; i++)
          if (ary[i] == val)
            return i;

        return -1;
      };
  })();


  // empty function
  empty = function() { };

  /**
   * Escape spaces and underscores in name.  Used to generate a "safe"
   * key from a name.
   *
   * @private
   */
  esc = function(str) {
    return 'PS' + str.replace(/_/g, '__').replace(/ /g, '_s');
  };

  C = {
    /* 
     * Backend search order.
     * 
     * Note that the search order is significant; the backends are
     * listed in order of capacity, and many browsers
     * support multiple backends, so changing the search order could
     * result in a browser choosing a less capable backend.
     */ 
    search_order: [
      // TODO: air
      'cefStorage',
      'winOldStorage',
      'winStoreStorage',
      'macStorage',
      'iosStorage',
      'localChromeStorage',
      'androidStorage',
      'whatwg_db', 
      'localstorage',
      'globalstorage', 
      'cookie',
      'gears',
      'ie', 
      'flash'
    ],

    // valid name regular expression
    name_re: /^[a-z][a-z0-9_ -]+$/i,

    // list of backend methods
    methods: [
      'init', 
      'get', 
      'set', 
      'remove', 
      'load', 
      'save'
      // TODO: clear method?
    ],

    // sql for db backends (gears and db)
    sql: {
      version:  '1', // db schema version

      // XXX: the "IF NOT EXISTS" is a sqlite-ism; fortunately all the 
      // known DB implementations (safari and gears) use sqlite
      create:   "CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",
      get:      "SELECT v FROM persist_data WHERE k = ?",
      set:      "INSERT INTO persist_data(k, v) VALUES (?, ?)",
      remove:   "DELETE FROM persist_data WHERE k = ?" 
    },

    // default flash configuration
    flash: {
      // ID of wrapper element
      div_id:   '_persist_flash_wrap',

      // id of flash object/embed
      id:       '_persist_flash',

      // default path to flash object
      path: 'persist.swf',
      size: { w:1, h:1 },

      // arguments passed to flash object
      args: {
        autostart: true
      }
    } 
  };

  // built-in backends
  B = {
    // gears db backend
    // (src: http://code.google.com/apis/gears/api_database.html)
    gears: {
      // no known limit
      size:   -1,

      test: function() {
        // test for gears
        return (window.google && window.google.gears) ? true : false;
      },

      methods: {
        transaction: function(fn) {
          var db = this.db;

          // begin transaction
          db.execute('BEGIN').close();

          // call callback fn
          fn.call(this, db);

          // commit changes
          db.execute('COMMIT').close();
        },

        init: function() {
          var db;

          // create database handle (TODO: add schema version?)
          db = this.db = google.gears.factory.create('beta.database');

          // open database
          // from gears ref:
          //
          // Currently the name, if supplied and of length greater than
          // zero, must consist only of visible ASCII characters
          // excluding the following characters:
          //
          //   / \ : * ? " < > | ; ,
          //
          // (this constraint is enforced in the Store constructor)
          db.open(esc(this.name));

          // create table
          db.execute(C.sql.create).close();
        },

        get: function(key, fn, scope) {
          var r, sql = C.sql.get;

          // if callback isn't defined, then return
          if (!fn)
            return;

          // begin transaction
          this.transaction(function (t) {
            var is_valid, val;
            // exec query
            r = t.execute(sql, [key]);

            // check result and get value
            is_valid = r.isValidRow();
            val = is_valid ? r.field(0) : null;

            // close result set
            r.close();

            // call callback
            fn.call(scope || this, is_valid, val);
          });
        },

        set: function(key, val, fn, scope) {
          var rm_sql = C.sql.remove,
              sql    = C.sql.set, r;

          // begin set transaction
          this.transaction(function(t) {
            // exec remove query
            t.execute(rm_sql, [key]).close();

            // exec set query
            t.execute(sql, [key, val]).close();
            
            // run callback (TODO: get old value)
            if (fn)
              fn.call(scope || this, true, val);
          });
        },

        remove: function(key, fn, scope) {
          var get_sql = C.sql.get;
              sql = C.sql.remove,
              r, val = null, is_valid = false;

          // begin remove transaction
          this.transaction(function(t) {
            // if a callback was defined, then get the old
            // value before removing it
            if (fn) {
              // exec get query
              r = t.execute(get_sql, [key]);

              // check validity and get value
              is_valid = r.isValidRow();
              val = is_valid ? r.field(0) : null;

              // close result set
              r.close();
            }

            // exec remove query if no callback was defined, or if a
            // callback was defined and there was an existing value
            if (!fn || is_valid) {
              // exec remove query
              t.execute(sql, [key]).close();
            }

            // exec callback
            if (fn)
              fn.call(scope || this, is_valid, val);
          });
        } 
      }
    }, 

    cefStorage: {
      size:   -1,

      test: function() {
        return !!window.cefQuery;
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        query: function(method, paramString, callback) {
          cefQuery({request:method+" "+paramString,
            onSuccess: function(response) {
              callback(true, response);
            },
            onFailure: function(error_code, error_message) {
              console.error(method + " error: " + error_message);
              callback(false);
            }
          });
        },

        get: function(key, fn, scope) {
          key = this.key(key);

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          this.query("StorageGet", key, function(ok, results) {
            fn.call(scope, ok, results);
          });
        },

        set: function(key, val, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          this.query("StorageSet", key + " " + val, function(ok){
            if (fn) fn.call(scope, ok, val);
          });
          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          this.query("StorageRemove", key, function(ok) {
            // return original value? meh
            if (fn) fn.call(scope, ok);
          });
        }
      }
    },

    // whatwg db backend (webkit, Safari 3.1+)
    // (src: whatwg and http://webkit.org/misc/DatabaseExample.html)
    whatwg_db: {
      // size based on DatabaseExample from above (should I increase
      // this?)
      size:   200 * 1024,

      test: function() {
        var name = 'PersistJS Test', 
            desc = 'Persistent database test.';

        // test for openDatabase
        if (!window.openDatabase)
          return false;

        // make sure openDatabase works
        // XXX: will this leak a db handle and/or waste space?
        if (!window.openDatabase(name, C.sql.version, desc, B.whatwg_db.size))
          return false;

        // return true
        return true;
      },

      methods: {
        transaction: function(fn) {
          // lazy create database table;
          // this is done here because there is no way to
          // prevent a race condition if the table is created in init()
          if (!this.db_created) {
            this.db.transaction(function(t) {
              // create table
              t.executeSql(C.sql.create, [], function() {
                this.db_created = true;
              });
            }, empty); // trap exception
          } 

          // execute transaction
          this.db.transaction(fn);
        },

        init: function() {
          // create database handle
          this.db = openDatabase(
            this.name, 
            C.sql.version, 
            this.o.about || ("Persistent storage for " + this.name),
            this.o.size || B.whatwg_db.size 
          );
        },

        get: function(key, fn, scope) {
          var sql = C.sql.get;

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          // begin transaction
          this.transaction(function (t) {
            t.executeSql(sql, [key], function(t, r) {
              if (r.rows.length > 0)
                fn.call(scope, true, r.rows.item(0)['v']);
              else
                fn.call(scope, false, null);
            });
          });
        },

        set: function(key, val, fn, scope) {
          var rm_sql = C.sql.remove,
              sql    = C.sql.set;

          // begin set transaction
          this.transaction(function(t) {
            // exec remove query
            t.executeSql(rm_sql, [key], function() {
              // exec set query
              t.executeSql(sql, [key, val], function(t, r) {
                // run callback
                if (fn)
                  fn.call(scope || this, true, val);
              });
            });
          });

          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          var get_sql = C.sql.get;
              sql = C.sql.remove;

          this.transaction(function(t) {
            // if a callback was defined, then get the old
            // value before removing it
            if (fn) {
              // exec get query
              t.executeSql(get_sql, [key], function(t, r) {
                if (r.rows.length > 0) {
                  // key exists, get value 
                  var val = r.rows.item(0)['v'];

                  // exec remove query
                  t.executeSql(sql, [key], function(t, r) {
                    // exec callback
                    fn.call(scope || this, true, val);
                  });
                } else {
                  // key does not exist, exec callback
                  fn.call(scope || this, false, null);
                }
              });
            } else {
              // no callback was defined, so just remove the
              // data without checking the old value

              // exec remove query
              t.executeSql(sql, [key]);
            }
          });
        } 
      }
    }, 
    
    // globalstorage backend (globalStorage, FF2+, IE8+)
    // (src: http://developer.mozilla.org/en/docs/DOM:Storage#globalStorage)
    // https://developer.mozilla.org/En/DOM/Storage
    //
    // TODO: test to see if IE8 uses object literal semantics or
    // getItem/setItem/removeItem semantics
    globalstorage: {
      // (5 meg limit, src: http://ejohn.org/blog/dom-storage-answers/)
      size: 5 * 1024 * 1024,

      test: function() {
        try {
          if (window.globalStorage && window.globalStorage[this.o.domain]) return true;
        } catch (e) {}
        return false;
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = globalStorage[this.o.domain];
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store[key];

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 
    
    // localstorage backend (globalStorage, FF2+, IE8+)
    // (src: http://www.whatwg.org/specs/web-apps/current-work/#the-localstorage)
    // also http://msdn.microsoft.com/en-us/library/cc197062(VS.85).aspx#_global
    localstorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.localStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = localStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.getItem(key);

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // chrome packaged app storage
    // http://developer.chrome.com/stable/apps/storage.html
    localChromeStorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.chrome && window.chrome.storage && window.chrome.storage.local;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = chrome.storage.local;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          scope = scope || this;
          this.store.get(key, function(val){
            if (fn) fn.call(scope, true, val[key]);
          });
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          var out = {};
          out[key] = val;
          if (fn) {
            scope = scope || this;  
            this.store.set(out, function(){
              fn.call(scope, true, val);
            });
          } else {
            this.store.set(out);
          }
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          if (fn) {
            // get value first
            scope = scope || this;
            this.store.get(key, function(val){
              this.store.remove(key, function(){
                fn.call(scope, (val[key] !== null), val[key]);
              });
            });
          } else {
            this.store.remove(key);
          }
        } 
      }
    }, 
    
    // DGF Fake local storage
    androidStorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.androidStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = androidStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.getItem(key);

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // DGF iOS managed storage
    iosStorage: {
      size: -1,

      test: function() {
        try {
          return (window.isIosApp || /CoGnibus/.test(navigator.userAgent)) ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        callIos: function(scheme, path) {
          path = encodeURIComponent(path).replace(/[!~*')(]/g, function(match) {
            return "%" + match.charCodeAt(0).toString(16);
          });

          var url = scheme + "://" + path;
          setTimeout(function() {
            var iframe = document.createElement("IFRAME");
            iframe.setAttribute("src", url);
            iframe.setAttribute("style", "display:none");
            document.documentElement.appendChild(iframe);
            iframe.parentNode.removeChild(iframe);
            iframe = null;
          }, 0);
        },

        get: function(key, fn, scope) {
          if (!fn) return;
          // expand key
          key = this.key(key);

          var nonce = "storageget" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function(value) {
            delete window[nonce];
            fn.call(scope || this, true, value);
          }
          this.callIos("storageget", key + " " + nonce);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          var nonce = "storageset" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function() {
            delete window[nonce];
            if (fn) fn.call(scope || this, true, val);
          }
          this.callIos("storageset", key + " " + nonce + " " + encodeURIComponent(val));
        },

        remove: function(key, fn, scope) {
          if (fn) {
            this.get(key, function(val) {
              this._remove(key, fn, scope, val);
            }, this);
          } else {
            this._remove(key, fn, scope);
          }
        },

        _remove: function(key, fn, scope, val) {
          var val;

          // expand key
          key = this.key(key);

          // delete value
          var nonce = "storagerem" + key + (+new Date);
          var i = 0;
          while (window[nonce]) {
            nonce = "storageget" + key + (+new Date) + String(i++);
          }
          window[nonce] = function() {
            delete window[nonce];
            if (fn) fn.call(scope || this, (val !== null), val);
          }
          this.callIos("storagerem", key + " " + nonce);
        } 
      }
    }, 

    // DGF OSX managed storage
    macStorage: {
      size: -1,

      test: function() {
        try {
          return window.macStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = macStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.objectForKey_(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setObject_forKey_(val, key);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.objectForKey_(key)

          // delete value
          this.store.removeObjectForKey_(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // DGF Old win app managed storage
    winOldStorage: {
      size: -1,

      test: function() {
        try {
          return window.external.IsWinOldApp();
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = window.external;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.GetValue(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.SetValue(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.GetValue(key)

          // delete value
          this.store.DeleteValue(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

      // DGF WinStore managed storage
    winStoreStorage: {
        size: -1,

        test: function () {
            try {
                return Windows.Storage.ApplicationData.current.roamingFolder;
            } catch (e) {
                return false;
            }
        },

        methods: {
            key: function (key) {
                return esc(this.name) + esc(key);
            },

            init: function () {
                var self = this;
                function doneLoadingWinStore() {
                  self.loaded = true;
                  for (var i = self.loadListeners.length - 1; i >= 0; i--) {
                    setTimeout(self.loadListeners[i], 0);
                  }
                }
                this.loaded = false;
                this.loadListeners = [];

                Windows.Storage.ApplicationData.current.roamingFolder
                  .createFileAsync("data.txt", Windows.Storage.CreationCollisionOption.openIfExists)
                  .then(function (file) {
                    self.file = file;
                    return Windows.Storage.FileIO.readTextAsync(file);
                  }).done(function (data) {
                    self.store = {};
                    if (data && typeof data == "string") {
                      var rows = data.split("\n");
                      for (var i = rows.length - 1; i >= 0; i--) {
                        var row = rows[i].split("\t");
                        self.store[row[0]] = decodeURIComponent(row[1]);
                      }
                    }
                    doneLoadingWinStore();
                  },
                  function(){
                    self.store = {};
                    doneLoadingWinStore();
                  });
            },

            get: function (key, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.get(key, fn, scope)});
                  return;
                }
                // expand key
                key = this.key(key);

                if (fn)
                    fn.call(scope || this, true, this.store[key]);
            },

            set: function (key, val, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.set(key, val, fn, scope)});
                  return;
                }
                // expand key
                key = this.key(key);

                // set value
                this.store[key] = val;
                this.writeAsync();

                if (fn)
                    fn.call(scope || this, true, val);
            },

            remove: function (key, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.remove(key, fn, scope)});
                  return;
                }
                var val;

                // expand key
                key = this.key(key);

                // get value
                val = this.store[key];

                // delete value
                delete this.store[key];
                this.writeAsync();

                if (fn)
                    fn.call(scope || this, (val !== null), val);
            },

            writeAsync: function() {
              var output = [];
              for (var key in this.store) {
                output.push(key, '\t', encodeURIComponent(this.store[key]), '\n');
              }
              Windows.Storage.FileIO.writeTextAsync(this.file, output.join(''));
            }
        }
    },

    // IE backend
    ie: {
      prefix:   '_persist_data-',
      // style:    'display:none; behavior:url(#default#userdata);',

      // 64k limit
      size:     64 * 1024,

      test: function() {
        // make sure we're dealing with IE
        // (src: http://javariet.dk/shared/browser_dom.htm)
        return window.ActiveXObject ? true : false;
      },

      make_userdata: function(id) {
        var el = document.createElement('div');

        // set element properties
        // http://msdn.microsoft.com/en-us/library/ms531424(VS.85).aspx 
        // http://www.webreference.com/js/column24/userdata.html
        el.id = id;
        el.style.display = 'none';
        el.addBehavior('#default#userdata');

        // append element to body
        document.body.appendChild(el);

        // return element
        return el;
      },

      methods: {
        init: function() {
          var id = B.ie.prefix + esc(this.name);

          // save element
          this.el = B.ie.make_userdata(id);

          // load data
          if (this.o.defer)
            this.load();
        },

        get: function(key, fn, scope) {
          var val;

          // expand key
          key = esc(key);

          // load data
          if (!this.o.defer)
            this.load();

          // get value
          val = this.el.getAttribute(key);

          // call fn
          if (fn)
            fn.call(scope || this, val ? true : false, val);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = esc(key);
          
          // set attribute
          this.el.setAttribute(key, val);

          // save data
          if (!this.o.defer)
            this.save();

          // call fn
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = esc(key);

          // load data
          if (!this.o.defer)
            this.load();

          // get old value and remove attribute
          val = this.el.getAttribute(key);
          this.el.removeAttribute(key);

          // save data
          if (!this.o.defer)
            this.save();

          // call fn
          if (fn)
            fn.call(scope || this, val ? true : false, val);
        },

        load: function() {
          this.el.load(esc(this.name));
        },

        save: function() {
          this.el.save(esc(this.name));
        }
      }
    },

    // cookie backend
    // uses easycookie: http://pablotron.org/software/easy_cookie/
    cookie: {
      delim: ':',

      // 4k limit (low-ball this limit to handle browser weirdness, and 
      // so we don't hose session cookies)
      size: 4000,

      test: function() {
        // XXX: use easycookie to test if cookies are enabled
        return P.Cookie.enabled ? true : false;
      },

      methods: {
        key: function(key) {
          return this.name + B.cookie.delim + key;
        },

        get: function(key, fn, scope) {
          var val;

          // expand key 
          key = this.key(key);

          // get value
          val = ec.get(key);

          // call fn
          if (fn)
            fn.call(scope || this, val != null, val);
        },

        set: function(key, val, fn, scope) {
          // expand key 
          key = this.key(key);

          // save value
          ec.set(key, val, this.o);

          // call fn
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, val, fn, scope) {
          var val;

          // expand key 
          key = this.key(key);

          // remove cookie
          val = ec.remove(key)

          // call fn
          if (fn)
            fn.call(scope || this, val != null, val);
        } 
      }
    },

    // flash backend (requires flash 8 or newer)
    // http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_16194&sliceId=1
    // http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002200.html
    flash: {
      test: function() {
        // TODO: better flash detection
        if (!window.deconcept || !window.deconcept.SWFObjectUtil)
          return false;

        // get the major version
        var major = deconcept.SWFObjectUtil.getPlayerVersion().major;

        // check flash version (require 8.0 or newer)
        return (major >= 8) ? true : false;
      },

      methods: {
        init: function() {
          if (!B.flash.el) {
            var o, key, el, cfg = C.flash;

            // create wrapper element
            el = document.createElement('div');
            el.id = cfg.div_id;

            // FIXME: hide flash element
            // el.style.display = 'none';

            // append element to body
            document.body.appendChild(el);

            // create new swf object
            o = new deconcept.SWFObject(this.o.swf_path || cfg.path, cfg.id, cfg.size.w, cfg.size.h, '8');

            // set parameters
            for (key in cfg.args)
              o.addVariable(key, cfg.args[key]);

            // write flash object
            o.write(el);

            // save flash element
            B.flash.el = document.getElementById(cfg.id);
          }

          // use singleton flash element
          this.el = B.flash.el;
        },

        get: function(key, fn, scope) {
          var val;

          // escape key
          key = esc(key);

          // get value
          val = this.el.get(this.name, key);

          // call handler
          if (fn)
            fn.call(scope || this, val !== null, val);
        },

        set: function(key, val, fn, scope) {
          var old_val;

          // escape key
          key = esc(key);

          // set value
          old_val = this.el.set(this.name, key, val);

          // call handler
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // get key
          key = esc(key);

          // remove old value
          val = this.el.remove(this.name, key);

          // call handler
          if (fn)
            fn.call(scope || this, true, val);
        }
      }
    }
  };

  /**
   * Test for available backends and pick the best one.
   * @private
   */
  var init = function() {
    var i, l, b, key, fns = C.methods, keys = C.search_order;

    // set all functions to the empty function
    for (i = 0, l = fns.length; i < l; i++) 
      P.Store.prototype[fns[i]] = empty;

    // clear type and size
    P.type = null;
    P.size = -1;

    // loop over all backends and test for each one
    for (i = 0, l = keys.length; !P.type && i < l; i++) {
      b = B[keys[i]];

      // test for backend
      try {
        if (b.test()) {
          // found backend, save type and size
          P.type = keys[i];
          P.size = b.size;

          // extend store prototype with backend methods
          for (key in b.methods)
            P.Store.prototype[key] = b.methods[key];
        }
      } catch (e) {}
    }

    // mark library as initialized
    P._init = true;
  };

  // create top-level namespace
  P = {
    // version of persist library
    VERSION: VERSION,

    // backend type and size limit
    type: null,
    size: 0,

    // XXX: expose init function?
    // init: init,

    add: function(o) {
      // add to backend hash
      B[o.id] = o;

      // add backend to front of search order
      C.search_order = [o.id].concat(C.search_order);

      // re-initialize library
      init();
    },

    remove: function(id) {
      var ofs = index_of(C.search_order, id);
      if (ofs < 0)
        return;

      // remove from search order
      C.search_order.splice(ofs, 1);

      // delete from lut
      delete B[id];

      // re-initialize library
      init();
    },

    // expose easycookie API
    Cookie: ec,

    // store API
    Store: function(name, o) {
      // verify name
      if (!C.name_re.exec(name))
        throw new Error("Invalid name");

      // XXX: should we lazy-load type?
      // if (!P._init)
      //   init();

      if (!P.type)
        throw new Error("No suitable storage found");

      o = o || {};
      this.name = name;

      // get domain (XXX: does this localdomain fix work?)
      o.domain = o.domain || location.host || 'localhost';
      
      // strip port from domain (XXX: will this break ipv6?)
      o.domain = o.domain.replace(/:\d+$/, '')

      // append localdomain to domains w/o '."
      // (see https://bugzilla.mozilla.org/show_bug.cgi?id=357323)
      // (file://localhost/ works, see: 
      // https://bugzilla.mozilla.org/show_bug.cgi?id=469192)
/* 
 *       if (!o.domain.match(/\./))
 *         o.domain += '.localdomain';
 */ 

      this.o = o;

      // expires in 2 years
      o.expires = o.expires || 365 * 2;

      // set path to root
      o.path = o.path || '/';

      // call init function
      this.init();
    } 
  };

  // init persist
  init();

  // return top-level namespace
  return P;
})();

;
/**
 * alertify
 * An unobtrusive customizable JavaScript notification system
 *
 * @author Fabien Doiron <fabien.doiron@gmail.com>
 * @copyright Fabien Doiron 2012
 * @license MIT <http://opensource.org/licenses/mit-license.php>
 * @link http://fabien-d.github.com/alertify.js/
 * @module alertify
 * @version 0.3.0
 */
(function(e,t){"use strict";var n=e.document,r;r=function(){var r={},i={},s=!1,o={ENTER:13,ESC:27,SPACE:32},u=[],a,f,l,c,h;return i={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok" />{{ok}}</button>',ok:'<a href="#" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</a>',cancel:'<a href="#" class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</a>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},a=function(e){return n.getElementById(e)},r={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,addListeners:function(r){var i=a("alertify-resetFocus"),s=a("alertify-ok")||t,u=a("alertify-cancel")||t,f=a("alertify-text")||t,l=a("alertify-form")||t,c=typeof s!="undefined",h=typeof u!="undefined",p=typeof f!="undefined",d="",v=this,m,g,y,b,w;m=function(e){typeof e.preventDefault!="undefined"&&e.preventDefault(),y(e),typeof f!="undefined"&&(d=f.value),typeof r=="function"&&r(!0,d)},g=function(e){typeof e.preventDefault!="undefined"&&e.preventDefault(),y(e),typeof r=="function"&&r(!1)},y=function(e){v.hide(),v.unbind(n.body,"keyup",b),v.unbind(i,"focus",w),p&&v.unbind(l,"submit",m),c&&v.unbind(s,"click",m),h&&v.unbind(u,"click",g)},b=function(e){var t=e.keyCode;t===o.SPACE&&!p&&m(e),t===o.ESC&&h&&g(e)},w=function(e){p?f.focus():h?u.focus():s.focus()},this.bind(i,"focus",w),c&&this.bind(s,"click",m),h&&this.bind(u,"click",g),this.bind(n.body,"keyup",b),p&&this.bind(l,"submit",m),e.setTimeout(function(){f?(f.focus(),f.select()):s.focus()},50)},bind:function(e,t,n){typeof e.addEventListener=="function"?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},build:function(e){var t="",n=e.type,r=e.message,s=e.cssClass||"";t+='<div class="alertify-dialog">',n==="prompt"&&(t+='<form id="alertify-form">'),t+='<article class="alertify-inner">',t+=i.message.replace("{{message}}",r),n==="prompt"&&(t+=i.input),t+=i.buttons.holder,t+="</article>",n==="prompt"&&(t+="</form>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>";switch(n){case"confirm":t=t.replace("{{buttons}}",i.buttons.cancel+i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",i.buttons.cancel+i.buttons.submit),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok);break;default:}return c.className="alertify alertify-show alertify-"+n+" "+s,l.className="alertify-cover",t},close:function(e,t){var n=t&&!isNaN(t)?+t:this.delay;this.bind(e,"click",function(){h.removeChild(e)}),setTimeout(function(){typeof e!="undefined"&&e.parentNode===h&&h.removeChild(e)},n)},dialog:function(e,t,r,i,o){f=n.activeElement;var a=function(){if(c&&c.scrollTop!==null)return;a()};if(typeof e!="string")throw new Error("message must be a string");if(typeof t!="string")throw new Error("type must be a string");if(typeof r!="undefined"&&typeof r!="function")throw new Error("fn must be a function");return typeof this.init=="function"&&(this.init(),a()),u.push({type:t,message:e,callback:r,placeholder:i,cssClass:o}),s||this.setup(),this},extend:function(e){if(typeof e!="string")throw new Error("extend method must have exactly one paramter");return function(t,n){return this.log(t,e,n),this}},hide:function(){u.splice(0,1),u.length>0?this.setup():(s=!1,c.className="alertify alertify-hide alertify-hidden",l.className="alertify-cover alertify-hidden",f?f.focus():null)},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),l=n.createElement("div"),l.setAttribute("id","alertify-cover"),l.className="alertify-cover alertify-hidden",n.body.appendChild(l),c=n.createElement("section"),c.setAttribute("id","alertify"),c.className="alertify alertify-hidden",n.body.appendChild(c),h=n.createElement("section"),h.setAttribute("id","alertify-logs"),h.className="alertify-logs",n.body.appendChild(h),n.body.setAttribute("tabindex","0"),delete this.init},log:function(e,t,n){var r=function(){if(h&&h.scrollTop!==null)return;r()};return typeof this.init=="function"&&(this.init(),r()),this.notify(e,t,n),this},notify:function(e,t,r){var i=n.createElement("article");i.className="alertify-log"+(typeof t=="string"&&t!==""?" alertify-log-"+t:""),i.innerHTML=e,h.insertBefore(i,h.firstChild),setTimeout(function(){i.className=i.className+" alertify-log-show"},50),this.close(i,r)},set:function(e){var t;if(typeof e!="object"&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setup:function(){var e=u[0];s=!0,c.innerHTML=this.build(e),typeof e.placeholder=="string"&&e.placeholder!==""&&(a("alertify-text").value=e.placeholder),this.addListeners(e.callback)},unbind:function(e,t,n){typeof e.removeEventListener=="function"?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}},{alert:function(e,t,n){return r.dialog(e,"alert",t,"",n),this},confirm:function(e,t,n){return r.dialog(e,"confirm",t,"",n),this},extend:r.extend,init:r.init,log:function(e,t,n){return r.log(e,t,n),this},prompt:function(e,t,n,i){return r.dialog(e,"prompt",t,n,i),this},success:function(e,t){return r.log(e,"success",t),this},error:function(e,t){return r.log(e,"error",t),this},set:function(e){r.set(e)},labels:r.labels}},typeof define=="function"?define([],function(){return new r}):typeof e.alertify=="undefined"&&(e.alertify=new r)})(this);
;
/*
 * Copyright 2010 by Dan Fabulich.
 * 
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 * 
 * See the License for the specific language governing
 * permissions and limitations under the License.
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */

_global = typeof globalThis !== "undefined" ? globalThis : this;

(function() {
  var userAgent, url, protocol, appMeta;
  if (typeof window !== "undefined") {
    userAgent = navigator.userAgent;
    url = window.location.href;
    protocol = window.location.protocol;
    appMeta = window.document.querySelector("meta[name=apple-itunes-app]");
  }
  _global.isWebOS = /webOS/.test(userAgent);
  _global.isMobile = _global.isWebOS || /Mobile/.test(userAgent);
  _global.isFile = /^file:/.test(url);
  _global.isXul = /^chrome:/.test(url);
  try {
    _global.greenworks = require('greenworks');
    _global.isGreenworks = true;
  } catch (ignored) {}
  _global.isWinOldApp = false;
  try {
    isWinOldApp = window.external.IsWinOldApp();
  } catch (ignored) {}
  _global.isAndroid = /Android/.test(userAgent);
  _global.isOmnibusApp = /CoGnibus/.test(userAgent);
  _global.isIosApp = _global.isIosApp || (_global.isOmnibusApp && !_global.isAndroid);
  _global.isAndroidApp = _global.isAndroidApp || (_global.isOmnibusApp && _global.isAndroid);
  _global.isAmazonAndroidApp = _global.isAmazonAndroidApp || (_global.isAndroidApp && _global.flavor && _global.flavor.isAmazon());
  _global.isWeb = !_global.isIosApp && !_global.isAndroidApp && !_global.isWinOldApp && /^https?:/.test(url);
  _global.isSecureWeb = /^https:?$/.test(protocol);
  _global.isSafari = /Safari/.test(userAgent);
  _global.isIE = /(MSIE|Trident)/.test(userAgent);
  _global.isIPad = /iPad/.test(userAgent);
  _global.isIPhone = /iPhone/.test(userAgent);
  _global.isKindleFire = /Kindle Fire/.test(userAgent);
  _global.isWinStoreApp = "ms-appx:" == protocol;
  _global.isCef = !!_global.cefQuery;
  _global.isNode = typeof process !== "undefined";
  _global.isHeartsChoice = appMeta && /1487052276/.test(appMeta.getAttribute("content"))
})();

_global.loadTime = new Date().getTime();

function callIos(scheme, path) {
  if (!_global.isIosApp) return;
  if (typeof webkit !== "undefined" && webkit.messageHandlers) {
    return webkit.messageHandlers.choicescript.postMessage([scheme, path]);
  }
  if (path) {
    path = encodeURIComponent(path).replace(/[!~*')(]/g, function(match) {
      return "%" + match.charCodeAt(0).toString(16);
    });
  } else {
    path = "";
  }
  setTimeout(function() {
    var iframe = document.createElement("IFRAME");
    iframe.setAttribute("src", scheme + "://" + path);
    iframe.setAttribute("style", "display:none");
    document.documentElement.appendChild(iframe);
    iframe.parentNode.removeChild(iframe);
    iframe = null;
  }, 0);
}

function safeCall(obj, fn) {
    if (!fn) return;
    var isHeadless = typeof window == "undefined";
    var debug = false || (!isHeadless && window.debug);
    if (isIE || isHeadless) {
        // just call through; onerror will be called and debugger will handle it
        if (typeof MSApp != "undefined") {
            if (obj) {
                MSApp.execUnsafeLocalFunction(function () { fn.call(obj); });
            } else {
                MSApp.execUnsafeLocalFunction(fn);
            }
        } else if (obj) {
            fn.call(obj);
        } else {
            fn.call();
        }
    } else {
        try {
            if (obj) {
                fn.call(obj);
            } else {
                fn.call();
            }
        } catch (e) {
            if (e.message) {
              window.onerror(e.message, e.fileName, e.lineNumber, e.stack);
            } else if (e.stack) {
              window.onerror(e.stack, e.fileName, e.lineNumber, e.stack);
            } else {
              window.onerror(toJson(e, '\n'));
            }

            if (window.console) {
              window.console.error(e);
              if (e.message) window.console.error("Message: " + e.message);
              if (e.stack) window.console.error("Stack: " + e.stack);
            }
            // Rethrow here so the debugger can handle it
            // On Firefox this causes a second prompt.  Meh!
            if (debug) throw e;
        }
    }
}

function safeCallback(callback) {
  return function() {
    safeCall(null, callback);
  };
}

function safeTimeout(fn, time) {
  setTimeout(function() {
    safeCall(null, fn);
  }, time);
}

function isDefined(x) {
    return "undefined" !== typeof x;
}

function jsonStringifyAscii(obj) {
  var output = JSON.stringify(obj).replace(/(.)/g, function(x) {
    var code = x.charCodeAt(0);
    if (code > 127 || code < 32) {
     var outCode = code.toString(16);
     switch (outCode.length) {
       case 4:
         return "\\u" + outCode;
       case 3:
         return "\\u0" + outCode;
       case 2:
         return "\\u00" + outCode;
       case 1:
         return "\\u000" + outCode;
       default:
         return x;
     }
    }
    return x;
  });
  return output;
}

function toJson(obj, standardized) {
 if (typeof JSON != "undefined" && JSON.stringify) {
  return jsonStringifyAscii(obj);
 }
 switch (typeof obj) {
  case 'object':
   if (obj) {
    var list = [];
    if (obj instanceof Array) {
     for (var i=0;i < obj.length;i++) {
      list.push(toJson(obj[i], standardized));
     }
     return '[' + list.join(',') + ']';
    } else {
     for (var prop in obj) {
      if (prop == "scene") continue;
      if (!standardized && /^[a-zA-Z][a-zA-Z_0-9]\w+$/.test(prop) && !/\b(abstract|boolean|break|byte|case|catch|char|class|comment|const|continue|debugger|default|delete|do|double|else|enum|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|label|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throws|transient|true|try|typeof|var|void|volatile|while|with)\b/.test(prop)) {
        list.push(prop + ':' + toJson(obj[prop], standardized));
      } else {
        list.push('"' + prop + '":' + toJson(obj[prop], standardized));
      }
     }
     return '{' + list.join(',') + '}';
    }
   } else {
    return 'null';
   }
   break;
  case 'string':
   var encoded = obj.replace(/(.)/g, function(x) {
     if (x == "'" || x == '"' || x == '\\') {
       return "\\" + x;
     }
     var code = x.charCodeAt(0);
     if (code > 127 || code < 32) {
       var outCode = code.toString(16);
       switch (outCode.length) {
         case 4:
           return "\\u" + outCode;
         case 3:
           return "\\u0" + outCode;
         case 2:
           return "\\u00" + outCode;
         case 1:
           return "\\u000" + outCode;
         default:
           return x;
       }
     }
     return x;
   });
   return '"' + encoded + '"';
  case 'number':
  case 'boolean':
   return String(obj);
  case 'function':
   return 'badfunction';
  case 'undefined':
    return 'undefined';
  default:
   throw new Error("invalid type: " + typeof obj);
 }
}

var loginUrlBase = "https://www.choiceofgames.com/api/";
function xhrAuthRequest(method, endpoint, callback) {
  var paramBuilder = new Array(arguments.length*3);
  for (var i = 3; i < arguments.length; i=i+2) {
    if (i > 3) paramBuilder.push("&");
    paramBuilder.push(arguments[i]);
    paramBuilder.push("=");
    paramBuilder.push(arguments[i+1]);
  }
  var params = paramBuilder.join("");
  var xhr = findXhr();
  if (method == "POST") {
    xhr.open(method, loginUrlBase + endpoint + ".php", true);
    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  } else {
    xhr.open(method, loginUrlBase + endpoint + ".php?" + params, true);
  }

  var done = false;

  xhr.onreadystatechange = function() {
    if (done) return;
    if (xhr.readyState != 4) return;
    done = true;
    var ok = xhr.status == 200;
    var response = {};
    try {
      if (xhr.responseText) response = JSON.parse(xhr.responseText);
    } catch (e) {
      ok = false;
    }
    if (!ok) {
      if (!response.error) response.error = "unknown error";
      response.status = xhr.status;
    }
    if (callback) safeCall(null, function() {callback(ok, response);});
  };
  xhr.send(params);
}

function login(email, password, register, subscribe, callback) {
  xhrAuthRequest("POST", "login", callback, "email", encodeURIComponent(email), "password", encodeURIComponent(password), "register", register, "subscribe", subscribe);
}

function forgotPassword(email, callback) {
  xhrAuthRequest("POST", "forgot", callback, "email", encodeURIComponent(email));
}

function logout(callback) {
  document.cookie = 'login=0;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
  xhrAuthRequest("GET", "logout", callback);
  recordLogin(false);
  window.knownPurchases = null;
  window.registered = false;
  if (typeof FB != "undefined" && FB.logout) FB.logout();
  if (typeof gapi != "undefined" && gapi.auth && gapi.auth.signOut) gapi.auth.signOut();
}

function recordLogin(registered, loginId, email, callback) {
  if (initStore()) {
    if (registered) recordEmail(email);
    window.store.set("login", loginId || 0, function() {safeCall(null, callback);});
    window.registered = registered;
  } else {
    safeTimeout(callback, 0);
  }
}

function getRemoteEmail(callback) {
  xhrAuthRequest("GET", "getuser", callback);
}

function saveCookie(callback, slot, stats, temps, lineNum, indent) {
    var value = computeCookie(stats, temps, lineNum, indent);
    return writeCookie(value, slot, callback);
}

function computeCookie(stats, temps, lineNum, indent) {
  var scene = stats.scene;
  delete stats.scene;
  if (scene) stats.sceneName = scene.name;
  var version = "UNKNOWN";
  if (typeof(window) != "undefined" && window && window.version) version = window.version;
  var value = toJson({version:version, stats:stats, temps:temps, lineNum: lineNum, indent: indent});
  stats.scene = scene;
  return value;
}

function writeCookie(value, slot, callback) {
  if (!_global.pseudoSave) _global.pseudoSave = {};
  if (!slot) {
    slot = "";
  }
  _global.pseudoSave[slot] = value;
  if (!initStore()) {
    if (callback) safeTimeout(callback, 0);
    return;
  }
  window.store.set("state"+slot, value, safeCallback(callback));
}

function clearCookie(callback, slot) {
    writeCookie('', slot, safeCallback(callback));
}

function areSaveSlotsSupported() {
  return !!(initStore() && window.Persist.type != "cookie");
}

function recordSave(slot, callback) {
  if (!areSaveSlotsSupported()) {
    safeTimeout(callback, 0);
    return;
  }
  restoreObject(initStore(), "save_list", [], function (saveList) {
    saveList.push(slot);
    window.store.set("save_list", toJson(saveList), safeCallback(callback));
  });
}

function recordDirtySlots(slots, callback) {
  if (!areSaveSlotsSupported()) {
    safeTimeout(callback, 0);
    return;
  }
  restoreObject(initStore(), "dirty_save_list", [], function (saveList) {
    saveSet = {};
    for (var i = 0; i < saveList.length; i++) {
      saveSet[saveList[i]] = 1;
    }
    for (i = 0; i < slots.length; i++) {
      if (!saveSet[slots[i]]) saveList.push(slots[i]);
    }
    window.store.set("dirty_save_list", toJson(saveList), safeCallback(callback));
  });
}

function recordEmail(email, callback) {
  if (initStore()) {
    window.recordedEmail = email;
    window.store.set("email", email, safeCallback(callback));
  } else {
    safeTimeout(callback, 0);
  }
}

function fetchEmail(callback) {
  if (!initStore()) {
    safeTimeout(function(){callback("");}, 0);
    return;
  }
  if (window.recordedEmail) {
    return safeTimeout(function() {
      callback(window.recordedEmail);
    })
  }
  if (window.isWeb) {
    var cookieEmail = getCookieByName("login");
    if (/@/.test(cookieEmail)) {
      return recordEmail(cookieEmail, function() {
        callback(cookieEmail);
      });
    }
  }
  // For some reason, this get seems to not respond sometimes
  // adding a fallback timeout
  window.store.get("email", function(ok, value) {
    safeCall(null, function() {
      if (ok) window.recordedEmail = value;
      if (!callback) return;
      var temp = callback;
      callback = null;
      if (ok && value) {
        temp(value);
      } else {
        temp("");
      }
    });
  });
  safeTimeout(function() {
    if (!callback) return;
    var temp = callback;
    callback = null;
    temp("");
  }, 1000);
}

function restoreObject(store, key, defaultValue, callback) {
  if (!store) {
    safeTimeout(function() {callback(defaultValue);}, 0);
    return;
  }
  store.get(key, function(ok, value) {
    var result = defaultValue;
    if (ok && value) {
      try{
        result = jsonParse(value);
      } catch (e) {}
    }
    safeCall(null, function() {callback(result);});
  });
}

function getDirtySaveList(callback) {
  restoreObject(initStore(), "dirty_save_list", [], function (slotList) {
    callback(slotList);
  });
}

function remoteSaveMerger(i, callback) {
  var remoteStore = new Persist.Store(window.remoteStoreNames[i]);
  restoreObject(remoteStore, "save_list", [], function (remoteSlotList) {
    fetchSavesFromSlotList(remoteStore, remoteSlotList, 0, [], function(remoteSaveList) {
      mergeRemoteSaves(remoteSaveList, 0/*recordDirty*/, function() {
        i++;
        if (i < window.remoteStoreNames.length) {
          remoteSaveMerger(i, callback);
        } else {
          callback.apply(null, arguments);
        }
      });
    });
  });
}

function getSaves(callback) {
  if (window.remoteStoreNames && window.remoteStoreNames.length) {
    remoteSaveMerger(0, callback);
  } else if (window.remoteStoreName && window.storeName != window.remoteStoreName) {
    var remoteStore = new Persist.Store(window.remoteStoreName);
    restoreObject(remoteStore, "save_list", [], function (remoteSlotList) {
      fetchSavesFromSlotList(remoteStore, remoteSlotList, 0, [], function(remoteSaveList) {
        mergeRemoteSaves(remoteSaveList, 0/*recordDirty*/, callback);
      });
    });
  } else {
    restoreObject(initStore(), "save_list", [], function (localSlotList) {
      fetchSavesFromSlotList(initStore(), localSlotList, 0, [], callback);
    });
  }
}

function fetchSavesFromSlotList(store, slotList, i, saveList, callback) {
  if (i >= slotList.length) {
    return safeCall(null, function() {callback(saveList);});
  }
  restoreObject(store, "state"+slotList[i], null, function(saveState) {
    if (saveState) {
      saveState.timestamp = slotList[i].substring(4/*"save".length*/);
      saveList.push(saveState);
    }
    fetchSavesFromSlotList(store, slotList, i+1, saveList, callback);
  });
}

function isWebSavePossible() {
  if (!initStore()) return false;
  if (/^http/.test(window.location.protocol)) {
    return document.domain == window.webSaveDomain || document.domain == "localhost";
  }
  // if it's a file URL with a valid store, either you're a 3rd party developer
  // who knows what you're doing, or you're a mobile app
  return true;
}


webSaveDomain = "www.choiceofgames.com";
webSaveUrl = "https://" + webSaveDomain + "/ajax_proxy.php/websave";

function submitRemoteSave(slot, email, subscribe, callback) {
  if (!isWebSavePossible()) return safeTimeout(function() { callback(false); });
  window.store.get("state"+slot, function(ok, value) {
    if (ok) {
      var timestamp = slot.substring(4/*"save".length*/);
      var xhr = findXhr();
      var gameName = window.remoteStoreName || window.storeName;
      var params = "email="+email+"&game="+gameName+"&realGame="+window.storeName+"&json="+encodeURIComponent(value)+"&timestamp="+ timestamp+"&subscribe="+subscribe;
      xhr.open("POST", webSaveUrl,true);
      xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      var done = false;

      xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        done = true;
        var ok = xhr.status == 200;
        if (ok) {
          safeCall(null, function() {callback(true);});
        } else {
          recordDirtySlots([slot], function() {
            safeCall(null, function() {callback(false);});
          });
        }
      };
      xhr.send(params);
    } else {
      recordDirtySlots([slot], function() {
        asyncAlert("There was a problem uploading the saved game. This is probably a bug; please contact support@choiceofgames.com with code 17891.", function() {
          safeCall(null, function() {callback(false);});
        });
      });
    }
  });
}

function submitDirtySaves(dirtySaveList, email, callback) {
  function submitDirtySave(i) {
    if (dirtySaveList[i]) {
      submitRemoteSave(dirtySaveList[i], email, false, function(ok) {
        if (ok) {
          submitDirtySave(i+1);
        } else {
          safeCall(null, function() {callback(false);});
        }
      });
    } else {
      window.store.remove("dirty_save_list", function() {
        safeCall(null, function() {callback(true);});
      });
    }
  }
  submitDirtySave(0);
}

function submitAnyDirtySaves(callback) {
  if (!callback) callback = function(ok) {};
  try {
    getDirtySaveList(function(dirtySaveList) {
      if (dirtySaveList && dirtySaveList.length) {
        try {
          fetchEmail(function(email) {
            if (email) {
              submitDirtySaves(dirtySaveList, email, callback);
            } else {
              callback(false);
            }
          });
        } catch (e) {
          callback(false);
        }
      }
    });
  } catch (e) {
    callback(false);
  }
}

function getRemoteSaves(email, callback) {
  if (!isWebSavePossible()) {
    safeTimeout(function() {callback([]);}, 0);
    return;
  }
  var xhr = findXhr();
  var gameName = window.remoteStoreName || window.storeName;
  xhr.open("GET", webSaveUrl + "?email="+email+"&game="+gameName, true);
  var done = false;
  xhr.onreadystatechange = function() {
    if (done) return;
    if (xhr.readyState != 4) return;
    done = true;
    if (xhr.status != 200) {
      if (window.console) console.log("Couldn't load remote saves. " + xhr.status + ": " + xhr.responseText);
      safeCall(null, function() {callback(null);});
    } else {
      var result = xhr.responseText;
      result = jsonParse(result);
      var remoteSaveList = [];
      for (var i = 0; i < result.length; i++) {
        if (!result[i]) continue;
        var save = result[i].json;
        if (!save) continue;
        save.timestamp = result[i].timestamp;
        remoteSaveList.push(save);
      }
      safeCall(null, function() {callback(remoteSaveList);});
    }
  };
  xhr.send();
}

function mergeRemoteSaves(remoteSaveList, recordDirty, callback) {
  if (!isWebSavePossible()) {
    safeTimeout(function() { callback([], 0, []); }, 0);
    return;
  }
  restoreObject(initStore(), "save_list", [], function (localSlotList) {
    fetchSavesFromSlotList(initStore(), localSlotList, 0, [], function(localSaveList) {
      var localSlotMap = {};
      for (var i = 0; i < localSlotList.length; i++) {
        localSlotMap[localSlotList[i]] = 1;
      }
      var remoteSlotMap = {};
      for (i = 0; i < remoteSaveList.length; i++) {
        remoteSlotMap["save"+remoteSaveList[i].timestamp] = 1;
      }
      var newRemoteSaves = 0;
      for (i = 0; i < remoteSaveList.length; i++) {
        var remoteSave = remoteSaveList[i];
        var slot = "save"+remoteSave.timestamp;
        if (!localSlotMap[slot]) {
          saveCookie(null, slot, remoteSave.stats, remoteSave.temps, remoteSave.lineNum, remoteSave.indent);
          localSlotList.push(slot);
          localSaveList.push(remoteSave);
          newRemoteSaves++;
        }
      }

      var dirtySaveList = [];
      for (i = 0; i < localSlotList.length; i++) {
        if (!remoteSlotMap[localSlotList[i]]) {
          dirtySaveList.push(localSlotList[i]);
        }
      }

      if (recordDirty) {
        window.store.set("dirty_save_list", toJson(dirtySaveList), finale);
      } else {
        finale();
      }

      function finale() {
        if (newRemoteSaves) {
          window.store.set("save_list", toJson(localSlotList), function() {
            safeCall(null, function() { callback(localSaveList, newRemoteSaves, dirtySaveList); });
          });
        } else {
          safeCall(null, function() {callback(localSaveList, newRemoteSaves, dirtySaveList);});
        }
      }
    });
  });
}

function getAppId() {
  if (window.isIosApp) {
    var appBanner = document.querySelector("meta[name=apple-itunes-app]");
    return /app-id=(\d+)/.exec(appBanner.getAttribute("content"))[1];
  } else if (window.isAndroidApp) {
    var androidLink = document.getElementById('androidLink');
    return /id=([\.\w]+)/.exec(androidLink.href)[1];
  }
}

function submitReceipts(receipts, callback) {
  console.log("submitReceipts: " + JSON.stringify(receipts));
  if (!callback) callback = function(error) {
    if (window.transferPurchaseCallback) {
      window.transferPurchaseCallback(error || "done");
    }
  };
  var appId = receipts.appId;
  var count = 0;
  var error;
  function submitCallback(product) {
    return function submitCallback(ok, response) {
      if (!ok) {
        console.log("failed: " + product + " " + JSON.stringify(response));
        if (!error) {
          var match = /^receipt transaction already processed: (\d+) current login (\d+)$/.exec(response.error);
          if (match) {
            callback("409-" + match[1] + "-" + match[2]);
          } else {
            callback("" + response.status + "r");
          }
        }
        error = true;
      }
      if (error) return;
      count--;
      if (!count) {
        if (!receipts.avoidOverrides) cacheKnownPurchases(response);
        callback();
      }
    }
  }

  if (window.isAndroidApp) {
    window.store.get("login", function(ok, loginId) {
      loginId = loginId || 0;
      var platform = window.isAmazonAndroidApp ? 'amazon' : 'google';
      if (receipts.prePurchased && platform === 'google') {
        for (var i = 0; i < receipts.prePurchased.length; i++) {
          var product = receipts.prePurchased[i];
          count++;
          xhrAuthRequest("POST", "submit-device-receipt", submitCallback(product),
            'platform', platform,
            'company', receipts.company,
            'game_id', window.storeName,
            'app_package', appId,
            'product_id', product,
            'signature', encodeURIComponent(receipts.signature),
            'receipt', encodeURIComponent(receipts.signedData),
            'login_id', loginId
          );
        }
      }
      if (receipts.iaps) {
        for (var product in receipts.iaps) {
          count++;
          xhrAuthRequest("POST", "submit-device-receipt", submitCallback(product),
            'platform', platform,
            'company', receipts.company,
            'game_id', window.storeName,
            'app_package', appId,
            'product_id', product,
            'receipt', encodeURIComponent(receipts.iaps[product]),
            'login_id', loginId
          );
        }
      }
      if (!count) safeTimeout(function () { callback(); }, 0);
    });
  } else {
    callback("error");
  }
}

function delayBreakStart(callback) {
  var nowInSeconds = Math.floor(new Date().getTime() / 1000);
  if (!initStore()) {
    safeTimeout(function() {callback(nowInSeconds);}, 0);
    return;
  }
  window.store.get("delayBreakStart", function(ok, value) {
    var valueNum = value*1;
    safeCall(null, function() {
      if (ok && value && !isNaN(valueNum)) {
        callback(valueNum);
      } else {
        window.store.set("delayBreakStart", nowInSeconds);
        callback(nowInSeconds);
      }
    });
  });
}

function delayBreakEnd() {
  if (initStore()) window.store.remove("delayBreakStart");
}

function initStore() {
  if (!window.storeName) return false;
  if (window.store) return window.store;
  try {
    window.store = new Persist.Store(window.storeName);
  } catch (e) {}
  return window.store;
}
function loadAndRestoreGame(slot, forcedScene) {
  function valueLoaded(ok, value) {
    safeCall(null, function() {
      var state = null;
      if (ok && value && ""+value) {
        //console.log("successfully loaded slot " + slot);
        state = jsonParse(value);
      } else if (slot == "backup") {
        console.log("loadAndRestoreGame couldn't find backup");
        if (typeof alertify !== "undefined") alertify.log("Failed restarting chapter. Restarting the game from scratch.");
        return restartGame();
      }
      restoreGame(state, forcedScene);
    });
  }
  if (!slot) slot = "";
  if (_global.pseudoSave && pseudoSave[slot]) return valueLoaded(true, pseudoSave[slot]);
  if (!initStore()) return restoreGame(null, forcedScene);
  window.store.get("state"+slot, valueLoaded);
}

function isStateValid(state) {
  if (!state) return false;
  if (!state.stats) return false;
  if (!state.stats.sceneName) return false;
  return true;
}

function restartGame(shouldPrompt) {
  if (_global.blockRestart) {
    asyncAlert("Please wait until the timer has run out.");
    return;
  }
  function actuallyRestart(result) {
    if (!result) return;
    delayBreakEnd();
    submitAnyDirtySaves();
    clearCookie(function() {}, 'temp');
    clearCookie(function() {
      _global.nav.resetStats(_global.stats);
      clearScreen(restoreGame);
    }, "");
  }
  if (shouldPrompt) {
    asyncConfirm("Start over from the beginning?", actuallyRestart);
  } else {
    actuallyRestart(true);
  }
}

function restoreGame(state, forcedScene, userRestored) {
    var scene;
    var secondaryMode = null;
    var saveSlot = "";
    var forcedSceneLabel = null;
    if (/\|/.test(forcedScene)) {
      var parts = forcedScene.split("|");
      forcedScene = parts[0];
      forcedSceneLabel = parts[1];
    }
    if (forcedScene == "choicescript_stats") {
      secondaryMode = "stats";
      saveSlot = "temp";
    } else if (forcedScene == "choicescript_upgrade") {
      secondaryMode = "upgrade";
      saveSlot = "temp";
    }
    if (!isStateValid(state)) {
        var startupScene = forcedScene ? forcedScene : _global.nav.getStartupScene();
        scene = new Scene(startupScene, _global.stats, _global.nav, {debugMode:_global.debug, secondaryMode:secondaryMode, saveSlot:saveSlot});
    } else {
      if (forcedScene) state.stats.sceneName = forcedScene;
      _global.stats = state.stats;
      // Someday, inflate the navigator using the state object
      scene = new Scene(state.stats.sceneName, state.stats, _global.nav, {debugMode:state.debug || _global.debug, secondaryMode:secondaryMode, saveSlot:saveSlot});
      if (!forcedScene) {
        scene.temps = state.temps;
        scene.lineNum = state.lineNum;
        scene.indent = state.indent;
      }
      if (userRestored) {
        scene.temps.choice_user_restored = true;
      }
    }
    if (forcedSceneLabel !== null) {
      scene.targetLabel = {label:forcedSceneLabel, origin:"url", originLine:0}
    }
    safeCall(scene, scene.execute);
}

function redirectScene(sceneName, label, originLine) {
  var scene = new Scene(sceneName, window.stats, window.nav, {debugMode:window.debug});
  if (label) scene.targetLabel = {label:label, origin:"choicescript_stats", originLine:originLine};
  scene.redirectingFromStats = true;
  clearScreen(function() {scene.execute();});
}

tempStatWrites = {};

function transferTempStatWrites() {
  if (!_global.isIosApp) return;
  callIos("transferwrites", JSON.stringify(tempStatWrites));
}

function getCookieByName(cookieName, ck) {
    if (!ck) ck = window.document.cookie;
    if (!ck) return null;
    var ckPairs = ck.split(/;/);
    for (var i = 0; i < ckPairs.length; i++) {
        var ckPair = trim(ckPairs[i]);
        var ckNameValue = ckPair.split(/=/);
        var ckName = decodeURIComponent(ckNameValue[0]);
        if (ckName === cookieName) {
            return decodeURIComponent(ckNameValue[1]);
        }
    }
    return null;
}

function parseQueryString(str) {
  if (!str) return null;
  str = String(str).substring(1);
  if (!str) return null;
  var map = {};
  var pairs = str.split("&");
  var i = pairs.length;
  while (i--) {
    var pair = pairs[i];
    var parts = pair.split("=");
    map[parts[0]] = parts[1];
  }
  return map;
}

function trim(str) {
    if (str === null || str === undefined) return null;
    var result = str.replace(/^\s+/g, "");
    // strip leading
    return result.replace(/\s+$/g, "");
    // strip trailing
}


function findOptimalDomain(docDomain) {
    if (!docDomain) docDomain = document.domain;
    // localhost and 127.0.0.1 will cause cookie not to be set; just omit them, it works fine
    if (docDomain == "localhost" || docDomain == "127.0.0.1") return null;
    // ip address
    if (/^\d+\.\d+\.\d+\.\d+$/.test(docDomain)) return null;
    // dotcom
    var result = docDomain.match(/(\w+\.\w{3}$)/);
    if (result) return result[1];
    return null;
}

function num(x, line, sceneName) {
    if (!line) line = "UNKNOWN";
    errorInfo = "line "+line;
    if (sceneName) errorInfo = sceneName + " " + errorInfo;
    var x_num = parseFloat(x);
    if (isNaN(x_num)) throw new Error(errorInfo+": Not a number: " + x);
    if (!isFinite(x_num)) throw new Error(errorInfo+": Not finite " + x);
    return x_num;
}

function bool(x, line, sceneName) {
  if (!line) line = "UNKNOWN";
  if ("boolean" == typeof x) {
    return x;
  } else if ("true" === x) {
    return true;
  } else if ("false" === x) {
    return false;
  }
  errorInfo = "line "+line;
  if (sceneName) errorInfo = sceneName + " " + errorInfo;
  throw new Error(errorInfo+": Neither true nor false: " + x);
}

function findXhr() {
  var ieFile = isIE && isFile;
  if (window.XMLHttpRequest && !ieFile) return new window.XMLHttpRequest();
  var ids = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];
  for (var i = 0; i < 3; i++) {
    try {
      return new ActiveXObject(ids[i]);
    } catch (e) {}
  }
  throw new Error("Couldn't create XHR object");
}

    crcTable = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";

    /* Number */
    function crc32( /* String */ str, /* Number */ crc ) {
        if( !crc ) crc = 0;
        var n = 0; //a number between 0 and 255 
        var x = 0; //an hex number 

        crc = crc ^ (-1);
        for( var i = 0, iTop = str.length; i < iTop; i++ ) {
            n = ( crc ^ str.charCodeAt( i ) ) & 0xFF;
            x = "0x" + crcTable.substr( n * 9, 8 );
            crc = ( crc >>> 8 ) ^ x;
        }
        return crc ^ (-1);
    }

function simpleDateFormat(date) {
  var day = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][date.getDay()];
  var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][date.getMonth()];
  var minutes = date.getMinutes();
  if (minutes < 10) minutes = "0" + ("" + minutes);
  var oneYearInMillis = 1000 * 60 * 60 * 24 * 365;
  var millisAgo = new Date().getTime() - date.getTime();
  var yearString = ""
  if (millisAgo > oneYearInMillis) {
    yearString = ", " + date.getFullYear();
  }
  return day + ", " + month + " " + date.getDate() + yearString;
}

function simpleDateTimeFormat(date) {
  var minutes = date.getMinutes();
  if (minutes < 10) minutes = "0" + ("" + minutes);
  return simpleDateFormat(date) + ", " + date.getHours() + ":" + minutes;
}

function jsonParse(str) {
  if (typeof JSON != "undefined") {
    try {
      return JSON.parse(str);
    } catch (e) {
      // try to handle unquoted keys
      try {
        return eval('('+str+')');
      } catch (e2) {
        // that might have failed because eval is forbidden
        try {
          eval("1");
        } catch (e3) {
          // eval forbidden; let's try a hack to fix unquoted keys
          var str2 = (str+"").replace(/([,\{])\s*(\w+)\s*\:/g, '$1"$2":');
          try {
            return JSON.parse(str2);
          } catch (e4) {}
        }
        // at this point, just report a clear error
        return JSON.parse(str);
      }
    }
  } else {
    return eval('('+str+')');
  }
}

function cefQuerySimple(method) {
  cefQuery({
    request:method,
    onSuccess: function(response) {console.log(method + " success");},
    onFailure: function(error_code, error_message) {console.error(method + " error: " + error_message);}
  });
}

shortMonthStrings = [null, "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse
// "Given a date string of "March 7, 2014", parse() assumes a local time zone, but given an
// ISO format such as "2014-03-07" it will assume a time zone of UTC for ES5 or local for
// ECMAScript 2015."
function parseDateStringInCurrentTimezone(YYYY_MM_DD, line) {
  var result = /^(\d{4})-(\d{2})-(\d{2})$/.exec(YYYY_MM_DD);
  if (!result) throw new Error("line "+line+": invalid date string " + YYYY_MM_DD);
  var fullYear = result[1];
  var oneBasedMonthNumber = parseInt(result[2],10);
  var dayOfMonth = parseInt(result[3],10);
  var shortMonthString = shortMonthStrings[oneBasedMonthNumber];
  return new Date(shortMonthString + " " + dayOfMonth + ", " + fullYear);
}

function matchBracket(line, brackets, startIndex) {
  var openBracket = brackets[0];
  var closeBracket = brackets[1];
  var brackets = 0;
  for (var i = startIndex; i < line.length; i++) {
    var c = line.charAt(i);
    if (c === openBracket) {
      brackets++;
    } else if (c === closeBracket) {
      if (brackets) {
        brackets--;
      } else {
        return i;
      }
    }
  }
  return -1;
}

function isStoreSceneCacheRequired() {
  if (!(initStore() &&
    _global.purchases &&
    _global.checkPurchase &&
    _global.hashes &&
    !(_global.isOmnibusApp && _global.isIosApp) &&
    hashes.scenes
  )) return false;
  var empty = true;
  for (var scene in purchases) {
    if (/^fake:/.test(scene)) continue;
    empty = false;
    break;
  }
  return !empty;
}

function updateSinglePaidSceneCache(sceneName, callback) {
  sceneName = sceneName.replace(/ /g, "_");
  var fileName = sceneName + ".txt.json";
  if (initStore() && _global.hashes && hashes.scenes && hashes.scenes[fileName]) {
    function actualRequest(receiptsSent) {
      var xhr = new XMLHttpRequest();
      var canonical = document.querySelector("link[rel=canonical]");
      var canonicalHref = canonical && canonical.getAttribute("href");
      if (window.beta) {
        canonicalHref = canonicalHref.replace('https://www.choiceofgames.com/', 'https://www.choiceofgames.com/beta/');
      }
      var url = canonicalHref + "scenes/" + fileName + "?hash="+hashes.scenes[fileName];
      xhr.open("GET", url);
      xhr.withCredentials = true;
      xhr.onload = function() {
        var error;
        if (xhr.status !== 200) {
          try {
            error = JSON.parse(xhr.responseText).error;
          } catch (e) {}
        }
        if (xhr.status === 404) {
          try {
            if (error === "hash doesn't match") {
              return awaitAppUpdate(function() {
                callback("strange");
              })
            }
          } catch (e) {
            if (window.console) console.error(e, e.stack);
          }
        }
        if (xhr.status == 403 && _global.isOmnibusApp && _global.isAndroidApp) {
          if (!receiptsSent) {
            window.receiptRequestCallback = function(receipts) {
              window.receiptRequestCallback = null;
              submitReceipts(receipts, function(error) {
                if (error) {
                  return callback(error);
                } else {
                  actualRequest("receiptsSent");
                }
              });
            }
            androidBilling.requestReceipts();
            return;
          } else if (error === "not registered" || error == "not purchased") {
            return callback(error);
          }
        } else if (xhr.status !== 200) {
          return callback(xhr.status);
        }
        var result;
        try {
          result = jsonParse(xhr.responseText);
        } catch (e) {
          if (window.console) console.error(e, e.stack);
        }
        var ok = result && result.crc && result.lines && result.labels;
        if (!ok) return callback("network");
        window.store.set("cache_scene_"+sceneName, xhr.responseText, function() {
          window.store.set("cache_scene_hash_"+sceneName, hashes.scenes[fileName], function() {
            callback(null, result);
          });
        });
      };
      xhr.onerror = function() {
        callback("network");
      }
      console.log("updateSinglePaidSceneCache " + url);
      xhr.send();
    }
    actualRequest();
  }
}

function updateAllPaidSceneCaches(receiptsSent) {
  if (!isStoreSceneCacheRequired()) {
    if (window.isOmnibusApp && window.isAndroidApp) {
      window.receiptRequestCallback = submitReceipts;
      androidBilling.requestReceipts();
    }
    return;
  }
  if (_global.isOmnibusApp && _global.isAndroidApp && !receiptsSent) {
    window.receiptRequestCallback = function(receipts) {
      submitReceipts(receipts, function() {updateAllPaidSceneCaches("receiptsSent");});
    };
    androidBilling.requestReceipts();
    return;
  }
  var flipped = {};
  for (var scene in purchases) {
    if (/^fake:/.test(scene)) continue;
    scene = scene.replace(/ /g, "_");
    if (!flipped[purchases[scene]]) flipped[purchases[scene]] = [];
    flipped[purchases[scene]].push(scene);
  }
  var products = [];
  for (var product in flipped) {
    products.push(product);
  }
  if (!products.length) return;
  checkPurchase(products.join(" "), function(ok, result) {
    if (!ok || !result) return;
    var sceneList = [];
    var push = Array.prototype.push;
    for (var product in flipped) {
      if (result[product]) {
        push.apply(sceneList, flipped[product]);
      }
    }
    if (!sceneList.length) return;
    for (var i = 0; i < sceneList.length; i++) {
      (function(i) {
        var scene = sceneList[i];
        var fileName = scene + ".txt.json";
        window.store.get("cache_scene_hash_"+scene, function(ok, result) {
          if (!ok || result !== hashes.scenes[fileName]) {
            updateSinglePaidSceneCache(scene, function() {});
          }
        });
      })(i);
    }
  })
}

function checkForAppUpdates() {
  if (navigator.serviceWorker) {
    navigator.serviceWorker.getRegistration().then(function(reg) {
      if (reg) reg.update();
    });
  }
}

function refreshIfAppUpdateReady() {
  if (navigator.serviceWorker) {
    if (window.controllerchanged) {
      return window.location.reload();
    }
    navigator.serviceWorker.getRegistration().then(function(reg) {
      if (reg.waiting) {
        reg.waiting.postMessage('skipWaiting');
        return window.location.reload();
      }
    });
  }
}

function awaitAppUpdate(callback) {

  var serviceWorkerExists = (navigator.serviceWorker && navigator.serviceWorker.controller);
  if (!serviceWorkerExists) return callback();

  var calledBack = false;
  var maybeCallback = function() {
    if (calledBack) return;
    calledBack = true;
    callback();
  }

  if (window.controllerchanged) return maybeCallback();
  setTimeout(maybeCallback, 10000);
  navigator.serviceWorker.getRegistration().then(function(reg) {
    if (!reg) return maybeCallback();
    if (reg.waiting) {
      reg.waiting.postMessage('skipWaiting');
      return maybeCallback();
    }
    var watchStateChange = function() {
      if (this.state == 'installed') {
        if (reg.waiting) reg.waiting.postMessage('skipWaiting');
        maybeCallback();
      }
    };
    if (reg.installing) reg.installing.addEventListener('statechange', watchStateChange);
    reg.update();
    reg.addEventListener('updatefound', function() {
      reg.installing.addEventListener('statechange', watchStateChange);
    })
  });
}

function remoteConfig(variable, callback) {
  if (!_global.isOmnibusApp) {
    safeTimeout(function() {callback(null);}, 0);
    return;
  }
  if (_global.isIosApp) {
    var nonce = "remoteConfig" + variable + (+new Date);
    window[nonce] = function(value) {
      delete window[nonce];
      callback(value);
    }
    callIos("remoteconfig", variable + " " + nonce);
  } else {
    var result = (_global.androidRemoteConfig && androidRemoteConfig.remoteConfig(variable)) || null;
    return safeTimeout(function() {callback(result);}, 0);
  }
}

;
/*
 * Copyright 2010 by Dan Fabulich.
 *
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */

;(function() {
  var lastTime = 0;
  if (!window.requestAnimationFrame)
    window.requestAnimationFrame = function(callback, element) {
        var currTime = new Date().getTime();
        var timeToCall = Math.max(0, 16 - (currTime - lastTime));
        var id = window.setTimeout(function() { callback(currTime + timeToCall); },
          timeToCall);
        lastTime = currTime + timeToCall;
        return id;
    };
})();

function printx(msg, parent) {
    if (msg === null || msg === undefined || msg === "") return;
    if (!parent) parent = document.getElementById('text');
    if (msg == " ") {
      // IE7 doesn't like innerHTML that's nothing but " "
      parent.appendChild(document.createTextNode(" "));
      return;
    }
    msg = replaceBbCode(msg);
    var frag = document.createDocumentFragment();
    temp = document.createElement('div');
    temp.innerHTML = msg;
    while (temp.firstChild) {
        frag.appendChild(temp.firstChild);
    }
    parent.appendChild(frag);
}

function replaceBbCode(msg) {
  return msg = String(msg).replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/\[url\=(.*?)\]/g, '<a href="$1">')
      .replace(/\[\/url\]/g, '</a>')
      .replace(/\[n\/\]/g, '<br>')
      .replace(/\[c\/\]/g, '')
      .replace(/\[b\]/g, '<b>')
      .replace(/\[\/b\]/g, '</b>')
      .replace(/\[i\]/g, '<i>')
      .replace(/\[\/i\]/g, '</i>')
      .replace(/\u2022([\s\S]*)/, '<ul>•$1</ul>')
      .replace(/\u2022([^\u2022]*)/g, '<li>$1</li>')
}

function println(msg, parent) {
    if (!parent) parent = document.getElementById('text');
    printx(msg, parent);
    var br = window.document.createElement("br");
    parent.appendChild(br);
}

function printParagraph(msg, parent) {
  if (msg === null || msg === undefined || msg === "") return;
  if (!parent) parent = document.getElementById('text');
  msg = replaceBbCode(msg);
  p = document.createElement('p');
  p.innerHTML = msg;
  parent.appendChild(p);
  return p;
}

function showStats() {
    if (document.getElementById('loading')) return;
    var button = document.getElementById("statsButton");
    if (button && button.innerHTML == "Return to the Game") {
      return clearScreen(function() {
        setButtonTitles();
        loadAndRestoreGame();
      });
    }
    var currentScene = window.stats.scene;
    var scene = new Scene("choicescript_stats", window.stats, this.nav, {secondaryMode:"stats", saveSlot:"temp"});
    clearScreen(function() {
      setButtonTitles();
      scene.execute();
    })
}

function redirectFromStats(scene, label, originLine, callback) {
  if (window.isIosApp) {
    if (!label) label = "";
    callIos("redirectfromstats", scene + " " +label  + " " + originLine);
  } else if (window.isAndroidApp) {
    statsMode.redirectFromStats(scene, label || "", originLine);
  } else {
    safeTimeout(callback, 0);
  }
}

function returnFromStats() {
  if (window.isIosApp && !window.isIPad) {
    callIos("returntogame");
  } else if (window.isAndroidApp && window.statsMode.get()) {
    statsMode.returnToGame();
  } else {
    clearScreen(loadAndRestoreGame);
  }
}

function showAchievements(hideNextButton) {
  if (document.getElementById('loading')) return;
  var button = document.getElementById("achievementsButton");
  if (!button) return;
  if (button.innerHTML == "Return to the Game") {
    return clearScreen(function() {
      setButtonTitles();
      loadAndRestoreGame();
    });
  }
  clearScreen(function() {
    setButtonTitles();
    var button = document.getElementById("achievementsButton");
    button.innerHTML = "Return to the Game";
    checkAchievements(function() {
      printAchievements(document.getElementById("text"));
      if (!hideNextButton) printButton("Next", main, false, function() {
        clearScreen(function() {
          setButtonTitles();
          loadAndRestoreGame();
        });
      });
      curl();
    });
  });
}

function showMenu() {
  if (document.getElementById('loading')) return;
  var button = document.getElementById("menuButton");
  if (!button) return;
  if (button.innerHTML == "Return to the Game") {
    return clearScreen(function() {
      setButtonTitles();
      loadAndRestoreGame();
    });
  }
  function menu() {
    setButtonTitles();
    var button = document.getElementById("menuButton");
    button.innerHTML = "Return to the Game";
    options = [
      {name:"Return to the game.", group:"choice", resume:true},
      {name:"View the credits.", group:"choice", credits:true},
      {name:"Play more games like this.", group:"choice", moreGames:true},
      {name:"Email us at " + getSupportEmail() + ".", group:"choice", contactUs:true},
      {name:"Share this game with friends.", group:"choice", share:true},
      {name:"Email me when new games are available.", group:"choice", subscribe:true},
      {name:"Make the text bigger or smaller.", group:"choice", fontSizeMenu:true},
      {name:"Change the background color.", group:"choice", background:true},
    ];
    if (window.animationProperty) options.push(
      {name:"Change the animation between pages.", group:"choice", animation:true}
    );
    printOptions([""], options, function(option) {
      if (option.resume) {
        return clearScreen(function() {
          setButtonTitles();
          loadAndRestoreGame();
        });
      } else if (option.credits) {
        absolutizeAboutLink();
        aboutClick();
      } else if (option.moreGames) {
        moreGames();
        curl();
      } else if (option.share) {
        clearScreen(function() {
          printShareLinks(document.getElementById("text"), "now");
          menu();
        });
      } else if (option.subscribe) {
        setButtonTitles();
        subscribeLink();
      } else if (option.contactUs) {
        window.location.href="mailto:"+getSupportEmail();
      } else if (option.fontSizeMenu) {
        textOptionsMenu({size:1});
      } else if (option.background) {
        textOptionsMenu({color:1});
      } else if (option.animation) {
        textOptionsMenu({animation:1});
      }
    });
    curl();
  }
  clearScreen(menu);
}

function setButtonTitles() {
  var button;
  button = document.getElementById("menuButton");
  if (button) {
    if (window.isCef || window.isNode || window.isMacApp) {
      button.innerHTML = "Menu";
    } else {
      button.innerHTML = "Settings";
    }
  }
  button = document.getElementById("statsButton");
  if (button) {
    button.innerHTML = "Show Stats";
  }
  button = document.getElementById("achievementsButton");
  if (button) {
    if (nav.achievementList.length) {
      button.style.display = "";
      button.innerHTML = "Achievements";
    } else {
      button.style.display = "none";
    }
  }
}


function textOptionsMenu(categories) {
  if (!categories) {
    categories = {size:1, color:1, animation:window.animationProperty};
    if (document.getElementById('loading')) return;
    var button = document.getElementById("menuButton");
    if (!button) return;
    if (button.innerHTML == "Menu") return showMenu();
    if (button.innerHTML == "Return to the Game") {
      return clearScreen(function() {
        setButtonTitles();
        loadAndRestoreGame();
      });
    }
  }
  clearScreen(function() {
    var button = document.getElementById("menuButton");
    if (button) button.innerHTML = "Return to the Game";
    var text = document.getElementById("text");
    var oldZoom = getZoomFactor();
    if (categories.size && categories.color) {
      text.innerHTML = "<p>Change the game's appearance.</p>";
    } else if (categories.size) {
      text.innerHTML = "<p>Make the text bigger or smaller.</p>";
    } else if (categories.color) {
      text.innerHTML = "<p>Change the background color.</p>";
    } else if (categories.animation) {
      text.innerHTML = "<p>Change the animation between pages.</p>";
    }
    options = [
      {name:"Return to the game.", group:"choice", resume:true},
    ];
    if (categories.size) {
      options.push(
        {name:"Make the text bigger.", group:"choice", bigger:true},
        {name:"Make the text smaller.", group:"choice", smaller:true}
      );
      if (oldZoom <= 0.5) {
        options[options.length-1].unselectable = true;
      }
      if (oldZoom !== 1) {
        options.push({name:"Reset the text to its original size.", group:"choice", reset:true});
      }
    }
    if (categories.color) options.push(
      {name:"Use a black background.", group:"choice", color:"black"},
      {name:"Use a sepia background.", group:"choice", color:"sepia"},
      {name:"Use a white background.", group:"choice", color:"white"}
    );
    if (categories.animation) options.push(
      {name: "Animate between pages.", group:"choice", animation:1},
      {name: "Don't animate between pages.", group:"choice", animation:2}
    );
    printOptions([""], options, function(option) {
      if (option.resume) {
        return clearScreen(function() {
          setButtonTitles();
          loadAndRestoreGame();
        });
      } else if (option.color) {
        changeBackgroundColor(option.color);
      } else if (option.reset) {
        setZoomFactor(1);
      } else if (option.animation) {
        window.animateEnabled = option.animation !== 2;
        if (initStore()) store.set("preferredAnimation", parseFloat(option.animation));
      } else {
        changeFontSize(option.bigger);
      }
      textOptionsMenu(categories);
    })
    curl();
  });
}

function getZoomFactor() {
  if (document.documentElement.style.fontSize === undefined) {
    return window.zoomFactor || 1;
  } else {
    var fontSize = parseFloat(document.documentElement.style.fontSize);
    if (isNaN(fontSize)) fontSize = 100;
    return fontSize / 100;
  }
}

function setZoomFactor(zoomFactor) {
  document.documentElement.style.fontSize = Math.round(100*zoomFactor) + "%";
  window.zoomFactor = zoomFactor;
  if (initStore()) store.set("preferredZoom", String(zoomFactor));
}

function changeFontSize(bigger) {
  var oldZoom = getZoomFactor();
  if (bigger) {
    setZoomFactor(oldZoom + 0.1);
  } else {
    setZoomFactor(oldZoom - 0.1);
  }
}

function changeBackgroundColor(color) {
  if (color === "sepia") {
    document.body.classList.remove("nightmode");
    document.body.classList.remove("whitemode");
  } else if (color === "black") {
    document.body.classList.remove("whitemode");
    document.body.classList.add("nightmode");
  } else if (color === "white") {
    document.body.classList.remove("nightmode");
    document.body.classList.add("whitemode");
  }
  if (initStore()) store.set("preferredBackground", color);
}

function isNightMode() {
  return document.body.classList.contains("nightmode");
}

function spell(num) {
  if (num > 99) return num;
  var smallNumbers = ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen"];
  var tens = ["zero", "ten", "twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety"];
  if (num < 20) {
    return smallNumbers[num];
  }
  var onesDigit = num % 10;
  if (onesDigit === 0) {
    return tens[num / 10];
  }
  var tensDigit = (num - onesDigit) / 10;
  return tens[tensDigit]+"-"+smallNumbers[onesDigit];
}

function printAchievements(target) {
  var unlockedBuffer = [];
  var lockedBuffer = [];
  var achievedCount = 0, hiddenCount = 0, score = 0, totalScore = 0;
  var totalAchievements = nav.achievementList.length;
  var buffer;
  for (var i = 0; i < totalAchievements; i++) {
    var name = nav.achievementList[i];
    var achievement = nav.achievements[name];
    var points = achievement.points;
    totalScore += points;

    var description;

    if (nav.achieved[name]) {
      achievedCount++;
      score += points;
      buffer = unlockedBuffer;
      description = achievement.earnedDescription;
    } else {
      if (achievement.visible) {
        buffer = lockedBuffer;
        description = achievement.preEarnedDescription;
      } else {
        hiddenCount++;
        continue;
      }
    }

    if (buffer.length) buffer.push("<br>");
    buffer.push("<b>");
    buffer.push(achievement.title.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'));
    buffer.push(":");
    buffer.push("</b> ");
    buffer.push(description.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')
      .replace(/\[b\]/g, '<b>')
      .replace(/\[\/b\]/g, '</b>')
      .replace(/\[i\]/g, '<i>')
      .replace(/\[\/i\]/g, '</i>')
    );
    buffer.push(" (");
    buffer.push(points);
    buffer.push(" points)");
  }

  // What if there's exactly one achievement worth exactly one point?
  if (achievedCount === 0) {
    if (hiddenCount === 0) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements, worth a total of "+totalScore+" points.<p>"];
    } else if (hiddenCount == 1) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements (including one hidden achievement), worth a total of "+totalScore+" points.<p>"];
    } else if (hiddenCount == totalAchievements) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" hidden achievements, worth a total of "+totalScore+" points.<p>"];
    } else {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements (including "+spell(hiddenCount)+" hidden achievements), worth a total of "+totalScore+" points.<p>"];
    }
    if (lockedBuffer.length) {
      buffer.push.apply(buffer, lockedBuffer);
      buffer.push("<p>");
    }
  } else if (score == totalScore) {
    if (totalAchievements == 2) {
      buffer = ["Congratulations! You have unlocked both achievements, earning a total of "+score+" points, a perfect score.<p>"];
    } else {
      buffer = ["Congratulations! You have unlocked all "+spell(totalAchievements)+" achievements, earning a total of "+score+" points, a perfect score.<p>"];
    }
    buffer.push.apply(buffer, unlockedBuffer);
    buffer.push("<p>");
  } else {
    buffer = ["You have unlocked "+spell(achievedCount)+" out of "+spell(totalAchievements)+" possible achievements, earning you a score of "+score+" out of a possible "+totalScore+" points.<p>"];
    buffer.push.apply(buffer, unlockedBuffer);
    var remaining = totalAchievements-achievedCount;
    if (remaining == hiddenCount) {
      if (remaining == 1) {
        buffer.push("<p>There is still one hidden achievement remaining.<p>");
      } else {
        buffer.push("<p>There are still " + spell(remaining) + " hidden achievements remaining.<p>");
      }
    } else if (hiddenCount > 1) {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining, including "+spell(hiddenCount)+" hidden achievements.<p>");
    } else if (hiddenCount == 1) {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining, including one hidden achievement.<p>");
    } else if (remaining == 1) {
      buffer.push("<p>There is still one achievement remaining.<p>");
    } else {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining.<p>");
    }
    if (lockedBuffer.length) {
      buffer.push.apply(buffer, lockedBuffer);
      buffer.push("<p>");
    }
  }

  target.innerHTML = buffer.join("");
}

function asyncAlert(message, callback) {
  if (!callback) callback = function(){};
  if (window.isIosApp) {
    window.alertCallback = callback;
    callIos("alert", message);
  } else if (window.isAndroidApp) {
    setTimeout(function() {
      alert(message);
      if (callback) callback();
    }, 0);
  } else if (window.isWinOldApp) {
    setTimeout(function() {
      window.external.Alert(message);
      if (callback) callback();
    }, 0);
  } else {
    alertify.alert(message, function() {safeCall(null, callback);});
  }
}

function asyncConfirm(message, callback) {
  if (false/*window.isIosApp*/) {
    // TODO asyncConfirm
    window.confirmCallback = callback;
    callIos("confirm", message);
  } else if (window.isAndroidApp) {
    setTimeout(function() {
      var result = confirm(message);
      if (callback) callback(result);
    }, 0);
  } else if (window.isWinOldApp) {
    setTimeout(function() {
      var result = window.external.Confirm(message);
      if (callback) callback(result);
    }, 0);
  } else {
    alertify.confirm(message, function(result) {safeCall(null, callback(result));});
  }
}


function clearScreen(code) {
    var text = document.getElementById("text");
    var container1 = document.getElementById("container1");
    if (!container1) throw new Error("<div id=container1> is missing from index.html");

    if (window.animateEnabled && window.animationProperty && !window.isIosApp && !document.getElementById('container2')) {
      var container2 = document.createElement("div");
      container2.setAttribute("id", "container2");
      container2.classList.add('container');
      document.body.classList.add('frozen');
      container2.style.opacity = 0;


      // get the vertical scroll position as pageYOffset
      // translate up by pageYOffset pixels, then scroll to the top
      // now we're scrolled up, but the viewport *looks* like it has retained its scroll position
      var pageYOffset = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
      var extraScroll = 0;
      if (window.isMobile && window.isWeb && window.isAndroid && !/Chrome/.test(navigator.userAgent)) {
        extraScroll = 1; // try to hide url bar
      }
      pageYOffset -= extraScroll;
      container1.style.transform = "translateY(-"+pageYOffset+ "px)";
      container1.style.webkitTransform = "translateY(-"+pageYOffset+ "px)";
      window.scrollTo(0,extraScroll);

      container2.innerHTML = container1.innerHTML;
      [].forEach.call(container1.querySelectorAll('input,button,a,textarea,label'), function(element) {
        element.setAttribute("tabindex", "-1");
        element.removeAttribute("accesskey");
      });

      document.body.insertBefore(container2, container1);
      main = document.getElementById("main");
      main.innerHTML = "";
      text = document.createElement("div");
      text.setAttribute("id", "text");
      main.appendChild(text);
      if (window.isChromeApp) fixChromeLinks();
    } else {
      main = document.getElementById("main");
      main.innerHTML = "";
      text = document.createElement("div");
      text.setAttribute("id", "text");
      main.appendChild(text);

      window.scrollTo(0,1);
    }


    var useAjax = true;
    if (isWeb && window.noAjax) {
      useAjax = false;
    }

    if (useAjax) {
      doneLoading();
      safeCall(null, code);
    } else {
      if (!initStore()) alert("Your browser has disabled cookies; this game requires cookies to work properly.  Please re-enable cookies and refresh this page to continue.");
      startLoading();
      var form = window.document.createElement("form");
      var axn = window.location.protocol + "//" + window.location.host + window.location.pathname;
      form.setAttribute("action", axn);
      form.setAttribute("method", "POST");
      main.appendChild(form);
      form.submit();
    }
}

// in the iOS app, display a page curl animation
function curl() {
  var focusFirst = function() {
    var text = document.getElementById("text");
    if (text.firstElementChild) {
      var focusable = text.firstElementChild;
      if (/^img$/i.test(focusable.tagName) && focusable.complete === false) {
        focusable.addEventListener("load", focusFirst);
        return;
      }
      focusable.setAttribute("tabindex", "-1");
      focusable.classList.add("tempfocus");
      focusable.focus();
      focusable.blur();
      requestAnimationFrame(function() {
        focusable.focus();
        requestAnimationFrame(function() {
          focusable.blur();
          focusable.removeAttribute("tabindex");
          focusable.classList.remove("tempfocus");
        });
      });
    }
  }

  // TODO force a reflow before curling the page
  var container2 = document.getElementById('container2');
  if (!container2) {
    focusFirst();
    return window.animateEnabled ? callIos("curl") : callIos("unfreeze");
  }

  var container1 = document.getElementById('container1');
  var onContainer1Disappeared = function(e) {
    if (container1.parentElement) container1.parentElement.removeChild(container1);
  };
  var onContainer2Appeared = function(e) {
    document.body.classList.remove('frozen');
    focusFirst();
    container2.removeEventListener('transitionend', onContainer2Appeared);
    container2.removeEventListener('webkitTransitionEnd', onContainer2Appeared);
  };

  if (!window.isIosApp && window.animationProperty) {
    var slideoutStyle = document.getElementById('slideoutStyle');
    if (!slideoutStyle) {
      slideoutStyle = document.createElement("style");
      slideoutStyle.setAttribute("id", "slideoutStyle");
      document.head.appendChild(slideoutStyle);
    }

    var shouldSlide = true;

    var timingFunction = "\n.container { transition-timing-function: ease-in; };";
    if (shouldSlide) timingFunction = "";

    slideoutStyle.innerHTML = "@keyframes containerslideout { "+
      "from { transform: "+container1.style.transform+"; } " +
      "to   { transform: "+container1.style.transform+" translateX(-105%); } }\n"+
      "@-webkit-keyframes containerslideout { "+
      "from { -webkit-transform: "+container1.style.webkitTransform+"; } " +
      "to   { -webkit-transform: "+container1.style.webkitTransform+" translateX(-105%); } }"+
      timingFunction;

    // double rAF so we start after container1 is transformed and scrolled to the top
    // minimizes flicker on iOS
    requestAnimationFrame(function() {
      requestAnimationFrame(function() {
        if (shouldSlide) {
          var fastApple = window.isIPad || window.isIPhone || window.isMacApp;
          var slowAndroid = window.isAndroidApp && /Android 4/.test(navigator.userAgent);
          var useCssAnimations = true; // fastApple || slowAndroid;
          if (useCssAnimations) {
            container1.style[window.animationProperty] = 'containerslideout';
            container2.style[window.animationProperty] = 'containerslidein';
          } else {
            var frames = 0;
            var durationInSeconds = 0.5;
            var framesPerSecond = 60;
            var totalSteps = framesPerSecond * durationInSeconds;
            var oldContainer1Transform = container1.style.transform;
            var rafSlide = function(stamp) {
              var fraction = frames / totalSteps;
              // ease approximation https://github.com/mietek/ease-tween/blob/master/src/index.js
              fraction = 1.0042954579734844 * Math.exp(
                -6.4041738958415664 * Math.exp(
                  -7.2908241330981340 * fraction));
              container1.style.transform = container1.style.webkitTransform =
                oldContainer1Transform + " translateX(-" + (105 * fraction) + "%)";
              container2.style.transform = container2.style.webkitTransform =
                "translateX(" + (100 - 100 * fraction) + "%)";
              if (frames < totalSteps) {
                frames++;
                requestAnimationFrame(rafSlide);
              }
            }
            requestAnimationFrame(rafSlide);
          }
        }
        container1.style.opacity = 0;
        container2.style.opacity = 1;
        container1.addEventListener('transitionend', onContainer1Disappeared);
        container2.addEventListener('transitionend', onContainer2Appeared);
        container1.addEventListener('webkitTransitionEnd', onContainer1Disappeared);
        container2.addEventListener('webkitTransitionEnd', onContainer2Appeared);
      })
    })
  } else {
    onContainer2Appeared();
    onContainer1Disappeared();
    window.animateEnabled ? callIos("curl") : callIos("unfreeze");
  }

  container1.removeAttribute("id");
  container2.setAttribute("id", "container1");
}

function safeSubmit(code) {
    return function safelySubmitted() {
        safeCall(code);
        return false;
    };
}

function startLoading() {
    var loading = document.getElementById('loading');
    if (!loading) {
      safeCall(null, function() {
        loading = document.createElement('div');
        loading.setAttribute("id", "loading");
        loading.innerHTML = (/MSIE [67]/.test(navigator.userAgent)?"":"<img src=\"data:image/gif;base64,R0lGODlhgAAPAPEAAPf08WJhYMvJx2JhYCH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAgAAPAAACo5QvoIC33NKKUtF3Z8RbN/55CEiNonMaJGp1bfiaMQvBtXzTpZuradUDZmY+opA3DK6KwaQTCbU9pVHc1LrDUrfarq765Ya9u+VRzLyO12lwG10yy39zY11Jz9t/6jf5/HfXB8hGWKaHt6eYyDgo6BaH6CgJ+QhnmWWoiVnI6ddJmbkZGkgKujhplNpYafr5OooqGst66Uq7OpjbKmvbW/p7UAAAIfkECQoAAAAsAAAAAIAADwAAArCcP6Ag7bLYa3HSZSG2le/Zgd8TkqODHKWzXkrWaq83i7V5s6cr2f2TMsSGO9lPl+PBisSkcekMJphUZ/OopGGfWug2Jr16x92yj3w247bh6teNXseRbyvc0rbr6/x5Ng0op4YSJDb4JxhI58eliEiYYujYmFi5eEh5OZnXhylp+RiaKQpWeDf5qQk6yprawMno2nq6KlsaSauqS5rLu8cI69k7+ytcvGl6XDtsyzxcAAAh+QQJCgAAACwAAAAAgAAPAAACvpw/oIC3IKIUb8pq6cpacWyBk3htGRk1xqMmZviOcemdc4R2kF3DvfyTtFiqnPGm+yCPQdzy2RQMF9Moc+fDArU0rtMK9SYzVUYxrASrxdc0G00+K8ruOu+9tmf1W06ZfsfXJfiFZ0g4ZvEndxjouPfYFzk4mcIICJkpqUnJWYiYs9jQVpm4edqJ+lkqikDqaZoquwr7OtHqAFerqxpL2xt6yQjKO+t7bGuMu1L8a5zsHI2MtOySVwo9fb0bVQAAIfkECQoAAAAsAAAAAIAADwAAAsucP6CAt9zSErSKZyvOd/KdgZaoeaFpRZKiPi1aKlwnfzBF4jcNzDk/e7EiLuLuhzwqayfmaNnjCCGNYhXqw9qcsWjT++TqxIKp2UhOprXf7PoNrpyvQ3p8fAdu82o+O5w3h2A1+Nfl5geHuLgXhEZVWBeZSMnY1oh5qZnyKOhgiGcJKHqYOSrVmWpHGmpauvl6CkvhaUD4qejaOqvH2+doV7tSqdsrexybvMsZrDrJaqwcvSz9i9qM/Vxs7Qs6/S18a+vNjUx9/v1TAAAh+QQJCgAAACwAAAAAgAAPAAAC0Zw/oIC33NKKUomLxct4c718oPV5nJmhGPWwU9TCYTmfdXp3+aXy+wgQuRRDSCN2/PWAoqVTCSVxilQZ0RqkSXFbXdf3ZWqztnA1eUUbEc9wm8yFe+VguniKPbNf6mbU/ubn9ieUZ6hWJAhIOKbo2Pih58C3l1a5OJiJuflYZidpgHSZCOnZGXc6l3oBWrE2aQnLWYpKq2pbV4h4OIq1eldrigt8i7d73Ns3HLjMKGycHC1L+hxsXXydO9wqOu3brPnLXL3C640sK+6cTaxNflEAACH5BAkKAAAALAAAAACAAA8AAALVnD+ggLfc0opS0SeyFnjn7oGbqJHf4mXXFD2r1bKNyaEpjduhPvLaC5nJEK4YTKhI1ZI334m5g/akJacAiDUGiUOHNUd9ApTgcTN81WaRW++Riy6Tv/S4dQ1vG4ps4NwOaBYlOEVYhYbnplexyJf3ZygGOXkWuWSZuNel+aboV0k5GFo4+qN22of6CMoq2kr6apo6m5fJWCoZm+vKu2Hr6KmqiHtJLKebRhuszNlYZ3ncewh9J9z8u3mLHA0rvetrzYjd2Wz8bB6oNO5MLq6FTp2+bVUAACH5BAkKAAAALAAAAACAAA8AAALanD+ggLfc0opS0XeX2Fy8zn2gp40ieHaZFWHt9LKNO5eo3aUhvisj6RutIDUZgnaEFYnJ4M2Z4210UykQ8BtqY0yHstk1UK+/sdk63i7VYLYX2sOa0HR41S5wi7/vcMWP1FdWJ/dUGIWXxqX3xxi4l0g4GEl5yOHIBwmY2cg1aXkHSjZXmbV4uoba5kkqelbaapo6u0rbN/SZG7trKFv7e6savKTby4voaoVpNAysiXscV4w8fSn8fN1pq1kd2j1qDLK8yYy9/ff9mgwrnv2o7QwvGO1ND049UgAAIfkECQoAAAAsAAAAAIAADwAAAticP6CAt9zSilLRd2d8onvBfV0okp/pZdamNRi7ui3yyoo4Ljio42h+w6kgNiJt5kAaasdYE7D78YKlXpX6GWphxqTT210qK1Cf9XT2SKXbYvv5Bg+jaWD5ekdjU9y4+PsXRuZHRrdnZ5inVidAyCTXF+nGlVhpdjil2OE49hjICVh4qZlpibcDKug5KAlHOWqqR8rWCjl564oLFruIucaYGlz7+XoKe2wsIqxLzMxaxIuILIs6/JyLbZsdGF063Uu6vH2tXc79LZ1MLWS96t4JH/rryzhPWgAAIfkECQoAAAAsAAAAAIAADwAAAtWcP6CAt9zSilLRd2fEe4kPCk8IjqTonZnVsQ33arGLwLV8Kyeqnyb5C60gM2LO6MAlaUukwdbcBUspYFXYcla00KfSywRzv1vpldqzprHFoTv7bsOz5jUaUMer5vL+Mf7Hd5RH6HP2AdiUKLa41Tj1Acmjp0bJFuinKKiZyUhnaBd5OLnzSNbluOnZWQZqeVdIYhqWyop6ezoquTs6O0aLC5wrHErqGnvJibms3LzKLIYMe7xnO/yL7TskLVosqa1aCy3u3FrJbSwbHpy9fr1NfR4fUgAAIfkECQoAAAAsAAAAAIAADwAAAsqcP6CAt9zSilLRd2fEW7cnhKIAjmFpZla3fh7CuS38OrUR04p5Ljzp46kgMqLOaJslkbhbhfkc/lAjqmiIZUFzy2zRe5wGTdYQuKs9N5XrrZPbFu94ZYE6ms5/9cd7/T824vdGyIa3h9inJQfA+DNoCHeomIhWGUcXKFIH6RZZ6Bna6Zg5l8JnSamayto2WtoI+4jqSjvZelt7+URKpmlmKykM2vnqa1r1axdMzPz5LLooO326Owxd7Bzam4x8pZ1t3Szu3VMOdF4AACH5BAkKAAAALAAAAACAAA8AAAK/nD+ggLfc0opS0XdnxFs3/i3CSApPSWZWt4YtAsKe/DqzXRsxDqDj6VNBXENakSdMso66WzNX6fmAKCXRasQil9onM+oziYLc8tWcRW/PbGOYWupG5Tsv3TlXe9/jqj7ftpYWaPdXBzbVF2eId+jYCAn1KKlIApfCSKn5NckZ6bnJpxB2t1kKinoqJCrlRwg4GCs4W/jayUqamaqryruES2b72StsqgvsKlurDEvbvOx8mzgazNxJbD18PN1aUgAAIfkECQoAAAAsAAAAAIAADwAAArKcP6CAt9zSilLRd2fEWzf+ecgjlKaQWZ0asqPowAb4urE9yxXUAqeZ4tWEN2IOtwsqV8YkM/grLXvTYbV4PTZpWGYU9QxTxVZyd4wu975ZZ/qsjsPn2jYpatdx62b+2y8HWMTW5xZoSIcouKjYePeTh7TnqFcpabmFSfhHeemZ+RkJOrp5OHmKKapa+Hiyyokaypo6q1CaGDv6akoLu3DLmLuL28v7CdypW6vsK9vsE1UAACH5BAkKAAAALAAAAACAAA8AAAKjnD+ggLfc0opS0XdnxFs3/nkISI2icxokanVt+JoxC8G1fNOlm6tp1QNmZj6ikDcMrorBpBMJtT2lUdzUusNSt9qurvrlhr275VHMvI7XaXAbXTLLf3NjXUnP23/qN/n8d9cHyEZYpoe3p5jIOCjoFofoKAn5CGeZZaiJWcjp10mZuRkaSAq6OGmU2lhp+vk6iioay3rpSrs6mNsqa9tb+ntQAAA7AAAAAAAAAAAA\">");
        document.body.appendChild(loading);
      });
    }
    callIos('startspinner');
}

function doneLoading() {
    var loading = document.getElementById('loading');
    if (loading) loading.parentNode.removeChild(loading);
    // TODO update header?
    callIos('stopspinner');
    if (window.doneLoadingCallback) {
      var callback = doneLoadingCallback;
      delete window.doneLoadingCallback;
      // long delay to ensure the spinner is fully stopped before continuing
      setTimeout(callback, 10);
    }
}

function setClass(element, classString) {
  element.setAttribute("class", classString);
  element.setAttribute("className", classString);
}

function printFooter() {
  // var footer = document.getElementById('footer');
  // We could put anything we want in the footer here, but perhaps we should avoid it.
  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    if (window.stats && stats.scene && stats.scene.secondaryMode == "stats") {
      statsButton.innerHTML = "Return to the Game";
    } else {
      statsButton.innerHTML = "Show Stats";
      if (window.isAndroidApp && window.statsMode.get()) {
        showStats();
      }
    }
  }
  curl();
}

// retrieve value of HTML form
function getFormValue(name) {
    var field = document.forms[0][name];
    if (!field) return "";
    // may return either one field or an array of fields
    if (field.checked) return field.value;
    for (var i = 0; i < field.length; i++) {
        var element = field[i];
        if (element.checked) return element.value;
    }
    return null;
}

function printOptions(groups, options, callback) {
  var form = document.createElement("form");
  main.appendChild(form);
  var self = this;
  form.action="#";
  form.onsubmit = function() {
      safeCall(self, function() {
        var currentOptions = options;
        var option, group;
        for (var i = 0; i < groups.length; i++) {
            if (i > 0) {
                currentOptions = option.suboptions;
            }
            group = groups[i];
            if (!group) group = "choice";
            var value = getFormValue(group);
            if (value === null || value === undefined) {
              if (groups.length == 1) {
                asyncAlert("Please choose one of the available options first.");
              } else {
                var article = "a";
                if (/^[aeiou].*/i.test(group)) article = "an";
                asyncAlert("Please choose " + article + " " + group + " first.");
              }
              return;
            }
            option = currentOptions[value];
        }

        if (groups.length > 1 && option.unselectable) {
          asyncAlert("Sorry, that combination of choices is not allowed. Please select a different " + groups[groups.length-1] + ".");
          return;
        }
        safeCall(null, function() {callback(option);});
      });
      return false;
  };

  if (!options) throw new Error("undefined options");
  if (!options.length) throw new Error("no options");
  // global num will be used to assign accessKeys to the options
  var globalNum = 1;
  var currentOptions = options;
  for (var groupNum = 0; groupNum < groups.length; groupNum++) {
      var group = groups[groupNum];
      if (group) {
          var textBuilder = ["Select "];
          textBuilder.push(/^[aeiou]/i.test(group)?"an ":"a ");
          textBuilder.push(group);
          textBuilder.push(":");

          var p = document.createElement("p");
          p.appendChild(document.createTextNode(textBuilder.join("")));
          form.appendChild(p);
      }
      var div = document.createElement("div");
      form.appendChild(div);
      setClass(div, "choice");
      var checked = null;
      for (var optionNum = 0; optionNum < currentOptions.length; optionNum++) {
          var option = currentOptions[optionNum];
          if (!checked && !option.unselectable) checked = option;
          var isLast = (optionNum == currentOptions.length - 1);
          printOptionRadioButton(div, group, option, optionNum, globalNum++, isLast, checked == option);
      }
      // for rendering, the first options' suboptions should be as good as any other
      currentOptions = currentOptions[0].suboptions;
  }

  var touchStartHandler = function (e) {
    if (e.touches.length > 1) return;
    var target = e.target;
    var rect = target.getBoundingClientRect();
    var shuttle;
    var shuttleWidth = rect.width * 0.2;
    //console.log(rect);
    var lastMouse = e.touches[0];
    var draw = function () {
      var transformX = rect.width + rect.left - lastMouse.clientX - (shuttleWidth/2);
      if (transformX < 0) transformX = 0;
      var maxX = rect.width - shuttleWidth - 2;
      if (transformX > maxX) transformX = maxX;
      if (transformX >= maxX * 0.8) {
        target.classList.add('selected');
      } else {
        target.classList.remove('selected');
      }
      shuttle.style.transform = "translateX(-"+transformX+"px)"
      shuttle.style.webkitTransform = "translateX(-"+transformX+"px)"
    };
    var outsideTimeout = null;
    var moveTracker = function(e) {
      e.preventDefault();
      lastMouse = e.touches[0];
      // on iPad app, touchend doesn't fire outside webview (touchmove does)
      // so, fire a fake touchend 300 ms after touchmove outside webview
      if (window.isIosApp && window.isIPad) {
        if (outsideTimeout) {
          clearTimeout(outsideTimeout);
          outsideTimeout = null;
        }
        if (lastMouse.pageY < 0 || lastMouse.pageX < 0) {
          outsideTimeout = setTimeout(function() {
            document.body.dispatchEvent(new Event('touchend'));
          }, 300);
        }
      }
      window.requestAnimationFrame(draw);
    }
    if ((e.touches[0].clientX - rect.left) > rect.width - shuttleWidth) {
      shuttle = document.createElement("div");
      shuttle.classList.add("shuttle");
      target.appendChild(shuttle);
      shuttle.style.width = shuttleWidth + "px";
      document.body.addEventListener('touchmove', moveTracker, {passive: false});
      var touchEnd = function(e) {
        document.body.removeEventListener('touchmove', moveTracker, {passive: false});
        document.body.removeEventListener('touchend', touchEnd);
        if (target.classList.contains('selected')) {
          if (target.click) {
            target.click();
          } else {
            var event = document.createEvent('Events');
            event.initEvent("click", true, true);
            target.dispatchEvent(event);
          }
          if (window.isIosApp) {
            window.freezeCallback = function() {
              window.freezeCallback = null;
              form.onsubmit();
            };
            callIos("freeze");
          } else {
            safeCall(null, function() {form.onsubmit();});
          }
        } else {
          if (shuttle.style.opacity !== "0") {
            shuttle.style.opacity = 0;
            var removeShuttle = function(e) {
              if (shuttle.parentElement) shuttle.parentElement.removeChild(shuttle);
            };
            shuttle.addEventListener('transitionend', removeShuttle);
            shuttle.addEventListener('webkitTransitionEnd', removeShuttle);
          } else {
            if (shuttle.parentElement) shuttle.parentElement.removeChild(shuttle);
          }
        }
      };
      document.body.addEventListener('touchend', touchEnd);
    }
    //console.log(e);
  };

  var slidingEnabled = true;
  if (window.slidingEnabled === false || groups.length > 1) slidingEnabled = false;

  if (slidingEnabled) [].forEach.call(document.querySelectorAll('.choice > div'), function(label) {
    label.addEventListener('touchstart', touchStartHandler);
    if (window.isMobile) label.addEventListener('click', function(e) {
      var target = e.currentTarget;
      if (document.body.querySelector(".shuttle.discovery")) return;
      var shuttle = document.createElement("div");
      shuttle.classList.add("shuttle");
      shuttle.classList.add("discovery");
      target.appendChild(shuttle);
      var animationEnd = function(e) {
        if (e.animationName === 'shuttlefadeout') {
          if (shuttle.parentElement) shuttle.parentElement.removeChild(shuttle);
        }
      };
      shuttle.addEventListener('animationend', animationEnd);
      shuttle.addEventListener('webkitAnimationEnd', animationEnd);
    })
  });

  var useRealForm = false;
  if (useRealForm) {
    printButton("Next", form, false);
  } else {
    printButton("Next", main, false, function() {
      form.onsubmit();
    });
  }
}

function printOptionRadioButton(div, name, option, localChoiceNumber, globalChoiceNumber, isLast, checked) {
    var line = option.name;
    var unselectable = false;
    if (!name) unselectable = option.unselectable;
    var disabledString = unselectable ? " disabled" : "";
    var id = name + localChoiceNumber + "-" + Math.random().toString(36).substring(2);
    if (!name) name = "choice";
    var radio;
    var div2 = document.createElement("div");
    var label = document.createElement("label");
    // IE doesn't allow you to dynamically specify the name of radio buttons
    if (!/^\w+$/.test(name)) throw new Error("invalid choice group name: " + name);
    label.innerHTML = "<input type='radio' name='"+name+
            "' value='"+localChoiceNumber+"' id='"+id+
            "' "+(checked?"checked":"")+disabledString+">";

    label.setAttribute("for", id);
    if (localChoiceNumber === 0) {
      if (isLast) {
        setClass(label, "onlyChild"+disabledString);
      } else {
        setClass(label, "firstChild"+disabledString);
      }
    } else if (isLast) {
      setClass(label, "lastChild"+disabledString);
    } else if (unselectable) {
      setClass(label, "disabled");
    }
    label.setAttribute("accesskey", globalChoiceNumber);
    if (!unselectable) {
      if (window.Touch) { // Make labels clickable on iPhone
          label.onclick = function labelClick(evt) {
              try {
                var target = evt.target;
                if (!/label/i.test(target.tagName)) return;
                var button = document.getElementById(target.getAttribute("for"));
                button.checked = true;
              } catch (e) {}
          };
      } else if (/MSIE 6/.test(navigator.userAgent)) {
        label.onclick = function labelClick() {
          try {
            var target = window.event.srcElement;
            if (!/label/i.test(target.tagName)) return;
            var button = document.getElementById(target.getAttribute("for"));
            button.checked = true;
          } catch (e) {}
        };
      }
    }
    printx(line, label);
    
    div2.appendChild(label);
    div.appendChild(div2);
}

function printImage(source, alignment, alt, invert) {
  var img = document.createElement("img");
  if (typeof hashes != 'undefined' && hashes[source]) {
    source += "?hash=" + hashes[source];
  }
  img.src = source;
  if (alt !== null && String(alt).length > 0) img.setAttribute("alt", alt);
  var zoomFactor = getZoomFactor();
  if (zoomFactor !== 1) {
    var size = (zoomFactor * 100) + '%';
    img.style.height = size;
    img.style.width = size;
  }
  if (invert) {
    setClass(img, "invert align"+alignment);
  } else {
    setClass(img, "align"+alignment);
  }
  document.getElementById("text").appendChild(img);
}

function playSound(source) {
  for (var existingAudios = document.getElementsByTagName("audio"); existingAudios.length;) {
    existingAudios[0].parentNode.removeChild(existingAudios[0]);
  }
  if (typeof hashes != 'undefined' && hashes[source]) {
    source += "?hash=" + hashes[source];
  }
  var audio = document.createElement("audio");
  if (audio.play) {
    audio.setAttribute("src", source);
    document.body.appendChild(audio);
    audio.play();
  }
}

function printYoutubeFrame(slug) {
  var wrapper = document.createElement("div");
  setClass(wrapper, "videoWrapper");
  var iframe = document.createElement("iframe");
  iframe.width="560";
  iframe.height="315";
  iframe.src="https://www.youtube.com/embed/"+slug;
  iframe.setAttribute("frameborder", 0);
  iframe.setAttribute("allowfullscreen", true);
  wrapper.appendChild(iframe);
  document.getElementById("text").appendChild(wrapper);
}

function moreGames() {
    if (window.isIosApp) {
      window.location.href = "https://choiceofgames.app.link/jBm199qZXL/";
    } else if (window.isAndroidApp) {
      if (window.isNookAndroidApp) {
        asyncAlert("Please search the Nook App Store for \"Choice of Games\" for more games like this!");
        return;
      }
      if (window.isAmazonAndroidApp) {
        window.location.href = "https://www.amazon.com/gp/mas/dl/android?p=com.choiceofgames.omnibus&t=choofgam-20&ref=moreGames";
      } else {
        window.location.href = "https://play.google.com/store/apps/details?id=com.choiceofgames.omnibus&referrer=utm_medium%3Dweb%26utm_source%3Dmoregames";
      }
    } else if (window.isSteamApp) {
      window.location.href = "https://store.steampowered.com/curator/7026798-Choice-of-Games/";
    } else {
      try {
        if (window.isChromeApp) {
          window.open("https://www.choiceofgames.com/category/our-games/");
        } else if (window.isHeartsChoice) {
          window.location.href = "https://www.heartschoice.com/shop/";
        } else {
          window.location.href = "https://www.choiceofgames.com/category/our-games/";
        }
      } catch (e) {
        // in xulrunner, this will be blocked, but it will trigger opening the external browser
      }
    }
}

function printShareLinks(target, now) {
  if (!target) target = document.getElementById('text');
  var msgDiv = document.createElement("div");
  if (window.isIosApp) {
    if (now) {
      callIos("share");
      return;
    }
    var button = document.createElement("button");
    button.appendChild(document.createTextNode("Share This Game"));
    button.onclick = function() {
      callIos("share");
    };
    msgDiv.appendChild(button);
    target.appendChild(msgDiv);
    return;
  }

  var mobileMesg = "";
  if (window.isAndroidApp) {
    var androidLink = document.getElementById('androidLink');
    var androidUrl;
    if (window.isNookAndroidApp) {
      if (window.nookEan && nookEan != "UNKNOWN") {
        mobileMesg = "  <li><a href='choiceofgamesnook://"+window.nookEan+"'>Rate this app</a> in the Nook App Store</li>\n";
      }
    } else if (androidLink) {
      androidUrl = getAndroidReviewLink();
      if (androidUrl) {
        mobileMesg = "  <li><a href='"+androidUrl+"'>Rate this app</a> in the Google Play Store</li>\n";
      }
    }
  } else if (/webOS/.test(navigator.userAgent) && window.isFile) {
    var palmLink = document.getElementById('palmLink');
    var palmUrl;
    if (palmLink) {
      palmUrl = palmLink.href;
      if (palmUrl) {
        mobileMesg = "  <li><a href='"+palmUrl+"'>Rate this app</a> in the Palm App Catalog</li>\n";
      }
    }
  } else if (window.isChromeApp) {
    var chromeLink = document.getElementById('chromeLink');
    var chromeUrl;
    if (chromeLink) {
      chromeUrl = chromeLink.href;
      if (chromeUrl) {
        mobileMesg = "  <li><a href='"+chromeUrl+"/reviews'>Rate this app</a> in the Chrome Web Store</li>\n";
      }
    }
  }

  var url = window.location.href;
  var links = document.getElementsByTagName("link");
  for (var i = links.length - 1; i >= 0; i--) {
    if (links[i].getAttribute("rel") == "canonical") {
      url = links[i].getAttribute("href") || url;
      break;
    }
  }

  if (/^\//.test(url)) {
    if (window.isWeb) {
      url = window.location.protocol + "//" + window.location.hostname + url;
    } else {
      url = "https://www.choiceofgames.com" + url;
    }
  }

  url = encodeURIComponent(url);
  var title = encodeURIComponent(document.title);
  var dataUriSupported = !/MSIE [67]/.test(navigator.userAgent);

  var twitterHandle = window.isHeartsChoice ? "heartschoice" : "choiceofgames";

  var shareLinkText =
        '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsklEQVQ4EWNgoBAwgvQnVq75f+vBG5KMUlMQYZjfHsLIBNJFqmZkPSzEWKsqL8zQXebJICLIDVZuEzUTrg3sAjgPBwNZM7oSolyAzWaYQUS5AKYYG43XBUeWpaPogfGRwwCvAW/efwUbAPMCjI9sKl4DArKXgNXCbIbxkQ2gOAwoNgDsBS5ONgYNJTFkl2FlG2nLwMVv3HsFZlPHBTLifAznrj6Bm47OQI42mBwoM1EFAAAnVCliRFKHdQAAAABJRU5ErkJggg==">':"")+
        ' <a href="http://www.facebook.com/sharer.php?u='+url+'&amp;t='+title+'"'+
        'onclick="if (window.isFile || window.isXul) return true; '+
        'window.open(&quot;http://www.facebook.com/sharer.php?u='+url+'&amp;t='+title+
        '&quot;,&quot;sharer&quot;,&quot;toolbar=0,status=0,width=626,height=436&quot;);return false;" class="spacedLink">Facebook</a></li>'+

        '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVQ4EYVTO24UQRB9/dmZkdfCIK0QBhMACQdwgDgMN4AEiYALcAFy7kNABkYkGzhAWMa2DHg9n+7iVfXMaAmAknp7tuvVq1dV3Q6j9SlJlzLEOXgIPPcmRjf5/7ZHdWQRaVPCOjucDYJlcHi8AFLOErz/J4kRQASXGfjYDmhIeDwAKx9xBzz8jxUCgjqSfE8CPWi5EpeTjOu+F36CVcGxrEBBMVDiaDOB5vqVBQu6WAU+dQmnwZuGwkACstxlRDckqWIhMQLPOtfXvfw0AmfA95thqwBNWGg04PktLbTYrEAlXxJTEciemtd+KdvZf7ESTjipEyaazAgyu/2lTTjP2ZpICZZQYSp7gg8kelh5PFj4Kd56ZvhE2IUSMOMVm/niZoPDOqJl0FSAYlYhoNoabSmBiI5pVNouv39w32G3l05wIwaqKRq00XErWGWYFvXz3uAbA4+51lyf+wy9h0JVRqAgfmehc8vmJt7n/CrKP6J81fzqfIPTVOOAo+S9soko+GkzhxgNocUkDfLmosPrsyvwtpTDP5KRWBz2Of4PB3vYr8o9mNuZncfLvRrPdmveJJVNDn0G8yKUMV/pO+p16MVmAn00yvnu9g7erpZ4xAbUrFtXMy42AE9YwmHNxo42lzAd6AtMQ48NgjVVOz+BVNQ9Zql4UI9P/TehBOJIi+EJIAAAAABJRU5ErkJggg==">':"")+
        ' <a href="https://twitter.com/intent/tweet?related='+twitterHandle+'&amp;text='+title+'&amp;url='+url+'&amp;via='+twitterHandle+'" class="spacedLink">Twitter</a></li>';

  var nowMsg = "";
  if (now) nowMsg = "<p>Please support our work by sharing this game with friends!  The more people play, the more resources we'll have to work on the next game.</p>";
  msgDiv.innerHTML = nowMsg + "<ul id='sharelist'>\n"+
    mobileMesg+
    shareLinkText+
    "</ul>\n";
  target.appendChild(msgDiv);
}

function isShareConfigured() {
  return !!document.getElementById("share");
}

function shareAction(e) {
  clearScreen(function() {
    var target = document.getElementById('text');
    printShareLinks(target, "now");
    printButton("Next", target, false, function () {
      clearScreen(loadAndRestoreGame);
    });
    curl();
  });
}

function isReviewSupported() {
  return !!(window.isIosApp || window.isAndroidApp);
}

function promptForReview() {
  var store;
  target = document.getElementById('text');
  function printMessage(store) {
    println("Please post a review of this game on "+store+". It really helps.[n/]", target);
  }
  var anchorText = "Review This Game";
  var href;
  if (window.isSteamApp) {
    printMessage("Steam");
    return printLink(target, "#", anchorText, function(e) {
      preventDefault(e);
      try {
        purchase("adfree", function() {});
      } catch (x) {}
      return false;
    });
  } else if (window.isIosApp) {
    println("Please post a review of this version of the game on the App Store. It really helps.[n/]", target);
    return printLink(target, "#", anchorText, function(e) {
      preventDefault(e);
      try {
        callIos("reviewapp");
      } catch (x) {}
      return false;
    });
  } else if (window.isAndroidApp) {
    href = getAndroidReviewLink();
    if (window.isAmazonAndroidApp) {
      printMessage("Amazon's Appstore");
    } else {
      printMessage("the Google Play Store");
    }
  } else if (window.isChromeApp) {
    href = document.getElementById('chromeLink').href;
  }
  
  printLink(target, href, anchorText);
}

function getAndroidReviewLink() {
  var href = document.getElementById('androidLink').href;
  var package = /id=([\.\w]+)/.exec(href)[1];
  // TODO legacy hosted
  if (window.isOmnibusApp) {
    var omnibus;
    if (/^org\.hostedgames/.test(package)) {
      omnibus = "org.hostedgames.omnibus";
    } else if (/^com\.heartschoice/.test(package)) {
      omnibus = "com.heartschoice.o";
    } else {
      omnibus = "com.choiceofgames.omnibus";
    }
    if (window.isAmazonAndroidApp) {
      return "http://www.amazon.com/gp/mas/dl/android?p="+omnibus+"&t=choofgam-20&ref=rate"
    } else {
      return "https://play.google.com/store/apps/details?id="+omnibus+"&referrer=utm_medium%3Dweb%26utm_source%3D"+window.storeName+"Game";
    }
  } else if (window.isAmazonAndroidApp) {
    return "http://www.amazon.com/gp/mas/dl/android?p="+package+"&t=choofgam-20&ref=rate";
  } else {
    return href;
  }
}

function isFollowEnabled() {
  return false;
  if (!window.isWeb) return false;
  // iOS add to homescreen seems not to like these iframes
  if (window.navigator.standalone) return false;
  if ("localhost" != window.location.hostname && !/\.?choiceofgames\.com$/.test(window.location.hostname)) return false;
  return true;
}

function printFollowButtons() {
  if (!isFollowEnabled()) return;
  // Just FB Like, for now
  var target = document.getElementById('text');
  var iframe = document.createElement('iframe');
  var width = 300;
  var height = 66;
  iframe.setAttribute("src", "//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fchoiceofgames"+
    "&amp;send=false&amp;layout=standard&amp;width="+width+"&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;"+
    "action=like&amp;height="+height+"&amp;appId=190439350983878");
  iframe.setAttribute("scrolling", "no");
  iframe.setAttribute("frameborder", "0");
  iframe.setAttribute("style", "border:none; overflow:hidden; width:"+width+"px; height:"+height+"px;");
  iframe.setAttribute("allowTransparency", "true");
  target.appendChild(iframe);
}

function subscribeLink(e) {
  clearScreen(function() {
    subscribe(document.getElementById('text'), {now:1}, function() {
      clearScreen(loadAndRestoreGame);
    });
    curl();
  });
}

function subscribeByMail(target, options, callback, code) {
  if (options.now) {
    code();
    if (options.allowContinue) safeTimeout(function() {callback("now");}, 0);
  } else {
    println("Click here to subscribe to our mailing list; " + options.message);
    println("");
    printButton("Subscribe", target, false, function() {
        code();
      });
    if (options.allowContinue) {
      printButton("No, Thanks", target, false, function() {
        safeTimeout(function() {callback();}, 0);
      });
    }
    // why is this timeout necessary?
    safeTimeout(function() {printFooter();}, 0);
  }
}

function subscribe(target, options, callback) {
  if (!options.message) options.message = "we'll notify you when our next game is ready!";
  if (typeof options.allowContinue === "undefined") options.allowContinue = 1;
  if (!target) target = document.getElementById('text');
  if (window.isIosApp) {
    subscribeByMail(target, options, callback, function() {
      callIos("subscribe");
    });
    return;
  }
  var mailToSupported = isMobile && !window.isMacApp;
  if (window.isAndroidApp) mailToSupported = urlSupport.isSupported("mailto:support@choiceofgames.com");
  var domain = window.isHeartsChoice ? "heartschoice.com" : "choiceofgames.com";
  if (mailToSupported) {
    subscribeByMail(target, options, callback, function() {
      window.location.href = "mailto:subscribe-"+window.storeName+"-"+platformCode() + "@"+domain+"?subject=Sign me up&body=Please notify me when the next game is ready.";
    });
    return;
  }
  println("Type your email address below; " + options.message);
  println("");
  fetchEmail(function(defaultEmail) {
    promptEmailAddress(target, defaultEmail, options.allowContinue, function(cancel, email) {
      if (cancel) {
        return safeCall(null, callback);
      }
      var head= document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      var timestamp = new Date().getTime();
      var timeout = setTimeout(function() {
        window["jsonp"+timestamp]({
          result:"error", msg:"Couldn't connect. Please try again later."
        });
      }, 10000);
      window["jsonp"+timestamp] = function(response) {
        clearTimeout(timeout);
        if (response.result == "error") {
          var errElement = document.getElementById("errorMessage");
          if (errElement) errElement.innerHTML = response.msg;
        } else {
          clearScreen(function() {
            target = document.getElementById('text');
            println(response.msg, target);
            println("", target);
            if (options.allowContinue) {
              printButton("Next", target, false, function() {
                safeCall(null, callback);
              });
            }
            curl();
          });
        }
      };
      var listId = window.isHeartsChoice ? "fa4134344b" : "e9cdee1aaa";
      var mailParams = "u=eba910fddc9629b2810db6182&id="+listId+"&SIGNUP="+window.storeName+"-"+platformCode()+"&EMAIL="+encodeURIComponent(email);
      if (window.isChromeApp) {
        chrome.permissions.contains({origins: ["http://choiceofgames.us4.list-manage.com/"]},function(isXhrAllowed) {
          if (isXhrAllowed) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", 'http://choiceofgames.us4.list-manage.com/subscribe/post-json?'+mailParams, true);
            xhr.onreadystatechange = function() {
              if (xhr.readyState != 4) return;
              if (xhr.status == 200) {
                var response = JSON.parse(xhr.responseText);
                window["jsonp"+timestamp](response);
              } else if (xhr.status === 0) {
                window["jsonp"+timestamp]({result:"error", msg:"There was a network error submitting your registration. Please try again later, or email subscribe@choiceofgames.com instead."});
              } else {
                window["jsonp"+timestamp]({result:"error", msg:"Sorry, our mail server had an error. It's our fault. Please try again later, or email subscribe@choiceofgames.com instead."});
              }
            };
            xhr.send();
          } else {
            window.addEventListener('message', function(event) {
              if (window["jsonp"+timestamp]) {
                var jsonpt = window["jsonp"+timestamp];
                window["jsonp"+timestamp] = null;
                if (jsonpt) jsonpt(event.data);
              }
            });
            var iframe = document.createElement("IFRAME");
            iframe.setAttribute("src", "sandbox.html");
            iframe.setAttribute("name", "sandbox");
            iframe.onload = function() {
              iframe.contentWindow.postMessage({email:email, game:window.storeName, platform:platformCode()}, "*");
            };
            document.documentElement.appendChild(iframe);
            return;
          }
        });
      } else {
        if (isWinStoreApp || window.location.protocol == "https:") {
          var xhr = findXhr();
          xhr.open("GET", 'https://www.choiceofgames.com/mailchimp_proxy.php/subscribe/post-json?'+mailParams, true);
          var done = false;
          xhr.onreadystatechange = function() {
            if (done) return;
            if (xhr.readyState != 4) return;
            done = true;
            if (xhr.status == 200) {
              var response = JSON.parse(xhr.responseText);
              window["jsonp"+timestamp](response);
            } else if (xhr.status === 0) {
                window["jsonp"+timestamp]({result:"error", msg:"There was a network error submitting your registration. Please try again later, or email subscribe@choiceofgames.com instead."});
            } else {
              window["jsonp"+timestamp]({result:"error", msg:"Sorry, our mail server had an error. It's our fault. Please try again later, or email subscribe@choiceofgames.com instead."});
            }
          };
          xhr.send();
        } else {
          script.src = 'https://choiceofgames.us4.list-manage.com/subscribe/post-json?'+mailParams+'&c=jsonp' + timestamp;
          head.appendChild(script);
        }
      }
    });
  });
}

function downloadLink(e) {
  if (e && e.preventDefault) e.preventDefault();
  if (isPrerelease()) {
    return asyncAlert("You'll need to wait until after the game is released on " + window.releaseDate);
  }
  clearScreen(function() {
    var text = document.getElementById("text");
    if (window.knownPurchases && window.knownPurchases.adfree) {
      println("You can download the game using the links below.");
      println("");
      var files = {
        Windows: window.downloadName + " Setup " + window.downloadVersion + "-ia32.exe",
        Mac: window.downloadName + "-" + window.downloadVersion + ".dmg",
        Linux: window.downloadPackage + "-" + window.downloadVersion + "-ia32.deb"
      }
      var detectedOs;
      if (/Windows/.test(navigator.userAgent)) {
        detectedOs = "Windows";
      } else if (/Mac OS X/.test(navigator.userAgent)) {
        detectedOs = "Mac";
      } else if (/Linux/.test(navigator.userAgent)) {
        detectedOs = "Linux";
      }
      if (detectedOs) {
        printDownloadLink(detectedOs);
      }
      for (var os in files) {
        if (detectedOs != os) printDownloadLink(os);
      }
      function printDownloadLink(os) {
        var link = document.createElement("a");
        if (detectedOs == os) {
          setClass(link, "next linkButton");
        } else {
          link.style.display = "block";
        }
        link.innerHTML = "Download for " + os;
        link.href = "scenes/"+files[os];
        text.appendChild(link);
      }
      println("");
      printButton("Next", text, false, function() {
        safeCall(null, function() { clearScreen(loadAndRestoreGame); });
      });
    } else {
      println("To download this game for Windows, Mac, or Linux, you'll need to purchase it first.");
      println("");
      printOptions([""], [{name:"Purchase it now.", purchase:1}, {name:"No, thanks.", cancel:1}], function(option) {
        if (option.purchase) {
          purchase("adfree", downloadLink);
        } else {
          safeCall(null, function() { clearScreen(loadAndRestoreGame); });
        }
      });
    }
    curl();
  });
}

function cacheKnownPurchases(knownPurchases) {
  if (!knownPurchases) return;
  var output = {billingSupported:true};
  for (i = 0; i < knownPurchases.length; i++) {
    var parts = knownPurchases[i].split(/\./);
    if (parts[0] != window.storeName) continue;
    output[parts[1]] = true;
  }
  window.knownPurchases = output;
  fetchEmail(function(email) {
    if (email) window.store.set("knownPurchases"+email.replace(/[^A-z0-9]/g, "_"), JSON.stringify(window.knownPurchases));
  })
  if (window.isIosApp) {
    callIos("cachepurchases", knownPurchases);
  } else if (window.isAndroidApp) {
    if (window.isOmnibusApp) {
      androidBilling.cachePurchases(JSON.stringify(knownPurchases));
    }
    androidBilling.updateAdfree(!!output.adfree);
  }
}

// Callback expects a map from product ids to booleans
function checkPurchase(products, callback) {
  function publishPurchaseEvents(purchases) {
    if (purchases && window.purchaseSubscriptions) {
      for (var key in purchaseSubscriptions) {
        if (purchases[key]) purchaseSubscriptions[key].call();
      }
    }
  }

  function checkWebPurchases(callback) {
    isRegistered(function (registered) {
      if (!registered) return callback("ok", {billingSupported: true});
      if (window.knownPurchases) {
        safeTimeout(function() {
          callback("ok", window.knownPurchases);
          publishPurchaseEvents(knownPurchases);
        }, 0);
      } else {
        startLoading();
        xhrAuthRequest("GET", "get-purchases", function(ok, response) {
          doneLoading();
          if (ok) {
            cacheKnownPurchases(response);
            callback(ok, window.knownPurchases);
          } else {
            fetchEmail(function(email) {
              if (!email) return callback(ok, window.knownPurchases);
              window.store.get("knownPurchases"+email.replace(/[^A-z0-9]/g, "_"), function(ok, value) {
                if (ok) {
                  window.knownPurchases = JSON.parse(value);
                }
                callback(ok, window.knownPurchases);
                publishPurchaseEvents(window.knownPurchases);
              })
            });
          }
        });
      }
    });
  }

  function mergeKnownPurchases(purchases) {
    window.checkPurchaseCallback = null;
    checkWebPurchases(function(ok, knownPurchases) {
      if (knownPurchases) {
        var productList = products.split(/ /);
        for (i = 0; i < productList.length; i++) {
          if (knownPurchases[productList[i]]) purchases[productList[i]] = knownPurchases[productList[i]];
        }
      }
      callback("ok", purchases);
      publishPurchaseEvents(purchases);
    });
  }

  var i, oldCallback;
  if (window.isIosApp) {
    oldCallback = window.checkPurchaseCallback;
    window.checkPurchaseCallback = function (purchases) {
      if (oldCallback) oldCallback(purchases);
      mergeKnownPurchases(purchases);
    }
    if (!oldCallback) callIos("checkpurchase", products);
  } else if (window.isAndroidApp && !window.isNookAndroidApp) {
    oldCallback = window.checkPurchaseCallback;
    window.checkPurchaseCallback = function (purchases) {
      if (oldCallback) oldCallback(purchases);
      mergeKnownPurchases(purchases);
    }
    if (!oldCallback) androidBilling.checkPurchase(products);
  } else if (window.isWinOldApp) {
    safeTimeout(function() {
      var purchases = eval(window.external.CheckPurchase(products));
      callback("ok",purchases);
      publishPurchaseEvents(purchases);
    }, 0);
  } else if (window.isMacApp && window.macPurchase) {
    safeTimeout(function() {
      var purchases = JSON.parse(macPurchase.checkPurchases_(products));
      callback("ok",purchases);
      publishPurchaseEvents(purchases);
    }, 0);
  } else if (window.isCef) {
    cefQuery({
      request:"CheckPurchases " + products,
      onSuccess: function(response) {
        console.log("cp response " + response);
        var purchases = JSON.parse(response);
        callback("ok",purchases);
        publishPurchaseEvents(purchases);
      },
      onFailure: function(error_code, error_message) {
        console.error("CheckPurchases error: " + error_message);
        callback(!"ok");
      }
    });
  } else if (window.isGreenworks) {
    var greenworks = require('greenworks');
    var greenworksApps = require('../package.json').products;
    var purchases = {};
    var productList = products.split(/ /);
    for (i = 0; i < productList.length; i++) {
      var appId = greenworksApps[productList[i]];
      var purchased = false;
      try {
        purchased = greenworks.isSubscribedApp(appId);
      } catch (e) {
        return safeTimeout(function() {callback(!"ok");}, 0);
      }
      purchases[productList[i]] = purchased;
    }
    purchases.billingSupported = true;
    publishPurchaseEvents(purchases);
    safeTimeout(function() {callback("ok", purchases);}, 0);
  } else if (window.beta === "beta") {
    var productList = products.split(/ /);
    var purchases = {};
    for (i = 0; i < productList.length; i++) {
      purchases[productList[i]] = true;
    }
    purchases.billingSupported = true;
    publishPurchaseEvents(purchases);
    safeTimeout(function () { callback("ok", purchases); }, 0);
  } else if (isWebPurchaseSupported()) {
    checkWebPurchases(function(ok, knownPurchases) {
      callback(ok, knownPurchases);
      publishPurchaseEvents(window.knownPurchases);
    });
  } else {
    var productList = products.split(/ /);
    var purchases = {};
    for (i = 0; i < productList.length; i++) {
      purchases[productList[i]] = !!window.isChromeApp;
    }
    purchases.billingSupported = false;
    publishPurchaseEvents(purchases);
    safeTimeout(function() {callback("ok", purchases);}, 0);
  }
}

function isWebPurchaseSupported() {
  var enableBilling = (typeof window.enableBilling === 'undefined' || window.enableBilling)
  return enableBilling && isWebSavePossible() && !!window.stripeKey;
}

function isRestorePurchasesSupported() {
  return !!window.isIosApp || !!window.isAndroidApp || isWebPurchaseSupported();
}

function restorePurchases(product, callback) {
  function webRestoreCallback() {
    var purchased = window.knownPurchases && window.knownPurchases[product];
    if (!purchased) {
      if (window.isAndroidApp) {
        return asyncAlert("Restore completed. This product is not yet purchased. "+
          "Sometimes purchases can fail to restore for reasons outside our control. "+
          "If you have already purchased this product, try uninstalling and reinstalling the app. "+
          "If that doesn't work, please email a copy of your receipt to " + getSupportEmail() + " "+
          "and we'll find a way to help you.", function() {
            callback(purchased);
          });
      } else {
        asyncAlert("Restore completed. This product is not yet purchased.");
      }
    } else {
      refreshIfAppUpdateReady();
      updateAllPaidSceneCaches();
    }
    callback(purchased);
  }
  function secondaryRestore(error) {
    window.restoreCallback = null;
    if (product) {
      checkPurchase(product, function(ok, purchases) {
        if (purchases[product]) {
          return callback("purchased");
        }

        if (window.isOmnibusApp && (window.purchaseTransfer || window.omnibusSupportsTransfer)) {
          var appId = getAppId();
          if (window.isAndroidApp || (window.isIosApp && (appId !== "1363309257" && appId !== "1302297731"))) {
            return omnibusRestore(appId);
          }
        }

        clearScreen(function() {
          isRegistered(function (registered) {
            if (registered) {
              startLoading();
              xhrAuthRequest("GET", "get-purchases", function(ok, response) {
                doneLoading();
                if (ok) {
                  cacheKnownPurchases(response);
                  webRestoreCallback();
                } else {
                  if (response.error === "not registered") {
                    logout();
                    secondaryRestore("error");
                  } else {
                    asyncAlert("There was an error restoring purchases. (Your network connection may be down.) Please try again later.");
                    callback();
                  }
                }
              });
            } else {
              var target = document.getElementById('text');
              if (error) {
                target.innerHTML="<p>Restore failed. Please try again later, or sign in to Choiceofgames.com to restore purchases.</p>";
              } else {
                target.innerHTML="<p>Restore completed. This product is not yet purchased. You may also sign in to Choiceofgames.com to restore purchases.</p>";
              }
              loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, webRestoreCallback);
              curl();
            }
          })
        });
      });
    } else {
      callback();
    }
  }
  function omnibusRestore(appId) {
    var omnibus = "Choice of Games";
    var canonical = document.querySelector("link[rel=canonical]");
    var canonicalHref = canonical && canonical.getAttribute("href");
    if (/\/user-contributed\//.test(canonicalHref)) {
      omnibus = "Hosted Games";
    }
    var appStore = window.isIosApp ? "App Store"
      : window.isAmazonAndroidApp ? "Amazon Appstore"
      : "Google Play Store";
    var gameTitle = document.querySelector(".gameTitle").textContent;

    clearScreen(function() {
      printParagraph("Restore completed. "+appStore+" records indicate that "+
        "you have not purchased this product using the \""+omnibus+"\" app, "+
        "but you may have purchased the product in the \""+gameTitle+"\" app, "+
        "or on our website at Choiceofgames.com.");

      options = [
        {name:"Restore purchases from Choiceofgames.com.", group:"choice", webRestore:true},
        {name:"Restore purchases using the \""+gameTitle+"\" app.", group:"choice", transfer:true},
      ];

      printOptions([""], options, function(option) {
        if (option.webRestore) {
          clearScreen(function() {
            isRegistered(function (registered) {
              if (registered) {
                startLoading();
                xhrAuthRequest("GET", "get-purchases", function(ok, response) {
                  doneLoading();
                  if (ok) {
                    cacheKnownPurchases(response);
                    webRestoreCallback();
                  } else {
                    if (response.error === "not registered") {
                      logout();
                      printParagraph("Sign in to Choiceofgames.com to restore purchases.");
                      loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, webRestoreCallback);
                    } else {
                      asyncAlert("There was an error restoring purchases. (Your network connection may be down.) Please try again later.");
                      callback();
                    }
                  }
                });
              } else {
                printParagraph("Sign in to Choiceofgames.com to restore purchases.");
                loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, webRestoreCallback);
              }
            });
          });
        } else {
          var transferAttempted = false;
          var transferPurchaseCallback = function(result) {
            window.transferPurchaseCallback = null;
            clearScreen(function() {
              var transferPlatform = window.isIosApp ? "ios" : "android";

              if (result === "launch_failed") {
                if (!transferAttempted) {
                  transferAttempted = true;
                  printParagraph(
                    "The \""+gameTitle+"\" app is not installed on your current device. To transfer "+
                    "purchases from another app, you'll need to install the \""+gameTitle+"\" app and "+
                    "this \""+omnibus+"\" app at the same time."
                  );
                } else {
                  printParagraph(
                    "The \""+gameTitle+"\" app is not responding. Try uninstalling and reinstalling "+
                    "the \""+gameTitle+"\" app and trying again.");
                  printParagraph("Sometimes purchases can fail to "+
                    "restore for reasons outside our control. If you have already purchased "+
                    "this product, please email a copy of your receipt to "+
                    "[url=mailto:"+transferPlatform+"-transfer-"+storeName+"-missing@choiceofgames.com]"+transferPlatform+"-transfer-"+storeName+"-missing@choiceofgames.com[/url] and we'll find a way to help "+
                    "you."
                  );
                }

                var appLink = window.isIosApp ? "https://itunes.apple.com/app/id"+appId
                  : window.isAmazonAndroidApp ? "https://www.amazon.com/gp/mas/dl/android?p="+appId
                  : "https://play.google.com/store/apps/details?id="+appId;
                printParagraph("[url="+appLink+"]Download "+gameTitle+" from the "+appStore+"[/url]");

                printOptions([""], [
                  {name:"I've installed the \""+gameTitle+
                    "\" app. Try restoring purchases again.", group:"choice", retry:true},
                  {name:"Cancel.", group:"choice"},
                ], function (option) {
                  if (option.retry) {
                    window.transferPurchaseCallback = transferPurchaseCallback;
                    startLoading();
                    window.isIosApp ? callIos("transferpurchase") : purchaseTransfer.requestTransfer(appId);
                  } else {
                    callback(!"purchased");
                  }
                });
                curl();
              } else if (result === "done") {
                checkPurchase(product, function(ok, purchases) {
                  if (purchases[product]) {
                    callback("purchased");
                  } else {
                    printParagraph("Restore completed. "+appStore+" records indicate that you have not purchased "+
                    "this product in the \""+gameTitle+"\" app.");
                    printParagraph("Sometimes purchases can fail to restore for reasons outside our control. If you "+
                    "have already purchased this product, please email a copy of your receipt "+
                    "to [url=mailto:"+transferPlatform+"-transfer-"+storeName+"-failed@choiceofgames.com]"+transferPlatform+"-transfer-"+storeName+"-failed@choiceofgames.com[/url] and we'll find a "+
                    "way to help you.");
                    var target = document.getElementById('text');
                    printButton("Next", target, false, function() {
                      callback(!"purchased");
                    });
                    curl();
                  }
                });
              } else { // result === "error"
                printParagraph("Restore failed. Please try again later. If this error "+
                  "persists, please contact [url=mailto:"+transferPlatform+"-transfer-"+storeName+"-error@choiceofgames.com]"+transferPlatform+"-transfer-"+storeName+"-error@choiceofgames.com[/url] "+
                  "and we'll find a way to help you.")
                printOptions([""], [
                  {name:"Try again now.", group:"choice", retry:true},
                  {name:"Cancel.", group:"choice"},
                ], function(option) {
                  if (option.retry) {
                    window.transferPurchaseCallback = transferPurchaseCallback;
                    clearScreen(function() {
                      startLoading();
                      window.isIosApp ? callIos("transferpurchase") : purchaseTransfer.requestTransfer(appId);
                    });
                  } else {
                    callback(!"purchased");
                  }
                });
                curl();
              }
            });
          }
          if (window.isIosApp) {
            startLoading();
            window.transferPurchaseCallback = transferPurchaseCallback;
            callIos("transferpurchase");
          } else {
            isRegistered(function(registered) {
              if (registered) {
                window.transferPurchaseCallback = transferPurchaseCallback;
                clearScreen(function() {
                  startLoading();
                  purchaseTransfer.requestTransfer(appId);
                });
              } else {
                clearScreen(function() {
                  printParagraph("To restore purchases in the "+omnibus+" app using the "+gameTitle+" app, you'll first need to sign in using a Choiceofgames.com account.");
                  loginForm(document.getElementById('text'), /*optionality*/1, /*err*/null, function(ok) {
                    if (ok) {
                      window.transferPurchaseCallback = transferPurchaseCallback;
                      clearScreen(function() {
                        startLoading();
                        purchaseTransfer.requestTransfer(appId);
                      });
                    } else {
                      webRestoreCallback();
                    }
                  });
                });
              }
            });
          }
        }
      });
      curl();
    });
  }

  if (window.isIosApp) {
    window.restoreCallback = secondaryRestore;
    callIos("restorepurchases");
  } else if (window.isAndroidApp) {
    window.restoreCallback = secondaryRestore;
    androidBilling.forceRestoreTransactions();
  } else if (isWebPurchaseSupported()) {
    isRegistered(function(registered) {
      if (registered) {
        startLoading();
        xhrAuthRequest("GET", "get-purchases", function(ok, response) {
          doneLoading();
          if (ok) {
            cacheKnownPurchases(response);
          } else {
            if (response.error != "not registered") {
              alertify.error("There was an error downloading your purchases from Choiceofgames.com. "+
                "Please refresh this page to try again, or contact " + getSupportEmail() + " for assistance.", 15000);
            }
          }
          logout();
          restorePurchases(product, callback);
        });
      } else {
        clearScreen(function() {
          var target = document.getElementById('text');
          target.innerHTML="<p>Please sign in to Choiceofgames.com to restore purchases.</p>";
          var steamRestore = false;
          var steamLink = document.getElementById('steamLink');
          if (steamLink && steamLink.href && !/INSERTINSERTINSERT/.test(steamLink.href)) {
            steamRestore = true;
          }
          if (steamRestore) {
            window.steamRestoreCallback = function(response) {
              window.steamRestoreCallback = null;
              if (response) cacheKnownPurchases(response);
              webRestoreCallback();
            }
          }
          loginForm(document.getElementById('text'), /*optional*/1, /*err*/null, webRestoreCallback);
          curl();
        });
      }
    });
  } else {
    safeTimeout(callback, 0);
  }
}
// Callback expects a localized string, or "", or "free", or "guess"
function getPrice(product, callback) {
  if (window.isIosApp) {
    checkForAppUpdates();
    window.priceCallback = callback;
    callIos("price", product);
  } else if (window.isAndroidApp) {
    window.priceCallback = callback;
    androidBilling.getPrice(product);
  } else if (window.isWeb) {
    checkForAppUpdates();
    if (window.productData && window.productData[product] && window.productData[product].amount) {
      safeTimeout(function () {
        callback.call(this, "$"+(productData[product].amount/100));
      }, 0);
    } else {
      safeTimeout(function() {
        if (window.productData && window.productData[product] && window.productData[product].amount) {
          callback.call(this, "$"+(productData[product].amount/100));
        } else {
          callback.call(this, "guess");
        }
      }, 500);
    }
  } else if (window.isGreenworks) {
    if (window.productData && window.productData[product]) {
      safeTimeout(function () {
        callback.call(this, productData[product]);
      }, 0);
    } else {
      window.awaitSteamProductData = function() {
        doneLoading();
        window.awaitSteamProductData = null;
        if (window.productData && window.productData[product]) {
          callback.call(this, productData[product]);
        } else {
          callback.call(this, "hide");
        }
      };
      startLoading();
      safeTimeout(function() {if (window.awaitSteamProductData) awaitSteamProductData();}, 5000);
    }
  } else {
    safeTimeout(function () {
      callback.call(this, "hide");
    }, 0);
  }
}
// Callback expects no args, but should only be called on success
function purchase(product, callback) {
  var purchaseCallback = function() {
    window.purchaseCallback = null;
    refreshIfAppUpdateReady();
    updateAllPaidSceneCaches();
    safeCall(null, callback);
    if (window.purchaseSubscriptions && purchaseSubscriptions[product]) {
      purchaseSubscriptions[product].call();
    }
  };
  if (window.isIosApp) {
    if (!window.purchaseRequiresLogin || window.registered) {
      window.purchaseCallback = purchaseCallback;
      return callIos("purchase", product);
    } else {
      clearScreen(function() {
        var target = document.getElementById('text');
        target.innerHTML="<p>Please sign in to Choiceofgames.com to purchase.</p>";
        loginForm(target, /*optional*/1, /*err*/null, function(registered){
          if (registered) {
            if (window.knownPurchases && window.knownPurchases[product]) {
              purchaseCallback();
            } else {
              clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
              window.doneLoadingCallback = function() {
                window.purchaseCallback = purchaseCallback;
                callIos("purchase", product);
              }
            }
          } else {
            clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
          }
        });
        curl();
      });
    }
  } else if (window.isAndroidApp) {
    window.purchaseCallback = purchaseCallback;
    var androidStackTrace = androidBilling.purchase(product);
    if (androidStackTrace) throw new Error(androidStackTrace);
  } else if (window.isWinOldApp) {
    window.external.Purchase(product);
  } else if (window.isMacApp && window.macPurchase) {
    macPurchase.purchase_(product);
  } else if (window.isGreenworks) {
    var greenworksApps = require('../package.json').products;
    if (greenworksApps[product]) require("electron").shell.openExternal("steam://advertise/"+greenworksApps[product]);
  } else if (window.isCef) {
    cefQuerySimple("Purchase " + product);
    // no callback; we'll refresh on purchase
  } else if (window.isWeb && !isPrerelease() && product == window.appPurchase) {
    var webStoreFallback = function() {
      window.appPurchase = null;
      purchase(product, callback);
    };
    var clickLink = function(id) {
      var link = document.getElementById(id);
      if (!link) return webStoreFallback();
      var href = link.getAttribute("href");
      if (!href) return webStoreFallback();
      window.location.href = href;
    };
    
    // instead of IAP, send Android users to a store
    if (/Silk/.test(navigator.userAgent)) {
      clickLink("kindleLink");
    } else if (/Android/.test(navigator.userAgent)) {
      clickLink("androidLink");
    } else if (window.steamClobber && document.getElementById("steamLink")) {
      clickLink("steamLink");
    } else {
      webStoreFallback();
    }
  } else if (isWebPurchaseSupported()) {
    if (!window.StripeCheckout) return asyncAlert("Sorry, we weren't able to initiate payment. (Your "+
      "network connection may be down.) Please refresh the page and try again, or contact "+
      "support@choiceofgames.com for assistance.");
    var fullProductName = window.storeName + "." + product;
    function stripe() {
      if (window.productData && window.productData[product]) {
        var data = productData[product];
        return StripeCheckout.open({
          key:         window.stripeKey,
          address:     false,
          amount:      data.amount,
          name:        data.display_name,
          email:       window.recordedEmail,
          panelLabel:  'Buy',
          token:       function(response) {
            clearScreen(function() {
              startLoading();
              xhrAuthRequest("POST", "purchase", function(ok, response) {
                doneLoading();
                if (ok) {
                  cacheKnownPurchases(response);
                  return purchaseCallback();
                } else if (/^card error: /.test(response.error)) {
                  var cardError = response.error.substring("card error: ".length);
                  asyncAlert(cardError);
                  clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                } else if ("purchase already in flight" == response.error) {
                  asyncAlert("Sorry, there was an error handling your purchase. Please wait five minutes and try again, or contact support@choiceofgames.com for assistance.");
                  clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                } else {
                  asyncAlert("Sorry, there was an error processing your card. (Your "+
                    "network connection may be down.) Please refresh the page and try again, or contact "+
                    "support@choiceofgames.com for assistance.");
                  clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                }
                curl();
              }, "stripeToken", response.id, "product", fullProductName, "key", window.stripeKey);
            });
          }
        });
      } else {
        return asyncAlert("Sorry, we weren't able to initiate payment. (Your "+
          "network connection may be down.) Please refresh the page and try again, or contact "+
          "support@choiceofgames.com for assistance.");
      }
    }
    if (window.registered && window.recordedEmail) {
      stripe();
    }
    clearScreen(function() {
      var target = document.getElementById('text');
      target.innerHTML="<p>Please sign in to Choiceofgames.com to purchase.</p>";
      loginForm(document.getElementById('text'), /*optional*/1, /*err*/null, function(registered){
        if (registered) {
          if (window.knownPurchases && window.knownPurchases[product]) {
            purchaseCallback();
          } else {
            clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
            return stripe();
          }
        } else {
          clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
        }
      });
      curl();
    });
  } else {
    safeTimeout(purchaseCallback, 0);
  }
}

function printDiscount(product, fullYear, oneBasedMonthNumber, dayOfMonth, line, options) {
  if (window.updatedDiscountDates && updatedDiscountDates[product]) {
    var udd = updatedDiscountDates[product];
    fullYear = udd.fullYear;
    oneBasedMonthNumber = udd.oneBasedMonthNumber;
    dayOfMonth = udd.dayOfMonth;
  }
  var shortMonthString = shortMonthStrings[oneBasedMonthNumber];
  var discountTimestamp = new Date(shortMonthString + " " + dayOfMonth + ", " + fullYear).getTime();
  var discountEligible = new Date().getTime() < discountTimestamp;
  var span;
  span = document.createElement("span");
  span.setAttribute("id", "discount_" + product);
  printx(line, span);
  span.innerHTML = span.innerHTML.replace("${choice_discount_ends}", "<span id=discountdate_"+product+">"+shortMonthString + " " + parseInt(dayOfMonth, 10) + "</span>") + " ";

  if (!discountEligible) {
    span.style.display = "none";
  }

  document.getElementById('text').appendChild(span);
}

function rewriteDiscount(product, fullYear, oneBasedMonthNumber, dayOfMonth) {
  if (!window.updatedDiscountDates) window.updatedDiscountDates = {};
  window.updatedDiscountDates[product] = {fullYear:fullYear, oneBasedMonthNumber:oneBasedMonthNumber, dayOfMonth:dayOfMonth};
  var span = document.getElementById("discount_"+product);
  if (!span) return;
  var shortMonthString = shortMonthStrings[oneBasedMonthNumber];
  var discountTimestamp = new Date(shortMonthString + " " + dayOfMonth + ", " + fullYear).getTime();
  var discountEligible = new Date().getTime() < discountTimestamp;
  if (discountEligible) {
    var dateSpan = document.getElementById("discountdate_"+product);
    if (!dateSpan) return;
    span.style.display = "";
    dateSpan.innerHTML = shortMonthString + " " + parseInt(dayOfMonth, 10);
  } else {
    span.style.display = "none";
  }
}

function handleDiscountResponse(ok, response) {
  if (!ok || !response || !window.storeName || !response[storeName]) return;
  if (!window.updatedDiscountDates) window.updatedDiscountDates = {};
  var udds = response[storeName];
  for (var product in udds) {
    if (!udds.hasOwnProperty(product)) continue;
    var udd = udds[product];
    var result = udd.split("-");
    rewriteDiscount(product, result[0], parseInt(result[1],10), parseInt(result[2], 10));
  }
}

function isPrerelease() {
  var steamTrial = window.isSteamApp && window.isTrial;
  if (typeof window != "undefined" && (window.isWeb || steamTrial) && window.releaseDate) {
    if (new Date() > window.releaseDate.getTime()) return false;
    if (/(fullaccess|preview)@choiceofgames.com/.test(getCookieByName("login"))) return false;
    var identity = document.getElementById("identity");
    return !(identity && /(fullaccess|preview)@choiceofgames.com/.test(identity.innerHTML));
  } else {
    return false;
  }
}

function registerNativeAchievement(name) {
  if (window.blockNativeAchievements) return;
  if (window.isIosApp) {
    callIos("achieve", name+"/");
  } else if (window.isMacApp && window.macAchievements) {
    macAchievements.achieve_(name);
  } else if (window.isWinOldApp) {
    window.external.Achieve(name);
  } else if (window.isCef) {
    cefQuerySimple("Achieve " + name);
  } else if (window.isGreenworks) {
    require('greenworks').activateAchievement(name, function() {
      console.log("registered achievement " + name);
    })
  }
}

function achieve(name, title, description) {
  if (initStore()) {
    checkAchievements(function() {
      window.store.set("achieved", toJson(nav.achieved));
    })
  }
  registerNativeAchievement(name);
  // Game Center shows a prominent banner; no need to show our own
  if (window.isIosApp && !window.isOmnibusApp) return;
  var escapedTitle = title+"".replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
  var escapedDescription = description+"".replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/\[b\]/g, '<b>')
    .replace(/\[\/b\]/g, '</b>')
    .replace(/\[i\]/g, '<i>')
    .replace(/\[\/i\]/g, '</i>');
  var html = "<b>Achievement: "+escapedTitle+"</b><br>" + escapedDescription;
  alertify.log(html);
}

function checkAchievements(callback) {
  safeTimeout(function() {
    if (!initStore()) return callback();
    window.store.get("achieved", function(ok, value){
      function mergeNativeAchievements(achieved) {
        window.checkAchievementCallback = null;
        var nativeRegistered = {};
        for (var i = 0; i < achieved.length; i++) {
          nav.achieved[achieved[i]] = true;
          nativeRegistered[achieved[i]] = true;
        }
        for (var achievement in nav.achieved) {
          if (nav.achieved[achievement] && !nativeRegistered[achievement]) {
            registerNativeAchievement(achievement);
          }
        }
        callback();
      }
      var alreadyLoadingAchievements = false;
      if (ok && value) {
        var achievementRecord = jsonParse(value);
        for (var achieved in achievementRecord) {
          if (achievementRecord[achieved]) nav.achieved[achieved] = true;
        }
      }
      if (window.isIosApp) {
        alreadyLoadingAchievements = !!window.checkAchievementCallback;
        window.checkAchievementCallback = mergeNativeAchievements;
        if (!alreadyLoadingAchievements) callIos("checkachievements");
      } else if (window.isGreenworks) {
        if (!window.greenworksAchivementCallbackCount) {
          var greenworks = require('greenworks');
          var nativeAchievementNames = greenworks.getAchievementNames();
          window.greenworksAchivementCallbackCount = nativeAchievementNames.length;
          if (!window.greenworksAchivementCallbackCount) {
            return callback();
          }
          var nativeAchievements = [];
          for (var i = 0; i < nativeAchievementNames.length; i++) {
            (function(i) {
              greenworks.getAchievement(nativeAchievementNames[i], function(bAchieved) {
                greenworksAchivementCallbackCount--;
                if (bAchieved) {
                  nativeAchievements.push(nativeAchievementNames[i]);
                }
                if (!greenworksAchivementCallbackCount) {
                  mergeNativeAchievements(nativeAchievements);
                }
              }, function(err) {
                greenworksAchivementCallbackCount--;
              });
            })(i);
          }
        } else {
          safeTimeout(function() {checkAchievements(callback);}, 100);
        }
      } else if (window.isMacApp && window.macAchievements) {
        alreadyLoadingAchievements = !!window.checkAchievementCallback;
        window.checkAchievementCallback = mergeNativeAchievements;
        if (!alreadyLoadingAchievements) macAchievements.checkAchievements();
      } else if (window.isWinOldApp) {
        var checkWinAchievements = function () {
          var achieved = eval(window.external.GetAchieved());
          if (achieved) {
            mergeNativeAchievements(achieved);
          } else {
            safeTimeout(checkWinAchievements, 100);
          }
        };
        checkWinAchievements();
      } else if (window.isCef) {
        var checkCefAchievements = function() {
          cefQuery({
            request:"GetAchieved ",
            onSuccess: function(response) {
              //console.log("GetAchieved " + response);
              var achieved = eval(response);
              mergeNativeAchievements(achieved);
            },
            onFailure: function(error_code, error_message) {
              //console.error("GetAchieved error " + error_message);
              if (error_code == 1) {
                safeTimeout(checkCefAchievements, 100);
              } else {
                callback();
              }
            }
          });
        };
        checkCefAchievements();
      } else {
        callback();
      }
    });
  },0);
}

function isAdvertisingSupported() {
  if (typeof window === "undefined") return false;
  return (window.isIosApp || window.isAndroidApp || window.adSupportedDebug);
}

function isFullScreenAdvertisingSupported() {
  return isAdvertisingSupported();
}

function showFullScreenAdvertisement(callback) {
  if (window.isIosApp) {
    callIos("advertisement");
    safeTimeout(callback, 0);
  } else if (window.isAndroidApp && window.adBridge) {
    adBridge.displayFullScreenAdvertisement();
    safeTimeout(callback, 0);
  } else if (window.adSupportedDebug) {
    alert("ad!");
    safeTimeout(callback, 0);
  } else {
    safeTimeout(callback, 0);
  }
}

function showFullScreenAdvertisementButton(buttonName, skipCallback, doneCallback) {
  if (typeof isFullScreenAdvertisingSupported == "undefined" || !isFullScreenAdvertisingSupported()) {
    return skipCallback();
  }
  startLoading();
  checkPurchase("adfree", function (ok, result) {
    doneLoading();
    if (result.adfree) {
      skipCallback();
    } else {
      printButton(buttonName, main, false, function () {
        showFullScreenAdvertisement(doneCallback);
      })
    }
  });
}

function showTicker(target, endTimeInSeconds, finishedCallback) {
  if (!target) target = document.getElementById('text');
  var div = document.createElement("span");
  div.setAttribute("id", "delayTicker");
  target.appendChild(div);
  var timerDisplay = document.createElement("span");
  div.appendChild(timerDisplay);
  var timer;

  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    var defaultStatsButtonDisplay = statsButton.style.display;
    statsButton.style.display = "none";
  }

  if (endTimeInSeconds > Math.floor(new Date().getTime() / 1000)) {
    if (window.isAndroidApp) {
      notificationBridge.scheduleNotification(endTimeInSeconds);
    } else if (window.isIosApp) {
      callIos("schedulenotification", endTimeInSeconds);
    }
  }

  function cleanUpTicker() {
    window.blockRestart = false;
    if (window.isAndroidApp) {
      notificationBridge.cancelNotification();
    } else if (window.isIosApp) {
      callIos("cancelnotifications");
    }
    clearInterval(timer);
    if (statsButton) statsButton.style.display = defaultStatsButtonDisplay;
  }

  function formatSecondsRemaining(secondsRemaining, forceMinutes) {
    if (!forceMinutes && secondsRemaining < 60) {
      return ""+secondsRemaining+"s";
    } else {
      var minutesRemaining = Math.floor(secondsRemaining / 60);
      var remainderSeconds;
      if (minutesRemaining < 60) {
        remainderSeconds = secondsRemaining - minutesRemaining * 60;
        return ""+minutesRemaining+"m " + formatSecondsRemaining(remainderSeconds);
      } else if (minutesRemaining < 6000) {
        var hoursRemaining = Math.floor(secondsRemaining / 3600);
        remainderSeconds = secondsRemaining - hoursRemaining * 3600;
        return ""+hoursRemaining+"h " + formatSecondsRemaining(remainderSeconds, true);
      } else {
        var daysRemaining = Math.floor(secondsRemaining / 86400);
        remainderSeconds = secondsRemaining - daysRemaining * 86400;
        return ""+daysRemaining+" days " + formatSecondsRemaining(remainderSeconds, true);
      }
    }
  }

  function tick() {
    var tickerElement = document.getElementById("delayTicker");
    var tickerStillVisible = tickerElement && tickerElement.parentNode && tickerElement.parentNode.parentNode;
    if (!tickerStillVisible) {
      cleanUpTicker();
      return;
    }
    var nowInSeconds = Math.floor(new Date().getTime() / 1000);
    var secondsRemaining = endTimeInSeconds - nowInSeconds;
    if (secondsRemaining >= 0) {
      timerDisplay.innerHTML = "" + formatSecondsRemaining(secondsRemaining) + " seconds remaining";
    } else {
      cleanUpTicker();
      tickerElement.innerHTML = "0s remaining";
      if (finishedCallback) safeCall(null, finishedCallback);
    }
  }

  timer = setInterval(tick, 1000);
  tick();
}

function printButton(name, parent, isSubmit, code) {
  var button;
  if (isSubmit) {
    button = document.createElement("input");
    button.type = "submit";
    button.value = name;
    button.name = name;
  } else {
    button = document.createElement("button");
    button.setAttribute("type", "button");
    printx(name, button);
  }
  setClass(button, "next");
  button.setAttribute("accesskey", "n");
  if (code) button.onclick = function(event) {
    if (window.isIosApp) {
      window.freezeCallback = function() {
        window.freezeCallback = null;
        code(event);
      };
      callIos("freeze");
    } else {
      safeCall(null, function() {code(event);});
    }
  };
  if (!isMobile) try { button.focus(); } catch (e) {}
  parent.appendChild(button);
  return button;
}

function printLink(target, href, anchorText, onclick) {
  if (!target) target = document.getElementById('text');
  var link = document.createElement("a");
  link.setAttribute("href", href);
  link.appendChild(document.createTextNode(anchorText));
  if (onclick) {
    if (link.addEventListener) {
      link.addEventListener("click", onclick, true);
    } else {
      link.onclick = onclick;
    }
  }
  target.appendChild(link);
  target.appendChild(document.createTextNode(" "));
}

function kindleButton(target, query, buttonName) {
  printButton(buttonName, main, false,
    function() {
      try {
        window.location.href="http://www.amazon.com/s?rh=n%3A133140011%2Ck%3A" + encodeURIComponent(query);
      } catch (e) {} // xulrunner will intercept this link and throw an exception, opening it in the external browser
    }
  );
}

function printInput(target, inputOptions, callback, minimum, maximum, step) {
    if (!target) target = document.getElementById('text');
    var form = document.createElement("form");
    target.appendChild(form);
    var self = this;
    form.action="#";


    if (inputOptions.long) {
      var input = document.createElement("textarea");
      input.setAttribute("rows", 4);
    } else {
      var input = document.createElement("input");
      if (inputOptions.numeric) {
        input.setAttribute("type", "number");
        input.setAttribute("min", minimum);
        input.setAttribute("max", maximum);
        step = step || "any";
        input.setAttribute("step", step);
      }
    }

    input.setAttribute("autocomplete", "off");

    input.name="text";
    input.setAttribute("style", "font-size: 25px; width: 90%;");
    form.appendChild(input);

    form.onsubmit = function(e) {
        preventDefault(e);
        if (!input.value && !inputOptions.allow_blank) {
            asyncAlert("Don't just leave it blank!  Type something!");
            return;
        }
        if (window.isIosApp) {
          window.freezeCallback = function() {
            window.freezeCallback = null;
            safeCall(null, function() {callback(input.value);});
          };
          callIos("freeze");
        } else {
          safeCall(null, function() {callback(input.value);});
        }
        return false;
    };

    printButton("Next", form, true);

}

function promptEmailAddress(target, defaultEmail, allowContinue, callback) {
  if (!target) target = document.getElementById('text');
  var form = document.createElement("form");
  var self = this;
  form.action="#";

  var message = document.createElement("div");
  message.style.color = "red";
  message.style.fontWeight = "bold";
  message.setAttribute("id", "errorMessage");
  form.appendChild(message);

  var input = document.createElement("input");
  // This can fail on IE
  try { input.type="email"; } catch (e) {}
  input.name="email";
  input.value=defaultEmail;
  input.setAttribute("style", "font-size: 25px; width: 90%;");
  form.appendChild(input);
  target.appendChild(form);
  println("", form);
  println("", form);
  printButton("Next", form, true);

  if (allowContinue) {
    printButton("No, Thanks", target, false, function() {
      callback(true);
    });
  }

  form.onsubmit = function(e) {
    preventDefault(e);
    safeCall(this, function() {
      var email = trim(input.value);
      if (!/^\S+@\S+\.\S+$/.test(email)) {
        var messageText = document.createTextNode("Sorry, \""+email+"\" is not an email address.  Please type your email address again.");
        message.innerHTML = "";
        message.appendChild(messageText);
      } else {
        recordEmail(email, function() {
          callback(false, email);
        });
      }
    });
  };

  curl();
}

function loginForm(target, optional, errorMessage, callback) {
  if (!isRegisterAllowed() || !initStore()) return safeTimeout(function() {
    callback(!"ok");
  }, 0);
  var optional_start = 1;
  var optional_returning_subscribe = 2;
  var optional_returning_no_subscribe = 3;
  var optional_new_subscribe = 4;
  var optional_new_no_subscribe = 5;
  startLoading();
  fetchEmail(function(defaultEmail) {
    isRegistered(function(registered) {
      if (registered) {
        if (defaultEmail) {
          doneLoading();
          loginDiv(registered, defaultEmail);
          return safeTimeout(callback, 0);
        }
        // Cookie says I'm logged in, but we have no local record of the email address
        return getRemoteEmail(function(ok, response) {
          doneLoading();
          if (ok) {
            if (response.email) {
              loginDiv(registered, response.email);
              return recordEmail(response.email, callback);
            } else {
              // not really logged in after all
              logout();
              loginDiv();
              return loginForm(target, optional, errorMessage, callback);
            }
          } else {
            // missed an opportunity to record email locally. meh.
            return safeCall(null, callback);
          }
        });
      }
      doneLoading();
      var form = document.createElement("form");

    if (!errorMessage) errorMessage = "";

      var escapedEmail = defaultEmail.replace(/'/g, "&apos;");
      var passwordButton;
      if (optional == optional_start) {
        form.innerHTML = "<div id=message style='color:red; font-weight:bold'>"+errorMessage+
          "</div><div class='choice'>"+
          "<label for=yes class=firstChild><input type=radio name=choice value=yes id=yes checked> My email address is: "+
          "<input type=email name=email id=email value='"+escapedEmail+"' style='font-size: 25px; width: 11em'></label>"+
          ((isWeb && window.facebookAppId)?"<label for=facebook><input type=radio name=choice value=facebook id=facebook > Sign in with Facebook.</label>":"")+
          ((isWeb && window.googleAppId)?"<label for=google><input type=radio name=choice value=google id=google > Sign in with Google.</label>":"")+
          ((window.steamRestoreCallback)?"<label for=steam><input type=radio name=choice value=steam id=steam > Restore purchases from Steam.</label>":"")+
          "<label for=no class=lastChild><input type=radio name=choice value=no id=no > No, thanks.</label>"+
          "<p><label class=noBorder for=subscribe><input type=checkbox name=subscribe id=subscribe checked> "+
          "Email me when new games are available.</label></p>";

        form.email.onclick = function() {
          setTimeout(function() {form.email.focus();}, 0);
        };
        setTimeout(function() {form.email.focus();}, 0);
      } else {
        form.innerHTML = "<div id=message style='color:red; font-weight:bold'>"+errorMessage+
          "</div><span><span>My email address is: </span><input type=email name=email id=email value='"+
          escapedEmail+"' style='font-size: 25px; width: 12em'></span><p><label class=noBorder id=subscribeLabel for=subscribe>"+
          "<input type=checkbox name=subscribe id=subscribe checked> "+
          "Email me when new games are available.</label></p><p>Do you have a Choiceofgames.com password?</p>"+
          "<div class='choice'>"+
          "<label for=new class=firstChild><input type=radio name=choice value=new id=new checked> No, I'm new.</label>"+
          "<label for=passwordButton><input type=radio name=choice value=passwordButton id=passwordButton> "+
          "Yes, I have a password: <input id=password type=password name=password disabled class=needsclick style='font-size: 25px; width: 11em'></label>"+
          "<label for=forgot><input type=radio name=choice value=forgot id=forgot> I forgot my password.</label>"+
          ((isWeb && window.facebookAppId)?"<label for=facebook><input type=radio name=choice value=facebook id=facebook> Sign in with Facebook.</label>":"")+
          ((isWeb && window.googleAppId)?"<label for=google><input type=radio name=choice value=google id=google> Sign in with Google.</label>":"")+
          (optional ? "<label for=no><input type=radio name=choice value=no id=no> Cancel.</label>" : "") +
          "</div>";

        var labels = form.getElementsByTagName("label");
        setClass(labels[labels.length-1], "lastChild");

        var password = form.password;
        passwordButton = form.passwordButton;

        passwordButton.parentNode.onclick = function() {
          passwordButton.checked = true;
          passwordButton.onchange();
        };

        var radioButtons = form.choice;
        var onchange = function() {
          var enabled = passwordButton.checked;
          password.disabled = !enabled;
          if (enabled) {
            password.focus();
            setTimeout(function() {password.parentNode.scrollIntoView();}, 0);
          }
        };
        for (var i = radioButtons.length - 1; i >= 0; i--) {
          radioButtons[i].onchange = onchange;
        }
        if (optional) {
          form.subscribe.checked = (optional == optional_returning_subscribe || optional == optional_new_subscribe);
          passwordButton.checked = (optional == optional_returning_subscribe || optional == optional_returning_no_subscribe);
        }
      }

      function showMessage(msg) {
        var message = document.getElementById('message');
        var messageText = document.createTextNode(msg);
        message.innerHTML = "";
        message.appendChild(messageText);
      }

      form.onsubmit = function(event) {
        preventDefault(event);
        var email = trim(form.email.value);
        var subscribe = form.subscribe.checked;
        var choice = getFormValue("choice");
        if ("steam" == choice) {
          window.open('https://www.choiceofgames.com/api/Steam/');
        }
        if ("facebook" == choice) {
          if (!window.FB) return asyncAlert("Sorry, we weren't able to sign you in with Facebook. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
          var loginParams = {scope:'email',return_scopes:true};
          if (window.facebookReRequest) loginParams.auth_type = "rerequest";
          return FB.login(function(response){
            if ("connected" == response.status) {
              var grantedScopes = [];
              try { grantedScopes = response.authResponse.grantedScopes.split(","); } catch (e) {}
              var grantedEmail = false;
              for (var i = 0; i < grantedScopes.length; i++) {
                if ("email" == grantedScopes[i]) {
                  grantedEmail = true;
                  break;
                }
              }
              if (grantedEmail) {
                xhrAuthRequest("POST", "facebook-login", function(ok, response){
                  if (ok) {
                    loginDiv(ok, response.email);
                    recordLogin(ok, response.id, response.email);
                    cacheKnownPurchases(response.purchases);
                    safeCall(null, function() {callback("ok");});
                  } else {
                    asyncAlert("Sorry, we weren't able to sign you in with Facebook. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                }, "app_id", facebookAppId);
              } else {
                showMessage("Sorry, we require an email address to sign you in. Please grant access to your email address, or type your email address below.");
                window.facebookReRequest = true;
              }
            }
          },loginParams);
        }
        if ("google" == choice) {
          if (!window.gapi) return asyncAlert("Sorry, we weren't able to sign you in with Google. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
          var done = false;
          return gapi.auth.signIn({callback: function (authResult) {
            if (done) return;
            done = true;
            if (authResult['status']['signed_in']) {
              isRegistered(function(registered) {
                if (!registered) xhrAuthRequest("POST", "google-login", function(ok, response){
                  loginDiv(ok, response.email);
                  recordLogin(ok, response.id, response.email);
                  cacheKnownPurchases(response.purchases);
                  if (ok) {
                    callback("ok");
                  } else {
                    asyncAlert("Sorry, we weren't able to sign you in with Google. Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                }, "code", authResult['code'], "client_id", googleAppId);
              });
            } else {
              asyncAlert("Sorry, we weren't able to sign you in with Google. Please try again later, or contact support@choiceofgames.com for assistance.");
            }
          }});
        }
        if (!/^\S+@\S+\.\S+$/.test(email) && "no" != choice) {
          showMessage('Sorry, "'+email+'" is not an email address.  Please type your email address again.');
        } else {
          recordEmail(email, function() {
            if ("yes" == choice) {
              clearScreen(function() {
                if (defaultEmail) {
                  optional = subscribe ? optional_returning_subscribe : optional_returning_no_subscribe;
                } else {
                  optional = subscribe ? optional_new_subscribe : optional_new_no_subscribe;
                }
                loginForm(document.getElementById("text"), optional, null, callback);
                curl();
              });
            } else if ("no" == choice) {
              safeCall(null, function() {callback(false);});
            } else if ("new" == choice) {
              target.innerHTML = "";
              window.scrollTo(0,1);
              form = document.createElement("form");
              var escapedEmail = email.replace(/'/g, "&apos;");
              form.innerHTML = "<div id=message style='color:red; font-weight:bold'></div>"+
                "<div>My email address is: </div><div><input type=email name=email id=email value='"+
                escapedEmail+"' style='font-size: 25px; width: 12em'></div>"+
                "<div>Type it again: </div><div><input type=email name=email2 id=email2 autocomplete='off' style='font-size: 25px; width: 12em'></div>"+
                "<div>Enter a new password:&nbsp;</div><div>"+
                "<input type=password name=password id=password style='font-size: 25px; width: 12em'></div>";
              form.onsubmit = function(event) {
                preventDefault(event);
                var email = trim(form.email.value);
                var email2 = trim(form.email2.value);
                if (!/^\S+@\S+\.\S+$/.test(email)) {
                  showMessage('Sorry, "'+email+'" is not an email address.  Please type your email address again.');
                  return;
                } else if (email != email2) {
                  showMessage('Those email addresses don\'t match.  Please type your email address again.');
                  return;
                }
                startLoading();
                form.style.display = "none";
                window.scrollTo(0,1);
                login(email, form.password.value, /*register*/true, subscribe, function(ok, response) {
                  doneLoading();
                  if (ok) {
                    target.innerHTML = "";
                    loginDiv(ok, email);
                    recordLogin(ok, response.id, email);
                    cacheKnownPurchases(response.purchases);
                    // we need another click event so we can launch Stripe in a pop-up
                    if (window.isWeb) {
                      asyncAlert("You have registered successfully.", function() {
                        safeCall(null, function() {callback("ok");});
                      });
                    } else {
                      return safeCall(null, function() {callback("ok");});
                    }
                  } else if ("incorrect password" == response.error) {
                    target.innerHTML = "";
                    loginForm(target, optional, 'Sorry, the email address "'+email+'" is already in use. Please type your password below, or use a different email address.', callback);
                  } else {
                    form.style.display = "";
                    showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                });
              };
              target.appendChild(form);
              println("", form);
              printButton("Next", form, true);
              if (optional) {
                printButton("Cancel", form, false, function() {
                  safeCall(null, function() {callback(false);});
                });
              }
            } else if ("passwordButton" == choice) {
              startLoading();
              form.style.display = "none";
              window.scrollTo(0,1);
              login(email, form.password.value, /*register*/false, form.subscribe.checked, function(ok, response) {
                doneLoading();
                form.style.display = "";
                if (ok) {
                  target.innerHTML = "";
                  loginDiv(ok, email);
                  recordLogin(ok, response.id, email);
                  cacheKnownPurchases(response.purchases);
                  // we need another click event so we can launch Stripe in a pop-up
                  if (window.isWeb) {
                    asyncAlert("You have registered successfully.", function() {
                      safeCall(null, function() {callback("ok");});
                    });
                  } else {
                    return safeCall(null, function() {callback("ok");});
                  }
                } else if ("unknown email" == response.error) {
                  showMessage('Sorry, we can\'t find a record for the email address "'+email+'". Please try a different email address, or create a new account.');
                } else if ("incorrect password" == response.error) {
                  showMessage('Sorry, that password is incorrect. Please try again, or select "I forgot my password" to reset your password.');
                } else {
                  showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                }
              });
            } else if ("forgot" == choice) {
              startLoading();
              form.style.display = "none";
              window.scrollTo(0,1);
              forgotPassword(email, function(ok, response) {
                doneLoading();
                form.style.display = "";
                if (ok) {
                  showMessage("We've emailed you a link to reset your password. Please check your email and click on the link, then return here to sign in.");
                  document.getElementById('passwordButton').checked = true;
                  document.getElementById('passwordButton').onchange();
                } else if ("unknown email" == response.error) {
                  showMessage('Sorry, we can\'t find a record for the email address "'+email+'". Please try a different email address, or create a new account.');
                } else {
                  showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                }
              });
            }
          });
        }
      };

      target.appendChild(form);
      if (passwordButton && passwordButton.checked) passwordButton.onchange();
      if (optional && optional > 1) document.getElementById("subscribeLabel").style.display = "none";
      printButton("Next", form, true);
      printFooter();
    });
  });
}

function loginDiv(registered, email) {
  var domain = "https://www.choiceofgames.com/";
  var identity = document.getElementById("identity");
  if (!identity) return;
  if (registered) {
    var emailLink = document.getElementById("email");
    emailLink.setAttribute("href", domain + "profile" + "/");
    emailLink.innerHTML = "";
    emailLink.appendChild(document.createTextNode(email));
    identity.style.display = "block";
    var logoutLink = document.getElementById("logout");
    logoutLink.onclick = function(event) {
      preventDefault(event);
      logout();
      loginDiv();
    };
  } else {
    identity.style.display = "none";
  }
}

function isRegistered(callback) {
  if (window.isWeb) {
    return safeTimeout(function() {
      if (!window.registered) window.registered = !!getCookieByName("login");
      callback(window.registered);
    }, 0);
  } else if (initStore()) {
    return window.store.get("login", function(ok, value) {
      safeTimeout(function() {
        window.registered = ok && value && "false" != value && "0" != value;
        callback(window.registered);
      }, 0);
    });
  } else {
    safeCall(null, function() {
      window.registered = false;
      callback(false);
    });
  }
}

function isRegisterAllowed() {
  return window.isWeb || window.isIosApp || window.isAndroidApp;
}

function preventDefault(event) {
  if (!event) event = window.event;
  if (!event) return;
  if (event.preventDefault) {
    event.preventDefault();
  } else {
    event.returnValue = false;
  }
}

function getPassword(target, code) {
  if (!target) target = document.getElementById('text');
  var textArea = document.createElement("textarea");
  textArea.cols = 41;
  textArea.rows = 30;
  setClass(textArea, "savePassword");
  target.appendChild(textArea);
  println("", target);
  printButton("Next", target, false, function() {
    code(false, textArea.value);
  });

  printButton("Cancel", target, false, function() {
    code(true);
  });
}

function showPassword(target, password) {
  if (!target) target = document.getElementById('text');

  var textBuffer = [];
  var colWidth = 40;
  for (var i = 0; i < password.length; i++) {
    textBuffer.push(password.charAt(i));
    if ((i + 1) % colWidth === 0) {
      textBuffer.push('\n');
    }
  }
  password = "----- BEGIN PASSWORD -----\n" + textBuffer.join('') + "\n----- END PASSWORD -----";

  var shouldButton = isMobile;
  if (shouldButton) {
    var button = printButton("Email My Password to Me", target, false,
      function() {
        safeCall(self, function() {
            if (isWeb) {
              // TODO more reliable system
            }
            window.location.href = "mailto:?subject=Save%20this%20password&body=" + encodeURIComponent(password);
        });
      }
    );
    setClass(button, "");
  }

  var shouldTextArea = !isMobile;
  if (shouldTextArea) {
    var textArea = document.createElement("textarea");
    textArea.cols = colWidth + 1;
    textArea.rows = 30;
    setClass(textArea, "savePassword");

    textArea.setAttribute("readonly", true);
    textArea.onclick = function() {textArea.select();};
    textArea.value = (password);
    target.appendChild(textArea);
  }
}

function changeTitle(title) {
  document.title = title;
  var h1 = document.getElementsByTagName("h1");
  if (h1) h1 = h1[0];
  h1.innerHTML = "";
  h1.appendChild(document.createTextNode(title));
  if (window.isWinOldApp) {
    window.external.SetTitle(title);
  }
}

function changeAuthor(author) {
  var authorTag = document.getElementById("author");
  authorTag.innerHTML = "";
  authorTag.appendChild(document.createTextNode("by " + author));
}


function reportBug() {
  var prompt = "Please explain the problem. Be sure to describe what you expect, as well as what actually happened.";
  alertify.prompt(prompt, function(ok, body) {
    var statMsg = "(unknown)";
    try {
        var scene = window.stats.scene;
        statMsg = computeCookie(scene.stats, scene.temps, scene.lineNum, scene.indent);
    } catch (ex) {}
    body += "\n\nGame: " + window.storeName;
    if (window.stats && window.stats.scene) {
      body += "\nScene: " + window.stats.scene.name;
      body += "\nLine: " + (window.stats.scene.lineNum+1);
    }
    body += "\nUser Agent: " + navigator.userAgent;
    body += "\nLoad time: " + window.loadTime;
    if (window.Persist) body += "\nPersist: " + window.Persist.type;
    body += "\nversion=" + window.version;
    body += "\n\n" + statMsg;
    if (window.nav && window.nav.bugLog) body += "\n\n" + window.nav.bugLog.join("\n");
    console.log(body);
    if (ok) alertify.prompt("Please type your email address.", function(ok, email) {
      if (ok) xhrAuthRequest("POST", "support-mail", function(ok, response) {
        if (ok) {
          alertify.log("Thank you for reporting a bug!");
        } else {
          alertify.alert("Bug reporting failed. Please email your bug report to support@choiceofgames.com (and be sure to mention that the bug reporter failed!)");
        }
      }, "email", encodeURIComponent(email),
        "subject", encodeURIComponent("bug report " + window.storeName),
        "text", encodeURIComponent(body));
    });
  });
}

window.registered = false;

function getSupportEmail() {
  if (window.storeName) {
    return "support-" + storeName + "-" + platformCode() + "@choiceofgames.com";
  }
  try {
    return document.getElementById("supportEmail").getAttribute("href").substring(7);
  } catch (e) {
    return "support-external@choiceofgames.com";
  }
}

function absolutizeAboutLink() {
  var aboutAnchor = document.getElementById("aboutLink");
  if (aboutLink) {
    var aboutHref = aboutLink.getAttribute("href");
    if (/^https?:/.test(aboutHref)) return;

    var linkTags = document.getElementsByTagName("link");
    var canonical;
    for (var i = 0; i < linkTags.length; i++) {
      if (linkTags[i].getAttribute("rel") == "canonical") {
        canonical = linkTags[i].getAttribute("href");
        break;
      }
    }

    if (!canonical) return;

    var absoluteCanonical;
    if (/^https?:/.test(canonical)) {
      absoluteCanonical = canonical;
    } else if (/^\//.test(canonical)) {
      absoluteCanonical = "https://www.choiceofgames.com" + canonical;
    } else {
      absoluteCanonical = "https://www.choiceofgames.com/" + canonical;
    }
    if (!/\/$/.test(canonical)) {
      absoluteCanonical += "/";
    }

    aboutLink.setAttribute("href", absoluteCanonical + aboutHref);
  }
}

function aboutClick() {
    window.location.href = document.getElementById("aboutLink").href;
}

function loadPreferences() {
  if (initStore()) {
    store.get("preferredZoom", function(ok, preferredZoom) {
      if (ok && !isNaN(parseFloat(preferredZoom))) {
        setZoomFactor(parseFloat(preferredZoom));
      }
    });
    store.get("preferredBackground", function(ok, preferredBackground) {
      if (!/^(sepia|black|white)$/.test(preferredBackground)) {
        preferredBackground = "sepia";
      }
      if (preferredBackground === "black") {
        document.body.classList.add("nightmode");
      } else if (preferredBackground === "white") {
        document.body.classList.add("whitemode");
      }
    });
    store.get("preferredAnimation", function(ok, preferredAnimation) {
      window.animateEnabled = parseFloat(preferredAnimation) !== 2;
    });
  } else {
    window.animateEnabled = true;
  }
  if (typeof document.body.style.animationName === "undefined") {
    if (typeof document.body.style.webkitAnimationName === "undefined") {
      window.animateEnabled = false;
    } else {
      window.animationProperty = "webkitAnimationName";
    }
  } else {
    window.animationProperty = "animationName";
  }
  if (window.isCef || document.getElementsByTagName("audio").length) {
    delete window.animationProperty;
  }
}

window.onerror=function(msg, file, line, stack) {
    if (window.console) {
      window.console.error(msg);
      if (file) window.console.error("file: " + file);
      if (line) window.console.error("line: " + line);
    }
    if (window.Event && msg instanceof window.Event && /WebKit/.test(navigator.userAgent)) {
      return; // ignore "adsense offline" error
    } else if (/(Error loading script|Script error)/.test(msg) && /(show_ads|google-analytics|version\.js)/.test(file)) {
      return; // ignore "adsense offline" error
    }
    alert(msg);
    if (!window.storeName) return;
    var ok = confirm("Sorry, an error occured.  Click OK to email error data to support.");
    if (ok) {
        var statMsg = "(unknown)";
        try {
          var scene = window.stats.scene;
          statMsg = computeCookie(scene.stats, scene.temps, scene.lineNum, scene.indent);
        } catch (ex) {}
        var body = "What were you doing when the error occured?\n\nError: " + msg;
        body += "\n\nGame: " + window.storeName;
        if (window.stats && window.stats.scene) {
          body += "\nScene: " + window.stats.scene.name;
          body += "\nLine: " + (window.stats.scene.lineNum + 1);
        }
        if (file) body += "\nJS File: " + file;
        if (line) body += "\nJS Line: " + line;
        if (stack) body += "\nJS Stack: " + stack;
        body += "\nUser Agent: " + navigator.userAgent;
        body += "\nLoad time: " + window.loadTime;
        if (window.Persist) body += "\nPersist: " + window.Persist.type;
        body += "\n\n" + statMsg + "\n\nversion=" + window.version;
        if (window.currentVersion) {
          body += "\ncurrentVersion=" + window.currentVersion;
        }
        if (window.nav && window.nav.bugLog) body += "\n\n" + window.nav.bugLog.join("\n");
        var supportEmailHref = "mailto:support-external@choiceofgames.com";
        try {
          supportEmailHref="mailto:"+getSupportEmail();
          supportEmailHref=supportEmailHref.replace(/\+/g,"%2B");
        } catch (e) {}
        window.location.href=(supportEmailHref + "?subject=Error Report&body=" + encodeURIComponent(body));
    }
};

window.onload=function() {
    if (window.alreadyLoaded) return;
    window.alreadyLoaded = true;
    setTimeout(updateAllPaidSceneCaches, 0);
    window.main = document.getElementById("main");
    var head = document.getElementsByTagName("head")[0];
    window.nav.setStartingStatsClone(window.stats);
    loadPreferences();
    if (window.achievements && window.achievements.length) {
      nav.loadAchievements(window.achievements);
      checkAchievements(function() {});
      setButtonTitles();
    }
    nav.loadProducts(window.knownProducts, window.purchases);
    stats.sceneName = window.nav.getStartupScene();
    var map = parseQueryString(window.location.search);
    if (!map) {
      var hashMap = parseQueryString(window.location.hash);
      var realHash = false;
      for (var key in hashMap) {
        if (/^utm_/.test(key)) continue;
        realHash = true;
        break;
      }
      if (realHash) map = hashMap;
    }

    if (!map) {
      if (window.androidQueryString) {
        map = parseQueryString(window.androidQueryString.get());
      } else if (window.forcedScreenshots) {
        map = {forcedScene:"screenshots"};
      }
    }

    if (map) {
      window.forcedScene = map.forcedScene;
      window.slot = map.slot;
      window.debug = map.debug;
      if (map.restart) {
        restartGame();
      } else if (map.achievements) {
        doneLoading();
        showAchievements("hideNextButton");
      } else if (map.omnibusRestore) {
        restorePurchases('adfree', function(purchased) {
          if (window.isIosApp) {
            callIos('close');
          } else {
            setTimeout(function() {window.closer.close()}, 0);
          }
        });
      } else if (map.forcedScene) {
        safeCall(null, function() {loadAndRestoreGame(window.slot, window.forcedScene);});
      } else if (map.persistence) {
        var persistenceParts = map.persistence.split("|");
        if (persistenceParts.length == 2) {
          window.storeName = persistenceParts[0];
          window.remoteStoreName = persistenceParts[1];
        } else {
          window.storeName = map.persistence;
        }
        var startupScene = new Scene("startup", window.stats, window.nav, {secondaryMode:"startup", saveSlot:"startup"});
        startupScene.startupCallback = function() {
          safeCall(null, loadAndRestoreGame);
        }
        startupScene.execute();
      } else if (map.textOptionsMenu) {
        textOptionsMenu({size:1, color:1, animation:1});
      } else {
        safeCall(null, loadAndRestoreGame);
      }
    } else {
      safeCall(null, loadAndRestoreGame);
    }
    if (window.beta) {
      var reportBugButton = document.getElementById("bugButton");
      if (reportBugButton) reportBugButton.setAttribute("style", "");
    }
    if (window.Touch && window.isWeb) {
      // INSERT ADMOB AD
    }
    isRegistered(function(registered){
      if (registered) {
        fetchEmail(function(email) {
          loginDiv(registered, email);
        });
      } else {
        loginDiv();
      }
    });
    if (window.isWinStoreApp || window.isWinOldApp) {
        var subscribeAnchor = document.getElementById("subscribeLink");
        if (subscribeAnchor) {
            subscribeAnchor.onclick = function() {
              safeCall(null, subscribeLink);
              return false;
            };
        }
    }
    if (window.isCef || window.isNode || window.isMacApp) {
      var menuButton = document.getElementById("menuButton");
      if (menuButton) {
        menuButton.innerHTML = "Menu";
      }
    }
    if (window.isWinOldApp) {
        absolutizeAboutLink();
        var h1s = document.getElementsByTagName("h1");
        if (h1s.length) window.external.SetTitle(document.getElementsByTagName("h1")[0].innerText);
    }
    if (isFollowEnabled()) {
      var shareElement = document.getElementById("share");
      if (shareElement) shareElement.innerHTML = '<iframe src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fchoiceofgames&amp;send=false'+
      '&amp;layout=button_count&amp;width=90&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;action=like&amp;height=20&amp;appId=190439350983878"'+
      ' scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:20px;" allowTransparency="true"></iframe>'+
      '<iframe allowtransparency="true" frameborder="0" scrolling="no" '+
      'src="//platform.twitter.com/widgets/follow_button.html?screen_name=choiceofgames&amp;show_screen_name=false"'+
      ' style="width:160px; height:20px;"></iframe>';
    }
    var supportEmailLink = document.getElementById("supportEmail");
    if (window.storeName && supportEmailLink) {
      supportEmailLink.href = "mailto:" + getSupportEmail();
    }

    submitAnyDirtySaves();

    if (window.purchaseSubscriptions) {
      var productList = "";
      for (var key in purchaseSubscriptions) {
        productList += (productList ? " " : "") + key;
      }
      if (productList) checkPurchase(productList, function() {});
    }
    if (window.isWeb) {
      (function() {
        if (isPrerelease()) {
          var appLinks = document.getElementById('mobileLinks');
          if (appLinks) appLinks.style.display = 'none';
        }
        var productMap = {};
        if (typeof purchases === "object") {
          for (var scene in purchases) {
            productMap[purchases[scene]] = 1;
          }
        }
        if (!window.knownProducts) window.knownProducts = [];
        for (var product in productMap) {
          window.knownProducts.push(product);
        }

        var fullProducts = [];
        for (var i = 0; i < window.knownProducts.length; i++) {
          fullProducts[i] = window.storeName + "." + window.knownProducts[i];
        }
        xhrAuthRequest("GET", "product-data", function(ok, data) {
          if (!window.productData) window.productData = {};
          for (var i = 0; i < window.knownProducts.length; i++) {
            window.productData[window.knownProducts[i]] = data[window.storeName + "." + window.knownProducts[i]];
          }
        }, "products", fullProducts.join(","));
      })();
    }

};

if ( document.addEventListener ) {
  document.addEventListener( "DOMContentLoaded", window.onload, false );
}

try {
  var style = document.createElement('style');
  style.type = 'text/css';
  try {style.innerHTML = 'noscript {display: none;}'; } catch (e) {}
  document.getElementsByTagName('head')[0].appendChild(style);
} catch (e) {}

if (window.isWeb) {
  document.getElementById("dynamic").innerHTML = ".webOnly { display: block; }";
  var checkoutScript = document.createElement("script");
  checkoutScript.async = 1;
  checkoutScript.src="https://checkout.stripe.com/v2/checkout.js";
  document.getElementsByTagName("head")[0].appendChild(checkoutScript);

  var metas = document.getElementsByTagName("meta");
  var facebookAppId, googleAppId;
  var googleLoginCallbackCallback;
  for (var i = 0; i < metas.length; i++) {
    var meta = metas[i];
    if ("fb:app_id" == meta.getAttribute("property")) {
      facebookAppId = meta.getAttribute("content");
    } else if ("google-signin-clientid" == meta.getAttribute("name")) {
      googleAppId = meta.getAttribute("content");
    }
  }

  if (facebookAppId) {
    window.fbAsyncInit = function() {
      FB.init({
        appId      : facebookAppId,
        cookie     : true,  // enable cookies to allow the server to access 
                            // the session
        xfbml      : true,  // parse social plugins on this page
        version    : 'v2.0' // use version 2.0
      });
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src ="//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document,'script','facebook-jssdk'));
  }

  if (googleAppId) (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/client:plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
  
} else if (window.isIosApp) {
  document.getElementById("dynamic").innerHTML =
  "#header { display: none; }"+
  ""+
  "body { transition-duration: 0; }"+
  ""+
  "#emailUs { display: none; }"+
  ""+
  "#main { padding-top: 1em; }";
  // Use UIWebView width, not screen width, on iPad
  document.querySelector("meta[name=viewport]").setAttribute("content", "width="+window.innerWidth);
  window.addEventListener("resize", function() {
      document.querySelector("meta[name=viewport]").setAttribute("content", "width="+window.innerWidth);
      // this dummy element seems to be required to get the viewport to stick
      var dummy = document.createElement("p");
      dummy.innerHTML = "&nbsp;";
      document.body.appendChild(dummy);
      window.setTimeout(function() {document.body.removeChild(dummy);}, 10);
    }, false);
  callIos("checkdiscounts");
  // in a timeout because iOS may try to add to the head before mygame.js has run
  (function(){
    var requester = function() {
      if (window.stats) {
        callIos("requestscenes");
      } else {
        safeTimeout(requester, 1);
      }
    }
    if (window.isFile) safeTimeout(requester, 0);
  })();
} else if (window.isAndroidApp) {
  document.getElementById("dynamic").innerHTML =
  "#header { display: none; }"+
  ""+
  "#emailUs { display: none; }"+
  ""+
  "#main { padding-top: 1em; }";
} else if (window.isMacApp || window.isWinOldApp || window.isCef || window.isNode) {
  document.getElementById("dynamic").innerHTML =
    "#headerLinks { display: none; }"+
    ""+
    "#emailUs { display: none; }";
}
// on touch devices, this hover state never goes away
if (!('ontouchstart' in window)) {
  document.getElementById("dynamic").innerHTML += ".choice > div:hover {background-color: #E4DED8;}\n" +
    "body.nightmode .choice > div:hover {background-color: #555;}\n"+
    "body.whitemode .choice > div:hover {background-color: #ddd;}\n";
}
function fixChromeLinks() {
  var aboutLink = document.getElementById("aboutLink");
  aboutLink.addEventListener("click", function() {
    if (chrome.app.window) {
      event.preventDefault();
      chrome.app.window.create("credits.html", {}, function(w) {
        w.contentWindow.addEventListener( "DOMContentLoaded", function() {
          var win = this;
          var back = win.document.getElementById("back");
          back.addEventListener("click", function(event) {
            event.preventDefault();
            win.close();
          }, false);
          var base = win.document.createElement('base');
          base.setAttribute("target", "_blank");
          win.document.head.appendChild(base);
          win.document.documentElement.style.overflowY = "scroll";
        }, false);
      });
    }
  }, false);

  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    statsButton.onclick = undefined;
    statsButton.addEventListener("click", function() {
      showStats();
    }, false);
  }

  var achievementsButton = document.getElementById("achievementsButton");
  if (achievementsButton) {
    achievementsButton.onclick = undefined;
    achievementsButton.addEventListener("click", function() {
      showAchievements();
    }, false);
  }

  var restartButton = document.getElementById("restartButton");
  restartButton.onclick = undefined;
  restartButton.addEventListener("click", function() {
    restartGame("prompt");
  }, false);

  var subscribeAnchor = document.getElementById("subscribeLink");
  subscribeAnchor.onclick = undefined;
  subscribeAnchor.addEventListener("click", function() {
    subscribeLink();
  }, false);

  var supportAnchor = document.getElementById("supportEmail");
  supportAnchor.addEventListener("click", function(event) {
    event.preventDefault();
  }, false);

  var menuButton = document.getElementById("menuButton");
  menuButton.onclick = undefined;
  menuButton.addEventListener("click", function() {
    textOptionsMenu();
  }, false);
}
if (window.isChromeApp) {
  var base = document.createElement('base');
  base.setAttribute("target", "_blank");
  document.head.appendChild(base);

  document.addEventListener("DOMContentLoaded", fixChromeLinks);
  setInterval(function() {
    document.body.style.height = document.querySelector(".container").offsetHeight + "px";
  }, 100);
}
if (window.isCef) {
  var pollPurchases = function() {
    cefQuery({
      request:"PollPurchases",
      onSuccess:function(response){
        //console.log("PollPurchases: '"+response+"'");
        if (response) {
          clearScreen(loadAndRestoreGame);
        }
        safeTimeout(pollPurchases, 100);
      },
      onFailure:function(error_code, error_message) {
        console.error("PollPurchases error: " + error_message);
      }
    });
  };
  pollPurchases();
} else if (window.isGreenworks) {
	(function() {
		var greenworksApps = require('../package.json').products;
		if (typeof greenworksApps === "undefined") throw new Error("package.json missing products");
		var greenworksAppId = window.isTrial ? greenworksApps.steam_demo : greenworksApps.adfree;
		if (greenworks.restartAppIfNecessary(greenworksAppId)) return require('electron').remote.app.quit();
		if (!greenworks.initAPI()) {
			var errorCode = greenworks.isSteamRunning() ? 77778 : 77777;
			alert("There was an error connecting to Steam. Steam must be running" +
				" to play this game. If you launched this game using Steam, try restarting Steam" +
				" or rebooting your computer. If that doesn't work, try completely uninstalling" +
				" Steam and downloading a fresh copy from steampowered.com.\n\nIf none of that works, please contact" +
				" support@choiceofgames.com and we'll try to help. (Mention error code "+errorCode+".)")
			require('electron').remote.app.quit();
    }
		if (window.isTrial && greenworks.isSubscribedApp(greenworksApps.adfree)) {
			alert("This is the demo version of the game, " +
				"but you now own the full version. The demo will now exit. Your progress has been saved." +
				" Please launch the full version of the game using Steam.");
			require('electron').remote.app.quit();
		}
		var pollPurchases = function(oldCount) {
			var count = 0;
			for (var product in greenworksApps) {
				if (greenworks.isSubscribedApp(greenworksApps[product])) {
					count++;
				}
			}
			if (count != oldCount && typeof oldCount !== "undefined") clearScreen(loadAndRestoreGame);
			safeTimeout(function() {pollPurchases(count)}, 100);
		};
		pollPurchases();

    var appIds = [];
    for (var product in greenworksApps) {
      appIds.push(greenworksApps[product]);
    }

    xhrAuthRequest("GET", "steam-price", function(ok, data) {
      if (!window.productData) window.productData = {};
      for (var product in greenworksApps) {
        window.productData[product] = data[greenworksApps[product]];
      }
      if (window.awaitSteamProductData) window.awaitSteamProductData();
    }, "user_id", greenworks.getSteamId().steamId, "app_ids", appIds.join(","));
	})();
}

function winStoreShareLinkHandler(e) {
    var request = e.request;
    var canonical = document.querySelector("link[rel=canonical]");
    var canonicalHref = canonical && canonical.getAttribute("href");
    if (!/^https?:/.test(canonicalHref)) {
        canonicalHref = "https://www.choiceofgames.com" + canonicalHref;
    }
    if (!/\/$/.test(canonicalHref)) {
        canonicalHref += "/";
    }
    canonicalHref += "redirect.php?src=winshare";
    request.data.properties.title = document.title;
    request.data.properties.description = document.querySelector("meta[name=description]").getAttribute("content");
    request.data.setUri(new Windows.Foundation.Uri(canonicalHref));
}

if (window.isWinStoreApp) {
    var dataTransferManager = Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView();
    dataTransferManager.addEventListener("datarequested", winStoreShareLinkHandler);

    baseScript = document.createElement("script");
    baseScript.src = "//Microsoft.WinJS.1.0/js/base.js";
    baseScript.onload = function () {
        WinJS.Application.onsettings = function (e) {
            var privacyCmd = new Windows.UI.ApplicationSettings.SettingsCommand("privacy", "Privacy Policy", function () {
                window.open("https://www.choiceofgames.com/privacy-policy");
            });
            e.detail.e.request.applicationCommands.append(privacyCmd);
        };
        WinJS.Application.start();
    };
    document.head.appendChild(baseScript);

    uiScript = document.createElement("script");
    uiScript.src = "//Microsoft.WinJS.1.0/js/ui.js";
    document.head.appendChild(uiScript);
} else if (window.isWinOldApp) {
    console = {
        log: function (message) { window.external.ConsoleLog(message); },
        error: function (message) { window.external.ConsoleError(message); }
    };
    document.oncontextmenu = function() {return false;};
}

function platformCode() {
  var platform = "unknown";
  if (window.isIosApp) platform = "ios";
  else if (window.isAndroidApp) platform = "android";
  else if (window.isMacApp) platform = "mac";
  else if (window.isWinStoreApp) platform = "windows";
  else if (window.isWinOldApp) platform = "csharp";
  else if (window.isChromeApp) platform = "chrome";
  else if (window.isWebOS) platform = "palm";
  else if (window.isSteamApp) platform = "steam";
  else if (window.isCef) platform = "cef";
  else if (window.isNode) platform = "dl";
  else if (window.isWeb) platform = "web";
  if (window.isOmnibusApp) platform = "omnibus-" + platform;
  return platform;
}

function reinjectNavigator() {
  if (window.stats && window.stats.scene && window.stats.scene.nav) {
    var scene = window.stats.scene;
    scene.nav = window.nav;
    nav.repairStats(scene.stats);
  }
}

;
/*
 * Copyright 2010 by Dan Fabulich.
 *
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */
function Scene(name, stats, nav, options) {
    if (!name) name = "";
    if (!stats) stats = {};
    // the name of the scene
    this.name = name;

    // the permanent statistics and the temporary values
    this.stats = stats;
    // implicit_control_flow controls whether goto is necessary to leave options (true means no)
    // _choiceEnds stores the line numbers to jump to when choice #options end.
    this.temps = {choice_reuse:"allow", choice_user_restored:false, _choiceEnds:{}};

    // the navigator determines which scene comes next
    this.nav = nav;

    options = options || {};

    // should we print debugging information?
    this.debugMode = options.debugMode || false;

    // used for stats screen, and maybe other secondary views someday
    this.secondaryMode = options.secondaryMode;

    this.saveSlot = options.saveSlot || "";

    // the array of lines in the scene file
    this.lines = [];

    // the current line number (WARNING 0-based!)
    this.lineNum = 0;
    this.rollbackLineCoverage();

    // when this is true, the main printLoop will halt
    this.finished = false;

    // map of label names to line numbers
    this.labels = {};

    // the current amount of indentation
    this.indent = 0;

    // Did the previous line contain text?
    this.prevLine = "empty";

    // Have we ever printed any text?
    this.screenEmpty = true;

    // Have we run any commands (except for create and scene_list) yet?
    this.initialCommands = true;

    this.stats.sceneName = name;

    // for easy reachability from the window
    this.stats.scene = this;

    // where should we print text?
    this.target = null;

    this.accumulatedParagraph = [];
}

Scene.prototype.reexecute = function reexecute() {
  this.lineNum = this.stats.testEntryPoint || 0;
  this.finished = 0;
  this.indent = this.getIndent(this.lines[this.lineNum]);
  this.prevLine = "empty";
  this.screenEmpty = true;
  this.execute();
};

// the main loop of the scene
Scene.prototype.printLoop = function printLoop() {
    var line;
    for (;!this.finished && this.lineNum < this.lines.length; this.lineNum++) {
        line = this.lines[this.lineNum];
        if (!trim(line)) {
            this.paragraph();
            continue;
        }
        var indent = this.getIndent(line);
        if (indent > this.indent) {
            // ignore indentation level of *comments
            if (/\s*\*comment\b/.test(line)) continue;
            throw new Error(this.lineMsg() + "increasing indent not allowed, expected " + this.indent + " was " + indent);
        } else if (indent < this.indent) {
            this.dedent(indent);
        }
        // Ability to end a choice #option without goto is guarded by implicit_control_flow variable
        if (this.temps._choiceEnds[this.lineNum] &&
                (this.getVar("implicit_control_flow") || this.temps._fakeChoiceDepth > 0)) {
            // Skip to the end of the choice if we hit the end of an #option
            this.rollbackLineCoverage();
            this.lineNum = this.temps._choiceEnds[this.lineNum];
            this.rollbackLineCoverage();
            if (this.temps._fakeChoiceDepth > 0) {
                this.temps._fakeChoiceDepth--;
            }
            continue;
        }
        this.indent = indent;
        if (/^\s*#/.test(line)) {
            throw new Error(this.lineMsg() + "It is illegal to fall out of a *choice statement; you must *goto or *finish before the end of the indented block.");
        }
        if (!this.runCommand(line)) {
            this.prevLine = "text";
            this.screenEmpty = false;
            this.initialCommands = false;
            this.printLine(line);
        }
    }
    this.rollbackLineCoverage();
    if (!this.finished) {
        this.autofinish();
    }
    this.save("temp");
    if (this.skipFooter) {
        this.skipFooter = false;
    } else {
        printFooter();
    }
};

Scene.prototype.dedent = function dedent(newDent) {};

Scene.prototype.printLine = function printLine(line) {
    if (!line) return null;
    this.screenEmpty = false;
    line = this.replaceVariables(line.replace(/^\s*/, ""));
    this.accumulatedParagraph.push(line);
    // insert extra space unless the line ends with hyphen or dash
    if (!/([-\u2011-\u2014]|\[c\/\])$/.test(line)) this.accumulatedParagraph.push(' ');
};

Scene.prototype.replaceVariables = function (line) {
  line = String(line);
  var replacer = /([$@](\!?\!?)\{)/;
  var index = 0;
  var output = [];
  for (var result = replacer.exec(line); result; result = replacer.exec(line.substring(index))) {
    output.push(line.substring(index, index + result.index));
    var curlies = 0;
    var closingCurly = -1;
    var exprStart = index + result.index + result[1].length;
    for (var i = exprStart; i < line.length; i++) {
      var c = line.charAt(i);
      if (c === "{") {
        curlies++;
      } else if (c === "}") {
        if (curlies) {
          curlies--;
        } else {
          closingCurly = i;
          break;
        }
      }
    }
    if (closingCurly == -1) {
      throw new Error(this.lineMsg() + "invalid "+result[0]+"} variable substitution at letter " + (index + result.index + 1));
    }
    var body = line.substring(exprStart, closingCurly);
    var stack, value;
    if (result[0].charAt(0) === "$") {
      stack = this.tokenizeExpr(body);
      value = this.evaluateExpr(stack);
    } else {
      var expr;
      var options;
      if (/^\s*\(/.test(body)) {
        var parens = 0;
        var closingParen = -1;
        for (var i = 1; i < body.length; i++) {
          var c = body.charAt(i);
          if (c === "(") {
            parens++;
          } else if (c === ")") {
            if (parens) {
              parens--;
            } else {
              closingParen = i;
              break;
            }
          }
        }
        if (closingParen == -1) {
          throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; missing closing parenthesis )");
        }
        if (body.charAt(closingParen+1) != " ") {
          throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; there should be a space after the closing parenthesis )");
        }
        expr = body.substring(1, closingParen);
        options = body.substring(closingParen+2).split("|");
      } else {
        if (!/^\S+ /.test(body)) {
          throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; there should be a space after the first word");
        }
        var spaceIndex = body.indexOf(' ');
        expr = body.substring(0, spaceIndex);
        options = body.substring(spaceIndex+1).split("|");
      }
      if (options.length < 2) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; there should be at least one pipe | to separate options");
      }
      stack = this.tokenizeExpr(expr);
      value = this.evaluateExpr(stack);
      if (typeof value === "boolean" || /^(true|false)$/i.test(value)) {
        value = bool(value) ? 1 : 2;
      }
      value = num(value, this.lineNum+1, this.name);
      if ((value | 0) !== value) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; '"+expr+"' is equal to " + value + " which is not a whole integer number");
      } else if (value < 1) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; '"+expr+"' is equal to " + value + " which is not a positive number");
      } else if (value > options.length) {
        throw new Error(this.lineMsg() + "invalid "+result[0]+"} at letter " + (index + result.index + 1) + "; '"+expr+"' is equal to " + value + " but there are only " + options.length + " options");
      }
      value = options[value-1];
      value = this.replaceVariables(value);
    }
    var capitalize = result[2];
    if (capitalize) value = String(value);
    if (capitalize == "!") {
      value = value.charAt(0).toUpperCase() + value.slice(1);
    } else if (capitalize == "!!") {
      value = value.toUpperCase();
    }
    if (typeof highlightGenderPronouns != "undefined" && highlightGenderPronouns && /\b(he|him|his|she|her|hers)\b/gi.test(value)) {
      // this zero-width space will give us a hint for highlighting
      output.push("\u200b");
    }
    output.push(value);
    index = closingCurly+1;
  }
  if (index === 0) return line;
  output.push(line.substring(index));
  return output.join("");
};

Scene.prototype.paragraph = function paragraph() {
    printParagraph(this.accumulatedParagraph.join(""));
    this.accumulatedParagraph = [];
    this.prevLine = "empty";
};

Scene.prototype.loadSceneFast = function loadSceneFast(url) {
    if (this.loading) return;
    this.loading = true;
    var result;
    var self = this;
    if (typeof cachedResults != "undefined" && cachedResults && cachedResults[this.name]) {
      result = window.cachedResults[this.name];
      return safeTimeout(function() {self.loadLinesFast(result.crc, result.lines, result.labels);}, 0);
    } else if (typeof allScenes != "undefined") {
      result = allScenes[this.name];
      if (!result) throw new Error("Couldn't load scene '" + this.name + "'\nThe file doesn't exist.");
      return safeTimeout(function() {self.loadLinesFast(result.crc, result.lines, result.labels);}, 0);
    } else if (typeof window != "undefined" && window.isIosApp && window.isFile && !window.isOmnibusApp) {
      startLoading();
      var startedWaiting = new Date().getTime();

      function retryScenes(event, command) {
        if (!command) command = "retryscenes";
        clearScreen(function() {
          startLoading();
          if (command == "retryscenes") curl();
          window.downloadState = null;
          callIos(command);
          startedWaiting = new Date().getTime();
          awaitAllScenes();
        });
      }

      function awaitAllScenes() {
        if (typeof allScenes != "undefined") {
          result = allScenes[self.name];
          if (!result) throw new Error("Couldn't load scene '" + self.name + "'\nThe file doesn't exist.");
          self.loadLinesFast(result.crc, result.lines, result.labels);
        } else if (window.downloadState == "failed" || (new Date().getTime() - startedWaiting) > 5000) {
          doneLoading();
          if (window.downloadRequired) {
            self.printLine("We weren't able to download the latest version of the game.");
            self.paragraph();
            printButton("Try Again", main, false, retryScenes);
          } else {
            self.printLine("We weren't able to download the latest version of the game. Please try downloading again. The latest version may contain important fixes.");
            self.paragraph();
            var retry = {name: "Try downloading again."};
            var ignore = {name: "Continue playing without the latest version."}
            printOptions([""], [retry, ignore], function(option) {
              if (option == retry) {
                retryScenes();
              } else {
                retryScenes(null, "requestscenesforce");
              }
            });
          }
        } else {
          setTimeout(awaitAllScenes, 0);
        }
      }
      return awaitAllScenes();
    } else if (window.purchases[self.name] && isStoreSceneCacheRequired()) {
      var sceneName = this.name.replace(/ /g, "_");
      return window.store.get("cache_scene_hash_"+sceneName, function(ok, hash) {
        function keepScene(result) {
          if (!window.cachedResults) window.cachedResults = {};
          cachedResults[self.name] = result;
          self.loadLinesFast(result.crc, result.lines, result.labels);
        }
        function loadPaidScene() {
          startLoading();
          updateSinglePaidSceneCache(self.name, function(err, result) {
            doneLoading();
            if (err) {
              if (err === "not registered") {
                logout();
                loginDiv();
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              } else if (err === "not purchased") {
                window.rerestore = function () {
                  restorePurchases(window.purchases[self.name], function (purchased) {
                    window.location.reload(); 
                  });
                };
                main.innerHTML = "<div id='text'><p>Our apologies; we were unable to access your purchase while loading game data. (Error 403x)" +
                  "  Please restore purchases now; if that doesn't work, please email " + getSupportEmail() + " with details, including the error number 403x.</p>" +
                  " <p><button class='next' onclick='window.rerestore();'>Restore Now</button></p></div>";
                curl();
                return;
              }
              main.innerHTML = "<div id='text'><p>Our apologies; there was a " + err + " error while loading game data."+
              "  Please refresh now; if that doesn't work, please click the Restart button and email "+getSupportEmail()+" with details, including the error number.</p>"+
              " <p><button class='next' onclick='window.location.reload();'>Refresh Now</button></p></div>";
              curl();
            } else {
              keepScene(result);
            }
          })
        }
        if (ok && hash == hashes.scenes[sceneName + ".txt.json"]) {
          window.store.get("cache_scene_"+sceneName, function(ok, text) {
            if (ok && text) {
              var parsed;
              try {
                parsed = jsonParse(text);
              } catch (e) {
                if (window.console) console.error(e, e.stack);
              }
              if (parsed && parsed.crc && parsed.lines && parsed.labels) return keepScene(parsed);
              loadPaidScene();
            } else {
              loadPaidScene();
            }
          })
        } else {
          loadPaidScene();
        }
      });
    }
    startLoading();
    if (!url) {
        var fileName = this.name.replace(/ /g, "_") + ".txt.json";
        url = Scene.baseUrl + "/" + fileName;
        if (window.location.protocol == "https:" && window.hashes && window.hashes.scenes[fileName]) {
          url += "?hash="+hashes.scenes[fileName];
        }
    }
    var xhr = findXhr();
    xhr.open("GET", url, true);
    var self = this;
    var done = false;
    xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        if (xhr.status == 403) {
          try {
            var err = JSON.parse(xhr.responseText);
            if (err.error == "not registered") {
              return isRegistered(function(registered) {
                if (registered) {
                  logout();
                  loginDiv();
                }
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              });
            }
          } catch (e) {} // JSON parse failure? must not be a login prompt
        }
        done = true;

        var result;
        try {
          result = jsonParse(xhr.responseText);
        } catch (e) {
          if (window.console) console.error(e, e.stack);
        }
        if (window.isWeb && (xhr.status != 200 || !result)) {
          doneLoading();
          var status = xhr.status;
          if (status == 200 || !status) status = "network";
          main.innerHTML = "<div id='text'><p>Our apologies; there was a " + status + " error while loading game data."+
          "  Please refresh your browser now; if that doesn't work, please click the Restart button and email "+getSupportEmail()+" with details.</p>"+
          " <p><button onclick='window.location.reload();'>Refresh Now</button></p></div>";
          curl();
          return;
        } else if (xhr.responseText === "") {
          throw new Error("Couldn't load " + url + "\nThe file is probably missing or empty.");
        }

        if (!window.cachedResults) window.cachedResults = {};
        cachedResults[self.name] = result;
        self.loadLinesFast(result.crc, result.lines, result.labels);
    };
    if (isIE) {
      // IE8 swallows errors in onreadystatechange if xhr.send is in a try block
      xhr.send(null);
    } else {
      try {
        xhr.send(null);
      } catch (e) {
        if (window.location.protocol == "file:" && !window.isMobile) {
          if (/Chrome/.test(navigator.userAgent)) {
            window.onerror("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          }
        }
        window.onerror("Couldn't load URL: " + url + "\n" + e);
      }
    }
};

Scene.prototype.loadLinesFast = function loadLinesFast(crc, lines, labels) {
  this.crc = crc;
  this.lines = lines;
  this.labels = labels;
  this.loading = false;
  this.loaded = true;
  var self = this;
  if (this.executing) {
    safeCall(this, function() {
      doneLoading();
      self.execute();
    });
  }
};

// load the scene file from the specified URL (or from default URL by name)
Scene.prototype.loadScene = function loadScene() {
    if (this.loading) return;
    this.loading = true;
    if (window.isFile) return this.loadFile();
    startLoading();
    var url = Scene.baseUrl + "/" + this.name + ".txt";
    var xhr = findXhr();
    xhr.open("GET", url, true);
    var self = this;
    var done = false;
    xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        done = true;
        if (xhr.status == 403) {
          try {
            var err = JSON.parse(xhr.responseText);
            if (err.error == "not registered") {
              return isRegistered(function(registered) {
                if (registered) {
                  logout();
                  loginDiv();
                }
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              });
            }
          } catch (e) {} // JSON parse failure? must not be a login prompt
        }
        if (window.isWeb && xhr.status != 200) {
            var status = xhr.status || "network";
            main.innerHTML = "<p>Our apologies; there was a " + status + " error while loading game data."+
            "  Please refresh your browser now; if that doesn't work, please email "+getSupportEmail()+" with details.</p>"+
            " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
            return;
        } else if (xhr.responseText === "") {
          if (window.location.protocol == "file:" && !window.isMobile && /Chrome/.test(navigator.userAgent)) {
            window.onerror("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          } else {
            window.onerror("Couldn't load " + url + "\nThe file is probably missing or empty.");
            return;
          }
        }
        var result = xhr.responseText;
        scene = result;
        scene = scene.replace(/\r/g, "");
        this.loading = false;
        self.loadLines(scene);
        if (self.executing) {
            safeCall(self, function () {
              doneLoading();
              self.execute();
            });
        }
    };
    if (isIE) {
      // IE8 swallows errors in onreadystatechange if xhr.send is in a try block
      xhr.send(null);
    } else {
      try {
        xhr.send(null);
      } catch (e) {
        if (window.location.protocol == "file:" && !window.isMobile) {
          if (/Chrome/.test(navigator.userAgent)) {
            window.onerror("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          } else if (e.code === 1012 /*NS_ERROR_DOM_BAD_URI*/) {
            window.onerror("Couldn't load scene file: " + url + "\nThe file is probably missing.");
            return;
          }
        }
        window.onerror("Couldn't load URL: " + url + "\n" + e);
      }
    }
};

Scene.prototype.loadFile = function loadFile() {
  var _this = this;
  if (typeof uploadedFiles !== "object") {
    clearScreen(function() {
      var header = document.getElementById('header');
      if (header) header.style.display = "none";
      var makeYourOwnGames = document.getElementById('makeyourowngames');
      if (makeYourOwnGames) makeYourOwnGames.style.display = "none";
      _this.printLine("[b]Please \"Upload\" ChoiceScript[/b]");
      _this.paragraph();
      _this.printLine("To begin, you'll need to grant permission to \"upload\" your choicescript folder containing index.html.")
      _this.paragraph();
      _this.printLine("Use the button below to select your choicescript folder.");
      _this.paragraph();
      var text = document.getElementById('text');
      var input = document.createElement('input');
      input.type = 'file';
      input.webkitdirectory = true;
      input.multiple = true;
      input.addEventListener('change', function searchForStartup(e) {
        var numFiles = input.files.length;
        var startupCandidates = [];
        for (var i = 0; i < numFiles; i++) {
          var file = input.files[i];
          if (file.name === "startup.txt") {
            startupCandidates.push(file);
          }
        }
        if (!startupCandidates.length) {
          return clearScreen(function() {
            _this.printLine("We couldn't find startup.txt in the folder you chose. Please try again.")
            _this.paragraph();
            document.getElementById('text').appendChild(input);
            curl();
          });
        }

        if (startupCandidates.length > 1) {
          return clearScreen(function() {
            _this.printLine("There were multiple files called startup.txt in the folder you chose. Please try again.");
            _this.paragraph();
            for (var i = 0; i < startupCandidates.length; i++) {
              _this.printLine("\u2022 " + startupCandidates[i].webkitRelativePath);
            }
            _this.paragraph();
            document.getElementById('text').appendChild(input);
            curl();
          });
        }

        var startup = startupCandidates[0];
        var rootDirTest = new RegExp("^" + startup.webkitRelativePath.replace(/\/startup.txt$/, "/[^/]+$"));
        var sceneFiles = {};
        for (var i = 0; i < numFiles; i++) {
          var file = input.files[i];
          if (rootDirTest.test(file.webkitRelativePath)) {
            sceneFiles[file.name] = file;
          }
        }
        window.uploadedFiles = sceneFiles;
        if (header) header.style.display = "";
        if (makeYourOwnGames) makeYourOwnGames.style.display = "";
        clearScreen(function() {
          _this.loadFile();
        });
      });
      text.appendChild(input);
      _this.paragraph();
      _this.printLine("(We're not actually going to transfer your code over the Internet, " +
        "but this web page needs permission to upload your choicescript folder in order to access " +
        "your code and run it. The power to access your code would also grant us the power to " +
        "transfer your code elsewhere, but we're not going to do that. JavaScript programmers " +
        "can read our JavaScript to verify that this is true.)");
      _this.paragraph();
      curl();
    });
  } else {
    var fileName = this.name + ".txt";
    if (uploadedFiles[fileName]) {
      startLoading();
      new Response(uploadedFiles[fileName]).text().then(function(result) {
        scene = result;
        scene = scene.replace(/\r/g, "");
        _this.loading = false;
        safeCall(_this, function() {
          _this.loadLines(scene);
          doneLoading();
          _this.execute();
        });
      });
    } else {
      for (var otherFileName in uploadedFiles) {
        if (fileName.toLowerCase() === otherFileName.toLowerCase()) {
          main.innerHTML = "<p>Couldn't find "+fileName+" in the uploaded folder, but we did find "+otherFileName+". Scene file names must match exactly, including capitalization.</p>"+
          " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
          curl();
          return;
        }
      }
      main.innerHTML = "<p>Couldn't find "+fileName+" in the uploaded folder.</p>"+
        " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
      curl();
    }
  }
}

Scene.prototype.checkSum = function checkSum() {
  if (this.temps.choice_crc) {
    if (!this.randomtest && !this.quicktest && this.temps.choice_crc != this.crc && this.lineNum) {
      // The scene has changed; restart the scene from backup
      if (typeof alertify !== 'undefined') {
        if (!initStore()) {
          alertify.log(this.name + ".txt has updated. Restarting chapter.");
        } else {
          alertify.log("The game has updated. Restarting chapter.");
        }
      }
      var self = this;
      safeTimeout(function () {
        clearScreen(function () {
          loadAndRestoreGame("backup");
        });
      }, 0);
      return false;
    }
  }
  this.temps.choice_crc = this.crc;
  return true;
};

Scene.prototype.loadLines = function loadLines(str) {
    this.crc = crc32(str);
    this.lines = str.split(/\r?\n/);
    this.parseLabels();
    this.loaded = true;
};

// launch the vignette as soon as it's available
Scene.prototype.execute = function execute() {
    if (!this.loaded) {
        this.executing = true;
        if (Scene.generatedFast || (typeof generatedFast != "undefined" && generatedFast) || typeof allScenes != 'undefined') {
          this.loadSceneFast();
        } else {
          this.loadScene();
        }
        return;
    }
    if (!this.checkSum()) {
      return;
    }
    if (this.nav) this.nav.repairStats(stats);
    if (!this.temps._choiceEnds) this.temps._choiceEnds = {};
    doneLoading();
    if (typeof this.targetLabel != "undefined") {
      var label = this.targetLabel.label.toLowerCase();
      if (typeof(this.labels[label]) != "undefined") {
          this.lineNum = this.labels[label];
          this.indent = this.getIndent(this.lines[this.lineNum]);
          delete this.targetLabel;
      } else {
          throw new Error(this.targetLabel.origin + " line " + (this.targetLabel.originLine+1) + ": "+this.name+" doesn't contain label " + label);
      }
    }
    // this backup slot will only be used when the scene crc changes during upgrades
    if (!this.lineNum) {
      var subsceneStack = this.stats.choice_subscene_stack || [];
      if (!subsceneStack.length) this.save("backup");
    }
    if (this.redirectingFromStats) {
      this.save("");
      delete this.redirectingFromStats;
    }
    this.printLoop();
};

// loop through the file looking for *label commands
Scene.prototype.parseLabels = function parseLabels() {
    var lineLength = this.lines.length;
    var oldLineNum = this.lineNum;
    var screenshots = ("choicescript_screenshots" == this.name);
    var seenChoiceWithoutSet = 0;
    for (this.lineNum = 0; this.lineNum < lineLength; this.lineNum++) {
        this.rollbackLineCoverage();
        var line = this.lines[this.lineNum];
        // strip byte order mark
        if (this.lineNum == 0 && line.charCodeAt(0) == 65279) lines[0] = line.substring(1);
        var invalidCharacter = line.match(/^(.*)\ufffd/);
        if (invalidCharacter) throw new Error(this.lineMsg() + "invalid character. (ChoiceScript text should be saved in the UTF-8 encoding.) " + invalidCharacter[0]);
        var result = /^(\s*)\*(\w+)(.*)/.exec(line);
        if (!result) continue;
        var indentation = result[1];
        var indent = indentation.length;
        var command = result[2].toLowerCase();
        var data = trim(result[3]);
        if ("label" == command) {
            data = data.toLowerCase();
            if (/\s/.test(data)) throw new Error(this.lineMsg() + "label '"+data+"' is not allowed to contain spaces");
            if (this.labels.hasOwnProperty(data)) {
              throw new Error(this.lineMsg() + "label '"+data+"' already defined on line " + (this.labels[data]*1+1));
            }
            this.labels[data] = this.lineNum;
        } else if (screenshots) {
          if ("fake_choice" == command) {
            if (seenChoiceWithoutSet) throw new Error(this.lineMsg() +
              "In choicescript_screenshots, you need to *set at least one variable between *fake_choice commands, so the stat screen looks interesting. " +
              "There was no *set since the last *fake_choice on line " + seenChoiceWithoutSet + ".");
            seenChoiceWithoutSet = this.lineNum+1;
          } else if ("set" == command) {
            seenChoiceWithoutSet = 0;
          }
        }
    }
    this.rollbackLineCoverage();
    this.lineNum = oldLineNum;
};

// if this is a command line, run it
Scene.prototype.runCommand = function runCommand(line) {
    var result = /^\s*\*(\w+)(.*)/.exec(line);
    if (!result) {
      if (this.secondaryMode == "startup" && this.startupCallback) {
        this.finished = true;
        this.skipFooter = true;
        this.startupCallback();
        return true;
      }
      return false;
    }
    var command = result[1].toLowerCase();
    var data = trim(result[2]);
    if (Scene.validCommands[command]) {
        if ("comment" == command) return true;
        if (Scene.initialCommands[command]) {
          if ("startup" != String(this.name).toLowerCase() || !this.initialCommands) {
            throw new Error(this.lineMsg() + "Invalid "+command+" instruction, only allowed at the top of startup.txt");
          }
        } else {
          if (this.secondaryMode == "startup" && this.startupCallback) {
            this.finished = true;
            this.skipFooter = true;
            this.startupCallback();
            return true;
          }
          this.initialCommands = false;
        }
        if (command == "choice" && String(this.name).toLowerCase() == "choicescript_screenshots") {
          throw new Error(this.lineMsg() + "choicescript_screenshots files should only contain *fake_choice commands, not real *choice commands");
        }
        this[command](data);
    } else {
        throw new Error(this.lineMsg() + "Non-existent command '"+command+"'");
    }
    return true;
};

// *choice [group1] [group2] ...
// prompt the user with a multiple choice question.
// nested lines are options to be presented to the user
//
// Examples:
// *choice
//    good
//      Good choice
//      *finish
//    bad
//      Bad choice
//      *finish
//
// *choice toy
//    spaceship
//      Nice spaceship
//      *finish
//    train
//      Nice train
//      *finish
//    doll
//      Nice doll
//      *finish
//
// *choice color toy
//    red
//      spaceship
//        Nice red spaceship
//        *finish
//      train
//        Nice red train
//        *finish
//    blue
//       spaceship
//         Nice blue spaceship
//        *finish
//       train
//         Nice red train
//        *finish

// If a group is specified, generate a prompt message, e.g. "*choice toy" -> "Select a toy:"
// If no group is specified, don't generate a prompt message
// if multiple groups are specified, allow the user to make multiple choices simultaneously
//   all multi-dimensional choices must be valid (otherwise throw a parse error)
Scene.prototype.choice = function choice(data) {
    var startLineNum = this.lineNum;
    var groups = data.split(/ /);
    for (var i = 0; i < groups.length; i++) {
      if (!/^\w*$/.test(groups[i])) {
        throw new Error(this.lineMsg() + "invalid choice group name: " + groups[i]);
      }
    }
    var options = this.parseOptions(this.indent, groups);
    var self = this;
    this.renderOptions(groups, options, function(option) {
      self.standardResolution(option);
    });
    this.finished = true;
    if (this.temps._fakeChoiceDepth > 0 || this.getVar("implicit_control_flow")) {
      if (!this.temps._choiceEnds) {
        this.temps._choiceEnds = {};
      }
      for (i = 0; i < options.length; i++) {
        this.temps._choiceEnds[options[i].line-1] = this.lineNum;
      }
    }
    this.lineNum = startLineNum;
};

Scene.prototype.fake_choice = function fake_choice(data) {
    if (this.temps._fakeChoiceDepth === undefined) {
        this.temps._fakeChoiceDepth = 0;
    }
    this.temps._fakeChoiceDepth++;
    this.choice(data);
};

Scene.prototype.standardResolution = function(option) {
  var self = this;
  self.lineNum = option.line;
  self.indent = self.getIndent(self.nextNonBlankLine(true/*includingThisOne*/));
  if (option.reuse && option.reuse != "allow") self.temps.choice_used[option.line-1] = 1;
  if (this.nav) this.nav.bugLog.push("#"+(option.line+1) + " " + option.name);

  self.finished = false;
  self.resetPage();
};

Scene.prototype.nextNonBlankLine = function nextNonBlankLine(includingThisOne) {
    var line;
    var i = this.lineNum;
    if (!includingThisOne) i++;
    while(isDefined(line = this.lines[i]) && !trim(line)) {
      i++;
    }
    return line;
};

Scene.prototype.previousNonBlankLineNum = function previousNonBlankLineNum() {
  var line;
  var i = this.lineNum - 1;
  while(isDefined(line = this.lines[i]) && !trim(line)) {
    i--;
  }
  return i;
};


Scene.prototype.resetCheckedPurchases = function resetCheckedPurchases() {
  for (var temp in this.temps) {
    if (/^choice_purchased/.test(temp)) {
      delete this.temps[temp];
    }
  }
};

// reset the page and invoke code after clearing the screen
Scene.prototype.resetPage = function resetPage() {
    var self = this;
    this.resetCheckedPurchases();
    clearScreen(function() {
      // save in the background, eventually
      self.save("");
      self.prevLine = "empty";
      self.screenEmpty = true;
      self.execute();
    });
};

/* The function needs some explaining.
We want the game to be "refreshable," e.g. on the web.
So we only make a "real" autosave as you click "Next"
But if we do it that way, when we visit the stat screen, it's out of date
So we make a "temp" autosave slot, right as the page finishes redrawing,
and the stat screen uses the "temp" autosave to display your current data.
When you refresh the page, the "temp" autosave is rewritten.

If you save stats on the stat screen, they're written into tempStatWrites;
when the stat screen saves, we transfer tempStatWrites back to the main
game (if the main game is running in a separate iframe, e.g. iOS).

If the main game is about to write the main "" slot, we merge the temp
stat writes into the main stats (and clear the stat writes) before
saving.

Thus, stat changes on the stat screen will only be permanently saved when
the player clicks "Next" in the main game, ensuring that the game is still
refreshable.
*/
Scene.prototype.save = function save(slot) {
    if (this.saveSlot) {
      transferTempStatWrites();
    } else {
      if (!slot) {
        slot = "";
        for (var key in tempStatWrites) {
          if (tempStatWrites.hasOwnProperty(key)) {
            this.stats[key] = tempStatWrites[key];
          }
        }
        tempStatWrites = {};
      }

      saveCookie(function() {}, slot, this.stats, this.temps, this.lineNum, this.indent, this.debugMode, this.nav);
    }
};

// *goto labelName
// Go to the line labeled with the label command *label labelName
//
// goto by reference
//   *create foo "labelName"
//   *goto {foo}
Scene.prototype["goto"] = function scene_goto(line) {
    var label;
    if (/[\[\{]/.test(line)) {
      label = this.evaluateReference(this.tokenizeExpr(line));
    } else {
      label = String(line).toLowerCase();
    }
    if (typeof(this.labels[label]) != "undefined") {
        this.lineNum = this.labels[label];
        this.indent = this.getIndent(this.lines[this.lineNum]);
    } else {
        throw new Error(this.lineMsg() + "bad label " + label);
    }
    if (!this.localCoverage) this.localCoverage = {};
    if (this.localCoverage[this.lineNum]) {
        this.localCoverage[this.lineNum]++;
        if (this.looplimit_count && this.localCoverage[this.lineNum] > this.looplimit_count) {
            throw new Error(this.lineMsg() + "visited this line too many times (" + this.looplimit_count + ")");
        }
    } else {
        this.localCoverage[this.lineNum] = 1;
    }
};

Scene.prototype.gosub = function scene_gosub(data) {
    var label = /\S+/.exec(data)[0];
    var rest = data.substring(label.length+1);
    var args = [];
    var stack = this.tokenizeExpr(rest);
    while (stack.length) {
      args.push(this.evaluateValueToken(stack.shift(), stack));
    }
    if (!this.temps.choice_substack) {
      this.temps.choice_substack = [];
    }
    this.temps.choice_substack.push({lineNum: this.lineNum, indent: this.indent});
    // Works exactly the same as gosub_scene, putting args in this.temps.param.
    // This means there's no notion of scope - param acts more like "registers" that
    // get clobbered the next time a sub is called.
    // This may be more intuitive to non-programmers than idea of scope?  Especially
    // if temp normally doesn't follow scoping rules.  gosub_scene can serve this function anyway.
    // The params can be retrieved and put in named temps with "params" command.
    this.temps.param = args;
    this["goto"](label);
};

Scene.prototype.gosub_scene = function scene_gosub_scene(data) {
    if (!this.stats.choice_subscene_stack) {
      this.stats.choice_subscene_stack = [];
    }
    this.stats.choice_subscene_stack.push({name:this.name, lineNum: this.lineNum + 1, indent: this.indent, temps: this.temps});
    this.goto_scene(data);
};

Scene.prototype.params = function scene_params(data) {
    // Name the parameters passed by gosub/gosub_scene.
    // Rules should be the same as for "create."
    // All parameters, even those not named, exposed as param_1, param_2 etc.
    var words = /\w+/.exec(data);
    var nextParamNum = 1;
    this.temps.param_count = this.temps.param.length;
    while (words) {
        var varName = words[0].toLowerCase();
        this.validateVariable(varName);
        if (this.temps.param.length < 1) {
            throw new Error(this.lineMsg() + "No parameter passed for " + varName);
        }
        var paramVal = this.temps.param.shift();
        this.temps[varName] = paramVal;
        this.temps["param_" + nextParamNum] = paramVal;
        nextParamNum++;
        data = data.substring(varName.length+1);
        words = /\w+/.exec(data);
    }
    // All remaining params are anonymous, but you still have to say "params"
    // if you want any of them.
    while (this.temps.param.length > 0) {
        var paramVal = this.temps.param.shift();
        this.temps["param_" + nextParamNum] = paramVal;
        nextParamNum++;
    }
};

Scene.prototype["return"] = function scene_return() {
    var stackFrame;
    if (this.temps.choice_substack && this.temps.choice_substack.length) {
      stackFrame = this.temps.choice_substack.pop();
      this.lineNum = stackFrame.lineNum;
      this.indent = stackFrame.indent;
    } else if (this.stats.choice_subscene_stack && this.stats.choice_subscene_stack.length) {
      stackFrame = this.stats.choice_subscene_stack.pop();
      if (stackFrame.name == this.name) {
        this.temps = stackFrame.temps;
        this.lineNum = stackFrame.lineNum-1;
        this.indent = stackFrame.indent;
        return;
      }
      this.finished = true;
      this.skipFooter = true;
      var scene = new Scene(stackFrame.name, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:this.secondaryMode, saveSlot:this.saveSlot});
      scene.temps = stackFrame.temps;
      scene.screenEmpty = this.screenEmpty;
      scene.prevLine = this.prevLine;
      scene.lineNum = stackFrame.lineNum;
      scene.indent = stackFrame.indent;
      scene.accumulatedParagraph = this.accumulatedParagraph;
      if (this.randomtest) {
        // pop the stack in randomtest to avoid overflow
        clearScreen(function() {scene.execute()});
      } else {
        scene.execute();
      }
    } else if (!this.temps.choice_substack && !this.stats.choice_subscene_stack) {
      throw new Error(this.lineMsg() + "invalid return; gosub has not yet been called");
    } else {
      throw new Error(this.lineMsg() + "invalid return; we've already returned from the last gosub");
    }

};

// *gotoref expression
// Go to the label identified by the expression
//
// *temp foo
// *set foo "bar"
// *gotoref foo
// Skipped!
// *label bar
Scene.prototype["gotoref"] = function scene_gotoref(expression) {
    var stack = this.tokenizeExpr(expression);
    var value = this.evaluateExpr(stack);
    this["goto"](value);
};


// *finish
// halt the scene
Scene.prototype.finish = function finish(buttonName) {
    this.paragraph();
    this.finished = true;
    var self = this;
    if (this.secondaryMode == "stats") {
      if (typeof window == "undefined") return;
      // In iPad app, the stats screen is always visible
      if (window.isIosApp && window.isIPad) return;

      if (this.screenEmpty) {
        returnFromStats();
        return;
      }
      if (!buttonName) buttonName = "Next";
      buttonName = this.replaceVariables(buttonName);
      printButton(buttonName, main, false,
        function() {
          returnFromStats();
        }
      );
      return;
    }
    var nextSceneName = this.nav && nav.nextSceneName(this.name);
    // if there are no more scenes, then just halt
    if (!nextSceneName) {
        if (!this.secondaryMode) this.ending();
        return;
    }
    if (this.screenEmpty) {
      this.goto_scene(nextSceneName);
      return;
    }
    if (!buttonName) buttonName = "Next Chapter";
    buttonName = this.replaceVariables(buttonName);


    printButton(buttonName, main, false,
      function() {
        safeCall(self, function() {
            var scene = new Scene(nextSceneName, self.stats, self.nav, {debugMode:self.debugMode, secondaryMode:self.secondaryMode});
            scene.resetPage();
        });
      }
    );
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

Scene.prototype.autofinish = function autofinish(buttonName) {
  this.finish(buttonName);
};

// *reset
// clear all stats
Scene.prototype.reset = function reset() {
    this.nav.resetStats(this.stats);
    this.stats.scene = this;
};

Scene.prototype.parseGotoScene = function parseGotoScene(data) {
  var sceneName, label, param = [], stack;

  if (/[\[\{]/.test(data)) {
    stack = this.tokenizeExpr(data);
    sceneName = this.evaluateReference(stack, {toLowerCase: false});
    // Labels are required for arguments to avoid ambiguity
    if (stack.length) {
      label = this.evaluateReference(stack);
    }
    while (stack.length) {
      // Arguments when treating gosub_scene like a function call
      param.push(this.evaluateValueToken(stack.shift(), stack));
    }
  } else {
    // scenes and labels can contain hyphens and other non-expression punctuation
    // so we'll try to extract the first two words as the scene and label
    var match = /(\S+)\s+(\S+)\s*(.*)/.exec(data);
    if (match) {
      sceneName = match[1];
      label = match[2];
      stack = this.tokenizeExpr(match[3]);
      while (stack.length) {
        // Arguments when treating gosub_scene like a function call
        param.push(this.evaluateValueToken(stack.shift(), stack));
      }
    } else {
      if (data === "") throw new Error(this.lineMsg() + "missing scene name");
      sceneName = data;
    }
  }
  return {sceneName:sceneName, label:label, param:param};
};

// *goto_scene foo
//
Scene.prototype.goto_scene = function gotoScene(data) {
    var result = this.parseGotoScene(data);

    if (result.sceneName == this.name) {
      if (typeof result.label === "undefined") {
        this.lineNum = -1; // the printLoop will increment the line number to 0
      } else {
        this["goto"](result.label);
      }
      this.temps = {choice_reuse:"allow", choice_user_restored:false, _choiceEnds:{}};
      this.temps.param = result.param;
      this.initialCommands = true;
      return;
    }

    this.finished = true;
    this.skipFooter = true;
    var scene = new Scene(result.sceneName, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:this.secondaryMode, saveSlot:this.saveSlot});
    scene.screenEmpty = this.screenEmpty;
    scene.prevLine = this.prevLine;
    scene.accumulatedParagraph = this.accumulatedParagraph;
    if (typeof result.label != "undefined") scene.targetLabel = {label:result.label, origin:this.name, originLine:this.lineNum};
    if (typeof result.param != "undefined") scene.temps.param = result.param;
    if (this.redirectingFromStats) scene.redirectingFromStats = true;
    scene.execute();
};

// *redirect_scene foo
Scene.prototype.redirect_scene = function redirectScene(data) {
  if (this.secondaryMode != "stats") throw new Error(this.lineMsg() + "The *redirect_scene command can only be used from the stats screen.");
  var result = this.parseGotoScene(data);
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  redirectFromStats(result.sceneName, result.label, this.lineNum, function() {
    delete self.secondaryMode;
    delete self.saveSlot;
    self.redirectingFromStats = true;
    self.goto_scene(data);
  });
};

Scene.prototype.product = function product(productId) {
  if (!/^[a-z]+$/.test(productId)) throw new Error(this.lineMsg()+"Invalid product id (only lowercase letters, no numbers or punctuation): " +productId);
  if (this.nav) this.nav.products[productId] = {};
}

Scene.prototype.restore_purchases = function scene_restorePurchases(data) {
  var self = this;
  var target = this.target;
  if (!target) target = document.getElementById('text');
  var button = printButton("Restore Purchases", target, false,
    function() {
      safeCall(self, function() {
          restorePurchases(null, function() {
            self["goto"](data);
            self.finished = false;
            self.resetPage();
          });
      });
    }
  );

  setClass(button, "");
  this.prevLine = "block";
};

Scene.prototype.check_purchase = function scene_checkPurchase(data) {
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var productList = data.split(/ /);
  for (var i = 0; i < productList.length; i++) {
    var product = productList[i];
    if (!this.nav.products[product] && product != "adfree") {
      throw new Error(this.lineMsg() + "The product " + product + " wasn't declared in a *product command");
    }
  }
  checkPurchase(data, function(ok, result) {
    self.finished = false;
    self.skipFooter = false;
    if (!ok) {
      result = {billingSupported:true};
      self.temps.choice_purchase_error = true;
    }
    result = result || {};
    var products = data.split(/ /);
    var everything = true;
    for (var i = 0; i < products.length; i++) {
      var purchasedProduct = result[products[i]] || false;
      self.temps["choice_purchased_"+products[i]] = purchasedProduct;
      if (!purchasedProduct) everything = false;
    }
    self.temps.choice_purchased_everything = everything;
    self.temps.choice_purchase_supported = !!result.billingSupported;
    self.execute();
  });
};

Scene.prototype.parsePurchase = function parsePurchase(data) {
  var result;
  if (/^\{/.test(data)) {
    try {
      result = JSON.parse(data);
    } catch (e) {
      throw new Error(this.lineMsg() + "Couldn't parse purchase JSON: " + e)
    }
    if (!result.product) {
      throw new Error(this.lineMsg() + "JSON missing product");
    }
    if (!result['goto']) {
      throw new Error(this.lineMsg() + "JSON missing goto");
    }
    if (result.priceGuess && result.discount) {
      throw new Error(this.lineMsg() + "JSON has both top-level priceGuess and discount; there should be one or the other");
    }
    if (!(result.priceGuess || result.discount)) {
      throw new Error(this.lineMsg() + "JSON has neither top-level priceGuess nor discount; there should be one or the other");
    }
    if (result.discount) {
      if (!result.discount.end) throw new Error(this.lineMsg() + "JSON discount doesn't include end");
      result.discount.end = parseDateStringInCurrentTimezone(result.discount.end, this.lineNum + 1);
      if (!result.discount.lowPrice) throw new Error(this.lineMsg() + "JSON discount doesn't include lowPrice");
      if (!/^\$/.test(result.discount.lowPrice)) throw new Error(this.lineMsg() + "lowPrice " + fullPriceGuess + "doesn't start with dollar");
      if (!result.discount.fullPrice) throw new Error(this.lineMsg() + "JSON discount doesn't include fullPrice");
      if (!/^\$/.test(result.discount.fullPrice)) throw new Error(this.lineMsg() + "fullPrice " + fullPriceGuess + "doesn't start with dollar");
    }
    if (!result.title) result.title = "It";
  } else {
    var parsed = /^(\w+)\s+(\S+)\s+(.*)/.exec(data);
    if (!parsed) throw new Error(this.lineMsg() + "invalid line; can't parse purchaseable product: " + data);
    result = {product: parsed[1], priceGuess: parsed[2], "goto": parsed[3], title: "It"};
  }
  var product = result.product;
  if (!this.nav.products[product] && product != "adfree") {
    throw new Error(this.lineMsg() + "The product " + product + " wasn't declared in a *product command");
  }
  if (typeof this.temps["choice_purchased_" + product] === "undefined") throw new Error(this.lineMsg() + "Didn't check_purchases on this page");
  return result;
}

Scene.prototype.purchase = function purchase(data) {
  var parsed = this.parsePurchase(data);
  if (parsed.discount) {
    this.buyButtonDiscount(parsed.product, parsed.discount.end, parsed.discount.fullPrice, parsed.discount.lowPrice, parsed['goto'], parsed.title);
  } else {
    this.buyButton(parsed.product, parsed.priceGuess, parsed['goto'], parsed.title);
  }
}

Scene.prototype.buyButton = function(product, priceGuess, label, title) {
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var purchaseFinished = function() {
    if (label) self["goto"](label);
    self.finished = false;
    self.skipFooter = false;
    self.resetPage();
  }
  getPrice(product, function (price) {
    if (!price || "free" == price) {
      purchaseFinished();
    } else {
      if (price == "guess") price = priceGuess + " USD";
      var prerelease = self.getVar('choice_prerelease');
      var buttonText;
      if (prerelease) {
        buttonText = "Pre-Order " + title;
      } else {
        buttonText = "Buy "+title+" Now";
      }
      if (price != "hide") {
        buttonText += " for " + price;
      }
      var target = self.target;
      if (!target) target = document.getElementById('text');
      self.paragraph();
      var button = printButton(buttonText, target, false,
        function() {
          safeCall(self, function() {
              purchase(product, function() {
                safeCall(self, purchaseFinished);
              });
          });
        }
      );
      self.prevLine = "block";
      if (isRestorePurchasesSupported()) {
        self.prevLine = "text";
        printLink(printParagraph("If you've already purchased, click here to "), "#", "restore purchases",
          function(e) {
            preventDefault(e);
            safeCall(self, function() {
                restorePurchases(product, function(purchased) {
                  if (purchased) {
                    purchaseFinished();
                  } else {
                    // refresh, in case we're on web showing a full-screen login. Not necessary on mobile? But, meh.
                    clearScreen(function() {loadAndRestoreGame("", window.forcedScene);});
                  }
                });
            });
          }
        );
      }

      if (label) {
        self.skipFooter = false;
        self.finished = false;
        self.execute();
      }
    }
  });
};

Scene.prototype.purchase_discount = function purchase_discount(line) {
  this.paragraph();
  var args = trim(String(line)).split(" ");
  if (args.length != 5) throw new Error(this.lineMsg() + "expected five arguments, saw "+args.length+": " + line);
  var product = args[0];
  var expectedEndDateString = args[1];
  var expectedEndDate = parseDateStringInCurrentTimezone(expectedEndDateString, this.lineNum+1);
  var fullPriceGuess = this.replaceVariables(args[2]);
  var discountedPriceGuess = this.replaceVariables(args[3]);
  var label = args[4];
  var startsWithDollar = /^\$/;
  if (!startsWithDollar.test(fullPriceGuess)) {
    throw new Error(this.lineMsg() + "full price guess "+fullPriceGuess+"doesn't start with dollar: " + line);
  }
  if (!startsWithDollar.test(discountedPriceGuess)) {
    throw new Error(this.lineMsg() + "discounted price guess "+discountedPriceGuess+"doesn't start with dollar: " + line);
  }
  var title = "It";
  this.buyButtonDiscount(product, expectedEndDate, fullPriceGuess, discountedPriceGuess, label, title);
}

Scene.prototype.buyButtonDiscount = function buyButtonDiscount(product, expectedEndDate, fullPriceGuess, discountedPriceGuess, label, title) {
  var prerelease = this.getVar('choice_prerelease');
  var discountText;
  if (prerelease) {
    discountText = "[b]Buy now before the price increases![/b]";
  } else {
    discountText = "[b]On sale until "+shortMonthStrings[expectedEndDate.getMonth()+1]+" "+expectedEndDate.getDate()+"! Buy now before the price increases![/b]"
  }
  if (typeof printDiscount != "undefined") {
    printDiscount(product, expectedEndDate.getYear()+1900, expectedEndDate.getMonth()+1, expectedEndDate.getDate(), discountText);
  }
  var priceGuess;
  if (new Date().getTime() < expectedEndDate.getTime()) {
    priceGuess = discountedPriceGuess;
  } else {
    priceGuess = fullPriceGuess;
  }
  this.buyButton(product, priceGuess, label, title);
}

Scene.prototype.print_discount = function print_Discount(line) {
  var result = /(\w+) (\d{4})-(\d{2})-(\d{2}) (.*$)/.exec(line);
  if (!result) throw new Error("invalid discount: " + line);
  var product = result[1];
  var fullYear = result[2];
  var oneBasedMonthNumber = parseInt(result[3],10);
  var dayOfMonth = parseInt(result[4],10);
  var discountText = result[5];
  this.temps.choice_discount_ends = "POISONTOKEN";
  discountText = this.replaceVariables(discountText).replace("POISONTOKEN", "${choice_discount_ends}");
  delete this.temps.choice_discount_ends;
  if (typeof printDiscount != "undefined") printDiscount(product, fullYear, oneBasedMonthNumber, dayOfMonth, discountText);
};

// *abort
// halt the scene without showing a button
Scene.prototype.abort = function() {
  this.paragraph();
  this.finished = true;
};

// *create
// create a new permanent stat
Scene.prototype.create = function create(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg() + "Invalid create instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    variable = variable.toLowerCase();
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length > 1) throw new Error(this.lineMsg() + "Invalid create instruction, too many values: " + line);
    this.createVariable(variable, stack[0], line);
}

Scene.prototype.createVariable = function createVariable(variable, token, line) {
  var self = this;
  if (!token) throw new Error(this.lineMsg() + "Invalid create instruction, no value specified: " + line);
  function complexError() {
    throw new Error(self.lineMsg() + "Invalid create instruction, value must be a number, true/false, or a quoted string: " + line);
  }
  if (!/STRING|NUMBER|VAR/.test(token.name)) complexError();
  if ("VAR" == token.name && !/^true|false$/i.test(token.value)) complexError();
  if ("STRING" == token.name && /(\$|@)!?!?{/.test(token.value)) throw new Error(this.lineMsg() + "Invalid create instruction, value must be a simple string without ${} or @{}: " + line);
  var value = this.evaluateExpr([token]);
  if (!this.created) this.created = {};
  if (this.created[variable]) throw new Error(this.lineMsg() + "Invalid create. " + variable + " was previously created on line " + this.created[variable]);
  this.created[variable] = this.lineNum + 1;
  this.stats[variable] = value;
  if (this.nav) this.nav.startingStats[variable] = value;
}

// *create_array {name} {length} {value(s)}
// create an "array" of permanent stats:
//    myarray_1
//    myarray_2
//    ...
//    myarray_count
Scene.prototype.create_array = function create(line) {
  this.defineArray("create", line);
};

// *temp
// create a temporary stat for the current scene
Scene.prototype.temp = function temp(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg()+"Invalid temp instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length === 0) {
      this.temps[variable.toLowerCase()] = null;
      return;
    }
    var value = this.evaluateExpr(stack);
    if (typeof this.stats[variable.toLowerCase()] !== 'undefined') {
      this.warning("This is a temp, but we already ran *create " + variable);
    }
    this.temps[variable.toLowerCase()] = value;
};

// *temp_array
// create an "array" of temporary stats for the current scene
Scene.prototype.temp_array = function temp_array(line) {
  this.defineArray("temp", line);
};

Scene.prototype.defineArray = function defineArray(command, line) {
  var result = /^(\w+)(.*)/.exec(line);
  if (!result) throw new Error(this.lineMsg() + "Invalid " + command + "_array instruction, no array name specified: " + line);
  var variable = result[1];
  this.validateVariable(variable);
  variable = variable.toLowerCase();
  var stack = this.tokenizeExpr(result[2].trim());
  if (!stack.length) {
    throw new Error(this.lineMsg() + "Invalid " + command + "_array instruction, missing length: " + line);
  }
  var length = Number(stack.shift().value);
  if (length !== Math.floor(length) || length < 1) {
    throw new Error(this.lineMsg() + "Invalid " + command + "_array instruction, length should be a whole number greater than 0: " + line);
  }

  var token;
  var value = null;
  var self = this;
  var i;
  function create(suffix) {
    if (command === "create") {
      self.createVariable(variable + "_" + suffix, token, line);
    } else {
      self.temps[variable + "_" + suffix] = value;
    }
  }

  function next() {
    token = stack[0];
    if (!token) throw new Error(self.lineMsg() + "Too few values. Expected 1 default value or " + length + " explicit values, not " + i + ": " + line);
    value = self.evaluateValueToken(stack.shift(), stack);
  }

  if (stack.length) next();
  
  if (!stack.length) {
    // Use first default value for all creations
    for (i = 0; i < length; i++) {
      create(i+1);
    }
  } else {
    create(1);
    for (i = 1; i < length; i++) {
      next();
      create(i+1);
    }
  }

  if (stack.length) {
    throw new Error(this.lineMsg() + "Too many values. Expected 1 default value or " + length + " explicit values: " + line);
  }

  token = { name: "NUMBER", value: length };
  value = length;
  create("count");
}

// retrieve the value of the variable, preferring temp scope
Scene.prototype.getVar = function getVar(variable) {
    var value;
    variable = String(variable).toLowerCase();
    if (variable && !isNaN(1*variable) && String(1*variable) === variable) return 1*variable;
    if (variable == "true") return true;
    if (variable == "false") return false;
    if (variable == "choice_subscribe_allowed") return true;
    if (variable == "choice_register_allowed") return isRegisterAllowed();
    if (variable == "choice_registered") return typeof window != "undefined" && !!window.registered;
    if (variable == "choice_is_web") return typeof window != "undefined" && !!window.isWeb;
    if (variable == "choice_is_steam") return typeof window != "undefined" && !!window.isSteamApp;
    if (variable == "choice_is_ios_app") return typeof window != "undefined" && !!window.isIosApp;
    if (variable == "choice_is_ipad_app") return typeof window != "undefined" && !!window.isIosApp && !!window.isIPad;
    if (variable == "choice_is_android_app") return typeof window != "undefined" && !!window.isAndroidApp;
    if (variable == "choice_is_omnibus_app") return typeof window != "undefined" && !!window.isOmnibusApp;
    if (variable == "choice_is_amazon_app") return typeof window != "undefined" && !!window.isAmazonApp;
    if (variable == "choice_is_advertising_supported") return typeof isAdvertisingSupported != "undefined" && !!isAdvertisingSupported();
    if (variable == "choice_is_trial") return !!(typeof isTrial != "undefined" && isTrial);
    if (variable == "choice_release_date") {
      if (typeof window != "undefined" && window.releaseDate) {
        return simpleDateFormat(window.releaseDate);
      }
      return "release day";
    }
    if (variable == "choice_prerelease") return typeof isPrerelease != "undefined" && !!isPrerelease();
    if (variable == "choice_kindle") return typeof isKindle !== "undefined" && !!isKindle;
    if (variable == "choice_randomtest") return !!this.randomtest;
    if (variable == "choice_quicktest") return false; // quicktest will explore "false" paths
    if (variable == "choice_linenum") return this.lineNum;
    if (variable == "choice_scene") return this.name;
    if (variable == "choice_restore_purchases_allowed") return isRestorePurchasesSupported();
    if (variable == "choice_save_allowed") return areSaveSlotsSupported();
    if (variable == "choice_time_stamp") return Math.floor(new Date()/1000);
    if (variable == "choice_nightmode") return typeof isNightMode != "undefined" && isNightMode();
    if (variable == "choice_title") {
      if (typeof this.stats.choice_title === "undefined") {
        throw new Error(this.lineMsg() + "This game is missing a *title command");
      }
    }
    if ((!this.temps.hasOwnProperty(variable))) {
        if ((!this.stats.hasOwnProperty(variable))) {
            if (variable == "implicit_control_flow") return false;
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        value = this.stats[variable];
        if (value === null || value === undefined) {
            throw new Error(this.lineMsg() + "Variable '"+variable+"' exists but has no value");
        }
        if (this.debugMode) println("stats["+ variable + "]==" + value);
        return value;
    }
    value = this.temps[variable];
    if (value === null || value === undefined) {
        throw new Error(this.lineMsg() + "Variable '"+variable+"' exists but has no value");
    }
    if (this.debugMode) println("temps["+ variable + "]==" + value);
    return value;
};

// set the value of the variable, preferring temp scope
Scene.prototype.setVar = function setVar(variable, value) {
    variable = variable.toLowerCase();
    if (this.debugMode) println(variable +"="+ value);
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        this.stats[variable] = value;
        if (this.saveSlot == "temp") tempStatWrites[variable] = value;
        // Implicit control flow flag is ideally set just once in startup.
        // Removing these lines makes this not possible with quicktest.
        if (variable == "implicit_control_flow" && this.nav) {
            this.nav.startingStats["implicit_control_flow"] = value;
        }
    } else {
        this.temps[variable] = value;
    }
};

// *delete variable
// deletes the named variable
Scene.prototype["delete"] = function scene_delete(variable) {
    variable = variable.toLowerCase();
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        delete this.stats[variable];
    } else {
        delete this.temps[variable];
    }
};

Scene.prototype["delete_array"] = function scene_delete_array(arrayName) {
  arrayName = arrayName.toLowerCase();
  if ("undefined" === typeof this.temps[arrayName + "_count"]) {
      if ("undefined" === typeof this.stats[arrayName + "_count"]) {
          throw new Error(this.lineMsg() + "Non-existent array '"+arrayName+"'");
      }
      var length = this.stats[arrayName + "_count"];
      delete this.stats[arrayName + "_count"];
      for (var i = 1; i <= length; i++) {
        delete this.stats[arrayName + ("_" + i)];
      }
  } else {
      var length = this.temps[arrayName + "_count"];
      delete this.temps[arrayName + "_count"];
      for (var i = 1; i <= length; i++) {
        delete this.temps[arrayName + ("_" + i)];
      }
  }
};

// during a choice, recursively parse the options
Scene.prototype.parseOptions = function parseOptions(startIndent, choicesRemaining, expectedSubOptions) {
    // nextIndent: the level of indentation after the current line
    // For example, in the color/toy sample above, we start at 0
    // then the nextIndent is 2 for "red"
    // then the nextIndent is 4 for "spaceship"
    var nextIndent = null;
    var options = [];
    var choiceEnds = [];
    var line;
    var currentChoice = choicesRemaining[0];
    if (!currentChoice) currentChoice = "choice";
    var suboptionsEncountered = false;
    var bodyExpected = false;
    var previousSubOptions;
    var namesEncountered = {};
    var atLeastOneSelectableOption = false;
    var prevOption, ifResult;
    var startingLine = this.lineNum;
    var self = this;
    function removeModifierCommand(stripParethentical) {
      if (stripParethentical) {
        var openParen = line.indexOf("(")+1;
        var closingParen = matchBracket(line, "()", openParen);
        if (closingParen == -1) {
          throw new Error(self.lineMsg() + "missing closing parenthesis");
        }
        line = trim(line.substr(closingParen+1));
      } else {
        line = trim(line.replace(/^\s*\*(\w+)(.*)/, "$2"));
      }
      parsed = /^\s*\*(\w+)(.*)/.exec(line);
      if (parsed) {
        command = parsed[1].toLowerCase();
        data = trim(parsed[2]);
      } else {
        command = "";
      }
    }
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one '" + currentChoice + "'");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            break;
        }
        if (indent < this.indent) {
            // TODO drift detection
            if (false) /*(indent != nextIndent)*/ {
                // error: indentation has decreased, but not all the way back
                // Example:
                // *choice
                //     red
                //   blue
                throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
            }

            // we must be falling out of a sub-block
            this.dedent(indent);
            this.indent = indent;
        }
        if (indent > this.indent) {
            // body of the choice
            // ...unless we haven't identified our choices yet
            // TODO is this error test valid?
            if (choicesRemaining.length>1) throw new Error(this.lineMsg() + "invalid indent, there were subchoices remaining: [" + choicesRemaining.join(",") + "]");
            this.rollbackLineCoverage();
            bodyExpected = false;
            continue;
        }

        // here's the end of the previous option
        if (options.length) {
          prevOption = options[options.length-1];
          if (!prevOption.endLine) prevOption.endLine = this.lineNum;
        }

        // Execute *if commands (etc.) during option loop
        // sub-commands may modify this.indent
        var parsed = /^\s*\*(\w+)(.*)/.exec(line);
        var unselectable = false;
        var inlineIf = null;
        var selectableIf = null;
        var self = this;

        var overrideDefaultReuseSetting = false;
        var reuse = this.temps.choice_reuse;
        if (parsed) {
            var command = parsed[1].toLowerCase();
            var data = trim(parsed[2]);
            // TODO whitelist commands
            if ("hide_reuse" == command) {
              reuse = "hide";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("disable_reuse" == command) {
              reuse = "disable";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("allow_reuse" == command) {
              reuse = "allow";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("random_weight" == command) {
              removeModifierCommand(true /*stripParenthetical*/);
            }

            if ("print" == command) {
                line = this.evaluateExpr(this.tokenizeExpr(data));
            } else if ("if" == command) {
              choiceEnds.push(this.lineNum);
              ifResult = this.parseOptionIf(data, command);
              if (ifResult) {
                inlineIf = ifResult.condition;
                if (ifResult.result) {
                  line = ifResult.line;
                } else {
                  continue;
                }
              } else {
                this["if"](data, true /*inChoice*/);
                continue;
              }
            } else if ("else" == command) {
              if (data) throw new Error(this.lineMsg() + "Invalid content after *" + command + "; move the #option to the next line, indented: " + data);
              this[command](data, true /*inChoice*/);
              continue;
            } else if (/^(elseif|elsif)$/.test(command)) {
              ifResult = this.parseOptionIf(data, command);
              if (ifResult) {
                throw new Error(this.lineMsg() + "Invalid content after *" + command + "; move the #option to the next line, indented: " + ifResult.line);
              }
              this[command](data, true /*inChoice*/);
              continue;
            } else if ("selectable_if" == command) {
              ifResult = this.parseOptionIf(data, command);
              if (!ifResult) throw new Error(this.lineMsg() + "Couldn't parse the line after *selectable_if: " + data);
              line = ifResult.line;
              selectableIf = ifResult.condition;
              unselectable = unselectable || !ifResult.result;
            } else if ("comment" == command) {
                continue;
            } else if (!command) {
              // command was rewritten by earlier modifier
            } else {
                if (Scene.validCommands[command]) {
                  throw new Error(this.lineMsg() + "Invalid indent? Expected an #option here, not *"+command);
                }  else {
                    throw new Error(this.lineMsg() + "Non-existent command '"+command+"'");
                }
            }
        }

        if ("allow" != reuse) {
          if (!this.temps.choice_used) this.temps.choice_used = {};
          if (this.temps.choice_used[this.lineNum]) {
            if ("hide" == reuse) continue;
            unselectable = true;
          }
        }

        // this line should be a valid option
        if (!/^\s*\#\s*\S/.test(line)) {
            throw new Error(this.lineMsg() + "Expected option starting with #");
        }
        // replace variables here and discard the result, so error messages display the correct line
        this.replaceVariables(line);
        line = trim(trim(line).substring(1));
        var option = {name:line, group:currentChoice};
        if (reuse != "allow") option.reuse = reuse;
        if (this.displayOptionConditions) {
          option.displayIf = [];
          for (var i = 0; i < this.displayOptionConditions.length; i++) {
            option.displayIf[i] = this.displayOptionConditions[i];
          }
          if (inlineIf) option.displayIf.push(inlineIf);
        } else if (inlineIf) {
          option.displayIf = [inlineIf];
        }
        if (selectableIf) {
          option.selectableIf = selectableIf;
        }
        option.line = this.lineNum + 1;
        if (unselectable) {
          option.unselectable = true;
        }
        if (namesEncountered[line]) {
            this.conflictingOptions(this.lineMsg() + "Invalid option; conflicts with option '"+option.name+"' on line " + namesEncountered[line]);
        } else {
            namesEncountered[line] = option.line;
        }
        options.push(option);
        if (choicesRemaining.length>1) {
            // recursive call will modify this.indent
            option.suboptions = this.parseOptions(this.indent, choicesRemaining.slice(1), previousSubOptions);
            // now restore it
            this.indent = nextIndent;
            if (!previousSubOptions) previousSubOptions = option.suboptions;
            suboptionsEncountered = true;
        } else {
            bodyExpected = true;
        }
        if (!unselectable) atLeastOneSelectableOption = true;
    }

    // TODO is this error test valid?
    if (choicesRemaining.length>1 && !suboptionsEncountered) {
        throw new Error(this.lineMsg() + "invalid indent, there were subchoices remaining: [" + choicesRemaining.join(",") + "]");
    }
    if (bodyExpected &&
            (this.temps._fakeChoiceDepth === undefined || this.temps._fakeChoiceDepth < 1)) {
        throw new Error(this.lineMsg() + "Expected choice body");
    }
    if (!atLeastOneSelectableOption) this.conflictingOptions(this.lineMsg() + "No selectable options");
    if (expectedSubOptions) {
        this.verifyOptionsMatch(expectedSubOptions, options);
    }
    this.rollbackLineCoverage();
    prevOption = options[options.length-1];
    this.lineNum = this.previousNonBlankLineNum();
    if (!prevOption.endLine) prevOption.endLine = this.lineNum+1;
    for (i = 0; i < choiceEnds.length; i++) {
        this.temps._choiceEnds[choiceEnds[i]] = this.lineNum;
    }
    this.rollbackLineCoverage();
    return options;
};

// compute *if statement during options
Scene.prototype.parseOptionIf = function parseOptionIf(data) {
  var parsed = /^\s*\((.*)\)\s+(#.*)/.exec(data);
  if (!parsed) {
    return;
  }
  var condition = parsed[1];
  var stack = this.tokenizeExpr(condition);
  var result = this.evaluateExpr(stack);
  if (this.debugMode) println(condition + " :: " + result);
  result = bool(result, this.lineNum+1);
  // In the autotester, all conditionals are enabled
  result = result || this.testPath;
  return {result:result, line:parsed[2], condition:null};
};

// Add this as a separate method so we can override it elsewhere
// We want this error during randomtest but not during autotest
// Because autotest makes impossible situations happen
Scene.prototype.conflictingOptions = function conflictingOptions(str) {
  throw new Error(str);
};

// verify that the current option set corresponds to the previous option set
// (for multichoices)
Scene.prototype.verifyOptionsMatch = function verifyOptionsMatch(prev, current) {
    // find matching option by name
    function findMatch(name, options) {
        for (var i = 0; i < options.length; i++) {
            var option = options[i];
            if (option && name == option.name) {
                return option;
            }
        }
        return null;
    }

    var prevOpt, curOpt;
    for (var i = 0; i < prev.length; i++) {
        prevOpt = prev[i];
        curOpt = findMatch(prevOpt.name, current);
        if (!curOpt) throw new Error(this.lineMsg()+"Missing expected suboption '"+prevOpt.name+"'; all suboptions must have same option list");
    }

    if (prev.length == current.length) return;

    for (i = 0; i < current.length; i++) {
        curOpt = current[i];
        prevOpt = findMatch(curOpt.name, prev);
        if (!prevOpt) throw new Error(this.lineMsg()+"Added unexpected suboption '"+curOpt.name+"'; all suboptions must have same option list");
    }

    throw new Error(this.lineMsg()+"Bug? previous options and current options mismatch, but no particular missing element");
};

// render the prompt and the radio buttons
Scene.prototype.renderOptions = function renderOptions(groups, options, callback) {
    var self = this;
    function replaceVars(options) {
      for (var i = 0; i < options.length; i++) {
        var option = options[i];
        option.name = self.replaceVariables(option.name);
        if (option.suboptions) replaceVars(option.suboptions);
      }
    }
    replaceVars(options);
    this.paragraph();
    printOptions(groups, options, callback);

    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));

    if (this.finished) printFooter();
};

// *page_break
// pause and prompt the user to press "Next"
Scene.prototype.page_break = function page_break(buttonName) {
    if (this.screenEmpty) return;
    if (!buttonName) buttonName = "Next";
    buttonName = this.replaceVariables(buttonName);
    this.paragraph();
    this.finished = true;

    var self = this;
    printButton(buttonName, main, false,
      function() {
        delayBreakEnd();
        self.finished = false;
        self.resetPage();
      }
    );
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

Scene.prototype.page_break_advertisement = function pageBreakAdvertisement(line) {
  if (line) throw new Error(this.lineMsg() + "*page_break_advertisement doesn't allow you to change the button message. This text will never be shown: " + line);
  var self = this;
  this.finished = true;
  showFullScreenAdvertisementButton("Watch an Ad to Continue", function () {
    self.page_break("");
  }, function () {
    delayBreakEnd();
    self.finished = false;
    self.skipFooter = false;
    self.resetPage();
  });
};

Scene.prototype.finish_advertisement = function finishAdvertisement(line) {
  if (line) throw new Error(this.lineMsg() + "*finish_advertisement doesn't allow you to change the button message. This text will never be shown: " + line);
  var self = this;
  this.finished = true;
  showFullScreenAdvertisementButton("Watch an Ad for the Next Chapter", function () {
    self.finish("");
  }, function () {
    var nextSceneName = self.nav && nav.nextSceneName(self.name);
    var scene = new Scene(nextSceneName, self.stats, self.nav, { debugMode: self.debugMode, secondaryMode: self.secondaryMode });
    scene.resetPage();
  });
};

// *line_break
// single line break in the middle of a paragraph
Scene.prototype.line_break = function line_break() {
    // We want to prevent a huge <p><br></p> between blocks
    // so if there's existing text we'll just toss in a [n/]
    // and if there's no text yet, we'll directly insert a <br>
    if (this.accumulatedParagraph.length) {
      this.accumulatedParagraph.push('[n/]');
    } else {
      println();
    }
};

// *image
// display named image
Scene.prototype.image = function image(data, invert) {
    this.paragraph();
    data = data || "";
    data = this.replaceVariables(data);
    var match = /(\S+) (\S+)(.*)/.exec(data);
    var source, alignment;
    var alt = null;
    if (match) {
      var source = match[1];
      var alignment = match[2];
      var alt = trim(match[3]);
    } else {
      source = data;
    }
    if (source === "") throw new Error(this.lineMsg()+"*image requires the file name of an image");
    alignment = alignment || "center";
    if (!/(right|left|center|none)/.test(alignment)) throw new Error(this.lineMsg()+"Invalid alignment, expected right, left, center, or none: " + data);
    printImage(source, alignment, alt, invert);
    if (this.verifyImage) this.verifyImage(source);
    if (alignment == "none") this.prevLine = "text";
    this.screenEmpty = false;
};

Scene.prototype.text_image = function textImage(data) {
  this.image(data, "invert");
}

// *sound
// play named sound file
Scene.prototype.sound = function sound(source) {
    if (typeof playSound == "function") playSound(source);
    if (this.verifyImage) this.verifyImage(source);
};

Scene.prototype.kindle_image = function kindle_image() {
  // Do nothing on non-Kindle devices; show only on Kindle
};

Scene.prototype.youtube = function youtube(slug) {
  if (typeof printYoutubeFrame !== "undefined") {
    printYoutubeFrame(slug);
    this.prevLine = "block";
    this.screenEmpty = false;
  }
}

Scene.prototype.kindle_search = Scene.prototype.kindle_product = function kindle_search(data) {
  var result = /^\((.+)\) ([^\)]+)/.exec(data);
  if (!result) throw new Error(this.lineMsg()+"Invalid arguments: " + data);
  var query = result[1];
  var buttonName = result[2];
  if ("undefined" != typeof kindleButton) kindleButton(this.target, query, buttonName);
};

// *link
// Display URL with anchor text
Scene.prototype.link = function link(data) {
    var result = /^(\S+)\s*(.*)/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have an URL: " + data);
    var href = result[1].replace(/\]/g, "%5D");
    var anchorText = trim(result[2]) || href;
    this.printLine("[url="+href+"]"+anchorText+"[/url]");
    this.prevLine = "text";
    this.screenEmpty = false;
};

// *link_button
// Display button that takes you to an URL
Scene.prototype.link_button = function linkButton(data) {
    if (typeof window == "undefined") return;
    var result = /^(\S+)\s*(.*)/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have an URL: " + data);
    var href = result[1];
    var anchorText = trim(result[2]) || href;
    this.paragraph();
    var target = this.target;
    if (!target) target = document.getElementById('text');
    printButton(anchorText, target, false, function() {
      window.location.href = href;
    });
    this.prevLine = "empty";
    this.screenEmpty = false;
};

// how many spaces is this line indented?
Scene.prototype.getIndent = function getIndent(line) {
    if (line === null || line === undefined) return 0;
    var spaces = line.match(/^([ \t]*)/);
    if (spaces === null || spaces === undefined) return 0;
    var whitespace = spaces[0];
    var len = whitespace.length;
    if (0 === len) return 0;
    var tab = /\t/.test(whitespace);
    var space = / /.test(whitespace);
    if (tab && space) {
        throw new Error(this.lineMsg()+"Tabs and spaces appear on the same line");
    }
    if (tab) {
        this.firstTab = this.lineNum+1;
        if (this.firstSpace) {
            throw new Error(this.lineMsg()+"Illegal mixing of spaces and tabs; this line has a tab, but there were spaces on line " + this.firstSpace);
        }
    } else {
        this.firstSpace = this.lineNum + 1;
        if (this.firstTab) {
            throw new Error(this.lineMsg()+"Illegal mixing of spaces and tabs; this line has a space, but there were tabs on line " + this.firstTab);
        }
    }
    return len;
};

// *comment ignorable text
Scene.prototype.comment = function comment(line) {
    if (this.debugMode) println("*comment " + line);
};

Scene.prototype.advertisement = function advertisement(durationInSeconds) {
  if (/^\s*\*delay_break/.test(this.lines[this.lineNum - 1])) {
    throw new Error(this.lineMsg() + "*advertisement is not allowed immediately after *delay_break (*delay_break includes its own advertisement)");
  }
  if (this.getVar("choice_prerelease") || this.getVar("choice_is_steam")) return;
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  startLoading();
  checkPurchase("adfree", function(ok, result) {
    doneLoading();
    if (result.adfree) {
      self.finished = false;
      self.skipFooter = false;
      self.execute();
      return;
    }
    self.printLine("Come back later to play the next part of [i]${choice_title}[/i]!");
    self.paragraph();
    self.printLine("Or you can buy the game now to skip the wait.");
    self.paragraph();
    self.buyButton("adfree", "$1.99", null, "It");
    self.delay_break(durationInSeconds || 300);
  });
};

// *looplimit 5
// The number of times a given line is allowed to be accessed
Scene.prototype.looplimit_count = 1000;
Scene.prototype.looplimit = function looplimit(count) {
  this.looplimit_count = num(count, this.lineNum, this.name);
};

Scene.prototype.hide_reuse = function hide_reuse() {
  this.temps.choice_reuse = "hide";
};

Scene.prototype.disable_reuse = function disable_reuse() {
  this.temps.choice_reuse = "disable";
};

Scene.prototype.allow_reuse = function allow_reuse() {
  this.temps.choice_reuse = "allow";
};

// *label labelName
// Labels a line for use later in *goto
// Do nothing here; these labels are parsed in this.parseLabel
Scene.prototype.label = function label() {};

// *print expr
// print the value of the specified expression
Scene.prototype.print = function scene_print(expr) {
    var value = this.evaluateExpr(this.tokenizeExpr(expr));
    this.prevLine = "text";
    this.screenEmpty = false;
    this.printLine(value);
};

Scene.prototype.parseInputText = function parseInputText(line) {
  var stack = this.tokenizeExpr(line);
  var variable = this.evaluateReference(stack);
  if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
    throw new Error(this.lineMsg() + "Non-existent variable '" + variable + "'");
  }

  var inputOptions = { long: false, allow_blank: false };
  for (var i = 0; i < stack.length; i++) {
    var token = stack[i];
    if (token.name !== "VAR") {
      throw new Error(this.lineMsg() + "Couldn't understand this input_text line");
    }
    var option = token.value;
    if (typeof inputOptions[option] === "undefined") {
      throw new Error(this.lineMsg() + "Couldn't understand this input_text option: " + option);
    }
    inputOptions[option] = true;
  }
  return {variable:variable, inputOptions:inputOptions};
}

// *input_text var
// record text typed by the user and store it in the specified variable
Scene.prototype.input_text = function input_text(line) {
    var result = this.parseInputText(line);
    var variable = result.variable;

    this.finished = true;
    this.paragraph();
    var self = this;
    printInput(this.target, result.inputOptions, function(value) {
      safeCall(self, function() {
        value = trim(String(value));
        value = value.replace(/\n/g, "[n/]");
        if (self.nav) self.nav.bugLog.push("*input_text " + variable + " " + value);
        self.finished = false;
        self.setVar(variable, value);
        self.resetPage();
      });
    });
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

// *input_number var min max
// record number typed by the user and store it in the specified variable
Scene.prototype.input_number = function input_number(data) {
    var stack = this.tokenizeExpr(data);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }

    var simpleConstants;
    if (stack.length == 2 && stack[0].name == "NUMBER" && stack[1].name == "NUMBER") {
      simpleConstants = true;
    } else {
      simpleConstants = false;
    }

    if (!stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    var minimum = this.evaluateValueToken(stack.shift(), stack);
    if (isNaN(minimum*1)) throw new Error(this.lineMsg() + "Invalid minimum, not numeric: " + minimum);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");

    var maximum = this.evaluateValueToken(stack.shift(), stack);
    if (stack.length) throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    if (isNaN(maximum*1)) throw new Error(this.lineMsg() + "Invalid maximum, not numeric: " + maximum);

    // in quicktest, min and max can get mixed up as the interpreter "cheats" on if statements
    // so quicktest will ignore min/max errors unless they're simple constants e.g. *input_number x 6 4
    var checkMinMax = !this.quicktest || simpleConstants;
    if (checkMinMax && parseFloat(minimum) > parseFloat(maximum)) {
      throw new Error(this.lineMsg() + "Minimum " + minimum+ " should not be greater than maximum " + maximum);
    }

    function isInt(x) {
       var y=parseInt(x,10);
       if (isNaN(y)) return false;
       return x==y && x.toString()==y.toString();
    }
    var intRequired;
    if (isInt(minimum) && isInt(maximum)) {
      intRequired = 1;
    }
    this.finished = true;
    this.paragraph();
    var self = this;
    printInput(this.target, {numeric: true}, function(value) {
      safeCall(self, function() {
        var numValue = parseFloat(""+value);
        if (isNaN(numValue)) {
          asyncAlert("Please type in a number.");
          return;
        }
        if (intRequired && !isInt(value)) {
          asyncAlert("Please type in an integer number.");
          return;
        }
        if (numValue < minimum * 1) {
          asyncAlert("Please use a number greater than or equal to " + minimum);
          return;
        }
        if (numValue > maximum * 1 && !this.quicktest) {
          asyncAlert("Please use a number less than or equal to " + maximum);
          return;
        }
        if (self.nav) self.nav.bugLog.push("*input_number " + variable + " " + value);
        self.finished = false;
        self.setVar(variable, numValue);
        self.resetPage();
      });
    }, minimum, maximum, intRequired);
    if (this.debugMode) println(computeCookie(this.stats, this.temps, this.lineNum, this.indent));
};

// *script code
// evaluate the specified ECMAScript
Scene.prototype.script = function script(code) {
    var stats = this.stats;
    var temps = this.temps;
    try {
      if (typeof window == "undefined") {
        (function() {
          var window = _global;
          eval(code);
        }).call(this);
      } else {
        eval(code);
      }
    } catch (e) {
      throw new Error(this.lineMsg() + "error executing *script: " + e + (e.stack ? "\n" + e.stack : ""));
    }
};

// is this a valid variable name?
Scene.prototype.validateVariable = function validateVariable(variable) {
    if (!variable || !/^[a-zA-Z]/.test(variable)) {
        throw new Error(this.lineMsg()+"Invalid variable name, must start with a letter: " + variable);
    }
    if (!/^\w+$/.test(variable)) {
        throw new Error(this.lineMsg()+"Invalid variable name: '" + variable + "'");
    }
    if (/^(and|or|true|false|scene|scenename)$/i.test(variable)) throw new Error(this.lineMsg()+"Invalid variable name, '" + variable + "' is a reserved word");
    if (/^choice_/.test(variable)) throw new Error(this.lineMsg()+"Invalid variable name, variables may not start with 'choice_'; this is a reserved prefix");
};

// *rand varname min max
// Set varname to a random number from min to max
//
// Example:
// *rand foo 1 6
//   roll a cube die
// *rand foo 1.0 6.0
//   compute a decimal from [1.0,6.0)
Scene.prototype.rand = function rand(data) {
    var stack = this.tokenizeExpr(data);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }

    if (!stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var minimum = this.evaluateValueToken(stack.shift(), stack);
    if (!stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var maximum = this.evaluateValueToken(stack.shift(), stack);
    if (stack.length) throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    var diff;

    diff = maximum - minimum;
    if (isNaN(diff)) {
        throw new Error(this.lineMsg() + "Invalid rand statement, min and max must be numbers");
    }
    if (diff < 0) {
        throw new Error(this.lineMsg() + "Invalid rand statement, min must be less than max: " + minimum + " > " + maximum);
    }
    if (diff === 0) {
      this.setVar(variable, minimum);
      return;
    }
    function isInt(x) {
       var y=parseInt(x,10);
       if (isNaN(y)) return false;
       return x==y && x.toString()==y.toString();
    }
    var result;
    var random = Math.random();
    if (isInt(minimum) && isInt(maximum)) {
        // int random
        result = 1*minimum + Math.floor(random*(diff+1));
    } else {
        result = 1*minimum + random*diff;
    }
    this.setVar(variable, result);
    if (this.randomLog) {
      this.randomLog("*rand " + variable + " " + result);
    }
    if (this.nav) this.nav.bugLog.push("*rand " + variable + " " + result);
};

// *set varname expr
// sets the specified varname to the value of the expr
//
// Examples:
//
// literal
//     literal int: 2
//     literal decimal: 2.3
//     boolean value: true
//     quoted string: "fie"
//         with backslash escaping "she said it was \"ironic\"!"  "c:\\foo"
//     variable name: foo
//
// math
//     +: 2+2
//     -: foo-3
//     *: 2*3
//     /: 8/2
//     if one operand is a string, we'll try to parse it as a number, fail if that doesn't work
//
// fairmath
//     %+: foo%+30
//     %-: foo%-20
//
// concatenate
//     &: "foo"&bar
//
// may omit leading operand
//     *set foo +2
//     *set foo %+30
//     *set foo &"blah blah"
//
// spaces optional
//     *set foo+2
//     *set foo bar + 2
//     *set bar% +30
//
// multiple operators in one line, parentheses mandatory
//     *set foo (foo+2)/4
//     *set foo 2+(foo/2)
//     *set foo (foo/2)+(bar/3)
//     *set foo +(bar/3)
//
// set variable by reference
//
//     *set foo bar
//     *set {foo} 3
//     *comment now bar=3
Scene.prototype.set = function set(line) {
    var stack = this.tokenizeExpr(line);
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }
    if (stack.length === 0) throw new Error(this.lineMsg()+"Invalid set instruction, no expression specified: " + line);
    // if the first token is an operator, then it's implicitly based on the variable
    if (/OPERATOR|FAIRMATH/.test(stack[0].name)) stack.unshift({name:"VAR", value:variable, pos:"(implicit)"});
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
};

// *setref variableExpr expr
// just like *set, but variableExpr is a string expression naming a variable reference
//
// Example:
// *set foo "bar"
// *setref foo 3
// *comment now bar=3
Scene.prototype.setref = function setref(line) {
    var stack = this.tokenizeExpr(line);
    var variable = this.evaluateValueToken(stack.shift(), stack);
    variable = String(variable).toLowerCase();

    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }

    // if the first token is an operator, then it's implicitly based on the variable
    if (/OPERATOR|FAIRMATH/.test(stack[0].name)) stack.unshift({name:"VAR", value:variable, pos:"(implicit)"});
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
};

Scene.prototype.share_this_game = function share_links(now) {
  now = !!trim(now);
  this.paragraph();
  printShareLinks(this.target, now);
  this.prevLine = "empty"; // printShareLinks provides its own paragraph break
};

Scene.prototype.more_games = function more_games(now) {
  if (typeof window == "undefined" || typeof moreGames == "undefined") return;
  if (!!trim(now)) {
    moreGames();
    return;
  }
  var self = this;
  this.paragraph();
  var target = this.target;
  if (!target) target = document.getElementById('text');
  var button = printButton("Play More Games Like This", target, false,
    function() {
      safeCall(self, moreGames);
    }
  );

  setClass(button, "");
  this.prevLine = "block";
};

Scene.prototype.ending = function ending() {
    if (typeof window == "undefined") return;
    this.paragraph();
    var groups = [""];
    options = [];
    options.push({name:"Play again.", group:"choice", restart:true});
    if (!window.isOmnibusApp) options.push({name:"Play more games like this.", group:"choice", moreGames:true});
    options.push({name:"Share this game with friends.", group:"choice", share:true});
    options.push({name:"Email me when new games are available.", group:"choice", subscribe:true});

    var self = this;
    function endingMenu() {
      printFollowButtons();
      self.renderOptions([""], options, function(option) {
        if (option.restart) {
          return restartGame();
        } else if (option.moreGames) {
          self.more_games("now");
          if (typeof curl != "undefined") curl();
        } else if (option.share) {
          clearScreen(function() {
            self.share_this_game("now");
            endingMenu();
          });
        } else if (option.subscribe) {
          subscribeLink();
        }
      });
    }
    endingMenu();
    this.finished = true;
};

Scene.prototype.restart = function restart() {
  delayBreakEnd();
  if (this.secondaryMode) {
    if (this.secondaryMode == "stats") {
      this.reset();
      this.redirect_scene(this.nav.getStartupScene());
    } else {
      throw new Error(this.lineMsg() + "Cannot *restart in " + this.secondaryMode + " mode");
    }
  } else {
    restartGame();
  }
  this.finished = true;
};

/* Subscribe options, in JSON format.
"now" on mobile means we should immediately mailto: the subscribe address
otherwise, we should display a Subscribe button which launches the mailto:
On non-mailte: platforms, we ignore "now"

"allowContinue" is the default; setting it to false blocks the "No, Thanks"
button and the "Next" button after successfully subscribing
Only Coming Soon pages use "allowContinue"

"message" is the message we'll show to justify subscribing
the default message is: "we'll notify you when our next game is ready!" */
Scene.prototype.subscribe = function scene_subscribe(data) {
  this.paragraph();
  var options = {};
  if (data) {
    try {
      options = JSON.parse(data);
    } catch (e) {
      throw new Error(this.lineMsg() + "Couldn't parse subscribe arguments: " + data);
    }
  }
  this.prevLine = "block";
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  subscribe(this.target, options, function(now) {
    self.finished = false;
    // if "now" actually worked, then continue the scene
    // otherwise, reset the page before continuing
    if (now) {
      self.skipFooter = false;
      self.execute();
    } else {
      self.resetPage();
    }
  });
};

Scene.prototype.restore_game = function restore_game(data) {
  var cancelLabel;
  if (data) {
    var result = /^cancel=(\S+)$/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid restore_game line: " + data);
    cancelLabel = result[1];
  }
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var unrestorableScenes = this.parseRestoreGame(false/*alreadyFinished*/);
  function renderRestoreMenu(saveList, dirtySaveList) {
    self.paragraph();
    var options = [];
    for (var i = 0; i < saveList.length; i++) {
      var save = saveList[i];
      var date = new Date(save.timestamp*1);
      if (!save) continue;
      var name = "";
      if (save.temps && save.temps.choice_restore_name) name = save.temps.choice_restore_name;
      options.push({name:name + " ("+simpleDateTimeFormat(date)+")", group:"choice", state:save});
    }
    if (false) options.push({name:"Restore using a password.", group:"choice", password:true});
    options.push({name:"Retrieve saved games online from choiceofgames.com.", group:"choice", fetch:true});
    if (dirtySaveList.length) options.push({name:"Upload saved games to choiceofgames.com.", group:"choice", upload:true});
    options.push({name:"Cancel.", group:"choice", cancel:true});
    var groups = [""];
    self.renderOptions(groups, options, function(option) {
      if (option.upload) {
        clearScreen(function() {
          fetchEmail(function(defaultEmail){
            self.printLine("Please type your email address to identify yourself.");
            self.paragraph();
            promptEmailAddress(this.target, defaultEmail, "allowContinue", function(cancel, email) {
              if (cancel) {
                self.finished = false;
                if (typeof cancelLabel !== "undefined") {
                  self["goto"](cancelLabel);
                }
                self.resetPage();
                return;
              }
              clearScreen(function() {
                startLoading();
                submitDirtySaves(dirtySaveList, email, function(ok) {
                  doneLoading();
                  self.prevLine = "text"; // Put some space between the message and the option list
                  if (!ok) {
                    self.printLine("Error uploading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    var count = dirtySaveList.length + (dirtySaveList.length == 1 ? " save" : " saves");
                    self.printLine("Uploaded " + count + ".");
                    renderRestoreMenu(saveList, []);
                  }
                });
              });
            });
          });
        });
      } else if (option.fetch) {
        clearScreen(function() {
          fetchEmail(function(defaultEmail){
            self.printLine("Please type your email address to identify yourself.");
            self.paragraph();
            promptEmailAddress(this.target, defaultEmail, "allowContinue", function(cancel, email) {
              if (cancel) {
                self.finished = false;
                if (typeof cancelLabel !== "undefined") {
                  self["goto"](cancelLabel);
                }
                self.resetPage();
                return;
              }
              clearScreen(function() {
                startLoading();
                getRemoteSaves(email, function (remoteSaveList) {
                  doneLoading();
                  self.prevLine = "text";
                  if (!remoteSaveList) {
                    self.printLine("Error downloading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    mergeRemoteSaves(remoteSaveList, "recordDirty", function(saveList, newRemoteSaves, dirtySaveList) {
                      if (!remoteSaveList.length) {
                        self.printLine("No saves downloaded for email address \""+email+"\". (Is that the correct email address?) If you're having trouble, please contact support at "+getSupportEmail()+".");
                        renderRestoreMenu(saveList, dirtySaveList);
                      } else {
                        var downloadCount = remoteSaveList.length + " saved " + (remoteSaveList.length == 1 ? "game" : "games");
                        var newCount = newRemoteSaves + " new saved " + (newRemoteSaves == 1 ? "game" : "games");
                        self.printLine("Synchronized " + downloadCount + ". Downloaded " + newCount + ".");
                        renderRestoreMenu(saveList, dirtySaveList);
                      }
                    });
                  }
                });
              });
            });
          });
        });
      } else if (option.password) {
        clearScreen(function() {
          self.restore_password();
        });
      } else {
        if (option.cancel) {
          self.finished = false;
          if (typeof cancelLabel !== "undefined") {
            self["goto"](cancelLabel);
          }
          self.resetPage();
        } else {
          var state = option.state;
          var sceneName = null;
          if (state.stats && state.stats.sceneName) sceneName = (""+state.stats.sceneName).toLowerCase();
          var unrestorable = unrestorableScenes[sceneName];

          if (unrestorable) {
            asyncAlert(unrestorable);
            self.finished = false;
            self.resetPage();
            return;
          }

          saveCookie(function() {
            clearScreen(function() {
              restoreGame(state, null, /*userRestored*/true);
            });
          }, "", state.stats, state.temps, state.lineNum, state.indent, this.debugMode, this.nav);
        }
      }
    });
  }
  getDirtySaveList(function(dirtySaveList) {
    getSaves(function(saveList) {
      renderRestoreMenu(saveList, dirtySaveList);
    });
  });
};

Scene.prototype.restore_password = function restore_password() {
  var alreadyFinished = this.finished;
  this.finished = true;
  this.paragraph();
  this.printLine('Please paste your password here, then press "Next" below to continue.');
  this.prevLine = "text";
  this.paragraph();
  var self = this;
  var unrestorableScenes = this.parseRestoreGame(alreadyFinished);
  getPassword(this.target, function (cancel, password) {
    if (cancel) {
      self.finished = false;
      self.resetPage();
      return;
    }
    password = password.replace(/\s/g, "");
    password = password.replace(/^.*BEGINPASSWORD-----/, "");
    var token = self.deobfuscatePassword(password);
    token = token.replace(/^[^\{]*/, "");
    token = token.replace(/[^\}]*$/, "");
    var state;
    try {
      state = jsonParse(token);
    } catch (e) {
      asyncAlert("Sorry, that password was invalid. Please contact " + getSupportEmail() + " for assistance. Be sure to include your password in the email.");
      return;
    }

    var sceneName = null;
    if (state.stats && state.stats.sceneName) sceneName = (""+state.stats.sceneName).toLowerCase();

    var unrestorable = unrestorableScenes[sceneName];
    if (unrestorable) {
      asyncAlert(unrestorable);
      self.finished = false;
      self.resetPage();
      return;
    }

    saveCookie(function() {
      clearScreen(function() {
        // we're going to pretend not to be user restored, so we get reprompted to save
        restoreGame(state, null, /*userRestored*/false);
      });
    }, "", state.stats, state.temps, state.lineNum, state.indent, this.debugMode, this.nav);
  });
  if (alreadyFinished) printFooter();
};

Scene.prototype.parseRestoreGame = function parseRestoreGame(alreadyFinished) {
    if (alreadyFinished) {
      // if we're already finished, the printLoop bumped us an extra line ahead
      this.lineNum--;
      this.rollbackLineCoverage();
    }
    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var unrestorableScenes = {};
    var line;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent > startIndent) {
                this.indent = nextIndent = indent;
            }
        }
        if (indent <= startIndent) {
            // it's over!
            if (!alreadyFinished) {
              this.lineNum--;
              this.rollbackLineCoverage();
            }
            return unrestorableScenes;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }

        //
        // *restore_game
        //   ending You can't restore to the ending.

        line = trim(line);
        var result = /^(\w+)\s+(.*)/.exec(line);
        if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have a scene name followed by an error message: " + line);
        var sceneName = result[1].toLowerCase();
        var error = trim(result[2]);
        unrestorableScenes[sceneName] = error;
    }
    if (!alreadyFinished) {
      this.lineNum--;
      this.rollbackLineCoverage();
    }
    return unrestorableScenes;
};

Scene.prototype.check_registration = function scene_checkRegistration() {
  if (typeof window == "undefined" || typeof isRegistered == "undefined") return;
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  isRegistered(function() {
    self.finished = false;
    self.skipFooter = false;
    self.execute();
  });
};

Scene.prototype.login = function scene_login(optional) {
  if (typeof window == "undefined" || typeof loginForm == "undefined") return;
  optional = trim(optional);
  if (optional) {
    if (optional != "optional") throw new Error(this.lineMsg() + "invalid *login option: " + optional);
    optional = 1;
  }
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  this.paragraph();
  var target = this.target;
  if (!target) target = document.getElementById('text');
  loginForm(target, optional, null, function() {
    clearScreen(function() {
      self.finished = false;
      self.prevLine = "empty";
      self.screenEmpty = true;
      self.execute();
    });
  });
};

Scene.prototype.save_game = function save_game(destinationSceneName) {
  if (!destinationSceneName) throw new Error(this.lineMsg()+"*save_game requires a destination file name, e.g. *save_game Episode2");
  if (this.temps.choice_user_restored) return;
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  fetchEmail(function(defaultEmail){
    self.paragraph();
    var form = document.createElement("form");
    setClass(form, "saveGame");

    form.action="#";

    var message = document.createElement("div");
    message.style.color = "red";
    message.style.fontWeight = "bold";
    form.appendChild(message);

    var saveName = document.createElement("input");
    saveName.type="text";
    saveName.name="saveName";
    saveName.setAttribute("placeholder", "Type a name for your saved game");
    saveName.setAttribute("style", "display:block; font-size: 25px; width: 90%; margin: 1rem 0");
    form.appendChild(saveName);

    var hideEmailForm = false;
    // hideEmailForm = _global.automaticCloudStorage;
    if (!hideEmailForm) {
      println("Please login to the choiceofgames.com save system with your email address below.", form);

      var emailInput = document.createElement("input");
      // This can fail on IE
      try { emailInput.type="email"; } catch (e) {}
      emailInput.name="email";
      emailInput.value=defaultEmail;
      emailInput.setAttribute("placeholder", "you@example.com");
      emailInput.setAttribute("style", "display:block; font-size: 25px; width: 90%; margin: 1rem 0");
      form.appendChild(emailInput);

      var subscribeLabel = document.createElement("label");
      subscribeLabel.setAttribute("for", "subscribeBox");
      var subscribeBox = document.createElement("input");
      subscribeBox.type = "checkbox";
      subscribeBox.name = "subscribe";
      subscribeBox.setAttribute("id", "subscribeBox");
      subscribeBox.setAttribute("checked", true);
      subscribeLabel.appendChild(subscribeBox);
      subscribeLabel.appendChild(document.createTextNode("Email me when new games are available."));
      form.appendChild(subscribeLabel);
    }

    var target = this.target;
    if (!target) target = document.getElementById('text');
    target.appendChild(form);
    printButton("Next", form, true);

    printButton("Cancel", target, false, function() {
      clearScreen(function() {
        self.finished = false;
        self.prevLine = "empty";
        self.screenEmpty = true;
        self.execute();
      });
    });

    form.onsubmit = function(e) {
      preventDefault(e);
      safeCall(this, function() {
        var messageText;
        if (!trim(saveName.value)) {
          messageText = document.createTextNode("Please type a name for your saved game.");
          message.innerHTML = "";
          message.appendChild(messageText);
          return;
        }

        var slot = "save" + new Date().getTime();
        // create a clone stats object whose scene name is the destination scene
        var saveStats = {};
        for (var stat in self.stats) {
          if ("scene" == stat) continue;
          saveStats[stat] = self.stats[stat];
        }
        saveStats.scene = {name:destinationSceneName};

        if (hideEmailForm) {
          clearScreen(function() {
            saveCookie(function() {
              recordSave(slot, function() {
                self.finished = false;
                self.prevLine = "empty";
                self.screenEmpty = true;
                self.execute();
              });
            }, slot, saveStats, {choice_reuse:"allow", choice_user_restored:true, choice_restore_name:saveName.value}, 0, 0, false, self.nav);
          });
          return;
        }

        var shouldSubscribe = subscribeBox.checked;
        var subscribe = shouldSubscribe && window.isHeartsChoice ? "hc" : "cog";
        var email = trim(emailInput.value);
        if (!/^\S+@\S+\.\S+$/.test(email)) {
          messageText = document.createTextNode("Sorry, \""+email+"\" is not an email address.  Please type your email address again.");
          message.innerHTML = "";
          message.appendChild(messageText);
          return;
        }

        recordEmail(email, function() {
          clearScreen(function() {
            saveCookie(function() {
              recordSave(slot, function() {
                startLoading();
                submitRemoteSave(slot, email, subscribe, function(ok) {
                  doneLoading();
                  if (!ok) {
                    asyncAlert("Couldn't upload your saved game to choiceofgames.com. You can try again later from the Restore menu.", function() {
                      self.finished = false;
                      self.prevLine = "empty";
                      self.screenEmpty = true;
                      self.execute();
                    });
                  } else {
                    self.finished = false;
                    self.prevLine = "empty";
                    self.screenEmpty = true;
                    self.execute();
                  }
                });
              });
            }, slot, saveStats, {choice_reuse:"allow", choice_user_restored:true, choice_restore_name:saveName.value}, 0, 0, false, self.nav);
          });
        });
      });
    };

    printFooter();
  });
};

Scene.prototype.show_password = function show_password() {
  if (this.temps.choice_user_restored) return;
  this.paragraph();
  if (typeof(window) != "undefined" && !window.isMobile) {
    this.printLine('Please copy and paste the password in a safe place, then press "Next" below to continue.');
    println("", this.target);
    println("", this.target);
  }
  var password = computeCookie(this.stats, this.temps, this.lineNum, this.indent);
  password = this.obfuscate(password);
  showPassword(this.target, password);
  this.prevLine = "block";
};

Scene.prototype.obfuscate = function obfuscate(password) {
  var self = this;
  return password.replace(/./g,
    function(x) {
      var y = self.obfuscator[x];
      return y;
    }
  );
};

// The obfuscator must take US-ASCII and obfuscate it
// for use in a password.  This password will be sent via
// HTML email and its whitespace handling will be unpredictable,
// So we can't output any of these characters: [ <>&]
// Since we're losing four characters of output, we JSON-escape
// four characters of input [^`|~].
Scene.prototype.obfuscator = {
  " ": "k",
  "!": "E",
  "\"": "`",
  "#": "\\",
  "$": "r",
  "%": "J",
  "&": "o",
  "'": "0",
  "(": "Z",
  ")": "M",
  "*": "G",
  "+": "t",
  ",": "Y",
  "-": "f",
  ".": "2",
  "/": "!",
  "0": "i",
  "1": "*",
  "2": "1",
  "3": "3",
  "4": "[",
  "5": "6",
  "6": "v",
  "7": "\"",
  "8": "F",
  "9": "9",
  ":": "{",
  ";": "Q",
  "<": "?",
  "=": "5",
  ">": "#",
  "?": "K",
  "@": "/",
  "A": "=",
  "B": "N",
  "C": "z",
  "D": "$",
  "E": "W",
  "F": "(",
  "G": ")",
  "H": "q",
  "I": "C",
  "J": "+",
  "K": "U",
  "L": ".",
  "M": "H",
  "N": "B",
  "O": "S",
  "P": "X",
  "Q": "I",
  "R": "-",
  "S": "m",
  "T": "D",
  "U": "^",
  "V": "A",
  "W": "a",
  "X": "y",
  "Y": ",",
  "Z": "d",
  "[": "O",
  "\\": "s",
  "]": "8",
  "^": "sVii6h",
  "_": "]",
  "`": "sViivi",
  "a": "4",
  "b": "g",
  "c": "%",
  "d": "w",
  "e": "h",
  "f": "n",
  "g": "b",
  "h": "7",
  "i": "x",
  "j": "~",
  "k": "_",
  "l": "l",
  "m": ":",
  "n": "c",
  "o": "L",
  "p": "j",
  "q": "u",
  "r": "R",
  "s": "}",
  "t": "p",
  "u": "V",
  "v": "P",
  "w": "'",
  "x": "T",
  "y": "|",
  "z": "@",
  "{": "e",
  "|": "sVii\"%",
  "}": ";",
  "~": "sVii\"h"
};
Scene.prototype.deobfuscator = {
  "k": " ",
  "E": "!",
  "`": "\"",
  "\\": "#",
  "r": "$",
  "J": "%",
  "o": "&",
  "0": "'",
  "Z": "(",
  "M": ")",
  "G": "*",
  "t": "+",
  "Y": ",",
  "f": "-",
  "2": ".",
  "!": "/",
  "i": "0",
  "*": "1",
  "1": "2",
  "3": "3",
  "[": "4",
  "6": "5",
  "v": "6",
  "\"": "7",
  "F": "8",
  "9": "9",
  "{": ":",
  "Q": ";",
  "?": "<",
  "5": "=",
  "#": ">",
  "K": "?",
  "/": "@",
  "=": "A",
  "N": "B",
  "z": "C",
  "$": "D",
  "W": "E",
  "(": "F",
  ")": "G",
  "q": "H",
  "C": "I",
  "+": "J",
  "U": "K",
  ".": "L",
  "H": "M",
  "B": "N",
  "S": "O",
  "X": "P",
  "I": "Q",
  "-": "R",
  "m": "S",
  "D": "T",
  "^": "U",
  "A": "V",
  "a": "W",
  "y": "X",
  ",": "Y",
  "d": "Z",
  "O": "[",
  "s": "\\",
  "8": "]",
  "]": "_",
  "4": "a",
  "g": "b",
  "%": "c",
  "w": "d",
  "h": "e",
  "n": "f",
  "b": "g",
  "7": "h",
  "x": "i",
  "~": "j",
  "_": "k",
  "l": "l",
  ":": "m",
  "c": "n",
  "L": "o",
  "j": "p",
  "u": "q",
  "R": "r",
  "}": "s",
  "p": "t",
  "V": "u",
  "P": "v",
  "'": "w",
  "T": "x",
  "|": "y",
  "@": "z",
  "e": "{",
  ";": "}"
};

Scene.prototype.deobfuscatePassword = function deobfuscatePassword(password) {
  var self = this;
  password = password.replace(/./g,
    function(x) {
      var y = self.deobfuscator[x];
      return y;
    }
  );
  return password;
};

Scene.prototype.stat_chart = function stat_chart() {
  this.paragraph();
  var rows = this.parseStatChart();
  var target = this.target;
  if (!target) target = document.getElementById('text');

  var barWidth = 0;
  var standardFontSize = 0;

  function fixFontSize(span1, span2) {
    if (!standardFontSize) {
      if (window.getComputedStyle) {
        standardFontSize = parseInt(getComputedStyle(document.body).fontSize, 10);
      } else if (document.body.currentStyle) {
        standardFontSize = parseInt(document.body.currentStyle.fontSize, 10);
      } else {
        standardFontSize = 16;
      }
    }
    if (!barWidth) barWidth = span1.parentNode.offsetWidth;
    var spanMaxWidth, biggestSpanWidth;
    if (span2) {
      spanMaxWidth = barWidth / 2 - 1; /* minus one as a fudge factor; why is this needed? */
      biggestSpanWidth = Math.max(span1.offsetWidth, span2.offsetWidth);
    } else {
      spanMaxWidth = barWidth;
      biggestSpanWidth = span1.offsetWidth;
    }

    if (biggestSpanWidth > spanMaxWidth) {
      var newSize = Math.floor(standardFontSize * spanMaxWidth / biggestSpanWidth);
      span1.parentNode.style.fontSize = newSize + "px";
      if (window.getComputedStyle) {
        // on Android, if the user is using non-standand styles, browser may try to ignore our font setting
        var actual = parseInt(getComputedStyle(span1).fontSize, 10);
        if (actual > newSize) {
          newSize *= newSize / actual;
          span1.parentNode.style.fontSize = newSize + "px";
        }
      }
    }

  }

  for (i = 0; i < rows.length; i++) {
    var row = rows[i];
    var type = row.type;
    var variable = row.variable;
    var value = this.evaluateExpr(this.tokenizeExpr(variable));
    var label = this.replaceVariables(row.label);
    var definition = this.replaceVariables(row.definition || "");

    var statWidth, div, span, statValue;
    if (type == "text") {
      div = document.createElement("div");
      setClass(div, "statText");
      span = document.createElement("span");
      if (trim(label) || trim(value)) {
        printx(label + ": " + value, span);
      } else {
        // unofficial line_break
        printx(" ", span);
      }
      div.appendChild(span);
      target.appendChild(div);
    } else if (type == "percent") {
      div = document.createElement("div");
      setClass(div, "statBar statLine");
      span = document.createElement("span");
      printx("\u00a0\u00a0"+label+": "+value+"%", span);
      div.appendChild(span);
      statValue = document.createElement("div");
      setClass(statValue, "statValue");
      statValue.style.width = value+"%";
      statValue.innerHTML = "&nbsp;";
      div.appendChild(statValue);
      target.appendChild(div);
      fixFontSize(span);
    } else if (type == "opposed_pair") {
      div = document.createElement("div");
      setClass(div, "statBar statLine opposed");
      span0 = document.createElement("span");
      printx("\u00a0\u00a0"+label+": "+value+"% ", span0);
      div.appendChild(span0);
      span = document.createElement("span");
      span.setAttribute("style", "float: right");
      printx(this.replaceVariables(row.opposed_label)+": "+(100-value)+"%\u00a0\u00a0", span);
      div.appendChild(span);
      statValue = document.createElement("div");
      setClass(statValue, "statValue");
      statValue.style.width = value+"%";
      statValue.innerHTML = "&nbsp;";
      div.appendChild(statValue);
      target.appendChild(div);
      fixFontSize(span0, span);
    } else {
      throw new Error("Bug! Parser accepted an unknown row type: " + type);
    }
  }
  this.prevLine = "block";
  this.screenEmpty = false;
};

Scene.prototype.parseStatChart = function parseStatChart() {
    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var rows = [];
    var line, line1, line2, line2indent;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one row");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            this.rollbackLineCoverage();
            this.lineNum = this.previousNonBlankLineNum();
            this.rollbackLineCoverage();
            return rows;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }

        //
        // *stat_chart
        //   text wounds Wounds
        //     Definition
        //   percent Infamy Infamy
        //     Definition
        //   opposed_pair brutality
        //     Brutality
        //       Strength and cruelty
        //     Finesse
        //       Precision and aerial maneuverability
        //

        // TODO opposed_pair
        // TODO definitions
        // TODO variable substitutions
        // TODO *if/*else
        // TODO *line_break
        line = trim(line);
        var result = /^(text|percent|opposed_pair)\s+(.*)/.exec(line);
        if (!result) throw new Error(this.lineMsg() + "invalid line; this line should start with 'percent', 'text', or 'opposed_pair'");
        var type = result[1].toLowerCase();
        var data = trim(result[2]);
        if ("opposed_pair" == type) {
          this.getVar(data);
          line1 = this.lines[++this.lineNum];
          this.replaceVariables(line1);
          line1indent = this.getIndent(line1);
          if (line1indent <= this.indent) throw new Error(this.lineMsg() + "invalid indent; expected at least one indented line to indicate opposed pair name. indent: " + line1indent + ", expected greater than " + this.indent);
          line2 = this.lines[this.lineNum + 1];
          line2indent = this.getIndent(line2);
          if (line2indent <= this.indent) {
            // line1 was the only line
            rows.push({type: type, variable: data, label: data, opposed_label: trim(line1)});
          } else {
            this.lineNum++;
            this.replaceVariables(line2);
            if (line2indent == line1indent) {
              // two lines: first label, second label
              rows.push({type: type, variable: data, label: trim(line1), opposed_label: trim(line2)});
            } else if (line2indent > line1indent) {
              // line 2 is a definition; therefore the opposed_label and its definition must be on lines 3 and 4
              var line1definition = line2;
              var line3 = this.lines[++this.lineNum];
              this.replaceVariables(line3);
              var line3indent = this.getIndent(line3);
              if (line3indent != line1indent) throw new Error(this.lineMsg() + "invalid indent; this line should be the opposing label name. expected " + line1indent + " was " + line3indent);
              var line4 = this.lines[++this.lineNum];
              this.replaceVariables(line4);
              var line4indent = this.getIndent(line4);
              if (line4indent != line2indent) throw new Error(this.lineMsg() + "invalid indent; this line should be the opposing label definition. expected " + line2indent + " was " + line4indent);
              rows.push({type: type, variable: data, label: trim(line1), definition:trim(line2), opposed_label: trim(line3), opposed_definition: trim(line4)});
            } else {
              throw new Error(this.lineMsg() + "invalid indent; expected a second line with indent " + line1indent + " to match line " + this.lineNum + ", or else no more opposed_pair lines");
            }
          }
        } else {
          var variable, label;
          if (!/ /.test(data)) {
            variable = data;
            label = data;
          } else if (/^\(/.test(data)) {
            var parens = 0;
            var closingParen = -1;
            for (var i = 1; i < data.length; i++) {
              var c = data.charAt(i);
              if (c === "(") {
                parens++;
              } else if (c === ")") {
                if (parens) {
                  parens--;
                } else {
                  closingParen = i;
                  break;
                }
              }
            }
            if (closingParen == -1) {
              throw new Error(this.lineMsg() + "missing closing parenthesis");
            }
            variable = data.substring(1, closingParen);
            label = trim(data.substring(closingParen+1))
            if (label === "") {
              label = variable;
            }
          } else {
            result = /^(\S+) (.*)/.exec(data);
            if (!result) throw new Error(this.lineMsg() + "Bug! can't find a space when a space was found");
            variable = result[1];
            label = result[2];
          }
          this.evaluateExpr(this.tokenizeExpr(variable));
          this.replaceVariables(label);
          line2 = this.lines[this.lineNum + 1];
          line2indent = this.getIndent(line2);
          if (line2indent <= this.indent) {
            // No definition line
            rows.push({type: type, variable: variable, label: label});
          } else {
            this.lineNum++;
            this.replaceVariables(line2);
            rows.push({type: type, variable: variable, label: label, definition: trim(line2)});
          }
        }
    }
    return rows;
};

// *timer Dec 25, 2016 9:30:00 PDT
Scene.prototype.timer = function(dateString) {
  var end;
  if (dateString == "release") {
    if (typeof window === "undefined" || !window.releaseDate) return;
    end = window.releaseDate/1000;
  } else {
    end = Date.parse(dateString)/1000;
  }
  var now = new Date()/1000;
  if (now < end) {
    var target = this.target;
    if (!target) {
      target = document.createElement("p");
      document.getElementById('text').appendChild(target);
    }
    var self = this;
    showTicker(target, end, function() {
      clearScreen(loadAndRestoreGame());
    });
  }
}

// *delay_break 1200
Scene.prototype.delay_break = function(durationInSeconds) {
  if (isNaN(durationInSeconds * 1)) throw new Error(this.lineMsg() + "invalid duration");
  this.finished = true;
  this.skipFooter = true;
  var target = this.target;
  if (!target) {
    target = document.createElement("p");
    document.getElementById('text').appendChild(target);
  }
  this.paragraph();
  var self = this;
  delayBreakStart(function(delayStart) {
    window.blockRestart = true;
    var endTimeInSeconds = durationInSeconds * 1 + delayStart * 1;
    showTicker(target, endTimeInSeconds, function() {
      self.page_break_advertisement();
    });
    printFooter();
  });
};

// *delay_ending 1200 $2.99 $0.99
Scene.prototype.delay_ending = function(data) {
  // Steam doesn't do delay breaks and especially not skiponce
  if (typeof window != "undefined" && !!window.isSteamApp) {
    return this.ending();
  }
  var args = data.split(/ /);
  var durationInSeconds = args[0];
  var fullPriceGuess = args[1];
  var singleUsePriceGuess = args[2];
  if (isNaN(durationInSeconds * 1)) throw new Error(this.lineMsg() + "invalid duration");
  if (!/^\$/.test(fullPriceGuess)) throw new Error(this.lineMsg() + "invalid fullPriceGuess: \""+fullPriceGuess+"\"");
  if (singleUsePriceGuess && !/^\$/.test(singleUsePriceGuess)) throw new Error(this.lineMsg() + "invalid singleUsePriceGuess: \""+singleUsePriceGuess+"\"");
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  checkPurchase("adfree", function(ok, result) {
    if (result.adfree || !result.billingSupported) {
      self.ending();
      return;
    }
    getPrice("adfree", function (fullPrice) {
      if (fullPrice == "guess") fullPrice = fullPriceGuess;
      getPrice("skiponce", function (singleUsePrice) {
        if (singleUsePrice == "guess") singleUsePrice = singleUsePriceGuess;

        options = [];
        var finishedWaiting = {name: "Play again after a short wait. ", unselectable: true};
        options.push(finishedWaiting);
        var upgradeSkip = {name: "Upgrade to the unlimited version for " + fullPrice + " to skip the wait forever."};
        options.push(upgradeSkip);
        var skipOnce = {name: "Skip the wait one time for " + singleUsePrice + "."};
        if (singleUsePriceGuess) options.push(skipOnce);
        var restorePurchasesOption = {name: "Restore purchases from another device."};
        if (isRestorePurchasesSupported()) options.push(restorePurchasesOption);
        var playMoreGames = {name: "Play more games like this."};
        options.push(playMoreGames);
        var emailMe = {name: "Email me when new games are available."};
        options.push(emailMe);

        function restartNow() {
          window.blockRestart = false;
          restartGame();
        }

        self.paragraph();
        printOptions([""], options, function(option) {
          if (option == playMoreGames) {
            self.more_games("now");
            if (typeof curl != "undefined") curl();
          } else if (option == emailMe) {
            subscribeLink();
          } else if (option == upgradeSkip) {
            purchase("adfree", restartNow);
          } else if (option == skipOnce) {
            purchase("skiponce", restartNow);
          } else if (option == restorePurchasesOption) {
            restorePurchases("adfree", function() {
              clearScreen(loadAndRestoreGame);
            });
          } else {
            return restartGame();
          }
        });

        var target = document.querySelector(".choice label");

        delayBreakStart(function(delayStart) {
          window.blockRestart = true;
          var endTimeInSeconds = durationInSeconds * 1 + delayStart * 1;
          showTicker(target, endTimeInSeconds, function() {
            clearScreen(function() {
              self.ending();
            });
          });
          printFooter();
        });
      });
    });
  });

};

// *if booleanExpr
// execute different code depending on whether the booleanExpr is true or false
//
// Examples:
// *if bool-expression
//     blah
//     blah
// *elseif bool-expression
//     blah
//     blah
// *else
//     blah
//     blah
// bool-expression
//     by reference
//         *set foo true
//         *if foo ...
//     equality
//         foo=2
//         foo="blah"
//         2="2"
//             true
//     inequality
//         foo>2
//         foo<2
//         foo<=2
//         foo>=2
//     and/or logic, parentheses mandatory
//         (foo=2) or (foo=3)
//         ((foo>4) and (foo<8)) or (bar=0)
//
// NOTE: *if commands may be used inside *choices, to make some choices conditionally available
Scene.prototype["if"] = function scene_if(line) {
    var stack = this.tokenizeExpr(line);
    var result = this.evaluateExpr(stack);
    if (this.debugMode) println(line + " :: " + result);
    result = bool(result, this.lineNum+1);
    if (result) {
        // "true" branch, just go on to the next line
        this.indent = this.getIndent(this.nextNonBlankLine());
    } else {
        // "false" branch; skip over the true branch
        this.skipTrueBranch(false);
    }
};

// TODO Rename this function to just skipBranch
Scene.prototype.skipTrueBranch = function skipTrueBranch(inElse) {
  var startIndent = this.indent;
  var nextIndent = null;
  var line;
  while (isDefined(line = this.lines[++this.lineNum])) {
      this.rollbackLineCoverage();
      if (!trim(line)) continue;
      var indent = this.getIndent(line);
      if (nextIndent === null || nextIndent === undefined) {
          if (indent <= startIndent) throw new Error(this.lineMsg() + "invalid indent, expected at least one line in 'if' true block");
          nextIndent = indent;
      }
      if (indent <= startIndent) {
          // true block is over
          var parsed = null;
          // check to see if this is an *else or *elseif
          if (indent == startIndent) parsed = /^\s*\*(\w+)(.*)/.exec(line);
          if (!parsed || inElse) {
              this.lineNum = this.previousNonBlankLineNum();
              this.rollbackLineCoverage();
              this.indent = indent;
              return;
          }
          var command = parsed[1].toLowerCase();
          var data = trim(parsed[2]);
          if ("else" == command) {
              if (data) {
                if (/^if\b/.test(data)) {
                  throw new Error(this.lineMsg() + "'else if' is invalid, use 'elseif'");
                }
                throw new Error(this.lineMsg() + "nothing should appear on a line after 'else': " + data);
              }
              this.lineNum = this.lineNum; // code coverage
              // go on to the next line
              this.indent = this.getIndent(this.nextNonBlankLine());
          } else if (/^else?if$/.test(command)) {
              this.lineNum = this.lineNum; // code coverage
              this["if"](data);
          } else if ("comment" == command) {
              continue;
          } else {
              this.lineNum = this.previousNonBlankLineNum();
              this.rollbackLineCoverage();
              this.indent = this.getIndent(this.nextNonBlankLine());
          }
          return;
      }
      if (indent < nextIndent) {
          // *if foo
          //      foo
          //    bar
          throw new Error(this.lineMsg() + "invalid indent, expected "+nextIndent+", was " + indent);
      }
  }
};

Scene.prototype["else"] = Scene.prototype.elsif = Scene.prototype.elseif = function scene_else(data, inChoice) {
    // Authors can avoid using goto to get out of an if branch with:  *create implicit_control_flow true
    // This avoids the error message at the end of the function.
    if (inChoice || this.getVar("implicit_control_flow")) {
      this.skipTrueBranch(true);
      return;
    }
    throw new Error(this.lineMsg() + "It is illegal to fall in to an *else statement; you must *goto or *finish before the end of the indented block.");
};

// break the string up into a stack of tokens, defined in Scene.tokens below
Scene.prototype.tokenizeExpr = function tokenizeExpr(str) {
    var stack = [];
    var tokenTypes = Scene.tokens;
    var tokenTypesLength = tokenTypes.length;
    var pos = 0;
    while (str) {
        var matched = false;
        for (var i = 0; i < tokenTypesLength; i++) {
            var tokenType = tokenTypes[i];
            var token = tokenType.test(str, this.lineNum+1, this);
            if (token) {
                matched = true;
                str = str.substr(token.length);
                pos += token.length;
                var item = {name:tokenType.name, value:token, pos:pos};
                if ("WHITESPACE" == tokenType.name) {
                    break;
                } else if ("CURLY_QUOTE" == tokenType.name) {
                  throw new Error(this.lineMsg()+"Invalid use of curly smart quote: " + token + "\nUse straight quotes \" instead")
                } else if ("FUNCTION" == tokenType.name) {
                  item.func = /^\w+/.exec(token)[0];
                }
                stack.push(item);
                break;
            }
        }
        if (!matched) throw new Error(this.lineMsg()+"Invalid expression, couldn't extract another token: " + str);
    }
    return stack;
};

// evaluate the stack of tokens
// parenthetical == true if we're evaluating a parenthetical expression
// all expressions consist of either a "singleton" value (2) or two values and one operator (2+2)
Scene.prototype.evaluateExpr = function evaluateExpr(stack, parenthetical) {
    if (!stack.length) {
        throw new Error(this.lineMsg() + "no expression specified");
    }
    var self = this;
    function getToken() {
        var token = stack.shift();
        if (!token) throw new Error(self.lineMsg() + "null token");
        return token;
    }

    var token, value1, value2, operator, result;

    value1 = this.evaluateValueToken(getToken(), stack);

    if (!stack.length) {
        if (parenthetical) {
            throw new Error(this.lineMsg() + "Invalid expression, expected " + parenthetical);
        }
        return value1;
    }

    token = getToken();

    if (parenthetical && parenthetical == token.name) {
        return value1;
    }

    // Since this isn't a singleton, it must be an operator
    operator = Scene.operators[token.value];
    if (!operator) {
      throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected OPERATOR"+
        (parenthetical?" or " + parenthetical : "")+
        ", was: " + token.name + " [" + token.value + "]");
    }

    if (token.value === '%') {
      this.warning("this is a bare % sign, which should be replaced with %+, %-, or modulo if you're really advanced.");
      this.warning("For more details on modulo, see: https://forum.choiceofgames.com/t/21176");
    }

    if (!stack[0]) {
      throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected something after a "+token.value);
    }

    if (stack[0].func == "auto") {
      value2 = this.autobalance(stack, token, value1);
    } else {
      value2 = this.evaluateValueToken(getToken(), stack);
    }

    // and do the operator
    result = operator(value1, value2, this.lineNum+1, this);

    if (parenthetical) {
        // expect close parenthesis
        if (stack.length) {
            token = getToken();
            if (parenthetical == token.name) {
                return result;
            } else {
                throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected "+parenthetical+", was: " + token.name + " [" + token.value + "]");
            }
        } else {
            throw new Error(this.lineMsg() + "Invalid expression, expected " + parenthetical);
        }
    } else {
        // if not parenthetical, expect no more tokens
        if (stack.length) {
            token = getToken();
            throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected no more tokens, found: " + token.name + " [" + token.value + "]");
        } else {
            return result;
        }
    }
    throw new Error(this.lineMsg() + "bug, how did I get here?");
};

// turn a number, string, or var token into its value
// or, if this is an open parenthesis, evaluate the parenthetical expression
Scene.prototype.evaluateValueToken = function evaluateValueToken(token, stack) {
    var name = token.name;
    var value;
    if ("OPEN_PARENTHESIS" == name) {
        return this.evaluateExpr(stack, "CLOSE_PARENTHESIS");
    } else if ("OPEN_CURLY" == name) {
        value = this.evaluateExpr(stack, "CLOSE_CURLY");
        return this.getVar(value);
    } else if ("FUNCTION" == name) {
        if (!this.functions[token.func]) throw new Error(this.lineMsg + "Unknown function " + token.func);
        value = this.evaluateExpr(stack, "CLOSE_PARENTHESIS");
        return this.functions[token.func].call(this, value);
    } else if ("NUMBER" == name) {
        return token.value;
    } else if ("STRING" == name) {
        // strip off the quotes and unescape backslashes
        return this.replaceVariables(token.value.slice(1,-1).replace(/\\(.)/g, "$1"));
    } else if ("VAR" == name) {
        var variable = String(token.value);
        while (stack.length && stack[0].name == "OPEN_SQUARE") {
          stack.shift();
          variable += "_" + this.evaluateExpr(stack, "CLOSE_SQUARE");
        }
        return this.getVar(variable);
    } else {
        throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected NUMBER, STRING, VAR or PARENTHETICAL, was: " + name + " [" + token.value + "]");
    }
};

// turn a var token into its name, remove it from the stack
// or if it's a curly parenthesis, evaluate that
// or if it's an array expression, convert it into its raw underscore name
Scene.prototype.evaluateReference = function evaluateReference(stack, options) {
  var toLowerCase = true;
  if (options && options.hasOwnProperty("toLowerCase")) toLowerCase = !!options.toLowerCase;
  function findClosingBracket(stack, type, offset) {
    if (!offset) offset = 0;
    var opens = 0;
    var openType = "OPEN_"+type;
    var closeType = "CLOSE_"+type;
    for (var i = offset; i < stack.length; i++) {
      if (stack[i].name == openType) {
        opens++;
      } else if (stack[i].name == closeType) {
        if (opens) {
          opens--;
        } else {
          return i;
        }
      }
    }
    return -1;
  }
  function normalizeCase(name) {
    if (toLowerCase) {
      return String(name).toLowerCase();
    } else {
      return name;
    }
  }
  if (!stack.length) throw new Error(this.lineMsg()+"Invalid expression, expected a name");
  var name;
  if (stack[0].name === "OPEN_CURLY") {
    stack.shift();
    var closingCurly = findClosingBracket(stack, "CURLY");
    if (closingCurly == -1) throw new Error(this.lineMsg()+"Invalid expression, no closing curly bracket: " + data);
    name = this.evaluateExpr(stack.slice(0, closingCurly));
    stack.splice(0, closingCurly+1);
    return normalizeCase(name);
  } else if (stack[0].name === "NUMBER") {
    // you could have a label that's just a number
    name = stack[0].value;
    stack.shift();
    return name;
  } else {
    if (stack[0].name !== "VAR") throw new Error(this.lineMsg() + "Invalid expression; expected name, found " + stack[0].name + " at char " + stack[0].pos);
    name = String(stack[0].value);
    stack.shift();
    while(stack.length && stack[0].name == "OPEN_SQUARE") {
      var closingBracket = findClosingBracket(stack, "SQUARE", 1);
      if (closingBracket == -1) throw new Error(this.lineMsg()+"Invalid expression, no closing array bracket at char " + stack[1].pos);
      var index = this.evaluateExpr(stack.slice(1, closingBracket));
      name += "_" + index;
      stack.splice(0, closingBracket+1);
    }
    return normalizeCase(name);
  }
};

Scene.prototype.functions = {
  not: function(value) {
    return !bool(value, this.lineNum+1);
  },
  round: function(value) {
    if (isNaN(value*1)) throw new Error(this.lineMsg()+"round() value is not a number: " + value);
    return Math.round(value);
  },
  timestamp: function(value) {
    return Date.parse(value)/1000;
  },
  log: function(value) {
    if (isNaN(value*1)) throw new Error(this.lineMsg()+"log() value is not a number: " + value);
    return Math.log(value)/Math.log(10);
  },
  length: function(value) {
    return String(value).length;
  },
  auto: function() {
    throw new Error(this.lineMsg()+"Invalid expression, auto() must come after a < or > symbol");
  }
};

Scene.prototype.autobalance = function autobalance(stack, operatorToken, value) {
  if (operatorToken.name !== "INEQUALITY") {
    throw new Error(this.lineMsg()+"Invalid expression, auto() must come after a < or > symbol");
  }
  stack.shift(); // remove auto function

  if (stack.length < 4 ||
    stack[0].name !== "NUMBER" ||
    stack[1].name !== "COMMA" ||
    !(stack[2].name == "VAR" || stack[2].name == "NUMBER") ||
    stack[3].name !== "CLOSE_PARENTHESIS"
  ) {
    throw new Error(this.lineMsg()+"Invalid expression, auto() requires (percentage, id)");
  }
  var rateString = stack.shift().value;
  var rate = parseFloat(rateString);
  if (isNaN(rate) || rate < 1 || rate > 99) {
    throw new Error(this.lineMsg()+"the first auto() parameter should be a number between 1 and 99: " + rateString);
  }
  stack.shift(); // comma
  var id = stack.shift().value;
  stack.shift(); // close parenthesis
  var result = this.stats['auto' + '_' + this.name + '_' + id];
  if (typeof result != "undefined") {
    return result;
  } else if (this.recordBalance) {
    return this.recordBalance(value, operatorToken.value, rate, id);
  }
  return 50;
}

Scene.prototype.evaluateValueExpr = function evaluateValueExpr(expr) {
    var stack = this.tokenizeExpr(expr);
    var token = stack.shift();
    if (!token) throw new Error(this.lineMsg() + "null token");
    var value = this.evaluateValueToken(token, stack);
    if (stack.length) {
        token = stack.shift();
        if (!token) throw new Error(this.lineMsg() + "null token");
        throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected no more tokens, found: " + token.name + " [" + token.value + "]");
    }
    return value;
};

Scene.prototype.goto_random_scene = function gotoRandomScene(data) {
  var parsed = this.parseGotoRandomScene(data);
  var allowReuseGlobally = /\ballow_reuse\b/.test(data);
  var allowNoSelection = /\ballow_no_selection\b/.test(data);
  var option = this.computeRandomSelection(Math.random(), parsed, allowReuseGlobally);

  if (option) {
    this.goto_scene(option.name);
  } else {
    if (allowNoSelection) {
      return;
    } else {
      throw new Error(this.lineMsg() + "No selectable scenes");
    }
  }

};

Scene.prototype.parseGotoRandomScene = function parseGotoRandomScene(data) {
    data = data || "";
    var directives = data.split(" ");
    var allowReuseGlobally = false;
    var allowNoSelection = false;
    for (var i = 0; i < directives; i++) {
      var directive = trim(directives[i]);
      if (!directive) continue;
      if (directive == "allow_reuse") {
        allowReuseGlobally = true;
      } else if (directive == "allow_no_selection") {
        allowNoSelection = true;
      } else {
        throw new Error(this.lineMsg() + "invalid command: '" + directive + "'");
      }
    }

    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var options = [];
    var line;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one line in *goto_random_scene");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            this.rollbackLineCoverage();
            this.lineNum--;
            this.rollbackLineCoverage();
            break;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }
        line = trim(line);

        var option = {allowReuse:allowReuseGlobally};
        var command;
        while(!!(command = /^\*(\S+)/.exec(line))) {
          command = command[1];
          if ("allow_reuse" == command) {
            option.allowReuse = true;
            line = trim(line.substring("*allow_reuse".length));
            command = /^\*(\S+)/.exec(line);
            continue;
          } else if ("if" == command) {
            var conditional = /^\*if\s+\((.+)\)\s+([^\)]+)/.exec(line);
            if (!conditional) throw new Error(this.lineMsg() + " invalid *if, expected () followed by scene name: " + line);
            line = conditional[2];
            var stack = this.tokenizeExpr(conditional[1]);
            this.evaluateExpr(stack);
            option.conditional = conditional[1];
          } else {
            throw new Error(this.lineMsg() + " invalid command: " + line);
          }
        }
        // TODO weights
        option.name = trim(line);
        options.push(option);
    }
    return options;
};

Scene.prototype.computeRandomSelection = function computeRandomSelection(randomFloat, options, allowReuseGlobally) {
  var filtered = [];
  var finished = {};
  if (!allowReuseGlobally) {
    if (!this.stats.choice_grs) this.stats.choice_grs = [];
  }
  var grs = this.stats.choice_grs;
  for (var i = 0; i < grs.length; i++) {
    finished[grs[i]] = 1;
  }
  var option;
  for (i = 0; i < options.length; i++) {
    option = options[i];
    if (!option.allowReuse) {
      if (finished[option.name]) continue;
    }
    if (option.conditional) {
      var stack = this.tokenizeExpr(option.conditional);
      var pass = this.evaluateExpr(stack);
      if (!pass) continue;
    }
    filtered.push(option);
  }
  if (!filtered.length) return null;
  // TODO weights
  var randomSelection = Math.floor(randomFloat*filtered.length);
  option = filtered[randomSelection];
  if (!option.allowReuse) {
    this.stats.choice_grs.push(option.name);
  }
  return option;
};

Scene.prototype.end_trial = function endTrial() {
  this.paragraph();
  printLink(this.target, "#", "Start Over from the Beginning", function(e) {
    preventDefault(e);
    return restartGame("prompt");
  });
  this.prevLine = "block";
  this.screenEmpty = false;
  this.finished = true;
};

Scene.prototype.achieve = function scene_achieve(name) {
  name = name.toLowerCase();
  if (!this.nav.achievements.hasOwnProperty(name)) {
    throw new Error(this.lineMsg() + "the achievement name "+name+" was not declared as an *achievement in startup");
  }
  var achievement = this.nav.achievements[name];
  this.nav.achieved[name] = true;
  if (typeof window != "undefined" && typeof achieve != "undefined") {
    achieve(name, achievement.title, achievement.earnedDescription);
  }
};

Scene.prototype.check_achievements = function scene_checkAchievements() {
  var self = this;
  function callback(immediately) {
    for (var achievement in nav.achievements) {

      self.temps["choice_achieved_"+achievement] = nav.achieved.hasOwnProperty(achievement);
    }
    if (!immediately) {
      self.finished = false;
      self.skipFooter = false;
      self.execute();
    }
  }
  if (typeof checkAchievements == "undefined") {
    callback("immediately");
  } else {
    this.finished = true;
    this.skipFooter = true;
    checkAchievements(callback);
  }
};

Scene.prototype.scene_list = function scene_list() {
  var scenes = this.parseSceneList();
  this.nav.setSceneList(scenes);
};

Scene.prototype.parseSceneList = function parseSceneList() {
  var nextIndent = null;
  var scenes = [];
  var line;
  var startIndent = this.indent;
  while(isDefined(line = this.lines[++this.lineNum])) {
      if (!trim(line)) {
          this.rollbackLineCoverage();
          continue;
      }
      var indent = this.getIndent(line);
      if (nextIndent === null || nextIndent === undefined) {
          // initialize nextIndent with whatever indentation the line turns out to be
          // ...unless it's not indented at all
          if (indent <= startIndent) {
              throw new Error(this.lineMsg() + "invalid indent, expected at least one row");
          }
          this.indent = nextIndent = indent;
      }
      if (indent <= startIndent) {
          // it's over!
          this.rollbackLineCoverage();
          this.lineNum--;
          this.rollbackLineCoverage();
          return scenes;
      }
      if (indent != this.indent) {
          // all scenes are supposed to be at the same indentation level
          throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
      }

      line = trim(line);
      var purchaseMatch = /^\$(\w*)\s+(.*)/.exec(line);
      if (purchaseMatch) {
        line = purchaseMatch[2];
      }
      if (!scenes.length && "startup" != String(line).toLowerCase()) scenes.push("startup");
      scenes.push(line);
  }
  return scenes;
};

Scene.prototype.title = function scene_title(title) {
  this.stats.choice_title = trim(title);
  if (this.nav) this.nav.startingStats.choice_title = trim(title);
  if (typeof changeTitle != "undefined") {
    changeTitle(title);
  }
};

Scene.prototype.author = function scene_author(author) {
  if (typeof changeAuthor != "undefined") {
    changeAuthor(author);
  }
};

// *achievement name hidden|visible 100 Achievement Title
//     Earned description
//     Pre-earned description
Scene.prototype.achievement = function scene_achievement(data) {
  var parsed = /(\S+)\s+(\S+)\s+(\S+)\s+(.*)/.exec(data);
  if (!parsed) throw new Error(this.lineMsg() + "Invalid *achievement, requires short name, visibility, points, and display title: " + data);
  var achievementName = parsed[1];
  if (!/^[a-z][a-z0-9_]+$/.test(achievementName)) throw new Error(this.lineMsg()+"Invalid achievement name: " +achievementName);

  if (!this.parsedAnAchievment && Object.keys(this.nav.achievements).length > 0) {
    // blow away pre-existing mygame.js achievements
    this.nav.achievements = {};
    this.nav.achievementList = [];
    this.achievementTotal = 0;
    this.seenAchievementTitles = {};
  }

  this.parsedAnAchievment = true;

  if (this.nav.achievements.hasOwnProperty(achievementName)) {
    var preExisting = this.nav.achievements[achievementName];
    throw new Error(this.lineMsg()+"Achievement "+achievementName+" already defined on line " + this.nav.achievements[achievementName].lineNumber);
  }

  var lineNumber = this.lineNum+1;
  var visibility = parsed[2];
  if (visibility != "hidden" && visibility != "visible") {
    throw new Error(this.lineMsg()+"Invalid *achievement, the second word should be either 'hidden' or 'visible': " +visibility);
  }
  var visible = (visibility != "hidden");
  var pointString = parsed[3];
  if (!/[1-9][0-9]*/.test(pointString)) {
    throw new Error(this.lineMsg()+"Invalid *achievement, the third word should be an integer number of points: " + pointString);
  }
  var points = parseInt(pointString, 10);
  if (points > 100) throw new Error(this.lineMsg()+"Invalid *achievement, no achievement may be worth more than 100 points: " + points);
  if (points < 1) throw new Error(this.lineMsg()+"Invalid *achievement, no achievement may be worth less than 1 point: " + points);
  if (!this.achievementTotal) this.achievementTotal = 0;
  this.achievementTotal += points;
  if (this.achievementTotal > 1000) {
    throw new Error(this.lineMsg()+"Invalid achievements. Adding " + points + " would add up to more than 1,000 points: " + this.achievementTotal);
  }
  var title = parsed[4];
  if (/(\$\{)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement title: " + title);
  if (/(\@\{)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. @{} not permitted in achievement title: " + title);
  if (/(\[)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement title: " + title);
  if (title.length > 50) throw new Error(this.lineMsg()+"Invalid *achievement. Title must be 50 characters or fewer: " + title);

  // Get the description from the next indented line
  var line = this.lines[++this.lineNum];
  var indent = this.getIndent(line);
  if (!indent) {
    throw new Error(this.lineMsg()+"Invalid *achievement. An indented description is required.");
  }
  var preEarnedDescription = trim(line);
  if (/(\$\{)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement description: " + preEarnedDescription);
  if (/(\@\{)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. @{} not permitted in achievement description: " + preEarnedDescription);
  if (/(\[)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement description: " + preEarnedDescription);
  if (preEarnedDescription.length > 200) throw new Error(this.lineMsg()+"Invalid *achievement. Pre-earned description must be 200 characters or fewer: " + preEarnedDescription);

  if (!visible) {
    if (preEarnedDescription.toLowerCase() != "hidden") throw new Error(this.lineMsg()+"Invalid *achievement. Hidden achievements must set their pre-earned description to 'hidden'.");
  }

  // Optionally get a post-earned description from the next line
  var postEarnedDescription = null;
  while(isDefined(line = this.lines[++this.lineNum])) {
    if (trim(line)) break;
    this.rollbackLineCoverage();
  }
  indent = this.getIndent(line);
  if (indent) {
    postEarnedDescription = trim(line);
    if (/(\$\{)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement description: " + postEarnedDescription);
    if (/(\@\{)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. @{} not permitted in achievement description: " + postEarnedDescription);
    if (/(\[)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement description: " + postEarnedDescription);
    if (postEarnedDescription.length > 200) throw new Error(this.lineMsg()+"Invalid *achievement. Post-earned description must be 200 characters or fewer: " + postEarnedDescription);
  } else {
    // No indent means the next line is not a post-earned description
    this.rollbackLineCoverage();
    this.lineNum--;
    this.rollbackLineCoverage();
  }

  if (!postEarnedDescription) {
    if (!visible) throw new Error(this.lineMsg()+"Invalid *achievement. Hidden achievements must set a post-earned description.");
    postEarnedDescription = preEarnedDescription;
  }

  if (!this.nav.achievements.hasOwnProperty(achievementName)) {
    this.nav.achievementList.push(achievementName);
    if (this.nav.achievementList.length > 100) {
      throw new Error(this.lineMsg()+"Too many *achievements. Each game can have up to 100 achievements.");
    }
  }

  if (!this.seenAchievementTitles) this.seenAchievementTitles = {};

  if (this.seenAchievementTitles[title]) {
    throw new Error(this.lineMsg()+"An achievement with display title \"" + title + "\" was already defined at line " + this.seenAchievementTitles[title]);
  }

  this.seenAchievementTitles[title] = this.lineNum+1;

  this.nav.achievements[achievementName] = {
    visible: visible,
    points: points,
    title: title,
    earnedDescription: postEarnedDescription,
    preEarnedDescription: preEarnedDescription,
    lineNumber: lineNumber
  };

  if (typeof setButtonTitles != "undefined") setButtonTitles();
};


Scene.prototype.bug = function scene_bug(message) {
  if (message) {
    message = "Bug: " + this.replaceVariables(message);
  } else {
    message = "Bug";
  }
  throw new Error(this.lineMsg() + message);
};

Scene.prototype.warning = function scene_warning(message) {
  // quicktest implements this
}

Scene.prototype.feedback = function scene_feedback() {
  if (typeof window == "undefined" || this.randomtest) return;
  this.paragraph();
  this.printLine("On a scale from 1 to 10, how likely are you to recommend this game to a friend?");
  this.paragraph();
  var options = [{name:"10 (Most likely)"}];
  for (var i = 9; i > 1; i--) {
    options.push({name:i});
  }
  options.push({name:"1 (Least likely)"});
  options.push({name:"No response."});
  var self = this;
  this.renderOptions([""], options, function(option) {
    var value = "null";
    var numberMatch = /^(\d+)/.exec(option.name);
    if (numberMatch) value = numberMatch[1]*1;
    if (!window.storeName) {
      self.finished = false;
      self.resetPage();
      return;
    }

    var postFeedback = function() {
      xhrAuthRequest("POST", "feedback", function(ok, response) {
        if (window.console) console.log("ok", ok, response);
      }, "game", window.storeName, "platform", platformCode(), "rating", value);
      if (/^(9|10)/.test(option.name)) {
        if (isReviewSupported()) {
          return clearScreen(function() {
            self.printLine("Great! ");
            promptForReview();
            self.screenEmpty = false;
            self.prevLine = "text";
            self.page_break();
            printFooter();
          });
        }
      }
      self.finished = false;
      self.resetPage();
    }

    if (value == "null") {
      self.finished = false;
      self.resetPage();
      return;
    }

    isRegistered(function(registered) {
      if (registered) {
        postFeedback();
      } else {
        clearScreen(function() {
          loginForm(main, 1/*optional*/, "Please sign in to have your vote counted!", postFeedback);
        });
      }
    });
  });
  this.finished = true;
};

Scene.prototype.parseTrackEvent = function(data) {
  var event = {};
  var stack = this.tokenizeExpr(data);
  if (!stack.length) throw new Error(this.lineMsg() + "Invalid track_event statement, expected at least two args: category and action");
  event.category = this.evaluateValueToken(stack.shift(), stack);
  if (!stack.length) throw new Error(this.lineMsg() + "Invalid track_event statement, expected at least two args: category and action");
  event.action = this.evaluateValueToken(stack.shift(), stack);
  if (stack.length) {
    event.label = this.evaluateValueToken(stack.shift(), stack);
    if (stack.length) {
      event.value = this.evaluateValueToken(stack.shift(), stack);
      if (stack.length) {
        throw new Error(this.lineMsg() + "Invalid track_event statement, expected at most four args: category, action, label, value");
      }
      var intValue = parseInt(event.value, 10);
      if (isNaN(intValue) || event.value != intValue || event.value.toString() != intValue.toString()) {
        throw new Error(this.lineMsg() + "Invalid track_event statement, value must be an integer: " + event.value);
      }
    }
  }
  return event;
}

Scene.prototype.track_event = function track_event(data) {
  var event = this.parseTrackEvent(data);
  if (typeof ga !== "undefined") {
    ga('send', 'event', event.category, event.action, event.label, event.value);
  }
}

Scene.prototype.ai = function ai(data) {}

Scene.prototype.config = function config(data) {
    var stack = this.tokenizeExpr(data);
    var variable = this.evaluateReference(stack);
    if ("undefined" === typeof this.temps[variable] && "undefined" === typeof this.stats[variable]) {
      throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
    }
    if (stack.length === 0) throw new Error(this.lineMsg()+"Invalid set instruction, no expression specified: " + line);
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
    if ("undefined" !== typeof remoteConfig && !this.randomtest && !this.quicktest) {
      this.finished = true;
      this.skipFooter = true;
      var self = this;
      remoteConfig(variable, function(result) {
        if (result !== null) self.setVar(variable, result);
        self.finished = false;
        self.skipFooter = false;
        self.execute();
      })
    }
};

Scene.prototype.ifid = function ifid(id) {
  if (!/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/.test(id)) {
    throw new Error(this.lineMsg() + "Invalid IFID. It should have five parts, like \"a0a0a0a0-a0a0-a0a0-a0a0-a0a0a0a0a0a0\: " + id);
  }
  if (!/^[A-F0-9\-]{36}$/i.test(id)) {
    throw new Error(this.lineMsg() + "Invalid IFID. It should contain only numbers, letters A-F, and dashes: " + id);
  }
}

Scene.prototype.lineMsg = function lineMsg() {
    return this.name + " line " + (this.lineNum+1) + ": ";
};

Scene.prototype.rollbackLineCoverage = function() {};

Scene.baseUrl = "scenes";
Scene.regexpMatch = function regexpMatch(str, re) {
    var result = re.exec(str);
    if (!result) return null;
    return result[0];
};
// Each token has a name and a test, which returns the matching string
Scene.tokens = [
    {name:"OPEN_PARENTHESIS", test:function(str){ return Scene.regexpMatch(str,/^\(/); } },
    {name:"CLOSE_PARENTHESIS", test:function(str){ return Scene.regexpMatch(str,/^\)/); } },
    {name:"OPEN_CURLY", test:function(str){ return Scene.regexpMatch(str,/^\{/); } },
    {name:"CLOSE_CURLY", test:function(str){ return Scene.regexpMatch(str,/^\}/); } },
    {name:"OPEN_SQUARE", test:function(str){ return Scene.regexpMatch(str,/^\[/); } },
    {name:"CLOSE_SQUARE", test:function(str){ return Scene.regexpMatch(str,/^\]/); } },
    {name:"FUNCTION", test:function(str){ return Scene.regexpMatch(str,/^(not|round|timestamp|log|length|auto)\s*\(/); } },
    {name:"NUMBER", test:function(str){ return Scene.regexpMatch(str,/^\d+(\.\d+)?\b/); } },
    {name:"STRING", test:function(str, line, sceneObj) {
            var i;
            if (!/^\"/.test(str)) return null;
            for (i = 1; i < str.length; i++) {
                var x = str.charAt(i);
                if ("\\" == x) {
                    i++;
                } else if ('"' == x) {
                    return str.substring(0,i+1);
                }
            }
            var errMessage = "line " + line + ": ";
            if (sceneObj) {
              errMessage = sceneObj.lineMsg();
            }
            throw new Error(errMessage+"Invalid string, open quote with no close quote: " + str);
        }
    },
    {name:"CURLY_QUOTE", test:function(str){ return Scene.regexpMatch(str,/^[\u201c\u201d]/); } },
    {name:"WHITESPACE", test:function(str){ return Scene.regexpMatch(str,/^\s+/); } },
    {name:"NAMED_OPERATOR", test:function(str){ return Scene.regexpMatch(str,/^(and|or|modulo)\b/); } },
    {name:"VAR", test:function(str){ return Scene.regexpMatch(str,/^\w*/); } },
    {name:"FAIRMATH", test:function(str){ return Scene.regexpMatch(str,/^%[\+\-]/); } },
    {name:"OPERATOR", test:function(str){ return Scene.regexpMatch(str,/^[\+\-\*\/\&\%\^\#]/); } },
    {name:"INEQUALITY", test:function(str){ return Scene.regexpMatch(str,/^[\!<>]\=?/); } },
    {name:"EQUALITY", test:function(str){ return Scene.regexpMatch(str,/^=/); } },
    {name:"COMMA", test:function(str){ return Scene.regexpMatch(str,/^,/); } }
    //
];
Scene.operators = {
    "+": function add(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) + num(v2,line,name); },
    "-": function subtract(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) - num(v2,line,name); },
    "*": function multiply(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) * num(v2,line,name); },
    "/": function divide(v1,v2,line,sceneObj) {
      var name = null; if (sceneObj) name = sceneObj.name; 
      v2 = num(v2, line, name);
      if (v2 === 0) throw new Error(name+" line "+line+": can't divide by zero");
      return num(v1,line,name) / num(v2,line,name);
    },
    "^": function exponent(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return Math.pow(num(v1,line,name), num(v2,line,name)); },
    "&": function concatenate(v1,v2) { return [v1,v2].join(""); },
    "#": function charAt(v1,v2,line,sceneObj) {
      var name = null;
      var errMessage = "line " + line + ": ";
      if (sceneObj) {
        name = sceneObj.name;
        errMessage = sceneObj.lineMsg();
      }
      var i = num(v2,line,name);
      if (i < 1) {
        throw new Error(errMessage+"There is no character at position " + i + "; the position must be greater than or equal to 1.");
      }
      if (i > String(v1).length) {
        throw new Error(errMessage+"There is no character at position " + i + ". \""+v1+"\" is only " + String(v1).length + " characters long.");
      }
      return String(v1).charAt(i-1);
    },
    "%+": function fairAdd(v1, v2, line, sceneObj) {
        var name = null;
        var errMessage = "line " + line + ": ";
        if (sceneObj) {
          name = sceneObj.name;
          errMessage = sceneObj.lineMsg();
        }
        v1 = num(v1,line,name);
        v2 = num(v2,line,name);
        var validValue = (v1 >= 0 && v1 <= 100);
        if (!validValue) {
            throw new Error(errMessage+"Can't fairAdd to non-percentile value: " + v1);
        }
        if (v2 > 0) {
          var multiplier = (100 - v1) / 100;
          var actualModifier = v2 * multiplier;
          var value = 1 * v1 + actualModifier;
          value = Math.floor(value);
          if (value > 99) value = 99;
          return value;
        } else {
          var multiplier = v1 / 100;
          var actualModifier = (0-v2) * multiplier;
          var value = v1 - actualModifier;
          value = Math.ceil(value);
          if (value < 1) value = 1;
          return value;
        }
    },
    "%-": function fairSubtract(v1, v2, line, sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        v2 = num(v2,line,name);
        return Scene.operators["%+"](v1,0-v2,line,sceneObj);
    },
    "=": function equals(v1,v2) { return v1 == v2 || String(v1) == String(v2); },
    "<": function lessThan(v1,v2,line,sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        return num(v1,line,name) < num(v2,line,name); },
    ">": function greaterThan(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) > num(v2,line,name); },
    "<=": function lessThanOrEquals(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) <= num(v2,line,name); },
    ">=": function greaterThanOrEquals(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) >= num(v2,line,name); },
    "!=": function notEquals(v1,v2) { return v1 != v2; },
    "and": function and(v1, v2, line, sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        return bool(v1,line,name) && bool(v2,line,name);
    },
    "or": function or(v1, v2, line, sceneObj) {
        var name = null; if (sceneObj) name = sceneObj.name; 
        return bool(v1,line,name) || bool(v2,line,name);
    },
    "modulo": function modulo(v1,v2,line,sceneObj) { var name = null; if (sceneObj) name = sceneObj.name; return num(v1,line,name) % num(v2,line,name); },
};

Scene.initialCommands = {"create":1,"create_array":1,"scene_list":1,"title":1,"author":1,"comment":1,"achievement":1,"product":1,"ifid":1};

Scene.validCommands = {"comment":1, "goto":1, "gotoref":1, "label":1, "looplimit":1, "finish":1, "abort":1,
    "choice":1, "create":1, "create_array": 1, "temp":1, "temp_array": 1, "delete":1, "delete_array":1, "set":1, "setref":1, "print":1, "if":1, "rand":1,
    "page_break":1, "line_break":1, "script":1, "else":1, "elseif":1, "elsif":1, "reset":1,
    "goto_scene":1, "fake_choice":1, "input_text":1, "ending":1, "share_this_game":1, "stat_chart":1,
    "subscribe":1, "show_password":1, "gosub":1, "return":1, "hide_reuse":1, "disable_reuse":1, "allow_reuse":1,
    "check_purchase":1,"restore_purchases":1,"purchase":1,"restore_game":1,"advertisement":1,
    "kindle_search":1,"kindle_product":1,"feedback":1,
    "save_game":1,"delay_break":1,"image":1,"kindle_image":1,"link":1,"input_number":1,"goto_random_scene":1,
    "restart":1,"more_games":1,"delay_ending":1,"end_trial":1,"login":1,"achieve":1,"scene_list":1,"title":1,
    "bug":1,"link_button":1,"check_registration":1,"sound":1,"author":1,"gosub_scene":1,"achievement":1,
    "check_achievements":1,"redirect_scene":1,"print_discount":1,"purchase_discount":1,"track_event":1,
    "timer":1,"youtube":1,"product":1,"text_image":1,"ai":1,"params":1,"config":1,"ifid":1,
    "page_break_advertisement":1, "finish_advertisement":1
    };

;
/*
 * Copyright 2010 by Dan Fabulich.
 * 
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 * 
 * See the License for the specific language governing
 * permissions and limitations under the License.
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */
function SceneNavigator(sceneList) {
    this.setSceneList(sceneList);
    this.startingStats = {};
}

SceneNavigator.prototype.setSceneList = function setSceneList(sceneList) {
    this._sceneList = sceneList;
    this._sceneMap = {};
    for (var i = 0; i < sceneList.length-1; i++) {
        var scene1 = sceneList[i];
        var scene2 = sceneList[i+1];
        this._sceneMap[scene1] = scene2;
    }
    this._startupScene = sceneList[0];
};

SceneNavigator.prototype.nextSceneName = function nextSceneName(currentSceneName) {
    var nextScene = this._sceneMap[currentSceneName];
    //if (!nextScene) throw new Error("No scene follows " + currentSceneName);
    return nextScene;
};

SceneNavigator.prototype.getStartupScene = function getStartupScene() {
    return this._startupScene;
};

SceneNavigator.prototype.setStartingStatsClone = function setStartingStatsClone(stats) {
  this.startingStats = {};
  for (var i in stats) {
    this.startingStats[i] = stats[i];
  }
};

SceneNavigator.prototype.resetStats = function resetStats(stats) {
  for (var i in stats) {
    delete stats[i];
  }
  for (i in this.startingStats) {
    stats[i] = this.startingStats[i];
  }
  this.bugLog = [];
};

SceneNavigator.prototype.repairStats = function repairStats(stats) {
  for (var i in this.startingStats) {
    var startingStat = this.startingStats[i];
    if (startingStat === null || startingStat === undefined) continue;
    if (typeof(stats[i]) === "undefined" || stats[i] === null) {
      stats[i] = this.startingStats[i];
    }
  }
};

SceneNavigator.prototype.bugLog = [];
SceneNavigator.prototype.achievements = {};
SceneNavigator.prototype.achievementList = [];
SceneNavigator.prototype.achieved = {};
SceneNavigator.prototype.products = {};

SceneNavigator.prototype.loadAchievements = function(achievementArray) {
  if (!achievementArray) return;
  this.achievements = {};
  this.achievementList = [];
  for (var i = 0; i < achievementArray.length; i++) {
    var achievement = achievementArray[i];
    var achievementName = achievement[0];
    var visible = achievement[1];
    var points = achievement[2];
    var title = achievement[3];
    var earnedDescription = achievement[4];
    var preEarnedDescription = achievement[5];
    this.achievements[achievementName] = {
      visible: visible,
      points: points,
      title: title,
      earnedDescription: earnedDescription,
      preEarnedDescription: preEarnedDescription
    };
    this.achievementList.push(achievementName);
  }
};
SceneNavigator.prototype.loadProducts = function(productArray, purchaseMap) {
  if (!productArray && !purchaseMap) return;
  this.products = {};
  for (var i = 0; i < productArray; i++) {
    this.products[productArray[i]] = {};
  }
  for (var scene in purchaseMap) {
    var product = purchaseMap[scene];
    this.products[product] = {};
  }
}

;
// Ext function toggle (set true/false to enable/disable)
var btn_delete_all = true;
var btn_export = true;
var btn_export_all = true;
var btn_import = true;

// set length (in ms) to delay before executing
var timeoutLength = 600; // default value: 3000

/* ----- New ChoiceScript Commands ----- */
Scene.prototype.sm_save = function(line) {
    var stack = this.tokenizeExpr(line);
    if (stack.length > 2)
        throw new Error("sm_save: Invalid number of arguments, expected 0, 1 (save name) or 2 (id).");
    ChoiceScriptSavePlugin._save(new Date().getTime(), stack.length == 1 ? this.evaluateExpr(stack) : null);
}

Scene.prototype.sm_load = function(line) {
    var stack = this.tokenizeExpr(line);
    var variable = this.evaluateExpr(stack);
    //if (stack.length === 0)
    this.finished = true;
    this.skipFooter = true;
    this.screenEmpty = true;
    ChoiceScriptSavePlugin._load(variable);
}

Scene.prototype.sm_delete = function(line) {
    var stack = this.tokenizeExpr(line);
    if (stack.length != 1)
        throw new Error("sm_delete: Invalid number of arguments, expected 1.");
    ChoiceScriptSavePlugin._delete(this.evaluateExpr(stack));
}

Scene.prototype.sm_update = function() {
    if (typeof this.stats._sm_save_count === "undefined")
        this.stats._sm_save_count = 0;
    ChoiceScriptSavePlugin._getSaveList(function(saveList) {
        if (!saveList)
            return;
        ChoiceScriptSavePlugin._syncHelperVariables(saveList, function() {});
    });
}

Scene.prototype.sm_menu = function(data) {
    data = data || "";
    data = data.toLowerCase();
    var selectEle = document.getElementById("quickSaveMenu");
    if (!selectEle)
        return;
    var active = false;
    if (data === "false") {
        active = false;
    } else if (data === "true") {
        active = true;
    } else if (!data) { // toggle
        active = selectEle.style.display == "none";
    } else {
        throw new Error("*sm_menu: expected true, false (or nothing) as an argument!");
    }
    selectEle.style.display = active ? "inline" : "none";
    var btns = document.getElementsByClassName("savePluginBtn");
    for (var i = 0; i < btns.length; i++) {
        btns[i].style.display = active ? "inline" : "none";
    }
}

Scene.validCommands["sm_save"] = 1;
Scene.validCommands["sm_load"] = 1;
Scene.validCommands["sm_delete"] = 1;
Scene.validCommands["sm_update"] = 1;
Scene.validCommands["sm_menu"] = 1;

/* ----- FrameWork Functionality (Internal) ----- */

var ChoiceScriptSavePlugin = {}

ChoiceScriptSavePlugin._CSS =
    "#quickSaveMenu {\
        margin: 5px;\
        width: 100px;\
    }";

/* Saving once a page has finished loading causes a lot of problems.
   However, ChoiceScript already stores a working save at the top of every page,
   so we can just copy that save over to the specified slot. */
ChoiceScriptSavePlugin._save = function(saveId, saveName) {
    restoreObject(initStore(), "state", null, function(baseSave) {
        if (baseSave) {
            baseSave.stats["_smSaveName"] = saveName || "";
            baseSave.stats["_smSaveDateId"] = saveId;
            ChoiceScriptSavePlugin._addToSaveList(saveId, function(success) {
                if (!success)
                    return;
                saveCookie(function() {}, ChoiceScriptSavePlugin._formatSlotName(saveId), baseSave.stats, baseSave.temps, baseSave.lineNum, baseSave.indent, this.debugMode, this.nav);
                /* Attempt to re-populate the quick save menu.
                This might not actually exist when an sm_save is run,
                so we have to wait a few seconds. If it still doesn't exist
                it's not the end of the world, but the save won't appear until
                the next refresh. */
                setTimeout(function() {
                    var selectEle = document.getElementById("quickSaveMenu");
                    if (selectEle) {
                        selectEle.innerHTML = "";
                        ChoiceScriptSavePlugin._populateSaveMenu(selectEle);
                    }
                }, timeoutLength);
            });
        } else {
            /* ChoiceScript hasn't created a save we can use yet.
               This happens when we try to save right after the game
               starts (or a save has just been loaded).
            */
        }
    });
}

/* Utility function to grab a slots (near) full name:
     Save data is stored in the form:
        'state' + STORE_NAME + '_SAVE_' + dateId
    Where 'state' is something ChoiceScript uses internally,
    STORE_NAME is provided in the game's index.html,
    and dateId is the unique handle/key stored in the save list.

    Note that 'state' is not included here, as we use some internal
    CS functions that already add it. Instead we hard-code it in the
    few places we rely directly on the persist.js API.
*/
ChoiceScriptSavePlugin._formatSlotName = function(saveId){
    return (window.storeName + '_SAVE_' + saveId);
}

ChoiceScriptSavePlugin._load = function(saveId) {
    clearScreen(loadAndRestoreGame.bind(stats.scene, ChoiceScriptSavePlugin._formatSlotName(saveId)));
}

ChoiceScriptSavePlugin._delete = function(saveId) {
    ChoiceScriptSavePlugin._removeFromSaveList(saveId, function(success) {
        if (!success)
            return;
        var select = document.getElementById("quickSaveMenu");
        if (select) {
            var deletedOption = select.options[select.selectedIndex];
            if (deletedOption)
                deletedOption.parentElement.removeChild(deletedOption);
        }
        initStore().remove("state" + ChoiceScriptSavePlugin._formatSlotName(saveId), function(success, val) {
            // Likely there's nothing to delete
        });
    });
}

ChoiceScriptSavePlugin._delete_all = function () {
    ChoiceScriptSavePlugin._getSaveList(function(saveList) {
        if (!saveList)
            return;
        saveList.forEach(function(saveId) {
            ChoiceScriptSavePlugin._removeFromSaveList(saveId, function(success) {
                if (!success)
                    return;
                initStore().remove("state" + ChoiceScriptSavePlugin._formatSlotName(saveId), function(success, val) {
                    // Likely there's nothing to delete
                });
            });
        });
        setTimeout(function() {
            var selectEle = document.getElementById("quickSaveMenu");
            if (selectEle) {
                selectEle.innerHTML = "";
                ChoiceScriptSavePlugin._populateSaveMenu(selectEle);
            }
        }, timeoutLength);
    });
}

ChoiceScriptSavePlugin._export = function (exportName, saveId) {
    var saveItem = "";
    saveItem = saveItem + "PS" + window.storeName + "PSstate" + ChoiceScriptSavePlugin._formatSlotName(saveId) + ":\"";
    saveItem = saveItem + localStorage.getItem("PS" + window.storeName.replace(/_/g, "__") + "PSstate" + ChoiceScriptSavePlugin._formatSlotName(saveId).replace(/_/g, "__")) + "\"";
    var saveName = "Save";
    ChoiceScriptSavePlugin._getSaveData(saveId, function(saveData) {
        if (!saveData) {
            return;
        }
        if (saveData.stats._smSaveName !== "") {
            saveName = saveData.stats._smSaveName;
        }
    });
    var textFile = new Blob([saveItem], {type: "text/plain;charset=utf-8"});
    // create pseudo-hyperlink
    var exportLink = document.createElement("a");
    var textFileUrl = window.URL.createObjectURL(textFile);
    exportLink.setAttribute("id", "exportLink");
    exportLink.setAttribute("href", textFileUrl);
    exportLink.setAttribute("download", (exportName || (window.storeName + " - " + saveName)) + ".txt");
    exportLink.click();
    // remove hyperlink after use
    window.URL.revokeObjectURL(textFileUrl);
    if (document.getElementById("exportLink")) {
        document.getElementById("exportLink").remove();
    };
}

ChoiceScriptSavePlugin._export_all = function (exportName) {
    ChoiceScriptSavePlugin._getSaveList(function(saveList) {
        if (!saveList)
            return;
        var saveItem = "";
        saveList.forEach(function(saveId) {
            if ( saveItem !== "" ) { saveItem = saveItem + "\n"; };
            saveItem = saveItem + "PS" + window.storeName + "PSstate" + ChoiceScriptSavePlugin._formatSlotName(saveId) + ":\"";
            saveItem = saveItem + localStorage.getItem("PS" + window.storeName.replace(/_/g, "__") + "PSstate" + ChoiceScriptSavePlugin._formatSlotName(saveId).replace(/_/g, "__")) + "\"";
        });
        var textFile = new Blob([saveItem], {type: "text/plain;charset=utf-8"});
        // create pseudo-hyperlink
        var exportLink = document.createElement("a");
        var textFileUrl = window.URL.createObjectURL(textFile);
        exportLink.setAttribute("id", "exportLink");
        exportLink.setAttribute("href", textFileUrl);
        exportLink.setAttribute("download", (exportName || (window.storeName + " - Saves")) + ".txt");
        exportLink.click();
        // remove hyperlink after use
        window.URL.revokeObjectURL(textFileUrl);
        if (document.getElementById("exportLink")) {
            document.getElementById("exportLink").remove();
        };
    });
}

ChoiceScriptSavePlugin._import = function(textAreaValue) {
    if ( textAreaValue == "" ) {
        alertify.alert("Text area is empty!");
        return;
    }
    var saveLines = textAreaValue.split(/\r*\n/);
    saveLines = saveLines.filter( function (line) {
        return line !== (null || "");
    });
    var storeKey = "PS" + window.storeName.replace(/_/g, "__") + "PSstate";
    var storeKeyLength = storeKey.length;

    var errorCheck = "";
    for (i = 0; i < saveLines.length; i++) {
        if (saveLines[i].substring(0, storeKeyLength) !== storeKey) {
            errorCheck = "Save line " + (i + 1) + " error: Save key does not match this game's store key!";
            break;
        }
        else {
            var saveSlotName = saveLines[i].substring(storeKeyLength, saveLines[i].indexOf(":"));
            var saveSlotToken = saveLines[i].substring(saveLines[i].indexOf(":") + 2, saveLines[i].length - 1);
            saveSlotToken = saveSlotToken.replace(/^[^\{]*/, "");
            saveSlotToken = saveSlotToken.replace(/[^\}]*$/, "");
            var saveSlotState;
            try {
                saveSlotState = jsonParse(saveSlotToken);
            } catch (e) {
                errorCheck = "Save line " + (i + 1) + " error: Cannot parse save state!"
                break;
            }
            var saveId = saveSlotState.stats["_smSaveDateId"];
            ChoiceScriptSavePlugin._addToSaveList(saveId, function(success) {
                if (!success)
                    return;
                saveCookie(function() {}, saveSlotName, saveSlotState.stats, saveSlotState.temps, saveSlotState.lineNum, saveSlotState.indent, this.debugMode, this.nav);
            });
        }
    }
    if (errorCheck !== (null || "")) {
        alertify.error(errorCheck);
    }
    else {
        setTimeout(function() {
            var selectEle = document.getElementById("quickSaveMenu");
            if (selectEle) {
                selectEle.innerHTML = "";
                ChoiceScriptSavePlugin._populateSaveMenu(selectEle);
            }
        }, timeoutLength);
    }
}

ChoiceScriptSavePlugin._createQuickSaveMenu = function() {

    // var p = document.getElementById("restartButton").parentElement;
    var p = document.getElementById("buttons");
    if (!p) {
        alert("Error: unable to attach quick save menu");
        return;
    }

    // CSS
    var head = document.getElementsByTagName("head")[0];
    var style = document.createElement("style");
    style.innerHTML = ChoiceScriptSavePlugin._CSS;
    head.appendChild(style);

    // HTML
    var selectEle = document.createElement("select");
    selectEle.setAttribute("id", "quickSaveMenu");

    p.appendChild(selectEle);

    var buttonArr = [{
            "innerHTML": "New Save",
            "clickFunc": "ChoiceScriptSavePlugin.save();"
        },
        {
            "innerHTML": "Load",
            "clickFunc": "ChoiceScriptSavePlugin.load();"
        },
        {
            "innerHTML": "Delete",
            "clickFunc": "ChoiceScriptSavePlugin.delete();"
        }
    ];
    if (btn_delete_all) {
        buttonArr.push( {
            "innerHTML": "Delete All",
            "clickFunc": "ChoiceScriptSavePlugin.delete_all();"
        } );
    }
    if (btn_export) {
        buttonArr.push( {
            "innerHTML": "Export",
            "clickFunc": "ChoiceScriptSavePlugin.export();"
        } );
    }
    if (btn_export_all) {
        buttonArr.push( {
            "innerHTML": "Export All",
            "clickFunc": "ChoiceScriptSavePlugin.export_all();"
        } );
    }
    if (btn_import) {
        buttonArr.push( {
            "innerHTML": "Import",
            "clickFunc": "ChoiceScriptSavePlugin.import();"
        } );
    }

    for (var i = 0; i < buttonArr.length; i++) {
        var btn = document.createElement("button");
        btn.innerHTML = buttonArr[i].innerHTML;
        btn.setAttribute("class", "spacedLink savePluginBtn");
        btn.setAttribute("onclick", buttonArr[i].clickFunc);
        p.appendChild(btn);
    }

    return selectEle;
}

/* Add the 'option' elements to the given selection input */
ChoiceScriptSavePlugin._populateSaveMenu = function(selectEle) {
    ChoiceScriptSavePlugin._getSaveList(function(saveList) {
        if (!saveList)
            return;
        saveList.forEach(function(saveId) {
            /* Grab the save data, so we can give it a nice title via _saveName */
            ChoiceScriptSavePlugin._getSaveData(saveId, function(saveData) {
                if (!saveData) {
                    return;
                }
                var option = document.createElement("option");
                option.setAttribute("value", saveData.stats._smSaveDateId /* time/date */ );
                if (!saveData) {
                    option.innerHTML = "Failed to load save.";
                } else {
                    var slotDesc = saveData.stats.sceneName + '.txt (' + simpleDateTimeFormat(new Date(parseInt(saveData.stats._smSaveDateId))) + ')';
                    if (saveData.stats._smSaveName) {
                        slotDesc = saveData.stats._smSaveName + " &mdash; " + slotDesc;
                    }
                    option.innerHTML = slotDesc;
                }
                selectEle.appendChild(option);
            });
        });
    });
}

ChoiceScriptSavePlugin._getSaveData = function(saveId, callback) {
    restoreObject(initStore(), "state" + ChoiceScriptSavePlugin._formatSlotName(saveId), null, function(saveData) {
        if (saveData) {
            callback(saveData);
        } else {
            /* Something went wrong. */
            callback(null);
        }
    });
}

/* The save list is a space separated string of date identifiers, e.g.
        "1581976656199 1581976297095 1581976660752"
    We use this to keep a record of stored save keys/handles.
*/
ChoiceScriptSavePlugin._removeFromSaveList = function(saveId, callback) {
    ChoiceScriptSavePlugin._getSaveList(function(saveList) {
        if (!saveList)
            return;
        var index = saveList.indexOf(saveId.toString());
        if (index > -1)
            saveList.splice(index, 1);
        initStore().set("save_list", saveList.join(" "), function(success, val) {
            ChoiceScriptSavePlugin._syncHelperVariables(saveList, function() {
                callback(success);
            })
        });
    });
}

ChoiceScriptSavePlugin._addToSaveList = function(saveId, callback) {
    ChoiceScriptSavePlugin._getSaveList(function(saveList) {
        if (!saveList)
            return;
        saveList.push(saveId.toString());
        initStore().set("save_list", saveList.join(" "), function(success, val) {
            ChoiceScriptSavePlugin._syncHelperVariables(saveList, function() {
                callback(success);
            })
        });
    });
}

ChoiceScriptSavePlugin._syncHelperVariables = function(saveList, callback) {
    self.stats._sm_save_count = saveList.length;
    saveList.forEach(function(save, index) {
        ChoiceScriptSavePlugin._getSaveData(save, function(saveData) {
            if (saveData) {
                self.stats["_sm_save_id_" + index] = save;
                self.stats["_sm_save_name_" + index] = saveData.stats._smSaveName || "";
                self.stats["_sm_save_date_" + index] = simpleDateTimeFormat(new Date(parseInt(save)));
            }
        });
    });
    callback();
}

/* Pull the list of stored 'saves' from the store by store name */
ChoiceScriptSavePlugin._getSaveList = function(callback) {
    initStore().get("save_list", function(success, val) {
        if (!success)
            callback(null);
        if (!val)
            callback([]);
        else
            callback(saveList = val.split(" ").sort(function(a, b) {
                return b - a;
            }));
    });
}

ChoiceScriptSavePlugin._init = function() {
    // don't initialize until files have been uploaded (CS commit: 8092aedf17505bd5f9b46c76acf082b89d494a03)
    if (("file:" === window.location.protocol) &&
       (typeof window.uploadedFiles === "undefined" && typeof allScenes === "undefined")) {
        setTimeout(ChoiceScriptSavePlugin._init, timeoutLength);
        return;
    }
    if (!window.storeName) {
        // disallow sm_ commands as they depend on a store
        Scene.validCommands["sm_save"] = 0;
        Scene.validCommands["sm_load"] = 0;
        Scene.validCommands["sm_delete"] = 0;
        Scene.validCommands["sm_menu"] = 0;
        Scene.validCommands["sm_menu"] = 0;
        return alertify.error("Disabling ChoiceScript Save Plugin as there is no storeName detected. Please check your index.html.");
    }
    ChoiceScriptSavePlugin._populateSaveMenu(ChoiceScriptSavePlugin._createQuickSaveMenu());
}

/* ----- FrameWork Functionality (External) ----- */

ChoiceScriptSavePlugin.save = function() {
    if (stats.sceneName == "choicescript_stats") {
        alert("Error: Unable to save at this point.");
        return;
    }
    var date = new Date();
    var message = "What would you like to call this save?<br>Leaving this blank will result in a scene and date identifier.";

    alertify.prompt(message, function(e, saveName) {
        if (e) {
            ChoiceScriptSavePlugin._save(date.getTime(), saveName);
        } else {
            // user cancelled
        }
    }, /* default value */ );
}

ChoiceScriptSavePlugin.delete = function() {
    var select = document.getElementById("quickSaveMenu");
    if (select.value <= 0)
        return;
    var message = "Delete save '" + select.options[select.selectedIndex].text + '\'?<br>This cannot be undone!';
    alertify.confirm(message, function(result) {
        if (!result) {
            return;
        } else {
            ChoiceScriptSavePlugin._delete(parseInt(select.value));
        }
    });
}

ChoiceScriptSavePlugin.load = function() {
    var select = document.getElementById("quickSaveMenu");
    if (select.value <= 0)
        return;
    alertify.confirm("Are you sure you wish to load this save?<br>Current progress will be lost!", function(result) {
        if (!result) {
            return;
        } else {
            ChoiceScriptSavePlugin._load(select.value);
        }
    });
}

ChoiceScriptSavePlugin.delete_all = function () {
    var message = "Delete all saves?<br>This cannot be undone!";
    alertify.confirm(message, function (result) {
        if (!result) {
            return;
        } else {
            ChoiceScriptSavePlugin._delete_all();
        }
    });
}

ChoiceScriptSavePlugin.export = function () {
    if (!window.Blob) {
        alertify.alert("Unable to export saves on this browser!");
        return;
    }
    var select = document.getElementById("quickSaveMenu");
    if (select.value <= 0)
        return;
    var date = new Date();
    var message = "What would you like to call this export file?<br>Leaving this blank will result in a game and save name identifier.";

    alertify.prompt(message, function(e, exportName) {
        if (e) {
            ChoiceScriptSavePlugin._export(exportName, select.value);
        } else {
            // user cancelled
        }
    }, /* default value */ );
}

ChoiceScriptSavePlugin.export_all = function () {
    if (!window.Blob) {
        alertify.alert("Unable to export saves on this browser!");
        return;
    }
    var date = new Date();
    var message = "What would you like to call this export file?<br>Leaving this blank will result in a game identifier.";

    alertify.prompt(message, function(e, exportName) {
        if (e) {
            ChoiceScriptSavePlugin._export_all(exportName);
        } else {
            // user cancelled
        }
    }, /* default value */ );
}

ChoiceScriptSavePlugin.import = function () {
    var message = "Paste your exported save(s) into the text area below.";
    // create file input element
    var sample = "e.g. PS(game name)PSstate(slot name):''{(game stats)}''\nPS(game name)PSstate(slot name 2):\''{(game stats 2)}''\n...";
    message = message + "<br><br>" + "(For multiple saves, use separate lines for each save.)";
    message = message + "<br><br>" + "<textarea id=\"saveInput\" cols=40 rows=30 placeholder=\"" + sample + "\"></textarea>"

    alertify.confirm(message, function(result) {
        if (!result) {
            if (document.getElementById("saveInput")) {
                document.getElementById("saveInput").remove();
            };
            return;
        } else {
            ChoiceScriptSavePlugin._import(document.getElementById("saveInput").value);
            // remove file input element after use
            if (document.getElementById("saveInput")) {
                document.getElementById("saveInput").remove();
            };
        }
    });
}

// initialize after a small delay, so everything else can catch up.
setTimeout(ChoiceScriptSavePlugin._init, timeoutLength);
;
nav = new SceneNavigator(["startup"]);
stats = {};

</script><style>html {
  font: -apple-system-body; /* we'll override the font, but keep the size from iOS dynamic text sizing */
}

body {
  position: relative;
  max-width: 80ch;
  min-height: 100vh; /* keep iOS address bar from popping in and out */
  font-size: 100%;  /* reset for CWS */
  font-family: Georgia,"Times New Roman",serif;
  background-color: #F7F4F1;
  color: rgba(0, 0, 0, 0.85);
  margin: 1ch auto;
  padding: 0;
  -webkit-user-select: text; /* selectable text for Chrome app support */
  transition-property: background-color, color;
  transition-duration: 2s;
  -webkit-transition-property: background-color, color;
  -webkit-transition-duration: 2s;
}

a {
  /* colored underlined links for XULRunner support */
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}

#main {
	line-height: 1.5;
}

.container {
  position: absolute; /* so containers can overlap */
  left: 0;
  right: 0;
  margin: 0 1ch;
  animation-duration: 0.5s;
  -webkit-animation-duration: 0.5s;
  transition-property: opacity;
  transition-duration: 0.5s;
  transition-timing-function: ease-in;
  -webkit-transition-property: opacity;
  -webkit-transition-duration: 0.5s;
  -webkit-transition-timing-function: ease-in;
}

@keyframes containerslidein {
  from {
    transform: translateX(100%);
  }

  to {
    transform: none;
  }
}

@-webkit-keyframes containerslidein {
  from {
    -webkit-transform: translateX(100%);
  }

  to {
    -webkit-transform: none;
  }
}

.tempfocus:focus {
  outline: none;
}

#loading {
  position: fixed;
  bottom: 0;
  right: 0;
}

.frozen {
  overflow-x: hidden;
  pointer-events: none;
}

#text img {
  max-width: 100%;
}

/*credits*/
#main.container img {
  max-width: 100%;
}

.statBar {
  background-color: #949291;
  height: 2rem;
  line-height: 2rem;
  margin: 0.5ch 0;
  width: 20rem;
  max-width: 100%;
  color: #f7f4f1;
  position: relative; /* to allow absolute positioned value */
  z-index: 0;
}
.opposed {
  background-color: #6D6DFC;
}

table {
  margin-bottom: 1.5em;
}

.statText {
  margin-left: 2ex;
  text-indent: -1ex;
}

.statBar > span, .statLine > span {
  position: relative;
  z-index: 1; /* visible over stat value */
  white-space: nowrap; /* remain on single line so we can resize font based on width */
}
.statValue {
  background-color: #ff5955;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  z-index: -1;
  /* width will be determined at runtime, 0-100% */
}

.choice {
  margin: 1rem 0;
}

.choice > div {
  position: relative; /* so the .shuttle can be positioned absolutely within it */
  min-height: 1.25cm;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-color:#a9acaf;
  border-style:solid;
  border-width: 1px 1px 0px 1px;
}

.choice label{
    transition-property: background-color, color;
    transition-duration: 0.1s;
    -webkit-transition-property: background-color, color;
    -webkit-transition-duration: 0.1s;
    -webkit-tap-highlight-color: transparent;
    padding: 0.5em 1ch;
    display:block;
}

.shuttle {
  position: absolute;
  right: 0px;
  top: 0px;
  width: 20%;
  height: 100%;
  background-color: #626160; /* match next */
  opacity: 0.25;
  transition-property: opacity;
  transition-duration: 0.3s;
  -webkit-transition-property: opacity;
  -webkit-transition-duration: 0.3s;
}

.shuttle.discovery {
  width: 20%;
  animation-name: shuttlefadein, shuttleslide, shuttlefadeout;
  animation-duration: 0.75s, 1s, 1s;
  animation-delay: 0s, 0.75s, 1.75s;
  -webkit-animation-name: shuttlefadein, shuttleslide, shuttlefadeout;
  -webkit-animation-duration: 0.75s, 1s, 1s;
  -webkit-animation-delay: 0s, 0.75s, 1.75s;
}

@keyframes shuttlefadein {
  from {opacity: 0;}
  to {opacity: 0.25;}
}

@keyframes shuttlefadeout {
  from {opacity: 0.25; transform: translateX(-401%);} /* borders, maybe? */
  to {opacity: 0; transform: translateX(-401%);}
}

@keyframes shuttleslide {
  from { opacity: 0.25; transform: translateX(0);}
  to { opacity: 0.25; transform: translateX(-401%); }
}

@-webkit-keyframes shuttlefadein {
  from {opacity: 0;}
  to {opacity: 0.25;}
}

@-webkit-keyframes shuttlefadeout {
  from {opacity: 0.25; -webkit-transform: translateX(-401%);} /* borders, maybe? */
  to {opacity: 0; -webkit-transform: translateX(-401%);}
}

@-webkit-keyframes shuttleslide {
  from { opacity: 0.25; -webkit-transform: translateX(0);}
  to { opacity: 0.25; -webkit-transform: translateX(-401%); }
}

.selected {
  color: rgba(255,255,255,0.85);
  background-color: #007AFF;
}

.choice>div:first-child{
    border-top-width:1px;
    -webkit-border-top-right-radius:1ch;
    -webkit-border-top-left-radius:1ch;
    border-top-right-radius:1ch;
    border-top-left-radius:1ch;
}
/* IE doesn't support label:last-child */
.choice>div:last-child{
    border-bottom-width:1px;
    -webkit-border-bottom-right-radius:1ch;
    -webkit-border-bottom-left-radius:1ch;
    border-bottom-right-radius:1ch;
    border-bottom-left-radius:1ch;
}

.choice .noBorder {
  border-width: 0;
}

input[type="radio"], input[type="checkbox"] {
  margin-right: 1ch;
}

.saveGame>label {
  display:block;
}

.choice .disabled {
  color: gray;
}

input[type=password]:disabled {
  background-color: lightgray;
}

/* Reset for Firefox vs. Chrome */
input[type=email],input[type=password] {
  padding: 1px;
  margin: 2px 0;
}

button {
  font-size: 100%;
}

.next {
    clear: both;
    display:block;
    width:100%;
    font-size:1.5em;
    font-weight:bolder;
    font-family: -apple-system, sans-serif; /* reset, for Android */
    margin: 1rem 0; /* reset button margin */
    -webkit-appearance: none; /* Safari, don't override my CSS styles */
    color: #f7f4f1; /* Match background color */ 
    background-color: #626160;
    border: none;
    -webkit-border-radius: 0.5em;
    -moz-border-radius: 0.5em;
    border-radius: 0.5em;
    padding: 6px;
}

.linkButton {
  text-align: center;
  text-decoration: none;
}

.next:hover {
  color: #E4DED8;
}

h1 {
  font-size: 1.5em;
  font-weight: normal;
}

h2 {
  font-size: 1.125em;
  font-weight: normal;
}

#identity {
  float: right;
  display: none;
}

#identity > a {
  display: block;
  text-align: end;
}

#footer {
  margin:10px 0px 75px 0px;
}

#mobileLinks a img {
  border: 0;
}

.mobileBadges {
  margin: 0;
}

.spacedLink {
  margin-right:0.5em;
}

.spacedLink:last-child {
  margin-right:0;
}

#sharelist {
  margin: 0; /* Eliminate leading space before share links */
}

#sharelist li {
  line-height: 1cm; /* Don't let the links bunch up */
}

.alertify-cover {
  background-color: black;
  filter:alpha(opacity=50);
  opacity: 0.5;
}

#greybackground {
    position: fixed;
    width:100%;
    height:100%;
    background-color: black;
    filter:alpha(opacity=50);
    opacity: 0.5;
    top:0;
    left:0;
}

.savePassword {
  font-family: monospace;
  display: block;
}

.webOnly { /* We'll override this in JavaScript */
  display: none;
}

.alignleft {
  display: inline;
  float: left;
  margin-right: 1.625em;
  margin-bottom: 1.5em;
}
.alignright {
  display: inline;
  float: right;
  margin-left: 1.625em;
  margin-bottom: 1.5em;
}
.aligncenter {
  clear: both;
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 1.5em;
}

#main form {
  clear: both;
}

.paidOnly {
  display: none;
}

.videoWrapper {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 */
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

body.nightmode {
  background-color: #242424;
  color: rgba(255,255,255,0.85);
}

body.nightmode a {
  color: #7bc8fa;
}

body.nightmode .next {
  color: #242424; /* Match background color */
  background-color: #D9D9D9;
}

body.nightmode .shuttle {
  background-color: #D9D9D9;
}

body.nightmode .next:hover {
  color: #555;
}

body.nightmode .alertify {
  color: black;
}

body.nightmode a.alertify-button {
  color: white;
}

body.nightmode img.invert {
  -webkit-filter: invert(100%);
  filter: invert(100%);
}

body.whitemode {
  background-color: white;
}

body.whitemode .next {
  color: white; /* Match background color */
}

body.whitemode .next:hover {
  color: #ddd;
}

@media only screen and (max-width: 480px) {
  .definition{
    display: none;
  }
  
  #headerLinks {
    line-height: 2; /* For tapability */
  }

  .gameTitle {
    display: none;
  }

  #advertisement {
    margin: -8px;
  }
  
  .mobileBadges {
    float: none;
  }
  
  #header {
    margin-top: 30px;
  }

  /** Floating images should leave enough room for text */
  #text .alignleft, #text .alignright {
    max-width: 45%;
  }
  
}
.alertify-show,
.alertify-log {
	-webkit-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1); /* older webkit */
	-webkit-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	   -moz-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	    -ms-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	     -o-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	        transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275); /* easeOutBack */
}
.alertify-hide {
	-webkit-transition: all 250ms cubic-bezier(0.600, 0, 0.735, 0.045); /* older webkit */
	-webkit-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	   -moz-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	    -ms-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	     -o-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	        transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045); /* easeInBack */
}
.alertify-cover {
	position: fixed; z-index: 99999;
	top: 0; right: 0; bottom: 0; left: 0;
}
.alertify {
	position: fixed; z-index: 99999;
	top: 50px; left: 50%;
	width: 550px;
	margin-left: -275px;
}
	.alertify-hidden {
		top: -50px;
		visibility: hidden;
	}
.alertify-logs {
	position: fixed;
	z-index: 5000;
	bottom: 10px;
	right: 10px;
	width: 300px;
}
	.alertify-log {
		display: block;
		margin-top: 10px;
		position: relative;
		right: -300px;
	}
	.alertify-log-show {
		right: 0;
	}
	.alertify-dialog {
		padding: 25px;
	}
		.alertify-resetFocus {
			border: 0;
			clip: rect(0 0 0 0);
			height: 1px;
			margin: -1px;
			overflow: hidden;
			padding: 0;
			position: absolute;
			width: 1px;
		}
		.alertify-inner {
			text-align: center;
		}
		.alertify-text {
			margin-bottom: 15px;
			width: 100%;
			-webkit-box-sizing: border-box;
			   -moz-box-sizing: border-box;
			        box-sizing: border-box;
			font-size: 100%;
		}
		.alertify-buttons {
		}
			.alertify-button {
				/* line-height and font-size for input button */
				line-height: 1.5;
				font-size: 100%;
				display: inline-block;
				cursor: pointer;
				margin-left: 5px;
			}

@media only screen and (max-width: 680px) {
	.alertify,
	.alertify-logs {
		width: 90%;
		-webkit-box-sizing: border-box;
		   -moz-box-sizing: border-box;
		        box-sizing: border-box;
	}
	.alertify {
		left: 5%;
		margin: 0;
	}
}
/**
 * Default Look and Feel
 */
.alertify,
.alertify-log {
	font-family: sans-serif;
}
.alertify {
	background: #FFF;
	border: 10px solid #333; /* browsers that don't support rgba */
	border: 10px solid rgba(0,0,0,.7);
	border-radius: 8px;
	box-shadow: 0 3px 3px rgba(0,0,0,.3);
	-webkit-background-clip: padding;     /* Safari 4? Chrome 6? */
	   -moz-background-clip: padding;     /* Firefox 3.6 */
	        background-clip: padding-box; /* Firefox 4, Safari 5, Opera 10, IE 9 */
}
	.alertify-text {
		border: 1px solid #CCC;
		padding: 10px;
		border-radius: 4px;
	}
	.alertify-button {
		border-radius: 4px;
		color: #FFF;
		font-weight: bold;
		padding: 6px 15px;
		text-decoration: none;
		text-shadow: 1px 1px 0 rgba(0,0,0,.5);
		box-shadow: inset 0 1px 0 0 rgba(255,255,255,.5);
		background-image: -webkit-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:    -moz-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:     -ms-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:      -o-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:         linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
	}
	.alertify-button:hover,
	.alertify-button:focus {
		outline: none;
		box-shadow: 0 0 15px #2B72D5;
		background-image: -webkit-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:    -moz-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:     -ms-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:      -o-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:         linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
	}
	.alertify-button:active {
		position: relative;
		top: 1px;
	}
		.alertify-button-cancel {
			background-color: #FE1A00;
			border: 1px solid #D83526;
		}
		.alertify-button-ok {
			background-color: #5CB811;
			border: 1px solid #3B7808;
		}
		
.alertify-log {
	background: #1F1F1F;
	background: rgba(0,0,0,.9);
	padding: 15px;
	border-radius: 4px;
	color: #FFF;
	text-shadow: -1px -1px 0 rgba(0,0,0,.5);
}
	.alertify-log-error {
		background: #FE1A00;
		background: rgba(254,26,0,.9);
	}
	.alertify-log-success {
		background: #5CB811;
		background: rgba(92,184,17,.9);
	}</style></head>
<body><div class="container" id="container1">
<div id="advertisement">
</div>
<div id="header">
  <div id="identity"><a href="#" id="email">you@example.com</a><a href="#" id="logout">Sign Out</a></div>

  <h1 class='gameTitle'>TFS Book Two Alpha</h1>
<h2 id="author" class="gameTitle"><!--by INSERTINSERTINSERT --></h2>

  <p id="headerLinks">
      <!-- <a href="credits.html" id="aboutLink" class="spacedLink">About</a> -->
    </p>
  <p id="buttons">
    <button id="statsButton" class="spacedLink" onclick="showStats()">Show Stats</button>
    <button id="restartButton" class="spacedLink" onclick="restartGame('prompt')">Restart</button>
    <button id="achievementsButton" onclick="showAchievements()" class="spacedLink" style="display: none">Achievements</button>
    <button id="bugButton" onclick="reportBug()" class="spacedLink" style="display: none">Report Bug</button>
    <button id="menuButton" onclick="textOptionsMenu()" class="spacedLink">Settings</button>
  </p>
</div>
<div id="main">
<div id="text">
</div>
<script>
startLoading();
</script>
</div>
<div id="mobileLinks" class="webOnly">
</div>
<noscript>
<p>This game requires JavaScript; please enable JavaScript and refresh this page.</p>
</noscript>
<a id="makeyourowngames" href="https://www.choiceofgames.com/make-your-own-games/choicescript-intro/">Make your own games with ChoiceScript</a>
</body>
</html>
